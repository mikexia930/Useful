import{q as wt,bh as bt,d as Ot,t as Bt,U as It,s as Rt,o as lt,c as dt,v as _t,R as Xt,Z as Yt,aq as Dt,$ as tt,F as Ft,K as At,b as Pt,a4 as ct,x as Tt,S as st,a as yt,w as kt,g as Wt,av as Ut,y as St,a1 as zt}from"./index.1da778f9.js";import{U as Gt}from"./UIWithTitle.f8208f61.js";import{b as Nt,c as Ht,d as Vt,e as qt,U as Kt}from"./UICreateImport.vue_vue_type_script_setup_true_lang.e9d5def8.js";import{u as Jt}from"./PortImport.vue_vue_type_script_setup_true_lang.2fc96ef8.js";import{r as Et}from"./___vite-browser-external_commonjs-proxy.48040041.js";import{F as $t}from"./FileSaver.min.fb720c0d.js";import{_ as Mt}from"./_plugin-vue_export-helper.cdc0426e.js";import{u as Zt}from"./ModuleAutoSaveLib.0fb4c3e5.js";import"./Interface.adbaf245.js";import"./DButton.vue_vue_type_script_setup_true_lang.7d1596b6.js";import"./DTooltip.63413dc2.js";import"./_baseIsEqual.74295246.js";import"./ModuleCollapsetLib.78fb6d31.js";import"./routeLib.b1a3bf91.js";import"./findIndex.4ace8958.js";import"./hasIn.49cbec25.js";import"./memoize.9cfb9d7d.js";import"./index.5aa88714.js";import"./KeyCode.9e37adda.js";import"./pick.5cf82e83.js";import"./_flatRest.4c2f6287.js";import"./DSelect.vue_vue_type_script_setup_true_lang.5279f391.js";import"./styleChecker.0a18f775.js";import"./debounce.64b6b86f.js";import"./now.5c01924d.js";import"./trim.8795fa7a.js";import"./fileLib.ab21b4c9.js";import"./DSpin.61091bf0.js";import"./DResult.vue_vue_type_script_setup_true_lang.65015d34.js";import"./config.aa76b2c0.js";import"./randomLib.04c6c9cc.js";import"./stringify.15412eb9.js";const ft=wt({folders:[],item:{}}),xt=".wb",Qt={[bt.Config]:"whiteboard_config",[bt.Folder]:"whiteboard_folder",[bt.Content]:"whiteboard_content",[bt.Env]:"whiteboard_env"};function te(){return{content:{setting:{canvas:{width:0,height:0,bgColor:""},stroke:{size:0,color:""}},content:""},isSaved:0}}var ut={};(function(W){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var d=d||{version:"3.6.6"};if(W.fabric=d,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?d.document=document:d.document=document.implementation.createHTMLDocument(""),d.window=window;else{var $=Et,et=new $.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;d.document=et.document,d.jsdomImplForWrapper=Et.implForWrapper,d.nodeCanvas=Et.Canvas,d.window=et,DOMParser=d.window.DOMParser}d.isTouchSupported="ontouchstart"in d.window||"ontouchstart"in d.document||d.window&&d.window.navigator&&d.window.navigator.maxTouchPoints>0,d.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",d.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],d.DPI=96,d.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",d.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,d.reNonWord=/[ \n\.,;!\?\-]/,d.fontPaths={},d.iMatrix=[1,0,0,1,0,0],d.svgNS="http://www.w3.org/2000/svg",d.perfLimitSizeTotal=2097152,d.maxCacheSideLimit=4096,d.minCacheSideLimit=256,d.charWidthsCache={},d.textureSize=2048,d.disableStyleCopyPaste=!1,d.enableGLFiltering=!0,d.devicePixelRatio=d.window.devicePixelRatio||d.window.webkitDevicePixelRatio||d.window.mozDevicePixelRatio||1,d.browserShadowBlurConstant=1,d.arcToSegmentsCache={},d.boundsOfCurveCache={},d.cachesBoundsOfCurve=!0,d.forceGLPutImageData=!1,d.initFilterBackend=function(){if(d.enableGLFiltering&&d.isWebglSupported&&d.isWebglSupported(d.textureSize))return console.log("max texture size: "+d.maxTextureSize),new d.WebglFilterBackend({tileSize:d.textureSize});if(d.Canvas2dFilterBackend)return new d.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=d),function(){function u(t,a){if(!!this.__eventListeners[t]){var n=this.__eventListeners[t];a?n[n.indexOf(a)]=!1:d.util.array.fill(n,!1)}}function e(t,a){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var n in t)this.on(n,t[n]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(a);return this}function h(t,a){if(!this.__eventListeners)return this;if(arguments.length===0)for(t in this.__eventListeners)u.call(this,t);else if(arguments.length===1&&typeof arguments[0]=="object")for(var n in t)u.call(this,n,t[n]);else u.call(this,t,a);return this}function r(t,a){if(!this.__eventListeners)return this;var n=this.__eventListeners[t];if(!n)return this;for(var c=0,s=n.length;c<s;c++)n[c]&&n[c].call(this,a||{});return this.__eventListeners[t]=n.filter(function(i){return i!==!1}),this}d.Observable={observe:e,stopObserving:h,fire:r,on:e,off:h,trigger:r}}(),d.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var u=0,e=arguments.length;u<e;u++)this._onObjectAdded(arguments[u]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(u,e,h){var r=this._objects;return h?r[e]=u:r.splice(e,0,u),this._onObjectAdded&&this._onObjectAdded(u),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var u=this._objects,e,h=!1,r=0,t=arguments.length;r<t;r++)e=u.indexOf(arguments[r]),e!==-1&&(h=!0,u.splice(e,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[r]));return this.renderOnAddRemove&&h&&this.requestRenderAll(),this},forEachObject:function(u,e){for(var h=this.getObjects(),r=0,t=h.length;r<t;r++)u.call(e,h[r],r,h);return this},getObjects:function(u){return typeof u>"u"?this._objects.concat():this._objects.filter(function(e){return e.type===u})},item:function(u){return this._objects[u]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(u){return this._objects.indexOf(u)>-1},complexity:function(){return this._objects.reduce(function(u,e){return u+=e.complexity?e.complexity():0,u},0)}},d.CommonMethods={_setOptions:function(u){for(var e in u)this.set(e,u[e])},_initGradient:function(u,e){u&&u.colorStops&&!(u instanceof d.Gradient)&&this.set(e,new d.Gradient(u))},_initPattern:function(u,e,h){u&&u.source&&!(u instanceof d.Pattern)?this.set(e,new d.Pattern(u,h)):h&&h()},_initClipping:function(u){if(!(!u.clipTo||typeof u.clipTo!="string")){var e=d.util.getFunctionBody(u.clipTo);typeof e<"u"&&(this.clipTo=new Function("ctx",e))}},_setObject:function(u){for(var e in u)this._set(e,u[e])},set:function(u,e){return typeof u=="object"?this._setObject(u):typeof e=="function"&&u!=="clipTo"?this._set(u,e(this.get(u))):this._set(u,e),this},_set:function(u,e){this[u]=e},toggle:function(u){var e=this.get(u);return typeof e=="boolean"&&this.set(u,!e),this},get:function(u){return this[u]}},function(u){var e=Math.sqrt,h=Math.atan2,r=Math.pow,t=Math.PI/180,a=Math.PI/2;d.util={cos:function(n){if(n===0)return 1;n<0&&(n=-n);var c=n/a;switch(c){case 1:case 3:return 0;case 2:return-1}return Math.cos(n)},sin:function(n){if(n===0)return 0;var c=n/a,s=1;switch(n<0&&(s=-1),c){case 1:return s;case 2:return 0;case 3:return-s}return Math.sin(n)},removeFromArray:function(n,c){var s=n.indexOf(c);return s!==-1&&n.splice(s,1),n},getRandomInt:function(n,c){return Math.floor(Math.random()*(c-n+1))+n},degreesToRadians:function(n){return n*t},radiansToDegrees:function(n){return n/t},rotatePoint:function(n,c,s){n.subtractEquals(c);var i=d.util.rotateVector(n,s);return new d.Point(i.x,i.y).addEquals(c)},rotateVector:function(n,c){var s=d.util.sin(c),i=d.util.cos(c),o=n.x*i-n.y*s,l=n.x*s+n.y*i;return{x:o,y:l}},transformPoint:function(n,c,s){return s?new d.Point(c[0]*n.x+c[2]*n.y,c[1]*n.x+c[3]*n.y):new d.Point(c[0]*n.x+c[2]*n.y+c[4],c[1]*n.x+c[3]*n.y+c[5])},makeBoundingBoxFromPoints:function(n,c){if(c)for(var s=0;s<n.length;s++)n[s]=d.util.transformPoint(n[s],c);var i=[n[0].x,n[1].x,n[2].x,n[3].x],o=d.util.array.min(i),l=d.util.array.max(i),f=l-o,g=[n[0].y,n[1].y,n[2].y,n[3].y],m=d.util.array.min(g),v=d.util.array.max(g),p=v-m;return{left:o,top:m,width:f,height:p}},invertTransform:function(n){var c=1/(n[0]*n[3]-n[1]*n[2]),s=[c*n[3],-c*n[1],-c*n[2],c*n[0]],i=d.util.transformPoint({x:n[4],y:n[5]},s,!0);return s[4]=-i.x,s[5]=-i.y,s},toFixed:function(n,c){return parseFloat(Number(n).toFixed(c))},parseUnit:function(n,c){var s=/\D{0,2}$/.exec(n),i=parseFloat(n);switch(c||(c=d.Text.DEFAULT_SVG_FONT_SIZE),s[0]){case"mm":return i*d.DPI/25.4;case"cm":return i*d.DPI/2.54;case"in":return i*d.DPI;case"pt":return i*d.DPI/72;case"pc":return i*d.DPI/72*12;case"em":return i*c;default:return i}},falseFunction:function(){return!1},getKlass:function(n,c){return n=d.util.string.camelize(n.charAt(0).toUpperCase()+n.slice(1)),d.util.resolveNamespace(c)[n]},getSvgAttributes:function(n){var c=["instantiated_by_use","style","id","class"];switch(n){case"linearGradient":c=c.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":c=c.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":c=c.concat(["offset","stop-color","stop-opacity"]);break}return c},resolveNamespace:function(n){if(!n)return d;var c=n.split("."),s=c.length,i,o=u||d.window;for(i=0;i<s;++i)o=o[c[i]];return o},loadImage:function(n,c,s,i){if(!n){c&&c.call(s,n);return}var o=d.util.createImage(),l=function(){c&&c.call(s,o),o=o.onload=o.onerror=null};o.onload=l,o.onerror=function(){d.log("Error loading "+o.src),c&&c.call(s,null,!0),o=o.onload=o.onerror=null},n.indexOf("data")!==0&&i&&(o.crossOrigin=i),n.substring(0,14)==="data:image/svg"&&(o.onload=null,d.util.loadImageInDom(o,l)),o.src=n},loadImageInDom:function(n,c){var s=d.document.createElement("div");s.style.width=s.style.height="1px",s.style.left=s.style.top="-100%",s.style.position="absolute",s.appendChild(n),d.document.querySelector("body").appendChild(s),n.onload=function(){c(),s.parentNode.removeChild(s),s=null}},enlivenObjects:function(n,c,s,i){n=n||[];var o=[],l=0,f=n.length;function g(){++l===f&&c&&c(o.filter(function(m){return m}))}if(!f){c&&c(o);return}n.forEach(function(m,v){if(!m||!m.type){g();return}var p=d.util.getKlass(m.type,s);p.fromObject(m,function(_,C){C||(o[v]=_),i&&i(m,_,C),g()})})},enlivenPatterns:function(n,c){n=n||[];function s(){++o===l&&c&&c(i)}var i=[],o=0,l=n.length;if(!l){c&&c(i);return}n.forEach(function(f,g){f&&f.source?new d.Pattern(f,function(m){i[g]=m,s()}):(i[g]=f,s())})},groupSVGElements:function(n,c,s){var i;return n&&n.length===1?n[0]:(c&&(c.width&&c.height?c.centerPoint={x:c.width/2,y:c.height/2}:(delete c.width,delete c.height)),i=new d.Group(n,c),typeof s<"u"&&(i.sourcePath=s),i)},populateWithProperties:function(n,c,s){if(s&&Object.prototype.toString.call(s)==="[object Array]")for(var i=0,o=s.length;i<o;i++)s[i]in n&&(c[s[i]]=n[s[i]])},drawDashedLine:function(n,c,s,i,o,l){var f=i-c,g=o-s,m=e(f*f+g*g),v=h(g,f),p=l.length,_=0,C=!0;for(n.save(),n.translate(c,s),n.moveTo(0,0),n.rotate(v),c=0;m>c;)c+=l[_++%p],c>m&&(c=m),n[C?"lineTo":"moveTo"](c,0),C=!C;n.restore()},createCanvasElement:function(){return d.document.createElement("canvas")},copyCanvasElement:function(n){var c=d.util.createCanvasElement();return c.width=n.width,c.height=n.height,c.getContext("2d").drawImage(n,0,0),c},toDataURL:function(n,c,s){return n.toDataURL("image/"+c,s)},createImage:function(){return d.document.createElement("img")},clipContext:function(n,c){c.save(),c.beginPath(),n.clipTo(c),c.clip()},multiplyTransformMatrices:function(n,c,s){return[n[0]*c[0]+n[2]*c[1],n[1]*c[0]+n[3]*c[1],n[0]*c[2]+n[2]*c[3],n[1]*c[2]+n[3]*c[3],s?0:n[0]*c[4]+n[2]*c[5]+n[4],s?0:n[1]*c[4]+n[3]*c[5]+n[5]]},qrDecompose:function(n){var c=h(n[1],n[0]),s=r(n[0],2)+r(n[1],2),i=e(s),o=(n[0]*n[3]-n[2]*n[1])/i,l=h(n[0]*n[2]+n[1]*n[3],s);return{angle:c/t,scaleX:i,scaleY:o,skewX:l/t,skewY:0,translateX:n[4],translateY:n[5]}},calcRotateMatrix:function(n){if(!n.angle)return d.iMatrix.concat();var c=d.util.degreesToRadians(n.angle),s=d.util.cos(c),i=d.util.sin(c);return[s,i,-i,s,0,0]},calcDimensionsMatrix:function(n){var c=typeof n.scaleX>"u"?1:n.scaleX,s=typeof n.scaleY>"u"?1:n.scaleY,i=[n.flipX?-c:c,0,0,n.flipY?-s:s,0,0],o=d.util.multiplyTransformMatrices,l=d.util.degreesToRadians;return n.skewX&&(i=o(i,[1,0,Math.tan(l(n.skewX)),1],!0)),n.skewY&&(i=o(i,[1,Math.tan(l(n.skewY)),0,1],!0)),i},composeMatrix:function(n){var c=[1,0,0,1,n.translateX||0,n.translateY||0],s=d.util.multiplyTransformMatrices;return n.angle&&(c=s(c,d.util.calcRotateMatrix(n))),(n.scaleX||n.scaleY||n.skewX||n.skewY||n.flipX||n.flipY)&&(c=s(c,d.util.calcDimensionsMatrix(n))),c},customTransformMatrix:function(n,c,s){return d.util.composeMatrix({scaleX:n,scaleY:c,skewX:s})},resetObjectTransform:function(n){n.scaleX=1,n.scaleY=1,n.skewX=0,n.skewY=0,n.flipX=!1,n.flipY=!1,n.rotate(0)},saveObjectTransform:function(n){return{scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,angle:n.angle,left:n.left,flipX:n.flipX,flipY:n.flipY,top:n.top}},getFunctionBody:function(n){return(String(n).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(n,c,s,i){i>0&&(c>i?c-=i:c=0,s>i?s-=i:s=0);var o=!0,l,f,g=n.getImageData(c,s,i*2||1,i*2||1),m=g.data.length;for(l=3;l<m&&(f=g.data[l],o=f<=0,o!==!1);l+=4);return g=null,o},parsePreserveAspectRatioAttribute:function(n){var c="meet",s="Mid",i="Mid",o=n.split(" "),l;return o&&o.length&&(c=o.pop(),c!=="meet"&&c!=="slice"?(l=c,c="meet"):o.length&&(l=o.pop())),s=l!=="none"?l.slice(1,4):"none",i=l!=="none"?l.slice(5,8):"none",{meetOrSlice:c,alignX:s,alignY:i}},clearFabricFontCache:function(n){n=(n||"").toLowerCase(),n?d.charWidthsCache[n]&&delete d.charWidthsCache[n]:d.charWidthsCache={}},limitDimsByArea:function(n,c){var s=Math.sqrt(c*n),i=Math.floor(c/s);return{x:Math.floor(s),y:i}},capValue:function(n,c,s){return Math.max(n,Math.min(c,s))},findScaleToFit:function(n,c){return Math.min(c.width/n.width,c.height/n.height)},findScaleToCover:function(n,c){return Math.max(c.width/n.width,c.height/n.height)},matrixToSVG:function(n){return"matrix("+n.map(function(c){return d.util.toFixed(c,d.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"}}}(W),function(){var u=Array.prototype.join;function e(a,n,c,s,i,o,l){var f=u.call(arguments);if(d.arcToSegmentsCache[f])return d.arcToSegmentsCache[f];var g=Math.PI,m=l*g/180,v=d.util.sin(m),p=d.util.cos(m),_=0,C=0;c=Math.abs(c),s=Math.abs(s);var y=-p*a*.5-v*n*.5,S=-p*n*.5+v*a*.5,w=c*c,O=s*s,E=S*S,L=y*y,B=w*O-w*E-O*L,Y=0;if(B<0){var U=Math.sqrt(1-B/(w*O));c*=U,s*=U}else Y=(i===o?-1:1)*Math.sqrt(B/(w*E+O*L));var b=Y*c*S/s,P=-Y*s*y/c,k=p*b-v*P+a*.5,F=v*b+p*P+n*.5,z=r(1,0,(y-b)/c,(S-P)/s),x=r((y-b)/c,(S-P)/s,(-y-b)/c,(-S-P)/s);o===0&&x>0?x-=2*g:o===1&&x<0&&(x+=2*g);for(var T=Math.ceil(Math.abs(x/g*2)),D=[],A=x/T,I=8/3*Math.sin(A/4)*Math.sin(A/4)/Math.sin(A/2),j=z+A,R=0;R<T;R++)D[R]=h(z,j,p,v,c,s,k,F,I,_,C),_=D[R][4],C=D[R][5],z=j,j+=A;return d.arcToSegmentsCache[f]=D,D}function h(a,n,c,s,i,o,l,f,g,m,v){var p=d.util.cos(a),_=d.util.sin(a),C=d.util.cos(n),y=d.util.sin(n),S=c*i*C-s*o*y+l,w=s*i*C+c*o*y+f,O=m+g*(-c*i*_-s*o*p),E=v+g*(-s*i*_+c*o*p),L=S+g*(c*i*y+s*o*C),B=w+g*(s*i*y-c*o*C);return[O,E,L,B,S,w]}function r(a,n,c,s){var i=Math.atan2(n,a),o=Math.atan2(s,c);return o>=i?o-i:2*Math.PI-(i-o)}d.util.drawArc=function(a,n,c,s){for(var i=s[0],o=s[1],l=s[2],f=s[3],g=s[4],m=s[5],v=s[6],p=[[],[],[],[]],_=e(m-n,v-c,i,o,f,g,l),C=0,y=_.length;C<y;C++)p[C][0]=_[C][0]+n,p[C][1]=_[C][1]+c,p[C][2]=_[C][2]+n,p[C][3]=_[C][3]+c,p[C][4]=_[C][4]+n,p[C][5]=_[C][5]+c,a.bezierCurveTo.apply(a,p[C])},d.util.getBoundsOfArc=function(a,n,c,s,i,o,l,f,g){for(var m=0,v=0,p,_=[],C=e(f-a,g-n,c,s,o,l,i),y=0,S=C.length;y<S;y++)p=t(m,v,C[y][0],C[y][1],C[y][2],C[y][3],C[y][4],C[y][5]),_.push({x:p[0].x+a,y:p[0].y+n}),_.push({x:p[1].x+a,y:p[1].y+n}),m=C[y][4],v=C[y][5];return _};function t(a,n,c,s,i,o,l,f){var g;if(d.cachesBoundsOfCurve&&(g=u.call(arguments),d.boundsOfCurveCache[g]))return d.boundsOfCurveCache[g];var m=Math.sqrt,v=Math.min,p=Math.max,_=Math.abs,C=[],y=[[],[]],S,w,O,E,L,B,Y,U;w=6*a-12*c+6*i,S=-3*a+9*c-9*i+3*l,O=3*c-3*a;for(var b=0;b<2;++b){if(b>0&&(w=6*n-12*s+6*o,S=-3*n+9*s-9*o+3*f,O=3*s-3*n),_(S)<1e-12){if(_(w)<1e-12)continue;E=-O/w,0<E&&E<1&&C.push(E);continue}Y=w*w-4*O*S,!(Y<0)&&(U=m(Y),L=(-w+U)/(2*S),0<L&&L<1&&C.push(L),B=(-w-U)/(2*S),0<B&&B<1&&C.push(B))}for(var P,k,F=C.length,z=F,x;F--;)E=C[F],x=1-E,P=x*x*x*a+3*x*x*E*c+3*x*E*E*i+E*E*E*l,y[0][F]=P,k=x*x*x*n+3*x*x*E*s+3*x*E*E*o+E*E*E*f,y[1][F]=k;y[0][z]=a,y[1][z]=n,y[0][z+1]=l,y[1][z+1]=f;var T=[{x:v.apply(null,y[0]),y:v.apply(null,y[1])},{x:p.apply(null,y[0]),y:p.apply(null,y[1])}];return d.cachesBoundsOfCurve&&(d.boundsOfCurveCache[g]=T),T}d.util.getBoundsOfCurve=t}(),function(){var u=Array.prototype.slice;function e(n,c){for(var s=u.call(arguments,2),i=[],o=0,l=n.length;o<l;o++)i[o]=s.length?n[o][c].apply(n[o],s):n[o][c].call(n[o]);return i}function h(n,c){return a(n,c,function(s,i){return s>=i})}function r(n,c){return a(n,c,function(s,i){return s<i})}function t(n,c){for(var s=n.length;s--;)n[s]=c;return n}function a(n,c,s){if(!(!n||n.length===0)){var i=n.length-1,o=c?n[i][c]:n[i];if(c)for(;i--;)s(n[i][c],o)&&(o=n[i][c]);else for(;i--;)s(n[i],o)&&(o=n[i]);return o}}d.util.array={fill:t,invoke:e,min:r,max:h}}(),function(){function u(h,r,t){if(t)if(!d.isLikelyNode&&r instanceof Element)h=r;else if(r instanceof Array){h=[];for(var a=0,n=r.length;a<n;a++)h[a]=u({},r[a],t)}else if(r&&typeof r=="object")for(var c in r)c==="canvas"?h[c]=u({},r[c]):r.hasOwnProperty(c)&&(h[c]=u({},r[c],t));else h=r;else for(var c in r)h[c]=r[c];return h}function e(h,r){return u({},h,r)}d.util.object={extend:u,clone:e},d.util.object.extend(d.util,d.Observable)}(),function(){function u(a){return a.replace(/-+(.)?/g,function(n,c){return c?c.toUpperCase():""})}function e(a,n){return a.charAt(0).toUpperCase()+(n?a.slice(1):a.slice(1).toLowerCase())}function h(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function r(a){var n=0,c,s=[];for(n=0,c;n<a.length;n++)(c=t(a,n))!==!1&&s.push(c);return s}function t(a,n){var c=a.charCodeAt(n);if(isNaN(c))return"";if(c<55296||c>57343)return a.charAt(n);if(55296<=c&&c<=56319){if(a.length<=n+1)throw"High surrogate without following low surrogate";var s=a.charCodeAt(n+1);if(56320>s||s>57343)throw"High surrogate without following low surrogate";return a.charAt(n)+a.charAt(n+1)}if(n===0)throw"Low surrogate without preceding high surrogate";var i=a.charCodeAt(n-1);if(55296>i||i>56319)throw"Low surrogate without preceding high surrogate";return!1}d.util.string={camelize:u,capitalize:e,escapeXml:h,graphemeSplit:r}}(),function(){var u=Array.prototype.slice,e=function(){},h=function(){for(var c in{toString:1})if(c==="toString")return!1;return!0}(),r=function(c,s,i){for(var o in s)o in c.prototype&&typeof c.prototype[o]=="function"&&(s[o]+"").indexOf("callSuper")>-1?c.prototype[o]=function(l){return function(){var f=this.constructor.superclass;this.constructor.superclass=i;var g=s[l].apply(this,arguments);if(this.constructor.superclass=f,l!=="initialize")return g}}(o):c.prototype[o]=s[o],h&&(s.toString!==Object.prototype.toString&&(c.prototype.toString=s.toString),s.valueOf!==Object.prototype.valueOf&&(c.prototype.valueOf=s.valueOf))};function t(){}function a(c){for(var s=null,i=this;i.constructor.superclass;){var o=i.constructor.superclass.prototype[c];if(i[c]!==o){s=o;break}i=i.constructor.superclass.prototype}return s?arguments.length>1?s.apply(this,u.call(arguments,1)):s.call(this):console.log("tried to callSuper "+c+", method not found in prototype chain",this)}function n(){var c=null,s=u.call(arguments,0);typeof s[0]=="function"&&(c=s.shift());function i(){this.initialize.apply(this,arguments)}i.superclass=c,i.subclasses=[],c&&(t.prototype=c.prototype,i.prototype=new t,c.subclasses.push(i));for(var o=0,l=s.length;o<l;o++)r(i,s[o],c);return i.prototype.initialize||(i.prototype.initialize=e),i.prototype.constructor=i,i.prototype.callSuper=a,i}d.util.createClass=n}(),function(){var u=!!d.document.createElement("div").attachEvent;d.util.addListener=function(h,r,t,a){h&&h.addEventListener(r,t,u?!1:a)},d.util.removeListener=function(h,r,t,a){h&&h.removeEventListener(r,t,u?!1:a)};function e(h){var r=h.changedTouches;return r&&r[0]?r[0]:h}d.util.getPointer=function(h){var r=h.target,t=d.util.getScrollLeftTop(r),a=e(h);return{x:a.clientX+t.left,y:a.clientY+t.top}}}(),function(){function u(n,c){var s=n.style;if(!s)return n;if(typeof c=="string")return n.style.cssText+=";"+c,c.indexOf("opacity")>-1?a(n,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):n;for(var i in c)if(i==="opacity")a(n,c[i]);else{var o=i==="float"||i==="cssFloat"?typeof s.styleFloat>"u"?"cssFloat":"styleFloat":i;s[o]=c[i]}return n}var e=d.document.createElement("div"),h=typeof e.style.opacity=="string",r=typeof e.style.filter=="string",t=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,a=function(n){return n};h?a=function(n,c){return n.style.opacity=c,n}:r&&(a=function(n,c){var s=n.style;return n.currentStyle&&!n.currentStyle.hasLayout&&(s.zoom=1),t.test(s.filter)?(c=c>=.9999?"":"alpha(opacity="+c*100+")",s.filter=s.filter.replace(t,c)):s.filter+=" alpha(opacity="+c*100+")",n}),d.util.setStyle=u}(),function(){var u=Array.prototype.slice;function e(f){return typeof f=="string"?d.document.getElementById(f):f}var h,r=function(f){return u.call(f,0)};try{h=r(d.document.childNodes)instanceof Array}catch{}h||(r=function(f){for(var g=new Array(f.length),m=f.length;m--;)g[m]=f[m];return g});function t(f,g){var m=d.document.createElement(f);for(var v in g)v==="class"?m.className=g[v]:v==="for"?m.htmlFor=g[v]:m.setAttribute(v,g[v]);return m}function a(f,g){f&&(" "+f.className+" ").indexOf(" "+g+" ")===-1&&(f.className+=(f.className?" ":"")+g)}function n(f,g,m){return typeof g=="string"&&(g=t(g,m)),f.parentNode&&f.parentNode.replaceChild(g,f),g.appendChild(f),g}function c(f){for(var g=0,m=0,v=d.document.documentElement,p=d.document.body||{scrollLeft:0,scrollTop:0};f&&(f.parentNode||f.host)&&(f=f.parentNode||f.host,f===d.document?(g=p.scrollLeft||v.scrollLeft||0,m=p.scrollTop||v.scrollTop||0):(g+=f.scrollLeft||0,m+=f.scrollTop||0),!(f.nodeType===1&&f.style.position==="fixed")););return{left:g,top:m}}function s(f){var g,m=f&&f.ownerDocument,v={left:0,top:0},p={left:0,top:0},_,C={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!m)return p;for(var y in C)p[C[y]]+=parseInt(i(f,y),10)||0;return g=m.documentElement,typeof f.getBoundingClientRect<"u"&&(v=f.getBoundingClientRect()),_=c(f),{left:v.left+_.left-(g.clientLeft||0)+p.left,top:v.top+_.top-(g.clientTop||0)+p.top}}var i;d.document.defaultView&&d.document.defaultView.getComputedStyle?i=function(f,g){var m=d.document.defaultView.getComputedStyle(f,null);return m?m[g]:void 0}:i=function(f,g){var m=f.style[g];return!m&&f.currentStyle&&(m=f.currentStyle[g]),m},function(){var f=d.document.documentElement.style,g="userSelect"in f?"userSelect":"MozUserSelect"in f?"MozUserSelect":"WebkitUserSelect"in f?"WebkitUserSelect":"KhtmlUserSelect"in f?"KhtmlUserSelect":"";function m(p){return typeof p.onselectstart<"u"&&(p.onselectstart=d.util.falseFunction),g?p.style[g]="none":typeof p.unselectable=="string"&&(p.unselectable="on"),p}function v(p){return typeof p.onselectstart<"u"&&(p.onselectstart=null),g?p.style[g]="":typeof p.unselectable=="string"&&(p.unselectable=""),p}d.util.makeElementUnselectable=m,d.util.makeElementSelectable=v}(),function(){function f(g,m){var v=d.document.getElementsByTagName("head")[0],p=d.document.createElement("script"),_=!0;p.onload=p.onreadystatechange=function(C){if(_){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")return;_=!1,m(C||d.window.event),p=p.onload=p.onreadystatechange=null}},p.src=g,v.appendChild(p)}d.util.getScript=f}();function o(f){var g=d.jsdomImplForWrapper(f);return g._canvas||g._image}function l(f){if(!!d.isLikelyNode){var g=d.jsdomImplForWrapper(f);g&&(g._image=null,g._canvas=null,g._currentSrc=null,g._attributes=null,g._classList=null)}}d.util.getById=e,d.util.toArray=r,d.util.makeElement=t,d.util.addClass=a,d.util.wrapElement=n,d.util.getScrollLeftTop=c,d.util.getElementOffset=s,d.util.getElementStyle=i,d.util.getNodeCanvas=o,d.util.cleanUpJsdomNode=l}(),function(){function u(r,t){return r+(/\?/.test(r)?"&":"?")+t}function e(){}function h(r,t){t||(t={});var a=t.method?t.method.toUpperCase():"GET",n=t.onComplete||function(){},c=new d.window.XMLHttpRequest,s=t.body||t.parameters;return c.onreadystatechange=function(){c.readyState===4&&(n(c),c.onreadystatechange=e)},a==="GET"&&(s=null,typeof t.parameters=="string"&&(r=u(r,t.parameters))),c.open(a,r,!0),(a==="POST"||a==="PUT")&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(s),c}d.util.request=h}(),d.log=console.log,d.warn=console.warn,function(){function u(){return!1}function e(c,s,i,o){return-i*Math.cos(c/o*(Math.PI/2))+i+s}function h(c){a(function(s){c||(c={});var i=s||+new Date,o=c.duration||500,l=i+o,f,g=c.onChange||u,m=c.abort||u,v=c.onComplete||u,p=c.easing||e,_="startValue"in c?c.startValue:0,C="endValue"in c?c.endValue:100,y=c.byValue||C-_;c.onStart&&c.onStart(),function S(w){f=w||+new Date;var O=f>l?o:f-i,E=O/o,L=p(O,_,y,o),B=Math.abs((L-_)/y);if(m()){v(C,1,1);return}if(f>l){g(C,1,1),v(C,1,1);return}else g(L,B,E),a(S)}(i)})}var r=d.window.requestAnimationFrame||d.window.webkitRequestAnimationFrame||d.window.mozRequestAnimationFrame||d.window.oRequestAnimationFrame||d.window.msRequestAnimationFrame||function(c){return d.window.setTimeout(c,1e3/60)},t=d.window.cancelAnimationFrame||d.window.clearTimeout;function a(){return r.apply(d.window,arguments)}function n(){return t.apply(d.window,arguments)}d.util.animate=h,d.util.requestAnimFrame=a,d.util.cancelAnimFrame=n}(),function(){function u(h,r,t){var a="rgba("+parseInt(h[0]+t*(r[0]-h[0]),10)+","+parseInt(h[1]+t*(r[1]-h[1]),10)+","+parseInt(h[2]+t*(r[2]-h[2]),10);return a+=","+(h&&r?parseFloat(h[3]+t*(r[3]-h[3])):1),a+=")",a}function e(h,r,t,a){var n=new d.Color(h).getSource(),c=new d.Color(r).getSource();a=a||{},d.util.animate(d.util.object.extend(a,{duration:t||500,startValue:n,endValue:c,byValue:c,easing:function(s,i,o,l){var f=a.colorEasing?a.colorEasing(s,l):1-Math.cos(s/l*(Math.PI/2));return u(i,o,f)}}))}d.util.animateColor=e}(),function(){function u(b,P,k,F){return b<Math.abs(P)?(b=P,F=k/4):P===0&&b===0?F=k/(2*Math.PI)*Math.asin(1):F=k/(2*Math.PI)*Math.asin(P/b),{a:b,c:P,p:k,s:F}}function e(b,P,k){return b.a*Math.pow(2,10*(P-=1))*Math.sin((P*k-b.s)*(2*Math.PI)/b.p)}function h(b,P,k,F){return k*((b=b/F-1)*b*b+1)+P}function r(b,P,k,F){return b/=F/2,b<1?k/2*b*b*b+P:k/2*((b-=2)*b*b+2)+P}function t(b,P,k,F){return k*(b/=F)*b*b*b+P}function a(b,P,k,F){return-k*((b=b/F-1)*b*b*b-1)+P}function n(b,P,k,F){return b/=F/2,b<1?k/2*b*b*b*b+P:-k/2*((b-=2)*b*b*b-2)+P}function c(b,P,k,F){return k*(b/=F)*b*b*b*b+P}function s(b,P,k,F){return k*((b=b/F-1)*b*b*b*b+1)+P}function i(b,P,k,F){return b/=F/2,b<1?k/2*b*b*b*b*b+P:k/2*((b-=2)*b*b*b*b+2)+P}function o(b,P,k,F){return-k*Math.cos(b/F*(Math.PI/2))+k+P}function l(b,P,k,F){return k*Math.sin(b/F*(Math.PI/2))+P}function f(b,P,k,F){return-k/2*(Math.cos(Math.PI*b/F)-1)+P}function g(b,P,k,F){return b===0?P:k*Math.pow(2,10*(b/F-1))+P}function m(b,P,k,F){return b===F?P+k:k*(-Math.pow(2,-10*b/F)+1)+P}function v(b,P,k,F){return b===0?P:b===F?P+k:(b/=F/2,b<1?k/2*Math.pow(2,10*(b-1))+P:k/2*(-Math.pow(2,-10*--b)+2)+P)}function p(b,P,k,F){return-k*(Math.sqrt(1-(b/=F)*b)-1)+P}function _(b,P,k,F){return k*Math.sqrt(1-(b=b/F-1)*b)+P}function C(b,P,k,F){return b/=F/2,b<1?-k/2*(Math.sqrt(1-b*b)-1)+P:k/2*(Math.sqrt(1-(b-=2)*b)+1)+P}function y(b,P,k,F){var z=1.70158,x=0,T=k;if(b===0)return P;if(b/=F,b===1)return P+k;x||(x=F*.3);var D=u(T,k,x,z);return-e(D,b,F)+P}function S(b,P,k,F){var z=1.70158,x=0,T=k;if(b===0)return P;if(b/=F,b===1)return P+k;x||(x=F*.3);var D=u(T,k,x,z);return D.a*Math.pow(2,-10*b)*Math.sin((b*F-D.s)*(2*Math.PI)/D.p)+D.c+P}function w(b,P,k,F){var z=1.70158,x=0,T=k;if(b===0)return P;if(b/=F/2,b===2)return P+k;x||(x=F*(.3*1.5));var D=u(T,k,x,z);return b<1?-.5*e(D,b,F)+P:D.a*Math.pow(2,-10*(b-=1))*Math.sin((b*F-D.s)*(2*Math.PI)/D.p)*.5+D.c+P}function O(b,P,k,F,z){return z===void 0&&(z=1.70158),k*(b/=F)*b*((z+1)*b-z)+P}function E(b,P,k,F,z){return z===void 0&&(z=1.70158),k*((b=b/F-1)*b*((z+1)*b+z)+1)+P}function L(b,P,k,F,z){return z===void 0&&(z=1.70158),b/=F/2,b<1?k/2*(b*b*(((z*=1.525)+1)*b-z))+P:k/2*((b-=2)*b*(((z*=1.525)+1)*b+z)+2)+P}function B(b,P,k,F){return k-Y(F-b,0,k,F)+P}function Y(b,P,k,F){return(b/=F)<1/2.75?k*(7.5625*b*b)+P:b<2/2.75?k*(7.5625*(b-=1.5/2.75)*b+.75)+P:b<2.5/2.75?k*(7.5625*(b-=2.25/2.75)*b+.9375)+P:k*(7.5625*(b-=2.625/2.75)*b+.984375)+P}function U(b,P,k,F){return b<F/2?B(b*2,0,k,F)*.5+P:Y(b*2-F,0,k,F)*.5+k*.5+P}d.util.ease={easeInQuad:function(b,P,k,F){return k*(b/=F)*b+P},easeOutQuad:function(b,P,k,F){return-k*(b/=F)*(b-2)+P},easeInOutQuad:function(b,P,k,F){return b/=F/2,b<1?k/2*b*b+P:-k/2*(--b*(b-2)-1)+P},easeInCubic:function(b,P,k,F){return k*(b/=F)*b*b+P},easeOutCubic:h,easeInOutCubic:r,easeInQuart:t,easeOutQuart:a,easeInOutQuart:n,easeInQuint:c,easeOutQuint:s,easeInOutQuint:i,easeInSine:o,easeOutSine:l,easeInOutSine:f,easeInExpo:g,easeOutExpo:m,easeInOutExpo:v,easeInCirc:p,easeOutCirc:_,easeInOutCirc:C,easeInElastic:y,easeOutElastic:S,easeInOutElastic:w,easeInBack:O,easeOutBack:E,easeInOutBack:L,easeInBounce:B,easeOutBounce:Y,easeInOutBounce:U}}(),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,r=e.util.object.clone,t=e.util.toFixed,a=e.util.parseUnit,n=e.util.multiplyTransformMatrices,c=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],s=["symbol","image","marker","pattern","view","svg"],i=["pattern","defs","symbol","metadata","clipPath","mask","desc"],o=["symbol","g","a","svg","clipPath","defs"],l={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform"},f={stroke:"strokeOpacity",fill:"fillOpacity"},g="font-size",m="clip-path";e.svgValidTagNamesRegEx=_(c),e.svgViewBoxElementsRegEx=_(s),e.svgInvalidAncestorsRegEx=_(i),e.svgValidParentsRegEx=_(o),e.cssRules={},e.gradientDefs={},e.clipPaths={};function v(x){return x in l?l[x]:x}function p(x,T,D,A){var I=Object.prototype.toString.call(T)==="[object Array]",j;if((x==="fill"||x==="stroke")&&T==="none")T="";else if(x==="vector-effect")T=T==="non-scaling-stroke";else if(x==="strokeDashArray")T==="none"?T=null:T=T.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(x==="transformMatrix")D&&D.transformMatrix?T=n(D.transformMatrix,e.parseTransformAttribute(T)):T=e.parseTransformAttribute(T);else if(x==="visible")T=T!=="none"&&T!=="hidden",D&&D.visible===!1&&(T=!1);else if(x==="opacity")T=parseFloat(T),D&&typeof D.opacity<"u"&&(T*=D.opacity);else if(x==="textAnchor")T=T==="start"?"left":T==="end"?"right":"center";else if(x==="charSpacing")j=a(T,A)/A*1e3;else if(x==="paintFirst"){var R=T.indexOf("fill"),X=T.indexOf("stroke"),T="fill";(R>-1&&X>-1&&X<R||R===-1&&X>-1)&&(T="stroke")}else{if(x==="href"||x==="xlink:href")return T;j=I?T.map(a):a(T,A)}return!I&&isNaN(j)?T:j}function _(x){return new RegExp("^("+x.join("|")+")\\b","i")}function C(x){for(var T in f)if(!(typeof x[f[T]]>"u"||x[T]==="")){if(typeof x[T]>"u"){if(!e.Object.prototype[T])continue;x[T]=e.Object.prototype[T]}if(x[T].indexOf("url(")!==0){var D=new e.Color(x[T]);x[T]=D.setAlpha(t(D.getAlpha()*x[f[T]],2)).toRgba()}}return x}function y(x,T){var D,A=[],I,j,R;for(j=0,R=T.length;j<R;j++)D=T[j],I=x.getElementsByTagName(D),A=A.concat(Array.prototype.slice.call(I));return A}e.parseTransformAttribute=function(){function x(N,J){var nt=e.util.cos(J[0]),ht=e.util.sin(J[0]),pt=0,vt=0;J.length===3&&(pt=J[1],vt=J[2]),N[0]=nt,N[1]=ht,N[2]=-ht,N[3]=nt,N[4]=pt-(nt*pt-ht*vt),N[5]=vt-(ht*pt+nt*vt)}function T(N,J){var nt=J[0],ht=J.length===2?J[1]:J[0];N[0]=nt,N[3]=ht}function D(N,J,nt){N[nt]=Math.tan(e.util.degreesToRadians(J[0]))}function A(N,J){N[4]=J[0],J.length===2&&(N[5]=J[1])}var I=e.iMatrix,j=e.reNum,R="(?:\\s+,?\\s*|,\\s*)",X="(?:(skewX)\\s*\\(\\s*("+j+")\\s*\\))",G="(?:(skewY)\\s*\\(\\s*("+j+")\\s*\\))",H="(?:(rotate)\\s*\\(\\s*("+j+")(?:"+R+"("+j+")"+R+"("+j+"))?\\s*\\))",it="(?:(scale)\\s*\\(\\s*("+j+")(?:"+R+"("+j+"))?\\s*\\))",q="(?:(translate)\\s*\\(\\s*("+j+")(?:"+R+"("+j+"))?\\s*\\))",K="(?:(matrix)\\s*\\(\\s*("+j+")"+R+"("+j+")"+R+"("+j+")"+R+"("+j+")"+R+"("+j+")"+R+"("+j+")\\s*\\))",Z="(?:"+K+"|"+q+"|"+it+"|"+H+"|"+X+"|"+G+")",Q="(?:"+Z+"(?:"+R+"*"+Z+")*)",at="^\\s*(?:"+Q+"?)\\s*$",gt=new RegExp(at),Ct=new RegExp(Z,"g");return function(N){var J=I.concat(),nt=[];if(!N||N&&!gt.test(N))return J;N.replace(Ct,function(pt){var vt=new RegExp(Z).exec(pt).filter(function(Lt){return!!Lt}),jt=vt[1],mt=vt.slice(2).map(parseFloat);switch(jt){case"translate":A(J,mt);break;case"rotate":mt[0]=e.util.degreesToRadians(mt[0]),x(J,mt);break;case"scale":T(J,mt);break;case"skewX":D(J,mt,2);break;case"skewY":D(J,mt,1);break;case"matrix":J=mt;break}nt.push(J.concat()),J=I.concat()});for(var ht=nt[0];nt.length>1;)nt.shift(),ht=e.util.multiplyTransformMatrices(ht,nt[0]);return ht}}();function S(x,T){var D,A;x.replace(/;\s*$/,"").split(";").forEach(function(I){var j=I.split(":");D=j[0].trim().toLowerCase(),A=j[1].trim(),T[D]=A})}function w(x,T){var D,A;for(var I in x)typeof x[I]>"u"||(D=I.toLowerCase(),A=x[I],T[D]=A)}function O(x,T){var D={};for(var A in e.cssRules[T])if(E(x,A.split(" ")))for(var I in e.cssRules[T][A])D[I]=e.cssRules[T][A][I];return D}function E(x,T){var D,A=!0;return D=B(x,T.pop()),D&&T.length&&(A=L(x,T)),D&&A&&T.length===0}function L(x,T){for(var D,A=!0;x.parentNode&&x.parentNode.nodeType===1&&T.length;)A&&(D=T.pop()),x=x.parentNode,A=B(x,D);return T.length===0}function B(x,T){var D=x.nodeName,A=x.getAttribute("class"),I=x.getAttribute("id"),j,R;if(j=new RegExp("^"+D,"i"),T=T.replace(j,""),I&&T.length&&(j=new RegExp("#"+I+"(?![a-zA-Z\\-]+)","i"),T=T.replace(j,"")),A&&T.length)for(A=A.split(" "),R=A.length;R--;)j=new RegExp("\\."+A[R]+"(?![a-zA-Z\\-]+)","i"),T=T.replace(j,"");return T.length===0}function Y(x,T){var D;if(x.getElementById&&(D=x.getElementById(T)),D)return D;var A,I,j,R=x.getElementsByTagName("*");for(I=0,j=R.length;I<j;I++)if(A=R[I],T===A.getAttribute("id"))return A}function U(x){for(var T=y(x,["use","svg:use"]),D=0;T.length&&D<T.length;){var A=T[D],I=(A.getAttribute("xlink:href")||A.getAttribute("href")).substr(1),j=A.getAttribute("x")||0,R=A.getAttribute("y")||0,X=Y(x,I).cloneNode(!0),G=(X.getAttribute("transform")||"")+" translate("+j+", "+R+")",H,it=T.length,q,K,Z,Q,at=e.svgNS;if(P(X),/^svg$/i.test(X.nodeName)){var gt=X.ownerDocument.createElementNS(at,"g");for(K=0,Z=X.attributes,Q=Z.length;K<Q;K++)q=Z.item(K),gt.setAttributeNS(at,q.nodeName,q.nodeValue);for(;X.firstChild;)gt.appendChild(X.firstChild);X=gt}for(K=0,Z=A.attributes,Q=Z.length;K<Q;K++)q=Z.item(K),!(q.nodeName==="x"||q.nodeName==="y"||q.nodeName==="xlink:href"||q.nodeName==="href")&&(q.nodeName==="transform"?G=q.nodeValue+" "+G:X.setAttribute(q.nodeName,q.nodeValue));X.setAttribute("transform",G),X.setAttribute("instantiated_by_use","1"),X.removeAttribute("id"),H=A.parentNode,H.replaceChild(X,A),T.length===it&&D++}}var b=new RegExp("^\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*$");function P(x){var T=x.getAttribute("viewBox"),D=1,A=1,I=0,j=0,R,X,G,H,it=x.getAttribute("width"),q=x.getAttribute("height"),K=x.getAttribute("x")||0,Z=x.getAttribute("y")||0,Q=x.getAttribute("preserveAspectRatio")||"",at=!T||!e.svgViewBoxElementsRegEx.test(x.nodeName)||!(T=T.match(b)),gt=!it||!q||it==="100%"||q==="100%",Ct=at&&gt,N={},J="",nt=0,ht=0;if(N.width=0,N.height=0,N.toBeParsed=Ct,Ct)return N;if(at)return N.width=a(it),N.height=a(q),N;if(I=-parseFloat(T[1]),j=-parseFloat(T[2]),R=parseFloat(T[3]),X=parseFloat(T[4]),N.minX=I,N.minY=j,N.viewBoxWidth=R,N.viewBoxHeight=X,gt?(N.width=R,N.height=X):(N.width=a(it),N.height=a(q),D=N.width/R,A=N.height/X),Q=e.util.parsePreserveAspectRatioAttribute(Q),Q.alignX!=="none"&&(Q.meetOrSlice==="meet"&&(A=D=D>A?A:D),Q.meetOrSlice==="slice"&&(A=D=D>A?D:A),nt=N.width-R*D,ht=N.height-X*D,Q.alignX==="Mid"&&(nt/=2),Q.alignY==="Mid"&&(ht/=2),Q.alignX==="Min"&&(nt=0),Q.alignY==="Min"&&(ht=0)),D===1&&A===1&&I===0&&j===0&&K===0&&Z===0)return N;if((K||Z)&&(J=" translate("+a(K)+" "+a(Z)+") "),G=J+" matrix("+D+" 0 0 "+A+" "+(I*D+nt)+" "+(j*A+ht)+") ",N.viewboxTransform=e.parseTransformAttribute(G),x.nodeName==="svg"){for(H=x.ownerDocument.createElementNS(e.svgNS,"g");x.firstChild;)H.appendChild(x.firstChild);x.appendChild(H)}else H=x,G=H.getAttribute("transform")+G;return H.setAttribute("transform",G),N}function k(x,T){for(;x&&(x=x.parentNode);)if(x.nodeName&&T.test(x.nodeName.replace("svg:",""))&&!x.getAttribute("instantiated_by_use"))return!0;return!1}e.parseSVGDocument=function(x,T,D,A){if(!!x){U(x);var I=e.Object.__uid++,j,R,X=P(x),G=e.util.toArray(x.getElementsByTagName("*"));if(X.crossOrigin=A&&A.crossOrigin,X.svgUid=I,G.length===0&&e.isLikelyNode){G=x.selectNodes('//*[name(.)!="svg"]');var H=[];for(j=0,R=G.length;j<R;j++)H[j]=G[j];G=H}var it=G.filter(function(K){return P(K),e.svgValidTagNamesRegEx.test(K.nodeName.replace("svg:",""))&&!k(K,e.svgInvalidAncestorsRegEx)});if(!it||it&&!it.length){T&&T([],{});return}var q={};G.filter(function(K){return K.nodeName.replace("svg:","")==="clipPath"}).forEach(function(K){var Z=K.getAttribute("id");q[Z]=e.util.toArray(K.getElementsByTagName("*")).filter(function(Q){return e.svgValidTagNamesRegEx.test(Q.nodeName.replace("svg:",""))})}),e.gradientDefs[I]=e.getGradientDefs(x),e.cssRules[I]=e.getCSSRules(x),e.clipPaths[I]=q,e.parseElements(it,function(K,Z){T&&(T(K,X,Z,G),delete e.gradientDefs[I],delete e.cssRules[I],delete e.clipPaths[I])},r(X),D,A)}};function F(x,T){var D=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],A="xlink:href",I=T.getAttribute(A).substr(1),j=Y(x,I);if(j&&j.getAttribute(A)&&F(x,j),D.forEach(function(X){j&&!T.hasAttribute(X)&&j.hasAttribute(X)&&T.setAttribute(X,j.getAttribute(X))}),!T.children.length)for(var R=j.cloneNode(!0);R.firstChild;)T.appendChild(R.firstChild);T.removeAttribute(A)}var z=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+e.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+e.reNum+"))?\\s+(.*)");h(e,{parseFontDeclaration:function(x,T){var D=x.match(z);if(!!D){var A=D[1],I=D[3],j=D[4],R=D[5],X=D[6];A&&(T.fontStyle=A),I&&(T.fontWeight=isNaN(parseFloat(I))?I:parseFloat(I)),j&&(T.fontSize=a(j)),X&&(T.fontFamily=X),R&&(T.lineHeight=R==="normal"?1:R)}},getGradientDefs:function(x){var T=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],D=y(x,T),A,I=0,j={};for(I=D.length;I--;)A=D[I],A.getAttribute("xlink:href")&&F(x,A),j[A.getAttribute("id")]=A;return j},parseAttributes:function(x,T,D){if(!!x){var A,I={},j,R;typeof D>"u"&&(D=x.getAttribute("svgUid")),x.parentNode&&e.svgValidParentsRegEx.test(x.parentNode.nodeName)&&(I=e.parseAttributes(x.parentNode,T,D));var X=T.reduce(function(Q,at){return A=x.getAttribute(at),A&&(Q[at]=A),Q},{}),G=h(O(x,D),e.parseStyleAttribute(x));X=h(X,G),G[m]&&x.setAttribute(m,G[m]),j=R=I.fontSize||e.Text.DEFAULT_SVG_FONT_SIZE,X[g]&&(X[g]=j=a(X[g],R));var H,it,q={};for(var K in X)H=v(K),it=p(H,X[K],I,j),q[H]=it;q&&q.font&&e.parseFontDeclaration(q.font,q);var Z=h(I,q);return e.svgValidParentsRegEx.test(x.nodeName)?Z:C(Z)}},parseElements:function(x,T,D,A,I){new e.ElementsParser(x,T,D,A,I).parse()},parseStyleAttribute:function(x){var T={},D=x.getAttribute("style");return D&&(typeof D=="string"?S(D,T):w(D,T)),T},parsePointsAttribute:function(x){if(!x)return null;x=x.replace(/,/g," ").trim(),x=x.split(/\s+/);var T=[],D,A;for(D=0,A=x.length;D<A;D+=2)T.push({x:parseFloat(x[D]),y:parseFloat(x[D+1])});return T},getCSSRules:function(x){var T=x.getElementsByTagName("style"),D,A,I={},j;for(D=0,A=T.length;D<A;D++){var R=T[D].textContent||"";R=R.replace(/\/\*[\s\S]*?\*\//g,""),R.trim()!==""&&(j=R.match(/[^{]*\{[\s\S]*?\}/g),j=j.map(function(X){return X.trim()}),j.forEach(function(X){var G=X.match(/([\s\S]*?)\s*\{([^}]*)\}/),H={},it=G[2].trim(),q=it.replace(/;$/,"").split(/\s*;\s*/);for(D=0,A=q.length;D<A;D++){var K=q[D].split(/\s*:\s*/),Z=K[0],Q=K[1];H[Z]=Q}X=G[1],X.split(",").forEach(function(at){at=at.replace(/^svg/i,"").trim(),at!==""&&(I[at]?e.util.object.extend(I[at],H):I[at]=e.util.object.clone(H))})}))}return I},loadSVGFromURL:function(x,T,D,A){x=x.replace(/^\n\s*/,"").trim(),new e.util.request(x,{method:"get",onComplete:I});function I(j){var R=j.responseXML;if(R&&!R.documentElement&&e.window.ActiveXObject&&j.responseText&&(R=new ActiveXObject("Microsoft.XMLDOM"),R.async="false",R.loadXML(j.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),!R||!R.documentElement)return T&&T(null),!1;e.parseSVGDocument(R.documentElement,function(X,G,H,it){T&&T(X,G,H,it)},D,A)}},loadSVGFromString:function(x,T,D,A){x=x.trim();var I;if(typeof e.window.DOMParser<"u"){var j=new e.window.DOMParser;j&&j.parseFromString&&(I=j.parseFromString(x,"text/xml"))}else e.window.ActiveXObject&&(I=new ActiveXObject("Microsoft.XMLDOM"),I.async="false",I.loadXML(x.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));e.parseSVGDocument(I.documentElement,function(R,X,G,H){T(R,X,G,H)},D,A)}})}(W),d.ElementsParser=function(u,e,h,r,t,a){this.elements=u,this.callback=e,this.options=h,this.reviver=r,this.svgUid=h&&h.svgUid||0,this.parsingOptions=t,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=a},function(u){u.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},u.createObjects=function(){var e=this;this.elements.forEach(function(h,r){h.setAttribute("svgUid",e.svgUid),e.createObject(h,r)})},u.findTag=function(e){return d[d.util.string.capitalize(e.tagName.replace("svg:",""))]},u.createObject=function(e,h){var r=this.findTag(e);if(r&&r.fromElement)try{r.fromElement(e,this.createCallback(h,e),this.options)}catch(t){d.log(t)}else this.checkIfDone()},u.createCallback=function(e,h){var r=this;return function(t){var a;r.resolveGradient(t,h,"fill"),r.resolveGradient(t,h,"stroke"),t instanceof d.Image&&t._originalElement&&(a=t.parsePreserveAspectRatioAttribute(h)),t._removeTransformMatrix(a),r.resolveClipPath(t,h),r.reviver&&r.reviver(h,t),r.instances[e]=t,r.checkIfDone()}},u.extractPropertyDefinition=function(e,h,r){var t=e[h],a=this.regexUrl;if(!!a.test(t)){a.lastIndex=0;var n=a.exec(t)[1];return a.lastIndex=0,d[r][this.svgUid][n]}},u.resolveGradient=function(e,h,r){var t=this.extractPropertyDefinition(e,r,"gradientDefs");if(t){var a=h.getAttribute(r+"-opacity"),n=d.Gradient.fromElement(t,e,a,this.options);e.set(r,n)}},u.createClipPathCallback=function(e,h){return function(r){r._removeTransformMatrix(),r.fillRule=r.clipRule,h.push(r)}},u.resolveClipPath=function(e,h){var r=this.extractPropertyDefinition(e,"clipPath","clipPaths"),t,a,n,c,s,i;if(r){c=[],n=d.util.invertTransform(e.calcTransformMatrix());for(var o=r[0].parentNode,l=h;l.parentNode&&l.getAttribute("clip-path")!==e.clipPath;)l=l.parentNode;l.parentNode.appendChild(o);for(var f=0;f<r.length;f++)t=r[f],a=this.findTag(t),a.fromElement(t,this.createClipPathCallback(e,c),this.options);c.length===1?r=c[0]:r=new d.Group(c),s=d.util.multiplyTransformMatrices(n,r.calcTransformMatrix()),r.clipPath&&this.resolveClipPath(r,l);var i=d.util.qrDecompose(s);r.flipX=!1,r.flipY=!1,r.set("scaleX",i.scaleX),r.set("scaleY",i.scaleY),r.angle=i.angle,r.skewX=i.skewX,r.skewY=0,r.setPositionByOrigin({x:i.translateX,y:i.translateY},"center","center"),e.clipPath=r}else delete e.clipPath},u.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(e){return e!=null}),this.callback(this.instances,this.elements))}}(d.ElementsParser.prototype),function(u){var e=u.fabric||(u.fabric={});if(e.Point){e.warn("fabric.Point is already defined");return}e.Point=h;function h(r,t){this.x=r,this.y=t}h.prototype={type:"point",constructor:h,add:function(r){return new h(this.x+r.x,this.y+r.y)},addEquals:function(r){return this.x+=r.x,this.y+=r.y,this},scalarAdd:function(r){return new h(this.x+r,this.y+r)},scalarAddEquals:function(r){return this.x+=r,this.y+=r,this},subtract:function(r){return new h(this.x-r.x,this.y-r.y)},subtractEquals:function(r){return this.x-=r.x,this.y-=r.y,this},scalarSubtract:function(r){return new h(this.x-r,this.y-r)},scalarSubtractEquals:function(r){return this.x-=r,this.y-=r,this},multiply:function(r){return new h(this.x*r,this.y*r)},multiplyEquals:function(r){return this.x*=r,this.y*=r,this},divide:function(r){return new h(this.x/r,this.y/r)},divideEquals:function(r){return this.x/=r,this.y/=r,this},eq:function(r){return this.x===r.x&&this.y===r.y},lt:function(r){return this.x<r.x&&this.y<r.y},lte:function(r){return this.x<=r.x&&this.y<=r.y},gt:function(r){return this.x>r.x&&this.y>r.y},gte:function(r){return this.x>=r.x&&this.y>=r.y},lerp:function(r,t){return typeof t>"u"&&(t=.5),t=Math.max(Math.min(1,t),0),new h(this.x+(r.x-this.x)*t,this.y+(r.y-this.y)*t)},distanceFrom:function(r){var t=this.x-r.x,a=this.y-r.y;return Math.sqrt(t*t+a*a)},midPointFrom:function(r){return this.lerp(r)},min:function(r){return new h(Math.min(this.x,r.x),Math.min(this.y,r.y))},max:function(r){return new h(Math.max(this.x,r.x),Math.max(this.y,r.y))},toString:function(){return this.x+","+this.y},setXY:function(r,t){return this.x=r,this.y=t,this},setX:function(r){return this.x=r,this},setY:function(r){return this.y=r,this},setFromPoint:function(r){return this.x=r.x,this.y=r.y,this},swap:function(r){var t=this.x,a=this.y;this.x=r.x,this.y=r.y,r.x=t,r.y=a},clone:function(){return new h(this.x,this.y)}}}(W),function(u){var e=u.fabric||(u.fabric={});if(e.Intersection){e.warn("fabric.Intersection is already defined");return}function h(r){this.status=r,this.points=[]}e.Intersection=h,e.Intersection.prototype={constructor:h,appendPoint:function(r){return this.points.push(r),this},appendPoints:function(r){return this.points=this.points.concat(r),this}},e.Intersection.intersectLineLine=function(r,t,a,n){var c,s=(n.x-a.x)*(r.y-a.y)-(n.y-a.y)*(r.x-a.x),i=(t.x-r.x)*(r.y-a.y)-(t.y-r.y)*(r.x-a.x),o=(n.y-a.y)*(t.x-r.x)-(n.x-a.x)*(t.y-r.y);if(o!==0){var l=s/o,f=i/o;0<=l&&l<=1&&0<=f&&f<=1?(c=new h("Intersection"),c.appendPoint(new e.Point(r.x+l*(t.x-r.x),r.y+l*(t.y-r.y)))):c=new h}else s===0||i===0?c=new h("Coincident"):c=new h("Parallel");return c},e.Intersection.intersectLinePolygon=function(r,t,a){var n=new h,c=a.length,s,i,o,l;for(l=0;l<c;l++)s=a[l],i=a[(l+1)%c],o=h.intersectLineLine(r,t,s,i),n.appendPoints(o.points);return n.points.length>0&&(n.status="Intersection"),n},e.Intersection.intersectPolygonPolygon=function(r,t){var a=new h,n=r.length,c;for(c=0;c<n;c++){var s=r[c],i=r[(c+1)%n],o=h.intersectLinePolygon(s,i,t);a.appendPoints(o.points)}return a.points.length>0&&(a.status="Intersection"),a},e.Intersection.intersectPolygonRectangle=function(r,t,a){var n=t.min(a),c=t.max(a),s=new e.Point(c.x,n.y),i=new e.Point(n.x,c.y),o=h.intersectLinePolygon(n,s,r),l=h.intersectLinePolygon(s,c,r),f=h.intersectLinePolygon(c,i,r),g=h.intersectLinePolygon(i,n,r),m=new h;return m.appendPoints(o.points),m.appendPoints(l.points),m.appendPoints(f.points),m.appendPoints(g.points),m.points.length>0&&(m.status="Intersection"),m}}(W),function(u){var e=u.fabric||(u.fabric={});if(e.Color){e.warn("fabric.Color is already defined.");return}function h(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}e.Color=h,e.Color.prototype={_tryParsingColor:function(t){var a;t in h.colorNameMap&&(t=h.colorNameMap[t]),t==="transparent"&&(a=[255,255,255,0]),a||(a=h.sourceFromHex(t)),a||(a=h.sourceFromRgb(t)),a||(a=h.sourceFromHsl(t)),a||(a=[0,0,0,1]),a&&this.setSource(a)},_rgbToHsl:function(t,a,n){t/=255,a/=255,n/=255;var c,s,i,o=e.util.array.max([t,a,n]),l=e.util.array.min([t,a,n]);if(i=(o+l)/2,o===l)c=s=0;else{var f=o-l;switch(s=i>.5?f/(2-o-l):f/(o+l),o){case t:c=(a-n)/f+(a<n?6:0);break;case a:c=(n-t)/f+2;break;case n:c=(t-a)/f+4;break}c/=6}return[Math.round(c*360),Math.round(s*100),Math.round(i*100)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),a=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var t=this.getSource(),a=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+a[0]+","+a[1]+"%,"+a[2]+"%,"+t[3]+")"},toHex:function(){var t=this.getSource(),a,n,c;return a=t[0].toString(16),a=a.length===1?"0"+a:a,n=t[1].toString(16),n=n.length===1?"0"+n:n,c=t[2].toString(16),c=c.length===1?"0"+c:c,a.toUpperCase()+n.toUpperCase()+c.toUpperCase()},toHexa:function(){var t=this.getSource(),a;return a=Math.round(t[3]*255),a=a.toString(16),a=a.length===1?"0"+a:a,this.toHex()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var a=this.getSource();return a[3]=t,this.setSource(a),this},toGrayscale:function(){var t=this.getSource(),a=parseInt((t[0]*.3+t[1]*.59+t[2]*.11).toFixed(0),10),n=t[3];return this.setSource([a,a,a,n]),this},toBlackWhite:function(t){var a=this.getSource(),n=(a[0]*.3+a[1]*.59+a[2]*.11).toFixed(0),c=a[3];return t=t||127,n=Number(n)<Number(t)?0:255,this.setSource([n,n,n,c]),this},overlayWith:function(t){t instanceof h||(t=new h(t));var a=[],n=this.getAlpha(),c=.5,s=this.getSource(),i=t.getSource(),o;for(o=0;o<3;o++)a.push(Math.round(s[o]*(1-c)+i[o]*c));return a[3]=n,this.setSource(a),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function r(t,a,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(a-t)*6*n:n<1/2?a:n<2/3?t+(a-t)*(2/3-n)*6:t}e.Color.fromRgb=function(t){return h.fromSource(h.sourceFromRgb(t))},e.Color.sourceFromRgb=function(t){var a=t.match(h.reRGBa);if(a){var n=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),c=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),s=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(n,10),parseInt(c,10),parseInt(s,10),a[4]?parseFloat(a[4]):1]}},e.Color.fromRgba=h.fromRgb,e.Color.fromHsl=function(t){return h.fromSource(h.sourceFromHsl(t))},e.Color.sourceFromHsl=function(t){var a=t.match(h.reHSLa);if(!!a){var n=(parseFloat(a[1])%360+360)%360/360,c=parseFloat(a[2])/(/%$/.test(a[2])?100:1),s=parseFloat(a[3])/(/%$/.test(a[3])?100:1),i,o,l;if(c===0)i=o=l=s;else{var f=s<=.5?s*(c+1):s+c-s*c,g=s*2-f;i=r(g,f,n+1/3),o=r(g,f,n),l=r(g,f,n-1/3)}return[Math.round(i*255),Math.round(o*255),Math.round(l*255),a[4]?parseFloat(a[4]):1]}},e.Color.fromHsla=h.fromHsl,e.Color.fromHex=function(t){return h.fromSource(h.sourceFromHex(t))},e.Color.sourceFromHex=function(t){if(t.match(h.reHex)){var a=t.slice(t.indexOf("#")+1),n=a.length===3||a.length===4,c=a.length===8||a.length===4,s=n?a.charAt(0)+a.charAt(0):a.substring(0,2),i=n?a.charAt(1)+a.charAt(1):a.substring(2,4),o=n?a.charAt(2)+a.charAt(2):a.substring(4,6),l=c?n?a.charAt(3)+a.charAt(3):a.substring(6,8):"FF";return[parseInt(s,16),parseInt(i,16),parseInt(o,16),parseFloat((parseInt(l,16)/255).toFixed(2))]}},e.Color.fromSource=function(t){var a=new h;return a.setSource(t),a}}(W),function(){function u(a,n){var c=a.getAttribute("style"),s=a.getAttribute("offset")||0,i,o,l,f;if(s=parseFloat(s)/(/%$/.test(s)?100:1),s=s<0?0:s>1?1:s,c){var g=c.split(/\s*;\s*/);for(g[g.length-1]===""&&g.pop(),f=g.length;f--;){var m=g[f].split(/\s*:\s*/),v=m[0].trim(),p=m[1].trim();v==="stop-color"?i=p:v==="stop-opacity"&&(l=p)}}return i||(i=a.getAttribute("stop-color")||"rgb(0,0,0)"),l||(l=a.getAttribute("stop-opacity")),i=new d.Color(i),o=i.getAlpha(),l=isNaN(parseFloat(l))?1:parseFloat(l),l*=o*n,{offset:s,color:i.toRgb(),opacity:l}}function e(a){return{x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}}function h(a){return{x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"}}var r=d.util.object.clone;d.Gradient=d.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(a){a||(a={}),a.coords||(a.coords={});var n,c=this;Object.keys(a).forEach(function(s){c[s]=a[s]}),this.id?this.id+="_"+d.Object.__uid++:this.id=d.Object.__uid++,n={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},this.type==="radial"&&(n.r1=a.coords.r1||0,n.r2=a.coords.r2||0),this.coords=n,this.colorStops=a.colorStops.slice()},addColorStop:function(a){for(var n in a){var c=new d.Color(a[n]);this.colorStops.push({offset:parseFloat(n),color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(a){var n={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return d.util.populateWithProperties(this,n,a),n},toSVG:function(a,o){var c=r(this.coords,!0),s,i,o=o||{},l,f,g=r(this.colorStops,!0),m=c.r1>c.r2,v=this.gradientTransform?this.gradientTransform.concat():d.iMatrix.concat(),p=-this.offsetX,_=-this.offsetY,C=!!o.additionalTransform,y=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(g.sort(function(L,B){return L.offset-B.offset}),y==="objectBoundingBox"?(p/=a.width,_/=a.height):(p+=a.width/2,_+=a.height/2),a.type==="path"&&(p-=a.pathOffset.x,_-=a.pathOffset.y),v[4]-=p,v[5]-=_,f='id="SVGID_'+this.id+'" gradientUnits="'+y+'"',f+=' gradientTransform="'+(C?o.additionalTransform+" ":"")+d.util.matrixToSVG(v)+'" ',this.type==="linear"?l=["<linearGradient ",f,' x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`">
`]:this.type==="radial"&&(l=["<radialGradient ",f,' cx="',m?c.x1:c.x2,'" cy="',m?c.y1:c.y2,'" r="',m?c.r1:c.r2,'" fx="',m?c.x2:c.x1,'" fy="',m?c.y2:c.y1,`">
`]),this.type==="radial"){if(m)for(g=g.concat(),g.reverse(),s=0,i=g.length;s<i;s++)g[s].offset=1-g[s].offset;var S=Math.min(c.r1,c.r2);if(S>0){var w=Math.max(c.r1,c.r2),O=S/w;for(s=0,i=g.length;s<i;s++)g[s].offset+=O*(1-g[s].offset)}}for(s=0,i=g.length;s<i;s++){var E=g[s];l.push("<stop ",'offset="',E.offset*100+"%",'" style="stop-color:',E.color,typeof E.opacity<"u"?";stop-opacity: "+E.opacity:";",`"/>
`)}return l.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),l.join("")},toLive:function(a,n){var c,s=d.util.object.clone(this.coords),i,o,l=s.x1,f=s.y1,g=s.x2,m=s.y2,v=this.colorStops;if(!!this.type){for(n instanceof d.Text&&this.gradientUnits==="percentage"&&(l*=n.width,f*=n.height,g*=n.width,m*=n.height),this.type==="linear"?c=a.createLinearGradient(l,f,g,m):this.type==="radial"&&(c=a.createRadialGradient(l,f,s.r1,g,m,s.r2)),i=0,o=v.length;i<o;i++){var p=v[i].color,_=v[i].opacity,C=v[i].offset;typeof _<"u"&&(p=new d.Color(p).setAlpha(_).toRgba()),c.addColorStop(C,p)}return c}}}),d.util.object.extend(d.Gradient,{fromElement:function(a,n,c,s){var i=parseFloat(c)/(/%$/.test(c)?100:1);i=i<0?0:i>1?1:i,isNaN(i)&&(i=1);var o=a.getElementsByTagName("stop"),l,f=a.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",g=a.getAttribute("gradientTransform")||"",m=[],v,p,_=0,C=0,y;for(a.nodeName==="linearGradient"||a.nodeName==="LINEARGRADIENT"?(l="linear",v=e(a)):(l="radial",v=h(a)),p=o.length;p--;)m.push(u(o[p],i));y=d.parseTransformAttribute(g),t(n,v,s,f),f==="pixels"&&(_=-n.left,C=-n.top);var S=new d.Gradient({id:a.getAttribute("id"),type:l,coords:v,colorStops:m,gradientUnits:f,gradientTransform:y,offsetX:_,offsetY:C});return S},forObject:function(a,n){return n||(n={}),t(a,n.coords,n.gradientUnits,{viewBoxWidth:100,viewBoxHeight:100}),new d.Gradient(n)}});function t(a,n,c,s){var i,o;Object.keys(n).forEach(function(l){i=n[l],i==="Infinity"?o=1:i==="-Infinity"?o=0:(o=parseFloat(n[l],10),typeof i=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(i)&&(o*=.01,s==="pixels"&&((l==="x1"||l==="x2"||l==="r2")&&(o*=c.viewBoxWidth||c.width),(l==="y1"||l==="y2")&&(o*=c.viewBoxHeight||c.height)))),n[l]=o})}}(),function(){var u=d.util.toFixed;d.Pattern=d.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(e,h){if(e||(e={}),this.id=d.Object.__uid++,this.setOptions(e),!e.source||e.source&&typeof e.source!="string"){h&&h(this);return}if(typeof d.util.getFunctionBody(e.source)<"u")this.source=new Function(d.util.getFunctionBody(e.source)),h&&h(this);else{var r=this;this.source=d.util.createImage(),d.util.loadImage(e.source,function(t){r.source=t,h&&h(r)},null,this.crossOrigin)}},toObject:function(e){var h=d.Object.NUM_FRACTION_DIGITS,r,t;return typeof this.source=="function"?r=String(this.source):typeof this.source.src=="string"?r=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(r=this.source.toDataURL()),t={type:"pattern",source:r,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:u(this.offsetX,h),offsetY:u(this.offsetY,h),patternTransform:this.patternTransform?this.patternTransform.concat():null},d.util.populateWithProperties(this,t,e),t},toSVG:function(e){var h=typeof this.source=="function"?this.source():this.source,r=h.width/e.width,t=h.height/e.height,a=this.offsetX/e.width,n=this.offsetY/e.height,c="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(t=1,n&&(t+=Math.abs(n))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(r=1,a&&(r+=Math.abs(a))),h.src?c=h.src:h.toDataURL&&(c=h.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+a+'" y="'+n+'" width="'+r+'" height="'+t+`">
<image x="0" y="0" width="`+h.width+'" height="'+h.height+'" xlink:href="'+c+`"></image>
</pattern>
`},setOptions:function(e){for(var h in e)this[h]=e[h]},toLive:function(e){var h=typeof this.source=="function"?this.source():this.source;return!h||typeof h.src<"u"&&(!h.complete||h.naturalWidth===0||h.naturalHeight===0)?"":e.createPattern(h,this.repeat)}})}(),function(u){var e=u.fabric||(u.fabric={}),h=e.util.toFixed;if(e.Shadow){e.warn("fabric.Shadow is already defined.");return}e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(r){typeof r=="string"&&(r=this._parseShadow(r));for(var t in r)this[t]=r[t];this.id=e.Object.__uid++},_parseShadow:function(r){var t=r.trim(),a=e.Shadow.reOffsetsAndBlur.exec(t)||[],n=t.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:n.trim(),offsetX:parseInt(a[1],10)||0,offsetY:parseInt(a[2],10)||0,blur:parseInt(a[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(r){var t=40,a=40,n=e.Object.NUM_FRACTION_DIGITS,c=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-r.angle)),s=20,i=new e.Color(this.color);return r.width&&r.height&&(t=h((Math.abs(c.x)+this.blur)/r.width,n)*100+s,a=h((Math.abs(c.y)+this.blur)/r.height,n)*100+s),r.flipX&&(c.x*=-1),r.flipY&&(c.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+a+'%" height="'+(100+2*a)+'%" x="-'+t+'%" width="'+(100+2*t)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+h(this.blur?this.blur/2:0,n)+`"></feGaussianBlur>
	<feOffset dx="`+h(c.x,n)+'" dy="'+h(c.y,n)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+i.toRgb()+'" flood-opacity="'+i.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var r={},t=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(a){this[a]!==t[a]&&(r[a]=this[a])},this),r}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/}(W),function(){if(d.StaticCanvas){d.warn("fabric.StaticCanvas is already defined.");return}var u=d.util.object.extend,e=d.util.getElementOffset,h=d.util.removeFromArray,r=d.util.toFixed,t=d.util.transformPoint,a=d.util.invertTransform,n=d.util.getNodeCanvas,c=d.util.createCanvasElement,s=new Error("Could not initialize `canvas` element");d.StaticCanvas=d.util.createClass(d.CommonMethods,{initialize:function(i,o){o||(o={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(i,o)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:d.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(i,o){var l=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(i),this._initOptions(o),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),o.overlayImage&&this.setOverlayImage(o.overlayImage,l),o.backgroundImage&&this.setBackgroundImage(o.backgroundImage,l),o.backgroundColor&&this.setBackgroundColor(o.backgroundColor,l),o.overlayColor&&this.setOverlayColor(o.overlayColor,l),this.calcOffset()},_isRetinaScaling:function(){return d.devicePixelRatio!==1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?d.devicePixelRatio:1},_initRetinaScaling:function(){if(!!this._isRetinaScaling()){var i=d.devicePixelRatio;this.__initRetinaScaling(i,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(i,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(i,o,l){o.setAttribute("width",this.width*i),o.setAttribute("height",this.height*i),l.scale(i,i)},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(i,o,l){return this.__setBgOverlayImage("overlayImage",i,o,l)},setBackgroundImage:function(i,o,l){return this.__setBgOverlayImage("backgroundImage",i,o,l)},setOverlayColor:function(i,o){return this.__setBgOverlayColor("overlayColor",i,o)},setBackgroundColor:function(i,o){return this.__setBgOverlayColor("backgroundColor",i,o)},_setImageSmoothing:function(){var i=this.getContext();i.imageSmoothingEnabled=i.imageSmoothingEnabled||i.webkitImageSmoothingEnabled||i.mozImageSmoothingEnabled||i.msImageSmoothingEnabled||i.oImageSmoothingEnabled,i.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(i,o,l,f){return typeof o=="string"?d.util.loadImage(o,function(g){if(g){var m=new d.Image(g,f);this[i]=m,m.canvas=this}l&&l(g)},this,f&&f.crossOrigin):(f&&o.setOptions(f),this[i]=o,o&&(o.canvas=this),l&&l(o)),this},__setBgOverlayColor:function(i,o,l){return this[i]=o,this._initGradient(o,i),this._initPattern(o,i,l),this},_createCanvasElement:function(){var i=c();if(!i||(i.style||(i.style={}),typeof i.getContext>"u"))throw s;return i},_initOptions:function(i){var o=this.lowerCanvasEl;this._setOptions(i),this.width=this.width||parseInt(o.width,10)||0,this.height=this.height||parseInt(o.height,10)||0,this.lowerCanvasEl.style&&(o.width=this.width,o.height=this.height,o.style.width=this.width+"px",o.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(i){i&&i.getContext?this.lowerCanvasEl=i:this.lowerCanvasEl=d.util.getById(i)||this._createCanvasElement(),d.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(i,o){return this.setDimensions({width:i},o)},setHeight:function(i,o){return this.setDimensions({height:i},o)},setDimensions:function(i,o){var l;o=o||{};for(var f in i)l=i[f],o.cssOnly||(this._setBackstoreDimension(f,i[f]),l+="px",this.hasLostContext=!0),o.backstoreOnly||this._setCssDimension(f,l);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(),this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),o.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(i,o){return this.lowerCanvasEl[i]=o,this.upperCanvasEl&&(this.upperCanvasEl[i]=o),this.cacheCanvasEl&&(this.cacheCanvasEl[i]=o),this[i]=o,this},_setCssDimension:function(i,o){return this.lowerCanvasEl.style[i]=o,this.upperCanvasEl&&(this.upperCanvasEl.style[i]=o),this.wrapperEl&&(this.wrapperEl.style[i]=o),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(i){var o=this._activeObject,l,f=!1,g=!0,m,v;for(this.viewportTransform=i,m=0,v=this._objects.length;m<v;m++)l=this._objects[m],l.group||l.setCoords(f,g);return o&&o.type==="activeSelection"&&o.setCoords(f,g),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(i,o){var l=i,f=this.viewportTransform.slice(0);i=t(i,a(this.viewportTransform)),f[0]=o,f[3]=o;var g=t(i,f);return f[4]+=l.x-g.x,f[5]+=l.y-g.y,this.setViewportTransform(f)},setZoom:function(i){return this.zoomToPoint(new d.Point(0,0),i),this},absolutePan:function(i){var o=this.viewportTransform.slice(0);return o[4]=-i.x,o[5]=-i.y,this.setViewportTransform(o)},relativePan:function(i){return this.absolutePan(new d.Point(-i.x-this.viewportTransform[4],-i.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(i){this.stateful&&i.setupState(),i._set("canvas",this),i.setCoords(),this.fire("object:added",{target:i}),i.fire("added")},_onObjectRemoved:function(i){this.fire("object:removed",{target:i}),i.fire("removed"),delete i.canvas},clearContext:function(i){return i.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var i=this.contextContainer;return this.renderCanvas(i,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=d.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var i={},o=this.width,l=this.height,f=a(this.viewportTransform);return i.tl=t({x:0,y:0},f),i.br=t({x:o,y:l},f),i.tr=new d.Point(i.br.x,i.tl.y),i.bl=new d.Point(i.tl.x,i.br.y),this.vptCoords=i,i},cancelRequestedRender:function(){this.isRendering&&(d.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(i,o){var l=this.viewportTransform,f=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(i),this.fire("before:render",{ctx:i}),this.clipTo&&d.util.clipContext(this,i),this._renderBackground(i),i.save(),i.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._renderObjects(i,o),i.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(i),this.clipTo&&i.restore(),f&&(f.canvas=this,f.shouldCache(),f._transformDone=!0,f.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(i)),this._renderOverlay(i),this.controlsAboveOverlay&&this.interactive&&this.drawControls(i),this.fire("after:render",{ctx:i})},drawClipPathOnCanvas:function(i){var o=this.viewportTransform,l=this.clipPath;i.save(),i.transform(o[0],o[1],o[2],o[3],o[4],o[5]),i.globalCompositeOperation="destination-in",l.transform(i),i.scale(1/l.zoomX,1/l.zoomY),i.drawImage(l._cacheCanvas,-l.cacheTranslationX,-l.cacheTranslationY),i.restore()},_renderObjects:function(i,o){var l,f;for(l=0,f=o.length;l<f;++l)o[l]&&o[l].render(i)},_renderBackgroundOrOverlay:function(i,o){var l=this[o+"Color"],f=this[o+"Image"],g=this.viewportTransform,m=this[o+"Vpt"];if(!(!l&&!f)){if(l){i.save(),i.beginPath(),i.moveTo(0,0),i.lineTo(this.width,0),i.lineTo(this.width,this.height),i.lineTo(0,this.height),i.closePath(),i.fillStyle=l.toLive?l.toLive(i,this):l,m&&i.transform(g[0],g[1],g[2],g[3],g[4],g[5]),i.transform(1,0,0,1,l.offsetX||0,l.offsetY||0);var v=l.gradientTransform||l.patternTransform;v&&i.transform(v[0],v[1],v[2],v[3],v[4],v[5]),i.fill(),i.restore()}f&&(i.save(),m&&i.transform(g[0],g[1],g[2],g[3],g[4],g[5]),f.render(i),i.restore())}},_renderBackground:function(i){this._renderBackgroundOrOverlay(i,"background")},_renderOverlay:function(i){this._renderBackgroundOrOverlay(i,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(i){return this._centerObject(i,new d.Point(this.getCenter().left,i.getCenterPoint().y))},centerObjectV:function(i){return this._centerObject(i,new d.Point(i.getCenterPoint().x,this.getCenter().top))},centerObject:function(i){var o=this.getCenter();return this._centerObject(i,new d.Point(o.left,o.top))},viewportCenterObject:function(i){var o=this.getVpCenter();return this._centerObject(i,o)},viewportCenterObjectH:function(i){var o=this.getVpCenter();return this._centerObject(i,new d.Point(o.x,i.getCenterPoint().y)),this},viewportCenterObjectV:function(i){var o=this.getVpCenter();return this._centerObject(i,new d.Point(i.getCenterPoint().x,o.y))},getVpCenter:function(){var i=this.getCenter(),o=a(this.viewportTransform);return t({x:i.left,y:i.top},o)},_centerObject:function(i,o){return i.setPositionByOrigin(o,"center","center"),i.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(i){return this.toDatalessObject(i)},toObject:function(i){return this._toObjectMethod("toObject",i)},toDatalessObject:function(i){return this._toObjectMethod("toDatalessObject",i)},_toObjectMethod:function(i,o){var l=this.clipPath,f={version:d.version,objects:this._toObjects(i,o)};return l&&(f.clipPath=this._toObject(this.clipPath,i,o)),u(f,this.__serializeBgOverlay(i,o)),d.util.populateWithProperties(this,f,o),f},_toObjects:function(i,o){return this._objects.filter(function(l){return!l.excludeFromExport}).map(function(l){return this._toObject(l,i,o)},this)},_toObject:function(i,o,l){var f;this.includeDefaultValues||(f=i.includeDefaultValues,i.includeDefaultValues=!1);var g=i[o](l);return this.includeDefaultValues||(i.includeDefaultValues=f),g},__serializeBgOverlay:function(i,o){var l={},f=this.backgroundImage,g=this.overlayImage;return this.backgroundColor&&(l.background=this.backgroundColor.toObject?this.backgroundColor.toObject(o):this.backgroundColor),this.overlayColor&&(l.overlay=this.overlayColor.toObject?this.overlayColor.toObject(o):this.overlayColor),f&&!f.excludeFromExport&&(l.backgroundImage=this._toObject(f,i,o)),g&&!g.excludeFromExport&&(l.overlayImage=this._toObject(g,i,o)),l},svgViewportTransformation:!0,toSVG:function(i,o){i||(i={}),i.reviver=o;var l=[];return this._setSVGPreamble(l,i),this._setSVGHeader(l,i),this.clipPath&&l.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(l,"background"),this._setSVGBgOverlayImage(l,"backgroundImage",o),this._setSVGObjects(l,o),this.clipPath&&l.push(`</g>
`),this._setSVGBgOverlayColor(l,"overlay"),this._setSVGBgOverlayImage(l,"overlayImage",o),l.push("</svg>"),l.join("")},_setSVGPreamble:function(i,o){o.suppressPreamble||i.push('<?xml version="1.0" encoding="',o.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(i,o){var l=o.width||this.width,f=o.height||this.height,g,m='viewBox="0 0 '+this.width+" "+this.height+'" ',v=d.Object.NUM_FRACTION_DIGITS;o.viewBox?m='viewBox="'+o.viewBox.x+" "+o.viewBox.y+" "+o.viewBox.width+" "+o.viewBox.height+'" ':this.svgViewportTransformation&&(g=this.viewportTransform,m='viewBox="'+r(-g[4]/g[0],v)+" "+r(-g[5]/g[3],v)+" "+r(this.width/g[0],v)+" "+r(this.height/g[3],v)+'" '),i.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',l,'" ','height="',f,'" ',m,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",d.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(o),`</defs>
`)},createSVGClipPathMarkup:function(i){var o=this.clipPath;return o?(o.clipPathId="CLIPPATH_"+d.Object.__uid++,'<clipPath id="'+o.clipPathId+`" >
`+this.clipPath.toClipPathSVG(i.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var i=this,o=["background","overlay"].map(function(l){var f=i[l+"Color"];if(f&&f.toLive){var g=i[l+"Vpt"],m=i.viewportTransform,v={width:i.width/(g?m[0]:1),height:i.height/(g?m[3]:1)};return f.toSVG(v,{additionalTransform:g?d.util.matrixToSVG(m):""})}});return o.join("")},createSVGFontFacesMarkup:function(){var i="",o={},l,f,g,m,v,p,_,C,y,S=d.fontPaths,w=[];for(this._objects.forEach(function E(L){w.push(L),L._objects&&L._objects.forEach(E)}),C=0,y=w.length;C<y;C++)if(l=w[C],f=l.fontFamily,!(l.type.indexOf("text")===-1||o[f]||!S[f])&&(o[f]=!0,!!l.styles)){g=l.styles;for(v in g){m=g[v];for(_ in m)p=m[_],f=p.fontFamily,!o[f]&&S[f]&&(o[f]=!0)}}for(var O in o)i+=[`		@font-face {
`,"			font-family: '",O,`';
`,"			src: url('",S[O],`');
`,`		}
`].join("");return i&&(i=['	<style type="text/css">',`<![CDATA[
`,i,"]]>",`</style>
`].join("")),i},_setSVGObjects:function(i,o){var l,f,g,m=this._objects;for(f=0,g=m.length;f<g;f++)l=m[f],!l.excludeFromExport&&this._setSVGObject(i,l,o)},_setSVGObject:function(i,o,l){i.push(o.toSVG(l))},_setSVGBgOverlayImage:function(i,o,l){this[o]&&!this[o].excludeFromExport&&this[o].toSVG&&i.push(this[o].toSVG(l))},_setSVGBgOverlayColor:function(i,o){var l=this[o+"Color"],f=this.viewportTransform,g=this.width,m=this.height;if(!!l)if(l.toLive){var v=l.repeat,p=d.util.invertTransform(f),_=this[o+"Vpt"],C=_?d.util.matrixToSVG(p):"";i.push('<rect transform="'+C+" translate(",g/2,",",m/2,')"',' x="',l.offsetX-g/2,'" y="',l.offsetY-m/2,'" ','width="',v==="repeat-y"||v==="no-repeat"?l.source.width:g,'" height="',v==="repeat-x"||v==="no-repeat"?l.source.height:m,'" fill="url(#SVGID_'+l.id+')"',`></rect>
`)}else i.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',l,'"',`></rect>
`)},sendToBack:function(i){if(!i)return this;var o=this._activeObject,l,f,g;if(i===o&&i.type==="activeSelection")for(g=o._objects,l=g.length;l--;)f=g[l],h(this._objects,f),this._objects.unshift(f);else h(this._objects,i),this._objects.unshift(i);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(i){if(!i)return this;var o=this._activeObject,l,f,g;if(i===o&&i.type==="activeSelection")for(g=o._objects,l=0;l<g.length;l++)f=g[l],h(this._objects,f),this._objects.push(f);else h(this._objects,i),this._objects.push(i);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(i,o){if(!i)return this;var l=this._activeObject,f,g,m,v,p,_=0;if(i===l&&i.type==="activeSelection")for(p=l._objects,f=0;f<p.length;f++)g=p[f],m=this._objects.indexOf(g),m>0+_&&(v=m-1,h(this._objects,g),this._objects.splice(v,0,g)),_++;else m=this._objects.indexOf(i),m!==0&&(v=this._findNewLowerIndex(i,m,o),h(this._objects,i),this._objects.splice(v,0,i));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(i,o,l){var f,g;if(l)for(f=o,g=o-1;g>=0;--g){var m=i.intersectsWithObject(this._objects[g])||i.isContainedWithinObject(this._objects[g])||this._objects[g].isContainedWithinObject(i);if(m){f=g;break}}else f=o-1;return f},bringForward:function(i,o){if(!i)return this;var l=this._activeObject,f,g,m,v,p,_=0;if(i===l&&i.type==="activeSelection")for(p=l._objects,f=p.length;f--;)g=p[f],m=this._objects.indexOf(g),m<this._objects.length-1-_&&(v=m+1,h(this._objects,g),this._objects.splice(v,0,g)),_++;else m=this._objects.indexOf(i),m!==this._objects.length-1&&(v=this._findNewUpperIndex(i,m,o),h(this._objects,i),this._objects.splice(v,0,i));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(i,o,l){var f,g,m;if(l)for(f=o,g=o+1,m=this._objects.length;g<m;++g){var v=i.intersectsWithObject(this._objects[g])||i.isContainedWithinObject(this._objects[g])||this._objects[g].isContainedWithinObject(i);if(v){f=g;break}}else f=o+1;return f},moveTo:function(i,o){return h(this._objects,i),this._objects.splice(o,0,i),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(d.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(i){i.dispose&&i.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,d.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),u(d.StaticCanvas.prototype,d.Observable),u(d.StaticCanvas.prototype,d.Collection),u(d.StaticCanvas.prototype,d.DataURLExporter),u(d.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(i){var o=c();if(!o||!o.getContext)return null;var l=o.getContext("2d");if(!l)return null;switch(i){case"setLineDash":return typeof l.setLineDash<"u";default:return null}}}),d.StaticCanvas.prototype.toJSON=d.StaticCanvas.prototype.toObject,d.isLikelyNode&&(d.StaticCanvas.prototype.createPNGStream=function(){var i=n(this.lowerCanvasEl);return i&&i.createPNGStream()},d.StaticCanvas.prototype.createJPEGStream=function(i){var o=n(this.lowerCanvasEl);return o&&o.createJPEGStream(i)})}(),d.BaseBrush=d.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,setShadow:function(u){return this.shadow=new d.Shadow(u),this},_setBrushStyles:function(){var u=this.canvas.contextTop;u.strokeStyle=this.color,u.lineWidth=this.width,u.lineCap=this.strokeLineCap,u.miterLimit=this.strokeMiterLimit,u.lineJoin=this.strokeLineJoin,d.StaticCanvas.supports("setLineDash")&&u.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(u){var e=this.canvas.viewportTransform;u.save(),u.transform(e[0],e[1],e[2],e[3],e[4],e[5])},_setShadow:function(){if(!!this.shadow){var u=this.canvas,e=this.shadow,h=u.contextTop,r=u.getZoom();u&&u._isRetinaScaling()&&(r*=d.devicePixelRatio),h.shadowColor=e.color,h.shadowBlur=e.blur*r,h.shadowOffsetX=e.offsetX*r,h.shadowOffsetY=e.offsetY*r}},needsFullRender:function(){var u=new d.Color(this.color);return u.getAlpha()<1||!!this.shadow},_resetShadow:function(){var u=this.canvas.contextTop;u.shadowColor="",u.shadowBlur=u.shadowOffsetX=u.shadowOffsetY=0}}),function(){d.PencilBrush=d.util.createClass(d.BaseBrush,{decimate:.4,initialize:function(u){this.canvas=u,this._points=[]},_drawSegment:function(u,e,h){var r=e.midPointFrom(h);return u.quadraticCurveTo(e.x,e.y,r.x,r.y),r},onMouseDown:function(u,e){!this.canvas._isMainEvent(e.e)||(this._prepareForDrawing(u),this._captureDrawingPath(u),this._render())},onMouseMove:function(u,e){if(!!this.canvas._isMainEvent(e.e)&&this._captureDrawingPath(u)&&this._points.length>1)if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var h=this._points,r=h.length,t=this.canvas.contextTop;this._saveAndTransform(t),this.oldEnd&&(t.beginPath(),t.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(t,h[r-2],h[r-1],!0),t.stroke(),t.restore()}},onMouseUp:function(u){return this.canvas._isMainEvent(u.e)?(this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(u){var e=new d.Point(u.x,u.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(u){return this._points.length>1&&u.eq(this._points[this._points.length-1])?!1:(this._points.push(u),!0)},_reset:function(){this._points=[],this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(u){var e=new d.Point(u.x,u.y);return this._addPoint(e)},_render:function(){var u=this.canvas.contextTop,e,h,r=this._points[0],t=this._points[1];if(this._saveAndTransform(u),u.beginPath(),this._points.length===2&&r.x===t.x&&r.y===t.y){var a=this.width/1e3;r=new d.Point(r.x,r.y),t=new d.Point(t.x,t.y),r.x-=a,t.x+=a}for(u.moveTo(r.x,r.y),e=1,h=this._points.length;e<h;e++)this._drawSegment(u,r,t),r=this._points[e],t=this._points[e+1];u.lineTo(r.x,r.y),u.stroke(),u.restore()},convertPointsToSVGPath:function(u){var e=[],h,r=this.width/1e3,t=new d.Point(u[0].x,u[0].y),a=new d.Point(u[1].x,u[1].y),n=u.length,c=1,s=0,i=n>2;for(i&&(c=u[2].x<a.x?-1:u[2].x===a.x?0:1,s=u[2].y<a.y?-1:u[2].y===a.y?0:1),e.push("M ",t.x-c*r," ",t.y-s*r," "),h=1;h<n;h++){if(!t.eq(a)){var o=t.midPointFrom(a);e.push("Q ",t.x," ",t.y," ",o.x," ",o.y," ")}t=u[h],h+1<u.length&&(a=u[h+1])}return i&&(c=t.x>u[h-2].x?1:t.x===u[h-2].x?0:-1,s=t.y>u[h-2].y?1:t.y===u[h-2].y?0:-1),e.push("L ",t.x+c*r," ",t.y+s*r),e},createPath:function(u){var e=new d.Path(u,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},decimatePoints:function(u,e){if(u.length<=2)return u;var h=this.canvas.getZoom(),r=Math.pow(e/h,2),t,a=u.length-1,n=u[0],c=[n],s;for(t=1;t<a;t++)s=Math.pow(n.x-u[t].x,2)+Math.pow(n.y-u[t].y,2),s>=r&&(n=u[t],c.push(n));return c.length===1&&c.push(new d.Point(c[0].x,c[0].y)),c},_finalizeAndAddPath:function(){var u=this.canvas.contextTop;u.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var e=this.convertPointsToSVGPath(this._points).join("");if(e==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.requestRenderAll();return}var h=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.add(h),this.canvas.requestRenderAll(),h.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:h})}})}(),d.CircleBrush=d.util.createClass(d.BaseBrush,{width:10,initialize:function(u){this.canvas=u,this.points=[]},drawDot:function(u){var e=this.addPoint(u),h=this.canvas.contextTop;this._saveAndTransform(h),this.dot(h,e),h.restore()},dot:function(u,e){u.fillStyle=e.fill,u.beginPath(),u.arc(e.x,e.y,e.radius,0,Math.PI*2,!1),u.closePath(),u.fill()},onMouseDown:function(u){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(u)},_render:function(){var u=this.canvas.contextTop,e,h,r=this.points;for(this._saveAndTransform(u),e=0,h=r.length;e<h;e++)this.dot(u,r[e]);u.restore()},onMouseMove:function(u){this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(u),this._render()):this.drawDot(u)},onMouseUp:function(){var u=this.canvas.renderOnAddRemove,e,h;this.canvas.renderOnAddRemove=!1;var r=[];for(e=0,h=this.points.length;e<h;e++){var t=this.points[e],a=new d.Circle({radius:t.radius,left:t.x,top:t.y,originX:"center",originY:"center",fill:t.fill});this.shadow&&a.setShadow(this.shadow),r.push(a)}var n=new d.Group(r);n.canvas=this.canvas,this.canvas.add(n),this.canvas.fire("path:created",{path:n}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=u,this.canvas.requestRenderAll()},addPoint:function(u){var e=new d.Point(u.x,u.y),h=d.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,r=new d.Color(this.color).setAlpha(d.util.getRandomInt(0,100)/100).toRgba();return e.radius=h,e.fill=r,this.points.push(e),e}}),d.SprayBrush=d.util.createClass(d.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(u){this.canvas=u,this.sprayChunks=[]},onMouseDown:function(u){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(u),this.render(this.sprayChunkPoints)},onMouseMove:function(u){this.addSprayChunk(u),this.render(this.sprayChunkPoints)},onMouseUp:function(){var u=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],h=0,r=this.sprayChunks.length;h<r;h++)for(var t=this.sprayChunks[h],a=0,n=t.length;a<n;a++){var c=new d.Rect({width:t[a].width,height:t[a].width,left:t[a].x+1,top:t[a].y+1,originX:"center",originY:"center",fill:this.color});e.push(c)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var s=new d.Group(e);this.shadow&&s.setShadow(this.shadow),this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=u,this.canvas.requestRenderAll()},_getOptimizedRects:function(u){var e={},h,r,t;for(r=0,t=u.length;r<t;r++)h=u[r].left+""+u[r].top,e[h]||(e[h]=u[r]);var a=[];for(h in e)a.push(e[h]);return a},render:function(u){var e=this.canvas.contextTop,h,r;for(e.fillStyle=this.color,this._saveAndTransform(e),h=0,r=u.length;h<r;h++){var t=u[h];typeof t.opacity<"u"&&(e.globalAlpha=t.opacity),e.fillRect(t.x,t.y,t.width,t.width)}e.restore()},_render:function(){var u=this.canvas.contextTop,e,h;for(u.fillStyle=this.color,this._saveAndTransform(u),e=0,h=this.sprayChunks.length;e<h;e++)this.render(this.sprayChunks[e]);u.restore()},addSprayChunk:function(u){this.sprayChunkPoints=[];var e,h,r,t=this.width/2,a;for(a=0;a<this.density;a++){e=d.util.getRandomInt(u.x-t,u.x+t),h=d.util.getRandomInt(u.y-t,u.y+t),this.dotWidthVariance?r=d.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):r=this.dotWidth;var n=new d.Point(e,h);n.width=r,this.randomOpacity&&(n.opacity=d.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(n)}this.sprayChunks.push(this.sprayChunkPoints)}}),d.PatternBrush=d.util.createClass(d.PencilBrush,{getPatternSrc:function(){var u=20,e=5,h=d.util.createCanvasElement(),r=h.getContext("2d");return h.width=h.height=u+e,r.fillStyle=this.color,r.beginPath(),r.arc(u/2,u/2,u/2,0,Math.PI*2,!1),r.closePath(),r.fill(),h},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(u){var e=this.callSuper("createPath",u),h=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new d.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-h.x,offsetY:-h.y}),e}}),function(){var u=d.util.getPointer,e=d.util.degreesToRadians,h=d.util.radiansToDegrees,r=Math.atan2,t=Math.abs,a=d.StaticCanvas.supports("setLineDash"),n=.5;d.Canvas=d.util.createClass(d.StaticCanvas,{initialize:function(s,i){i||(i={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(s,i),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=d.PencilBrush&&new d.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var s=this.getActiveObjects(),i,o,l;if(s.length>0&&!this.preserveObjectStacking){o=[],l=[];for(var f=0,g=this._objects.length;f<g;f++)i=this._objects[f],s.indexOf(i)===-1?o.push(i):l.push(i);s.length>1&&(this._activeObject._objects=l),o.push.apply(o,l)}else o=this._objects;return o},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var s=this.contextContainer;return this.renderCanvas(s,this._chooseObjectsToRender()),this},renderTopLayer:function(s){s.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(s),this.contextTopDirty=!0),s.restore()},renderTop:function(){var s=this.contextTop;return this.clearContext(s),this.renderTopLayer(s),this.fire("after:render"),this},_resetCurrentTransform:function(){var s=this._currentTransform;s.target.set({scaleX:s.original.scaleX,scaleY:s.original.scaleY,skewX:s.original.skewX,skewY:s.original.skewY,left:s.original.left,top:s.original.top}),this._shouldCenterTransform(s.target)?(s.originX!=="center"&&(s.originX==="right"?s.mouseXSign=-1:s.mouseXSign=1),s.originY!=="center"&&(s.originY==="bottom"?s.mouseYSign=-1:s.mouseYSign=1),s.originX="center",s.originY="center"):(s.originX=s.original.originX,s.originY=s.original.originY)},containsPoint:function(s,i,o){var l=!0,f=o||this.getPointer(s,l),g;return i.group&&i.group===this._activeObject&&i.group.type==="activeSelection"?g=this._normalizePointer(i.group,f):g={x:f.x,y:f.y},i.containsPoint(g)||i._findTargetCorner(f)},_normalizePointer:function(s,i){var o=s.calcTransformMatrix(),l=d.util.invertTransform(o),f=this.restorePointerVpt(i);return d.util.transformPoint(f,l)},isTargetTransparent:function(s,i,o){if(s.shouldCache()&&s._cacheCanvas&&s!==this._activeObject){var l=this._normalizePointer(s,{x:i,y:o}),f=Math.max(s.cacheTranslationX+l.x*s.zoomX,0),g=Math.max(s.cacheTranslationY+l.y*s.zoomY,0),_=d.util.isTransparent(s._cacheContext,Math.round(f),Math.round(g),this.targetFindTolerance);return _}var m=this.contextCache,v=s.selectionBackgroundColor,p=this.viewportTransform;s.selectionBackgroundColor="",this.clearContext(m),m.save(),m.transform(p[0],p[1],p[2],p[3],p[4],p[5]),s.render(m),m.restore(),s===this._activeObject&&s._renderControls(m,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),s.selectionBackgroundColor=v;var _=d.util.isTransparent(m,i,o,this.targetFindTolerance);return _},_isSelectionKeyPressed:function(s){var i=!1;return Object.prototype.toString.call(this.selectionKey)==="[object Array]"?i=!!this.selectionKey.find(function(o){return s[o]===!0}):i=s[this.selectionKey],i},_shouldClearSelection:function(s,i){var o=this.getActiveObjects(),l=this._activeObject;return!i||i&&l&&o.length>1&&o.indexOf(i)===-1&&l!==i&&!this._isSelectionKeyPressed(s)||i&&!i.evented||i&&!i.selectable&&l&&l!==i},_shouldCenterTransform:function(s){if(!!s){var i=this._currentTransform,o;return i.action==="scale"||i.action==="scaleX"||i.action==="scaleY"?o=this.centeredScaling||s.centeredScaling:i.action==="rotate"&&(o=this.centeredRotation||s.centeredRotation),o?!i.altKey:i.altKey}},_getOriginFromCorner:function(s,i){var o={x:s.originX,y:s.originY};return i==="ml"||i==="tl"||i==="bl"?o.x="right":(i==="mr"||i==="tr"||i==="br")&&(o.x="left"),i==="tl"||i==="mt"||i==="tr"?o.y="bottom":(i==="bl"||i==="mb"||i==="br")&&(o.y="top"),o},_getActionFromCorner:function(s,i,o){if(!i||!s)return"drag";switch(i){case"mtr":return"rotate";case"ml":case"mr":return o[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return o[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(s,i,o){if(!!i){var l=this.getPointer(s),f=i._findTargetCorner(this.getPointer(s,!0)),g=this._getActionFromCorner(o,f,s,i),m=this._getOriginFromCorner(i,f);this._currentTransform={target:i,action:g,corner:f,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:l.x-i.left,offsetY:l.y-i.top,originX:m.x,originY:m.y,ex:l.x,ey:l.y,lastX:l.x,lastY:l.y,theta:e(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:s.shiftKey,altKey:s[this.centeredKey],original:d.util.saveObjectTransform(i)},this._currentTransform.original.originX=m.x,this._currentTransform.original.originY=m.y,this._resetCurrentTransform(),this._beforeTransform(s)}},_translateObject:function(s,i){var o=this._currentTransform,l=o.target,f=s-o.offsetX,g=i-o.offsetY,m=!l.get("lockMovementX")&&l.left!==f,v=!l.get("lockMovementY")&&l.top!==g;return m&&l.set("left",f),v&&l.set("top",g),m||v},_changeSkewTransformOrigin:function(s,i,o){var l="originX",f={0:"center"},g=i.target.skewX,m="left",v="right",p=i.corner==="mt"||i.corner==="ml"?1:-1,_=1;s=s>0?1:-1,o==="y"&&(g=i.target.skewY,m="top",v="bottom",l="originY"),f[-1]=m,f[1]=v,i.target.flipX&&(_*=-1),i.target.flipY&&(_*=-1),g===0?(i.skewSign=-p*s*_,i[l]=f[-s]):(g=g>0?1:-1,i.skewSign=g,i[l]=f[g*p*_])},_skewObject:function(s,i,o){var l=this._currentTransform,f=l.target,g=!1,m=f.get("lockSkewingX"),v=f.get("lockSkewingY");if(m&&o==="x"||v&&o==="y")return!1;var p=f.getCenterPoint(),_=f.toLocalPoint(new d.Point(s,i),"center","center")[o],C=f.toLocalPoint(new d.Point(l.lastX,l.lastY),"center","center")[o],y,S,w=f._getTransformedDimensions();return this._changeSkewTransformOrigin(_-C,l,o),y=f.toLocalPoint(new d.Point(s,i),l.originX,l.originY)[o],S=f.translateToOriginPoint(p,l.originX,l.originY),g=this._setObjectSkew(y,l,o,w),l.lastX=s,l.lastY=i,f.setPositionByOrigin(S,l.originX,l.originY),g},_setObjectSkew:function(s,i,o,l){var f=i.target,g,m=!1,v=i.skewSign,p,_,C,y,S,w,O,E;return o==="x"?(C="y",y="Y",S="X",O=0,E=f.skewY):(C="x",y="X",S="Y",O=f.skewX,E=0),_=f._getTransformedDimensions(O,E),w=2*Math.abs(s)-_[o],w<=2?g=0:(g=v*Math.atan(w/f["scale"+S]/(_[C]/f["scale"+y])),g=d.util.radiansToDegrees(g)),m=f["skew"+S]!==g,f.set("skew"+S,g),f["skew"+y]!==0&&(p=f._getTransformedDimensions(),g=l[C]/p[C]*f["scale"+y],f.set("scale"+y,g)),m},_scaleObject:function(s,i,o){var l=this._currentTransform,f=l.target,g=f.lockScalingX,m=f.lockScalingY,v=f.lockScalingFlip;if(g&&m)return!1;var p=f.translateToOriginPoint(f.getCenterPoint(),l.originX,l.originY),_=f.toLocalPoint(new d.Point(s,i),l.originX,l.originY),C=f._getTransformedDimensions(),y=!1;return this._setLocalMouse(_,l),y=this._setObjectScale(_,l,g,m,o,v,C),f.setPositionByOrigin(p,l.originX,l.originY),y},_setObjectScale:function(s,i,o,l,f,g,m){var v=i.target,p=!1,_=!1,C=!1,y=s.x*v.scaleX/m.x,S=s.y*v.scaleY/m.y,w=v.scaleX!==y,O=v.scaleY!==S;if(i.newScaleX=y,i.newScaleY=S,d.Textbox&&f==="x"&&v instanceof d.Textbox){var E=v.width*(s.x/m.x);return E>=v.getMinWidth()?(C=E!==v.width,v.set("width",E),C):!1}return g&&y<=0&&y<v.scaleX&&(p=!0,s.x=0),g&&S<=0&&S<v.scaleY&&(_=!0,s.y=0),f==="equally"&&!o&&!l?C=this._scaleObjectEqually(s,v,i,m):f?f==="x"&&!v.get("lockUniScaling")?p||o||v.set("scaleX",y)&&(C=w):f==="y"&&!v.get("lockUniScaling")&&(_||l||v.set("scaleY",S)&&(C=O)):(p||o||v.set("scaleX",y)&&(C=C||w),_||l||v.set("scaleY",S)&&(C=C||O)),p||_||this._flipObject(i,f),C},_scaleObjectEqually:function(s,i,o,l){var f=s.y+s.x,g=l.y*o.original.scaleY/i.scaleY+l.x*o.original.scaleX/i.scaleX,m,v=s.x<0?-1:1,p=s.y<0?-1:1,_,C;return _=v*Math.abs(o.original.scaleX*f/g),C=p*Math.abs(o.original.scaleY*f/g),m=_!==i.scaleX||C!==i.scaleY,i.set("scaleX",_),i.set("scaleY",C),m},_flipObject:function(s,i){s.newScaleX<0&&i!=="y"&&(s.originX==="left"?s.originX="right":s.originX==="right"&&(s.originX="left")),s.newScaleY<0&&i!=="x"&&(s.originY==="top"?s.originY="bottom":s.originY==="bottom"&&(s.originY="top"))},_setLocalMouse:function(s,i){var o=i.target,l=this.getZoom(),f=o.padding/l;i.originX==="right"?s.x*=-1:i.originX==="center"&&(s.x*=i.mouseXSign*2,s.x<0&&(i.mouseXSign=-i.mouseXSign)),i.originY==="bottom"?s.y*=-1:i.originY==="center"&&(s.y*=i.mouseYSign*2,s.y<0&&(i.mouseYSign=-i.mouseYSign)),t(s.x)>f?s.x<0?s.x+=f:s.x-=f:s.x=0,t(s.y)>f?s.y<0?s.y+=f:s.y-=f:s.y=0},_rotateObject:function(s,i){var o=this._currentTransform,l=o.target,f,f=l.translateToOriginPoint(l.getCenterPoint(),o.originX,o.originY);if(l.lockRotation)return!1;var g=r(o.ey-f.y,o.ex-f.x),m=r(i-f.y,s-f.x),v=h(m-g+o.theta),p=!0;if(l.snapAngle>0){var _=l.snapAngle,C=l.snapThreshold||_,y=Math.ceil(v/_)*_,S=Math.floor(v/_)*_;Math.abs(v-S)<C?v=S:Math.abs(v-y)<C&&(v=y)}return v<0&&(v=360+v),v%=360,l.angle===v?p=!1:(l.angle=v,l.setPositionByOrigin(f,o.originX,o.originY)),p},setCursor:function(s){this.upperCanvasEl.style.cursor=s},_drawSelection:function(s){var i=this._groupSelector,o=i.left,l=i.top,f=t(o),g=t(l);if(this.selectionColor&&(s.fillStyle=this.selectionColor,s.fillRect(i.ex-(o>0?0:-o),i.ey-(l>0?0:-l),f,g)),!(!this.selectionLineWidth||!this.selectionBorderColor))if(s.lineWidth=this.selectionLineWidth,s.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!a){var m=i.ex+n-(o>0?0:f),v=i.ey+n-(l>0?0:g);s.beginPath(),d.util.drawDashedLine(s,m,v,m+f,v,this.selectionDashArray),d.util.drawDashedLine(s,m,v+g-1,m+f,v+g-1,this.selectionDashArray),d.util.drawDashedLine(s,m,v,m,v+g,this.selectionDashArray),d.util.drawDashedLine(s,m+f-1,v,m+f-1,v+g,this.selectionDashArray),s.closePath(),s.stroke()}else d.Object.prototype._setLineDash.call(this,s,this.selectionDashArray),s.strokeRect(i.ex+n-(o>0?0:f),i.ey+n-(l>0?0:g),f,g)},findTarget:function(s,i){if(!this.skipTargetFind){var o=!0,l=this.getPointer(s,o),f=this._activeObject,g=this.getActiveObjects(),m,v;if(this.targets=[],g.length>1&&!i&&f===this._searchPossibleTargets([f],l)||g.length===1&&f._findTargetCorner(l))return f;if(g.length===1&&f===this._searchPossibleTargets([f],l))if(this.preserveObjectStacking)m=f,v=this.targets,this.targets=[];else return f;var p=this._searchPossibleTargets(this._objects,l);return s[this.altSelectionKey]&&p&&m&&p!==m&&(p=m,this.targets=v),p}},_checkTarget:function(s,i,o){if(i&&i.visible&&i.evented&&this.containsPoint(null,i,s))if((this.perPixelTargetFind||i.perPixelTargetFind)&&!i.isEditing){var l=this.isTargetTransparent(i,o.x,o.y);if(!l)return!0}else return!0},_searchPossibleTargets:function(s,i){for(var o,l=s.length,f;l--;){var g=s[l],m=g.group&&g.group.type!=="activeSelection"?this._normalizePointer(g.group,i):i;if(this._checkTarget(m,g,i)){o=s[l],o.subTargetCheck&&o instanceof d.Group&&(f=this._searchPossibleTargets(o._objects,i),f&&this.targets.push(f));break}}return o},restorePointerVpt:function(s){return d.util.transformPoint(s,d.util.invertTransform(this.viewportTransform))},getPointer:function(s,i){if(this._absolutePointer&&!i)return this._absolutePointer;if(this._pointer&&i)return this._pointer;var o=u(s),l=this.upperCanvasEl,f=l.getBoundingClientRect(),g=f.width||0,m=f.height||0,v;(!g||!m)&&("top"in f&&"bottom"in f&&(m=Math.abs(f.top-f.bottom)),"right"in f&&"left"in f&&(g=Math.abs(f.right-f.left))),this.calcOffset(),o.x=o.x-this._offset.left,o.y=o.y-this._offset.top,i||(o=this.restorePointerVpt(o));var p=this.getRetinaScaling();return p!==1&&(o.x/=p,o.y/=p),g===0||m===0?v={width:1,height:1}:v={width:l.width/g,height:l.height/m},{x:o.x*v.width,y:o.y*v.height}},_createUpperCanvas:function(){var s=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),i=this.lowerCanvasEl,o=this.upperCanvasEl;o?o.className="":(o=this._createCanvasElement(),this.upperCanvasEl=o),d.util.addClass(o,"upper-canvas "+s),this.wrapperEl.appendChild(o),this._copyCanvasStyle(i,o),this._applyCanvasStyle(o),this.contextTop=o.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=d.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),d.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),d.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(s){var i=this.width||s.width,o=this.height||s.height;d.util.setStyle(s,{position:"absolute",width:i+"px",height:o+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),s.width=i,s.height=o,d.util.makeElementUnselectable(s)},_copyCanvasStyle:function(s,i){i.style.cssText=s.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var s=this._activeObject;return s?s.type==="activeSelection"&&s._objects?s._objects.slice(0):[s]:[]},_onObjectRemoved:function(s){s===this._activeObject&&(this.fire("before:selection:cleared",{target:s}),this._discardActiveObject(),this.fire("selection:cleared",{target:s}),s.fire("deselected")),s===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",s)},_fireSelectionEvents:function(s,i){var o=!1,l=this.getActiveObjects(),f=[],g=[],m={e:i};s.forEach(function(v){l.indexOf(v)===-1&&(o=!0,v.fire("deselected",m),g.push(v))}),l.forEach(function(v){s.indexOf(v)===-1&&(o=!0,v.fire("selected",m),f.push(v))}),s.length>0&&l.length>0?(m.selected=f,m.deselected=g,m.updated=f[0]||g[0],m.target=this._activeObject,o&&this.fire("selection:updated",m)):l.length>0?(l.length===1&&(m.target=f[0],this.fire("object:selected",m)),m.selected=f,m.target=this._activeObject,this.fire("selection:created",m)):s.length>0&&(m.deselected=g,this.fire("selection:cleared",m))},setActiveObject:function(s,i){var o=this.getActiveObjects();return this._setActiveObject(s,i),this._fireSelectionEvents(o,i),this},_setActiveObject:function(s,i){return this._activeObject===s||!this._discardActiveObject(i,s)||s.onSelect({e:i})?!1:(this._activeObject=s,!0)},_discardActiveObject:function(s,i){var o=this._activeObject;if(o){if(o.onDeselect({e:s,object:i}))return!1;this._activeObject=null}return!0},discardActiveObject:function(s){var i=this.getActiveObjects(),o=this.getActiveObject();return i.length&&this.fire("before:selection:cleared",{target:o,e:s}),this._discardActiveObject(s),this._fireSelectionEvents(i,s),this},dispose:function(){var s=this.wrapperEl;return this.removeListeners(),s.removeChild(this.upperCanvasEl),s.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(i){d.util.cleanUpJsdomNode(this[i]),this[i]=void 0}.bind(this)),s.parentNode&&s.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,d.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(s){var i=this._activeObject;i&&i._renderControls(s)},_toObject:function(s,i,o){var l=this._realizeGroupTransformOnObject(s),f=this.callSuper("_toObject",s,i,o);return this._unwindGroupTransformOnObject(s,l),f},_realizeGroupTransformOnObject:function(s){if(s.group&&s.group.type==="activeSelection"&&this._activeObject===s.group){var i=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],o={};return i.forEach(function(l){o[l]=s[l]}),this._activeObject.realizeTransform(s),o}else return null},_unwindGroupTransformOnObject:function(s,i){i&&s.set(i)},_setSVGObject:function(s,i,o){var l=this._realizeGroupTransformOnObject(i);this.callSuper("_setSVGObject",s,i,o),this._unwindGroupTransformOnObject(i,l)},setViewportTransform:function(s){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),d.StaticCanvas.prototype.setViewportTransform.call(this,s)}});for(var c in d.StaticCanvas)c!=="prototype"&&(d.Canvas[c]=d.StaticCanvas[c])}(),function(){var u={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=d.util.addListener,h=d.util.removeListener,r=3,t=2,a=1,n={passive:!1};function c(s,i){return s.button&&s.button===i-1}d.util.object.extend(d.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(e,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(s,i){var o=this.upperCanvasEl,l=this._getEventPrefix();s(d.window,"resize",this._onResize),s(o,l+"down",this._onMouseDown),s(o,l+"move",this._onMouseMove,n),s(o,l+"out",this._onMouseOut),s(o,l+"enter",this._onMouseEnter),s(o,"wheel",this._onMouseWheel),s(o,"contextmenu",this._onContextMenu),s(o,"dblclick",this._onDoubleClick),s(o,"dragover",this._onDragOver),s(o,"dragenter",this._onDragEnter),s(o,"dragleave",this._onDragLeave),s(o,"drop",this._onDrop),this.enablePointerEvents||s(o,"touchstart",this._onTouchStart,n),typeof eventjs<"u"&&i in eventjs&&(eventjs[i](o,"gesture",this._onGesture),eventjs[i](o,"drag",this._onDrag),eventjs[i](o,"orientation",this._onOrientationChange),eventjs[i](o,"shake",this._onShake),eventjs[i](o,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(h,"remove");var s=this._getEventPrefix();h(d.document,s+"up",this._onMouseUp),h(d.document,"touchend",this._onTouchEnd,n),h(d.document,s+"move",this._onMouseMove,n),h(d.document,"touchmove",this._onMouseMove,n)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0)},_onGesture:function(s,i){this.__onTransformGesture&&this.__onTransformGesture(s,i)},_onDrag:function(s,i){this.__onDrag&&this.__onDrag(s,i)},_onMouseWheel:function(s){this.__onMouseWheel(s)},_onMouseOut:function(s){var i=this._hoveredTarget;this.fire("mouse:out",{target:i,e:s}),this._hoveredTarget=null,i&&i.fire("mouseout",{e:s});var o=this;this._hoveredTargets.forEach(function(l){o.fire("mouse:out",{target:i,e:s}),l&&i.fire("mouseout",{e:s})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(l){l.isEditing&&l.hiddenTextarea.focus()})},_onMouseEnter:function(s){!this.currentTransform&&!this.findTarget(s)&&(this.fire("mouse:over",{target:null,e:s}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(s,i){this.__onOrientationChange&&this.__onOrientationChange(s,i)},_onShake:function(s,i){this.__onShake&&this.__onShake(s,i)},_onLongPress:function(s,i){this.__onLongPress&&this.__onLongPress(s,i)},_onDragOver:function(s){s.preventDefault();var i=this._simpleEventHandler("dragover",s);this._fireEnterLeaveEvents(i,s)},_onContextMenu:function(s){return this.stopContextMenu&&(s.stopPropagation(),s.preventDefault()),!1},_onDoubleClick:function(s){this._cacheTransformEventData(s),this._handleEvent(s,"dblclick"),this._resetTransformEventData(s)},getPointerId:function(s){var i=s.changedTouches;return i?i[0]&&i[0].identifier:this.enablePointerEvents?s.pointerId:-1},_isMainEvent:function(s){return s.isPrimary===!0?!0:s.isPrimary===!1?!1:s.type==="touchend"&&s.touches.length===0?!0:s.changedTouches?s.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(s){s.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(s)),this.__onMouseDown(s),this._resetTransformEventData();var i=this.upperCanvasEl,o=this._getEventPrefix();e(d.document,"touchend",this._onTouchEnd,n),e(d.document,"touchmove",this._onMouseMove,n),h(i,o+"down",this._onMouseDown)},_onMouseDown:function(s){this.__onMouseDown(s),this._resetTransformEventData();var i=this.upperCanvasEl,o=this._getEventPrefix();h(i,o+"move",this._onMouseMove,n),e(d.document,o+"up",this._onMouseUp),e(d.document,o+"move",this._onMouseMove,n)},_onTouchEnd:function(s){if(!(s.touches.length>0)){this.__onMouseUp(s),this._resetTransformEventData(),this.mainTouchId=null;var i=this._getEventPrefix();h(d.document,"touchend",this._onTouchEnd,n),h(d.document,"touchmove",this._onMouseMove,n);var o=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){e(o.upperCanvasEl,i+"down",o._onMouseDown),o._willAddMouseDown=0},400)}},_onMouseUp:function(s){this.__onMouseUp(s),this._resetTransformEventData();var i=this.upperCanvasEl,o=this._getEventPrefix();this._isMainEvent(s)&&(h(d.document,o+"up",this._onMouseUp),h(d.document,o+"move",this._onMouseMove,n),e(i,o+"move",this._onMouseMove,n))},_onMouseMove:function(s){!this.allowTouchScrolling&&s.preventDefault&&s.preventDefault(),this.__onMouseMove(s)},_onResize:function(){this.calcOffset()},_shouldRender:function(s){var i=this._activeObject;return!!i!=!!s||i&&s&&i!==s?!0:(i&&i.isEditing,!1)},__onMouseUp:function(s){var i,o=this._currentTransform,l=this._groupSelector,f=!1,g=!l||l.left===0&&l.top===0;if(this._cacheTransformEventData(s),i=this._target,this._handleEvent(s,"up:before"),c(s,r)){this.fireRightClick&&this._handleEvent(s,"up",r,g);return}if(c(s,t)){this.fireMiddleClick&&this._handleEvent(s,"up",t,g),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(s);return}!this._isMainEvent(s)||(o&&(this._finalizeCurrentTransform(s),f=o.actionPerformed),g||(this._maybeGroupObjects(s),f||(f=this._shouldRender(i))),i&&(i.isMoving=!1),this._setCursorFromEvent(s,i),this._handleEvent(s,"up",a,g),this._groupSelector=null,this._currentTransform=null,i&&(i.__corner=0),f?this.requestRenderAll():g||this.renderTop())},_simpleEventHandler:function(s,i){var o=this.findTarget(i),l=this.targets,f={e:i,target:o,subTargets:l};if(this.fire(s,f),o&&o.fire(s,f),!l)return o;for(var g=0;g<l.length;g++)l[g].fire(s,f);return o},_handleEvent:function(s,i,o,l){var f=this._target,g=this.targets||[],m={e:s,target:f,subTargets:g,button:o||a,isClick:l||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+i,m),f&&f.fire("mouse"+i,m);for(var v=0;v<g.length;v++)g[v].fire("mouse"+i,m)},_finalizeCurrentTransform:function(s){var i=this._currentTransform,o=i.target,l,f={e:s,target:o,transform:i};o._scaling&&(o._scaling=!1),o.setCoords(),(i.actionPerformed||this.stateful&&o.hasStateChanged())&&(i.actionPerformed&&(l=this._addEventOptions(f,i),this._fire(l,f)),this._fire("modified",f))},_addEventOptions:function(s,i){var o,l;switch(i.action){case"scaleX":o="scaled",l="x";break;case"scaleY":o="scaled",l="y";break;case"skewX":o="skewed",l="x";break;case"skewY":o="skewed",l="y";break;case"scale":o="scaled",l="equally";break;case"rotate":o="rotated";break;case"drag":o="moved";break}return s.by=l,o},_onMouseDownInDrawingMode:function(s){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(s).requestRenderAll(),this.clipTo&&d.util.clipContext(this,this.contextTop);var i=this.getPointer(s);this.freeDrawingBrush.onMouseDown(i,{e:s,pointer:i}),this._handleEvent(s,"down")},_onMouseMoveInDrawingMode:function(s){if(this._isCurrentlyDrawing){var i=this.getPointer(s);this.freeDrawingBrush.onMouseMove(i,{e:s,pointer:i})}this.setCursor(this.freeDrawingCursor),this._handleEvent(s,"move")},_onMouseUpInDrawingMode:function(s){this.clipTo&&this.contextTop.restore();var i=this.getPointer(s);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:s,pointer:i}),this._handleEvent(s,"up")},__onMouseDown:function(s){this._cacheTransformEventData(s),this._handleEvent(s,"down:before");var i=this._target;if(c(s,r)){this.fireRightClick&&this._handleEvent(s,"down",r);return}if(c(s,t)){this.fireMiddleClick&&this._handleEvent(s,"down",t);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(s);return}if(!!this._isMainEvent(s)&&!this._currentTransform){var o=this._pointer;this._previousPointer=o;var l=this._shouldRender(i),f=this._shouldGroup(s,i);if(this._shouldClearSelection(s,i)?this.discardActiveObject(s):f&&(this._handleGrouping(s,i),i=this._activeObject),this.selection&&(!i||!i.selectable&&!i.isEditing&&i!==this._activeObject)&&(this._groupSelector={ex:o.x,ey:o.y,top:0,left:0}),i){var g=i===this._activeObject;i.selectable&&this.setActiveObject(i,s),i===this._activeObject&&(i.__corner||!f)&&this._setupCurrentTransform(s,i,g)}this._handleEvent(s,"down"),(l||f)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(s){this._resetTransformEventData(),this._pointer=this.getPointer(s,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(s)||null},_beforeTransform:function(s){var i=this._currentTransform;this.stateful&&i.target.saveState(),this.fire("before:transform",{e:s,transform:i}),i.corner&&this.onBeforeScaleRotate(i.target)},__onMouseMove:function(s){this._handleEvent(s,"move:before"),this._cacheTransformEventData(s);var i,o;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(s);return}if(!!this._isMainEvent(s)){var l=this._groupSelector;l?(o=this._pointer,l.left=o.x-l.ex,l.top=o.y-l.ey,this.renderTop()):this._currentTransform?this._transformObject(s):(i=this.findTarget(s)||null,this._setCursorFromEvent(s,i),this._fireOverOutEvents(i,s)),this._handleEvent(s,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(s,i){var o=this._hoveredTarget,l=this._hoveredTargets,f=this.targets,g=Math.max(l.length,f.length);this.fireSyntheticInOutEvents(s,i,{oldTarget:o,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var m=0;m<g;m++)this.fireSyntheticInOutEvents(f[m],i,{oldTarget:l[m],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=s,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(s,i){var o=this._draggedoverTarget,l=this._hoveredTargets,f=this.targets,g=Math.max(l.length,f.length);this.fireSyntheticInOutEvents(s,i,{oldTarget:o,evtOut:"dragleave",evtIn:"dragenter"});for(var m=0;m<g;m++)this.fireSyntheticInOutEvents(f[m],i,{oldTarget:l[m],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=s},fireSyntheticInOutEvents:function(s,i,o){var l,f,g=o.oldTarget,m,v,p=g!==s,_=o.canvasEvtIn,C=o.canvasEvtOut;p&&(l={e:i,target:s,previousTarget:g},f={e:i,target:g,nextTarget:s}),v=s&&p,m=g&&p,m&&(C&&this.fire(C,f),g.fire(o.evtOut,f)),v&&(_&&this.fire(_,l),s.fire(o.evtIn,l))},__onMouseWheel:function(s){this._cacheTransformEventData(s),this._handleEvent(s,"wheel"),this._resetTransformEventData()},_transformObject:function(s){var i=this.getPointer(s),o=this._currentTransform;o.reset=!1,o.target.isMoving=!0,o.shiftKey=s.shiftKey,o.altKey=s[this.centeredKey],this._beforeScaleTransform(s,o),this._performTransformAction(s,o,i),o.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(s,i,o){var l=o.x,f=o.y,g=i.action,m=!1,v={target:i.target,e:s,transform:i,pointer:o};g==="rotate"?(m=this._rotateObject(l,f))&&this._fire("rotating",v):g==="scale"?(m=this._onScale(s,i,l,f))&&this._fire("scaling",v):g==="scaleX"?(m=this._scaleObject(l,f,"x"))&&this._fire("scaling",v):g==="scaleY"?(m=this._scaleObject(l,f,"y"))&&this._fire("scaling",v):g==="skewX"?(m=this._skewObject(l,f,"x"))&&this._fire("skewing",v):g==="skewY"?(m=this._skewObject(l,f,"y"))&&this._fire("skewing",v):(m=this._translateObject(l,f),m&&(this._fire("moving",v),this.setCursor(v.target.moveCursor||this.moveCursor))),i.actionPerformed=i.actionPerformed||m},_fire:function(s,i){this.fire("object:"+s,i),i.target.fire(s,i)},_beforeScaleTransform:function(s,i){if(i.action==="scale"||i.action==="scaleX"||i.action==="scaleY"){var o=this._shouldCenterTransform(i.target);(o&&(i.originX!=="center"||i.originY!=="center")||!o&&i.originX==="center"&&i.originY==="center")&&(this._resetCurrentTransform(),i.reset=!0)}},_onScale:function(s,i,o,l){return this._isUniscalePossible(s,i.target)?(i.currentAction="scale",this._scaleObject(o,l)):(!i.reset&&i.currentAction==="scale"&&this._resetCurrentTransform(),i.currentAction="scaleEqually",this._scaleObject(o,l,"equally"))},_isUniscalePossible:function(s,i){return(s[this.uniScaleKey]||this.uniScaleTransform)&&!i.get("lockUniScaling")},_setCursorFromEvent:function(s,i){if(!i)return this.setCursor(this.defaultCursor),!1;var o=i.hoverCursor||this.hoverCursor,l=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,f=(!l||!l.contains(i))&&i._findTargetCorner(this.getPointer(s,!0));f?this.setCursor(this.getCornerCursor(f,i,s)):(i.subTargetCheck&&this.targets.concat().reverse().map(function(g){o=g.hoverCursor||o}),this.setCursor(o))},getCornerCursor:function(s,i,o){return this.actionIsDisabled(s,i,o)?this.notAllowedCursor:s in u?this._getRotatedCornerCursor(s,i,o):s==="mtr"&&i.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(s,i,o){return s==="mt"||s==="mb"?o[this.altActionKey]?i.lockSkewingX:i.lockScalingY:s==="ml"||s==="mr"?o[this.altActionKey]?i.lockSkewingY:i.lockScalingX:s==="mtr"?i.lockRotation:this._isUniscalePossible(o,i)?i.lockScalingX&&i.lockScalingY:i.lockScalingX||i.lockScalingY},_getRotatedCornerCursor:function(s,i,o){var l=Math.round(i.angle%360/45);return l<0&&(l+=8),l+=u[s],o[this.altActionKey]&&u[s]%2===0&&(l+=2),l%=8,this.cursorMap[l]}})}(),function(){var u=Math.min,e=Math.max;d.util.object.extend(d.Canvas.prototype,{_shouldGroup:function(h,r){var t=this._activeObject;return t&&this._isSelectionKeyPressed(h)&&r&&r.selectable&&this.selection&&(t!==r||t.type==="activeSelection")&&!r.onSelect({e:h})},_handleGrouping:function(h,r){var t=this._activeObject;t.__corner||r===t&&(r=this.findTarget(h,!0),!r||!r.selectable)||(t&&t.type==="activeSelection"?this._updateActiveSelection(r,h):this._createActiveSelection(r,h))},_updateActiveSelection:function(h,r){var t=this._activeObject,a=t._objects.slice(0);t.contains(h)?(t.removeWithUpdate(h),this._hoveredTarget=h,this._hoveredTargets=this.targets.concat(),t.size()===1&&this._setActiveObject(t.item(0),r)):(t.addWithUpdate(h),this._hoveredTarget=t,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(a,r)},_createActiveSelection:function(h,r){var t=this.getActiveObjects(),a=this._createGroup(h);this._hoveredTarget=a,this._setActiveObject(a,r),this._fireSelectionEvents(t,r)},_createGroup:function(h){var r=this._objects,t=r.indexOf(this._activeObject)<r.indexOf(h),a=t?[this._activeObject,h]:[h,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new d.ActiveSelection(a,{canvas:this})},_groupSelectedObjects:function(h){var r=this._collectObjects(h),t;r.length===1?this.setActiveObject(r[0],h):r.length>1&&(t=new d.ActiveSelection(r.reverse(),{canvas:this}),this.setActiveObject(t,h))},_collectObjects:function(h){for(var r=[],t,a=this._groupSelector.ex,n=this._groupSelector.ey,c=a+this._groupSelector.left,s=n+this._groupSelector.top,i=new d.Point(u(a,c),u(n,s)),o=new d.Point(e(a,c),e(n,s)),l=!this.selectionFullyContained,f=a===c&&n===s,g=this._objects.length;g--&&(t=this._objects[g],!(!(!t||!t.selectable||!t.visible)&&(l&&t.intersectsWithRect(i,o)||t.isContainedWithinRect(i,o)||l&&t.containsPoint(i)||l&&t.containsPoint(o))&&(r.push(t),f))););return r.length>1&&(r=r.filter(function(m){return!m.onSelect({e:h})})),r},_maybeGroupObjects:function(h){this.selection&&this._groupSelector&&this._groupSelectedObjects(h),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){d.util.object.extend(d.StaticCanvas.prototype,{toDataURL:function(u){u||(u={});var e=u.format||"png",h=u.quality||1,r=(u.multiplier||1)*(u.enableRetinaScaling?this.getRetinaScaling():1),t=this.toCanvasElement(r,u);return d.util.toDataURL(t,e,h)},toCanvasElement:function(u,e){u=u||1,e=e||{};var h=(e.width||this.width)*u,r=(e.height||this.height)*u,t=this.getZoom(),a=this.width,n=this.height,c=t*u,s=this.viewportTransform,i=(s[4]-(e.left||0))*u,o=(s[5]-(e.top||0))*u,l=this.interactive,f=[c,0,0,c,i,o],g=this.enableRetinaScaling,m=d.util.createCanvasElement(),v=this.contextTop;return m.width=h,m.height=r,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=f,this.width=h,this.height=r,this.calcViewportBoundaries(),this.renderCanvas(m.getContext("2d"),this._objects),this.viewportTransform=s,this.width=a,this.height=n,this.calcViewportBoundaries(),this.interactive=l,this.enableRetinaScaling=g,this.contextTop=v,m}})}(),d.util.object.extend(d.StaticCanvas.prototype,{loadFromDatalessJSON:function(u,e,h){return this.loadFromJSON(u,e,h)},loadFromJSON:function(u,e,h){if(!!u){var r=typeof u=="string"?JSON.parse(u):d.util.object.clone(u),t=this,a=r.clipPath,n=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete r.clipPath,this._enlivenObjects(r.objects,function(c){t.clear(),t._setBgOverlay(r,function(){a?t._enlivenObjects([a],function(s){t.clipPath=s[0],t.__setupCanvas.call(t,r,c,n,e)}):t.__setupCanvas.call(t,r,c,n,e)})},h),this}},__setupCanvas:function(u,e,h,r){var t=this;e.forEach(function(a,n){t.insertAt(a,n)}),this.renderOnAddRemove=h,delete u.objects,delete u.backgroundImage,delete u.overlayImage,delete u.background,delete u.overlay,this._setOptions(u),this.renderAll(),r&&r()},_setBgOverlay:function(u,e){var h={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!u.backgroundImage&&!u.overlayImage&&!u.background&&!u.overlay){e&&e();return}var r=function(){h.backgroundImage&&h.overlayImage&&h.backgroundColor&&h.overlayColor&&e&&e()};this.__setBgOverlay("backgroundImage",u.backgroundImage,h,r),this.__setBgOverlay("overlayImage",u.overlayImage,h,r),this.__setBgOverlay("backgroundColor",u.background,h,r),this.__setBgOverlay("overlayColor",u.overlay,h,r)},__setBgOverlay:function(u,e,h,r){var t=this;if(!e){h[u]=!0,r&&r();return}u==="backgroundImage"||u==="overlayImage"?d.util.enlivenObjects([e],function(a){t[u]=a[0],h[u]=!0,r&&r()}):this["set"+d.util.string.capitalize(u,!0)](e,function(){h[u]=!0,r&&r()})},_enlivenObjects:function(u,e,h){if(!u||u.length===0){e&&e([]);return}d.util.enlivenObjects(u,function(r){e&&e(r)},null,h)},_toDataURL:function(u,e){this.clone(function(h){e(h.toDataURL(u))})},_toDataURLWithMultiplier:function(u,e,h){this.clone(function(r){h(r.toDataURLWithMultiplier(u,e))})},clone:function(u,e){var h=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(r){r.loadFromJSON(h,function(){u&&u(r)})})},cloneWithoutData:function(u){var e=d.util.createCanvasElement();e.width=this.width,e.height=this.height;var h=new d.Canvas(e);h.clipTo=this.clipTo,this.backgroundImage?(h.setBackgroundImage(this.backgroundImage.src,function(){h.renderAll(),u&&u(h)}),h.backgroundImageOpacity=this.backgroundImageOpacity,h.backgroundImageStretch=this.backgroundImageStretch):u&&u(h)}}),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,r=e.util.object.clone,t=e.util.toFixed,a=e.util.string.capitalize,n=e.util.degreesToRadians,c=e.StaticCanvas.supports("setLineDash"),s=!e.isLikelyNode,i=2;e.Object||(e.Object=e.util.createClass(e.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:s,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(o){o&&this.setOptions(o)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=e.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(o){var l=e.perfLimitSizeTotal,f=o.width,g=o.height,m=e.maxCacheSideLimit,v=e.minCacheSideLimit;if(f<=m&&g<=m&&f*g<=l)return f<v&&(o.width=v),g<v&&(o.height=v),o;var p=f/g,_=e.util.limitDimsByArea(p,l),C=e.util.capValue,y=C(v,_.x,m),S=C(v,_.y,m);return f>y&&(o.zoomX/=f/y,o.width=y,o.capped=!0),g>S&&(o.zoomY/=g/S,o.height=S,o.capped=!0),o},_getCacheCanvasDimensions:function(){var o=this.getTotalObjectScaling(),l=this._getTransformedDimensions(0,0),f=l.x*o.scaleX/this.scaleX,g=l.y*o.scaleY/this.scaleY;return{width:f+i,height:g+i,zoomX:o.scaleX,zoomY:o.scaleY,x:f,y:g}},_updateCacheCanvas:function(){var o=this.canvas;if(this.noScaleCache&&o&&o._currentTransform){var l=o._currentTransform.target,f=o._currentTransform.action;if(this===l&&f.slice&&f.slice(0,5)==="scale")return!1}var g=this._cacheCanvas,m=this._limitCacheSize(this._getCacheCanvasDimensions()),v=e.minCacheSideLimit,p=m.width,_=m.height,C,y,S=m.zoomX,w=m.zoomY,O=p!==this.cacheWidth||_!==this.cacheHeight,E=this.zoomX!==S||this.zoomY!==w,L=O||E,B=0,Y=0,U=!1;if(O){var b=this._cacheCanvas.width,P=this._cacheCanvas.height,k=p>b||_>P,F=(p<b*.9||_<P*.9)&&b>v&&P>v;U=k||F,k&&!m.capped&&(p>v||_>v)&&(B=p*.1,Y=_*.1)}return L?(U?(g.width=Math.ceil(p+B),g.height=Math.ceil(_+Y)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,g.width,g.height)),C=m.x/2,y=m.y/2,this.cacheTranslationX=Math.round(g.width/2-C)+C,this.cacheTranslationY=Math.round(g.height/2-y)+y,this.cacheWidth=p,this.cacheHeight=_,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(S,w),this.zoomX=S,this.zoomY=w,!0):!1},setOptions:function(o){this._setOptions(o),this._initGradient(o.fill,"fill"),this._initGradient(o.stroke,"stroke"),this._initClipping(o),this._initPattern(o.fill,"fill"),this._initPattern(o.stroke,"stroke")},transform:function(o){var l;this.group&&!this.group._transformDone?l=this.calcTransformMatrix():l=this.calcOwnMatrix(),o.transform(l[0],l[1],l[2],l[3],l[4],l[5])},toObject:function(o){var l=e.Object.NUM_FRACTION_DIGITS,f={type:this.type,version:e.version,originX:this.originX,originY:this.originY,left:t(this.left,l),top:t(this.top,l),width:t(this.width,l),height:t(this.height,l),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:t(this.strokeWidth,l),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:t(this.strokeMiterLimit,l),scaleX:t(this.scaleX,l),scaleY:t(this.scaleY,l),angle:t(this.angle,l),flipX:this.flipX,flipY:this.flipY,opacity:t(this.opacity,l),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:t(this.skewX,l),skewY:t(this.skewY,l)};return this.clipPath&&(f.clipPath=this.clipPath.toObject(o),f.clipPath.inverted=this.clipPath.inverted,f.clipPath.absolutePositioned=this.clipPath.absolutePositioned),e.util.populateWithProperties(this,f,o),this.includeDefaultValues||(f=this._removeDefaultValues(f)),f},toDatalessObject:function(o){return this.toObject(o)},_removeDefaultValues:function(o){var l=e.util.getKlass(o.type).prototype,f=l.stateProperties;return f.forEach(function(g){if(!(g==="left"||g==="top")){o[g]===l[g]&&delete o[g];var m=Object.prototype.toString.call(o[g])==="[object Array]"&&Object.prototype.toString.call(l[g])==="[object Array]";m&&o[g].length===0&&l[g].length===0&&delete o[g]}}),o},toString:function(){return"#<fabric."+a(this.type)+">"},getObjectScaling:function(){var o=e.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(o.scaleX),scaleY:Math.abs(o.scaleY)}},getTotalObjectScaling:function(){var o=this.getObjectScaling(),l=o.scaleX,f=o.scaleY;if(this.canvas){var g=this.canvas.getZoom(),m=this.canvas.getRetinaScaling();l*=g*m,f*=g*m}return{scaleX:l,scaleY:f}},getObjectOpacity:function(){var o=this.opacity;return this.group&&(o*=this.group.getObjectOpacity()),o},_set:function(o,l){var f=o==="scaleX"||o==="scaleY",g=this[o]!==l,m=!1;return f&&(l=this._constrainScale(l)),o==="scaleX"&&l<0?(this.flipX=!this.flipX,l*=-1):o==="scaleY"&&l<0?(this.flipY=!this.flipY,l*=-1):o==="shadow"&&l&&!(l instanceof e.Shadow)?l=new e.Shadow(l):o==="dirty"&&this.group&&this.group.set("dirty",l),this[o]=l,g&&(m=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(o)>-1?(this.dirty=!0,m&&this.group.set("dirty",!0)):m&&this.stateProperties.indexOf(o)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:e.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||this.width===0&&this.height===0&&this.strokeWidth===0||!this.visible},render:function(o){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(o.save(),this._setupCompositeOperation(o),this.drawSelectionBackground(o),this.transform(o),this._setOpacity(o),this._setShadow(o,this),this.transformMatrix&&o.transform.apply(o,this.transformMatrix),this.clipTo&&e.util.clipContext(this,o),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(o)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(o),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&o.restore(),o.restore())},renderCache:function(o){o=o||{},this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,o.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(o){var l=this.clipPath;if(o.save(),l.inverted?o.globalCompositeOperation="destination-out":o.globalCompositeOperation="destination-in",l.absolutePositioned){var f=e.util.invertTransform(this.calcTransformMatrix());o.transform(f[0],f[1],f[2],f[3],f[4],f[5])}l.transform(o),o.scale(1/l.zoomX,1/l.zoomY),o.drawImage(l._cacheCanvas,-l.cacheTranslationX,-l.cacheTranslationY),o.restore()},drawObject:function(o,l){var f=this.fill,g=this.stroke;l?(this.fill="black",this.stroke="",this._setClippingProperties(o)):(this._renderBackground(o),this._setStrokeStyles(o,this),this._setFillStyles(o,this)),this._render(o),this._drawClipPath(o),this.fill=f,this.stroke=g},_drawClipPath:function(o){var l=this.clipPath;!l||(l.canvas=this.canvas,l.shouldCache(),l._transformDone=!0,l.renderCache({forClipping:!0}),this.drawClipPathOnCache(o))},drawCacheOnCanvas:function(o){o.scale(1/this.zoomX,1/this.zoomY),o.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(o){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!o&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!o){var l=this.cacheWidth/this.zoomX,f=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-l/2,-f/2,l,f)}return!0}return!1},_renderBackground:function(o){if(!!this.backgroundColor){var l=this._getNonTransformedDimensions();o.fillStyle=this.backgroundColor,o.fillRect(-l.x/2,-l.y/2,l.x,l.y),this._removeShadow(o)}},_setOpacity:function(o){this.group&&!this.group._transformDone?o.globalAlpha=this.getObjectOpacity():o.globalAlpha*=this.opacity},_setStrokeStyles:function(o,l){l.stroke&&(o.lineWidth=l.strokeWidth,o.lineCap=l.strokeLineCap,o.lineDashOffset=l.strokeDashOffset,o.lineJoin=l.strokeLineJoin,o.miterLimit=l.strokeMiterLimit,o.strokeStyle=l.stroke.toLive?l.stroke.toLive(o,this):l.stroke)},_setFillStyles:function(o,l){l.fill&&(o.fillStyle=l.fill.toLive?l.fill.toLive(o,this):l.fill)},_setClippingProperties:function(o){o.globalAlpha=1,o.strokeStyle="transparent",o.fillStyle="#000000"},_setLineDash:function(o,l,f){!l||l.length===0||(1&l.length&&l.push.apply(l,l),c?o.setLineDash(l):f&&f(o))},_renderControls:function(o,l){var f=this.getViewportTransform(),g=this.calcTransformMatrix(),m,v,p;l=l||{},v=typeof l.hasBorders<"u"?l.hasBorders:this.hasBorders,p=typeof l.hasControls<"u"?l.hasControls:this.hasControls,g=e.util.multiplyTransformMatrices(f,g),m=e.util.qrDecompose(g),o.save(),o.translate(m.translateX,m.translateY),o.lineWidth=1*this.borderScaleFactor,this.group||(o.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),l.forActiveSelection?(o.rotate(n(m.angle)),v&&this.drawBordersInGroup(o,m,l)):(o.rotate(n(this.angle)),v&&this.drawBorders(o,l)),p&&this.drawControls(o,l),o.restore()},_setShadow:function(o){if(!!this.shadow){var l=this.shadow,f=this.canvas,g,m=f&&f.viewportTransform[0]||1,v=f&&f.viewportTransform[3]||1;l.nonScaling?g={scaleX:1,scaleY:1}:g=this.getObjectScaling(),f&&f._isRetinaScaling()&&(m*=e.devicePixelRatio,v*=e.devicePixelRatio),o.shadowColor=l.color,o.shadowBlur=l.blur*e.browserShadowBlurConstant*(m+v)*(g.scaleX+g.scaleY)/4,o.shadowOffsetX=l.offsetX*m*g.scaleX,o.shadowOffsetY=l.offsetY*v*g.scaleY}},_removeShadow:function(o){!this.shadow||(o.shadowColor="",o.shadowBlur=o.shadowOffsetX=o.shadowOffsetY=0)},_applyPatternGradientTransform:function(o,l){if(!l||!l.toLive)return{offsetX:0,offsetY:0};var f=l.gradientTransform||l.patternTransform,g=-this.width/2+l.offsetX||0,m=-this.height/2+l.offsetY||0;return l.gradientUnits==="percentage"?o.transform(this.width,0,0,this.height,g,m):o.transform(1,0,0,1,g,m),f&&o.transform(f[0],f[1],f[2],f[3],f[4],f[5]),{offsetX:g,offsetY:m}},_renderPaintInOrder:function(o){this.paintFirst==="stroke"?(this._renderStroke(o),this._renderFill(o)):(this._renderFill(o),this._renderStroke(o))},_render:function(){},_renderFill:function(o){!this.fill||(o.save(),this._applyPatternGradientTransform(o,this.fill),this.fillRule==="evenodd"?o.fill("evenodd"):o.fill(),o.restore())},_renderStroke:function(o){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(o),o.save(),this.strokeUniform&&this.group){var l=this.getObjectScaling();o.scale(1/l.scaleX,1/l.scaleY)}else this.strokeUniform&&o.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(o,this.strokeDashArray,this._renderDashedStroke),this.stroke.toLive&&this.stroke.gradientUnits==="percentage"?this._applyPatternForTransformedGradient(o,this.stroke):this._applyPatternGradientTransform(o,this.stroke),o.stroke(),o.restore()}},_applyPatternForTransformedGradient:function(o,l){var f=this._limitCacheSize(this._getCacheCanvasDimensions()),g=e.util.createCanvasElement(),m,v=this.canvas.getRetinaScaling(),p=f.x/this.scaleX/v,_=f.y/this.scaleY/v;g.width=p,g.height=_,m=g.getContext("2d"),m.beginPath(),m.moveTo(0,0),m.lineTo(p,0),m.lineTo(p,_),m.lineTo(0,_),m.closePath(),m.translate(p/2,_/2),m.scale(f.zoomX/this.scaleX/v,f.zoomY/this.scaleY/v),this._applyPatternGradientTransform(m,l),m.fillStyle=l.toLive(o),m.fill(),o.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),o.scale(v*this.scaleX/f.zoomX,v*this.scaleY/f.zoomY),o.strokeStyle=m.createPattern(g,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var o=e.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",o.scaleX),this.set("scaleY",o.scaleY),this.angle=o.angle,this.skewX=o.skewX,this.skewY=0}},_removeTransformMatrix:function(o){var l=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),l=e.util.transformPoint(l,this.transformMatrix)),this.transformMatrix=null,o&&(this.scaleX*=o.scaleX,this.scaleY*=o.scaleY,this.cropX=o.cropX,this.cropY=o.cropY,l.x+=o.offsetLeft,l.y+=o.offsetTop,this.width=o.width,this.height=o.height),this.setPositionByOrigin(l,"center","center")},clone:function(o,l){var f=this.toObject(l);this.constructor.fromObject?this.constructor.fromObject(f,o):e.Object._fromObject("Object",f,o)},cloneAsImage:function(o,l){var f=this.toCanvasElement(l);return o&&o(new e.Image(f)),this},toCanvasElement:function(o){o||(o={});var l=e.util,f=l.saveObjectTransform(this),g=this.group,m=this.shadow,v=Math.abs,p=(o.multiplier||1)*(o.enableRetinaScaling?e.devicePixelRatio:1);delete this.group,o.withoutTransform&&l.resetObjectTransform(this),o.withoutShadow&&(this.shadow=null);var _=e.util.createCanvasElement(),C=this.getBoundingRect(!0,!0),y=this.shadow,S,w={x:0,y:0},O,E,L;y&&(O=y.blur,y.nonScaling?S={scaleX:1,scaleY:1}:S=this.getObjectScaling(),w.x=2*Math.round(v(y.offsetX)+O)*v(S.scaleX),w.y=2*Math.round(v(y.offsetY)+O)*v(S.scaleY)),E=C.width+w.x,L=C.height+w.y,_.width=Math.ceil(E),_.height=Math.ceil(L);var B=new e.StaticCanvas(_,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});o.format==="jpeg"&&(B.backgroundColor="#fff"),this.setPositionByOrigin(new e.Point(B.width/2,B.height/2),"center","center");var Y=this.canvas;B.add(this);var U=B.toCanvasElement(p||1,o);return this.shadow=m,this.set("canvas",Y),g&&(this.group=g),this.set(f).setCoords(),B._objects=[],B.dispose(),B=null,U},toDataURL:function(o){return o||(o={}),e.util.toDataURL(this.toCanvasElement(o),o.format||"png",o.quality||1)},isType:function(o){return this.type===o},complexity:function(){return 1},toJSON:function(o){return this.toObject(o)},setGradient:function(o,l){l||(l={});var f={colorStops:[]};return f.type=l.type||(l.r1||l.r2?"radial":"linear"),f.coords={x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2},f.gradientUnits=l.gradientUnits||"pixels",(l.r1||l.r2)&&(f.coords.r1=l.r1,f.coords.r2=l.r2),f.gradientTransform=l.gradientTransform,e.Gradient.prototype.addColorStop.call(f,l.colorStops),this.set(o,e.Gradient.forObject(this,f))},setPatternFill:function(o,l){return this.set("fill",new e.Pattern(o,l))},setShadow:function(o){return this.set("shadow",o?new e.Shadow(o):null)},setColor:function(o){return this.set("fill",o),this},rotate:function(o){var l=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return l&&this._setOriginToCenter(),this.set("angle",o),l&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(o,l){l=l||this.canvas.getPointer(o);var f=new e.Point(l.x,l.y),g=this._getLeftTopCoords();return this.angle&&(f=e.util.rotatePoint(f,g,n(-this.angle))),{x:f.x-g.x,y:f.y-g.y}},_setupCompositeOperation:function(o){this.globalCompositeOperation&&(o.globalCompositeOperation=this.globalCompositeOperation)}}),e.util.createAccessors&&e.util.createAccessors(e.Object),h(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object._fromObject=function(o,l,f,g){var m=e[o];l=r(l,!0),e.util.enlivenPatterns([l.fill,l.stroke],function(v){typeof v[0]<"u"&&(l.fill=v[0]),typeof v[1]<"u"&&(l.stroke=v[1]),e.util.enlivenObjects([l.clipPath],function(p){l.clipPath=p[0];var _=g?new m(l[g],l):new m(l);f&&f(_)})})},e.Object.__uid=0)}(W),function(){var u=d.util.degreesToRadians,e={left:-.5,center:0,right:.5},h={top:-.5,center:0,bottom:.5};d.util.object.extend(d.Object.prototype,{translateToGivenOrigin:function(r,t,a,n,c){var s=r.x,i=r.y,o,l,f;return typeof t=="string"?t=e[t]:t-=.5,typeof n=="string"?n=e[n]:n-=.5,o=n-t,typeof a=="string"?a=h[a]:a-=.5,typeof c=="string"?c=h[c]:c-=.5,l=c-a,(o||l)&&(f=this._getTransformedDimensions(),s=r.x+o*f.x,i=r.y+l*f.y),new d.Point(s,i)},translateToCenterPoint:function(r,t,a){var n=this.translateToGivenOrigin(r,t,a,"center","center");return this.angle?d.util.rotatePoint(n,r,u(this.angle)):n},translateToOriginPoint:function(r,t,a){var n=this.translateToGivenOrigin(r,"center","center",t,a);return this.angle?d.util.rotatePoint(n,r,u(this.angle)):n},getCenterPoint:function(){var r=new d.Point(this.left,this.top);return this.translateToCenterPoint(r,this.originX,this.originY)},getPointByOrigin:function(r,t){var a=this.getCenterPoint();return this.translateToOriginPoint(a,r,t)},toLocalPoint:function(r,t,a){var n=this.getCenterPoint(),c,s;return typeof t<"u"&&typeof a<"u"?c=this.translateToGivenOrigin(n,"center","center",t,a):c=new d.Point(this.left,this.top),s=new d.Point(r.x,r.y),this.angle&&(s=d.util.rotatePoint(s,n,-u(this.angle))),s.subtractEquals(c)},setPositionByOrigin:function(r,t,a){var n=this.translateToCenterPoint(r,t,a),c=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",c.x),this.set("top",c.y)},adjustPosition:function(r){var t=u(this.angle),a=this.getScaledWidth(),n=d.util.cos(t)*a,c=d.util.sin(t)*a,s,i;typeof this.originX=="string"?s=e[this.originX]:s=this.originX-.5,typeof r=="string"?i=e[r]:i=r-.5,this.left+=n*(i-s),this.top+=c*(i-s),this.setCoords(),this.originX=r},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var r=this.getCenterPoint();this.originX="center",this.originY="center",this.left=r.x,this.top=r.y},_resetOrigin:function(){var r=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=r.x,this.top=r.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function u(t){return[new d.Point(t.tl.x,t.tl.y),new d.Point(t.tr.x,t.tr.y),new d.Point(t.br.x,t.br.y),new d.Point(t.bl.x,t.bl.y)]}var e=d.util.degreesToRadians,h=d.util.multiplyTransformMatrices,r=d.util.transformPoint;d.util.object.extend(d.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(t,a){this.oCoords||this.setCoords();var n=t?this.aCoords:this.oCoords;return u(a?this.calcCoords(t):n)},intersectsWithRect:function(t,a,n,c){var s=this.getCoords(n,c),i=d.Intersection.intersectPolygonRectangle(s,t,a);return i.status==="Intersection"},intersectsWithObject:function(t,a,n){var c=d.Intersection.intersectPolygonPolygon(this.getCoords(a,n),t.getCoords(a,n));return c.status==="Intersection"||t.isContainedWithinObject(this,a,n)||this.isContainedWithinObject(t,a,n)},isContainedWithinObject:function(t,a,n){for(var c=this.getCoords(a,n),s=0,i=t._getImageLines(n?t.calcCoords(a):a?t.aCoords:t.oCoords);s<4;s++)if(!t.containsPoint(c[s],i))return!1;return!0},isContainedWithinRect:function(t,a,n,c){var s=this.getBoundingRect(n,c);return s.left>=t.x&&s.left+s.width<=a.x&&s.top>=t.y&&s.top+s.height<=a.y},containsPoint:function(t,s,n,c){var s=s||this._getImageLines(c?this.calcCoords(n):n?this.aCoords:this.oCoords),i=this._findCrossPoints(t,s);return i!==0&&i%2===1},isOnScreen:function(t){if(!this.canvas)return!1;for(var a=this.canvas.vptCoords.tl,n=this.canvas.vptCoords.br,c=this.getCoords(!0,t),s,i=0;i<4;i++)if(s=c[i],s.x<=n.x&&s.x>=a.x&&s.y<=n.y&&s.y>=a.y)return!0;return this.intersectsWithRect(a,n,!0,t)?!0:this._containsCenterOfCanvas(a,n,t)},_containsCenterOfCanvas:function(t,a,n){var c={x:(t.x+a.x)/2,y:(t.y+a.y)/2};return!!this.containsPoint(c,null,!0,n)},isPartiallyOnScreen:function(t){if(!this.canvas)return!1;var a=this.canvas.vptCoords.tl,n=this.canvas.vptCoords.br;return this.intersectsWithRect(a,n,!0,t)?!0:this._containsCenterOfCanvas(a,n,t)},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,a){var n,c,s,i,o,l=0,f;for(var g in a)if(f=a[g],!(f.o.y<t.y&&f.d.y<t.y)&&!(f.o.y>=t.y&&f.d.y>=t.y)&&(f.o.x===f.d.x&&f.o.x>=t.x?o=f.o.x:(n=0,c=(f.d.y-f.o.y)/(f.d.x-f.o.x),s=t.y-n*t.x,i=f.o.y-c*f.o.x,o=-(s-i)/(n-c)),o>=t.x&&(l+=1),l===2))break;return l},getBoundingRect:function(t,a){var n=this.getCoords(t,a);return d.util.makeBoundingBoxFromPoints(n)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t===0?1e-4:t},scale:function(t){return this._set("scaleX",t),this._set("scaleY",t),this.setCoords()},scaleToWidth:function(t,a){var n=this.getBoundingRect(a).width/this.getScaledWidth();return this.scale(t/this.width/n)},scaleToHeight:function(t,a){var n=this.getBoundingRect(a).height/this.getScaledHeight();return this.scale(t/this.height/n)},calcCoords:function(t){var a=this._calcRotateMatrix(),n=this._calcTranslateMatrix(),c=h(n,a),s=this.getViewportTransform(),i=t?c:h(s,c),o=this._getTransformedDimensions(),l=o.x/2,f=o.y/2,g=r({x:-l,y:-f},i),m=r({x:l,y:-f},i),v=r({x:-l,y:f},i),p=r({x:l,y:f},i);if(!t){var _=this.padding,C=e(this.angle),y=d.util.cos(C),S=d.util.sin(C),w=y*_,O=S*_,E=w+O,L=w-O;_&&(g.x-=L,g.y-=E,m.x+=E,m.y-=L,v.x-=E,v.y+=L,p.x+=L,p.y+=E);var B=new d.Point((g.x+v.x)/2,(g.y+v.y)/2),Y=new d.Point((m.x+g.x)/2,(m.y+g.y)/2),U=new d.Point((p.x+m.x)/2,(p.y+m.y)/2),b=new d.Point((p.x+v.x)/2,(p.y+v.y)/2),P=new d.Point(Y.x+S*this.rotatingPointOffset,Y.y-y*this.rotatingPointOffset)}var k={tl:g,tr:m,br:p,bl:v};return t||(k.ml=B,k.mt=Y,k.mr=U,k.mb=b,k.mtr=P),k},setCoords:function(t,a){return this.oCoords=this.calcCoords(t),a||(this.aCoords=this.calcCoords(!0)),t||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){return d.util.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var t=this.getCenterPoint();return[1,0,0,1,t.x,t.y]},transformMatrixKey:function(t){var a="_",n="";return!t&&this.group&&(n=this.group.transformMatrixKey(t)+a),n+this.top+a+this.left+a+this.scaleX+a+this.scaleY+a+this.skewX+a+this.skewY+a+this.angle+a+this.originX+a+this.originY+a+this.width+a+this.height+a+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(t){if(t)return this.calcOwnMatrix();var a=this.transformMatrixKey(),n=this.matrixCache||(this.matrixCache={});if(n.key===a)return n.value;var c=this.calcOwnMatrix();return this.group&&(c=h(this.group.calcTransformMatrix(),c)),n.key=a,n.value=c,c},calcOwnMatrix:function(){var t=this.transformMatrixKey(!0),a=this.ownMatrixCache||(this.ownMatrixCache={});if(a.key===t)return a.value;var n=this._calcTranslateMatrix();return this.translateX=n[4],this.translateY=n[5],a.key=t,a.value=d.util.composeMatrix(this),a.value},_calcDimensionsTransformMatrix:function(t,a,n){return d.util.calcDimensionsMatrix({skewX:t,skewY:a,scaleX:this.scaleX*(n&&this.flipX?-1:1),scaleY:this.scaleY*(n&&this.flipY?-1:1)})},_getNonTransformedDimensions:function(){var t=this.strokeWidth,a=this.width+t,n=this.height+t;return{x:a,y:n}},_getTransformedDimensions:function(t,a){typeof t>"u"&&(t=this.skewX),typeof a>"u"&&(a=this.skewY);var n=this._getNonTransformedDimensions(),c,s,i=t===0&&a===0;if(this.strokeUniform?(c=this.width,s=this.height):(c=n.x,s=n.y),i)return this._finalizeDimensions(c*this.scaleX,s*this.scaleY);c/=2,s/=2;var o=[{x:-c,y:-s},{x:c,y:-s},{x:-c,y:s},{x:c,y:s}],l=d.util.calcDimensionsMatrix({scaleX:this.scaleX,scaleY:this.scaleY,skewX:t,skewY:a}),f=d.util.makeBoundingBoxFromPoints(o,l);return this._finalizeDimensions(f.width,f.height)},_finalizeDimensions:function(t,a){return this.strokeUniform?{x:t+this.strokeWidth,y:a+this.strokeWidth}:{x:t,y:a}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),a=this._getTransformedDimensions(),n=d.util.transformPoint(a,t,!0);return n.scalarAdd(2*this.padding)}})}(),d.util.object.extend(d.Object.prototype,{sendToBack:function(){return this.group?d.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?d.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(u){return this.group?d.StaticCanvas.prototype.sendBackwards.call(this.group,this,u):this.canvas&&this.canvas.sendBackwards(this,u),this},bringForward:function(u){return this.group?d.StaticCanvas.prototype.bringForward.call(this.group,this,u):this.canvas&&this.canvas.bringForward(this,u),this},moveTo:function(u){return this.group&&this.group.type!=="activeSelection"?d.StaticCanvas.prototype.moveTo.call(this.group,this,u):this.canvas&&this.canvas.moveTo(this,u),this}}),function(){function u(h,r){if(r){if(r.toLive)return h+": url(#SVGID_"+r.id+"); ";var t=new d.Color(r),a=h+": "+t.toRgb()+"; ",n=t.getAlpha();return n!==1&&(a+=h+"-opacity: "+n.toString()+"; "),a}else return h+": none; "}var e=d.util.toFixed;d.util.object.extend(d.Object.prototype,{getSvgStyles:function(h){var r=this.fillRule?this.fillRule:"nonzero",t=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"none",n=this.strokeDashOffset?this.strokeDashOffset:"0",c=this.strokeLineCap?this.strokeLineCap:"butt",s=this.strokeLineJoin?this.strokeLineJoin:"miter",i=this.strokeMiterLimit?this.strokeMiterLimit:"4",o=typeof this.opacity<"u"?this.opacity:"1",l=this.visible?"":" visibility: hidden;",f=h?"":this.getSvgFilter(),g=u("fill",this.fill),m=u("stroke",this.stroke);return[m,"stroke-width: ",t,"; ","stroke-dasharray: ",a,"; ","stroke-linecap: ",c,"; ","stroke-dashoffset: ",n,"; ","stroke-linejoin: ",s,"; ","stroke-miterlimit: ",i,"; ",g,"fill-rule: ",r,"; ","opacity: ",o,";",f,l].join("")},getSvgSpanStyles:function(h,r){var t="; ",n=h.fontFamily?"font-family: "+(h.fontFamily.indexOf("'")===-1&&h.fontFamily.indexOf('"')===-1?"'"+h.fontFamily+"'":h.fontFamily)+t:"",a=h.strokeWidth?"stroke-width: "+h.strokeWidth+t:"",n=n,c=h.fontSize?"font-size: "+h.fontSize+"px"+t:"",s=h.fontStyle?"font-style: "+h.fontStyle+t:"",i=h.fontWeight?"font-weight: "+h.fontWeight+t:"",o=h.fill?u("fill",h.fill):"",l=h.stroke?u("stroke",h.stroke):"",f=this.getSvgTextDecoration(h),g=h.deltaY?"baseline-shift: "+-h.deltaY+"; ":"";return f&&(f="text-decoration: "+f+t),[l,a,n,c,s,i,f,o,g,r?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(h){return["overline","underline","line-through"].filter(function(r){return h[r.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(h,r){var t=h?this.calcTransformMatrix():this.calcOwnMatrix(),a='transform="'+d.util.matrixToSVG(t);return a+(r||"")+this.getSvgTransformMatrix()+'" '},getSvgTransformMatrix:function(){return this.transformMatrix?" "+d.util.matrixToSVG(this.transformMatrix):""},_setSVGBg:function(h){if(this.backgroundColor){var r=d.Object.NUM_FRACTION_DIGITS;h.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,r),'" y="',e(-this.height/2,r),'" width="',e(this.width,r),'" height="',e(this.height,r),`"></rect>
`)}},toSVG:function(h){return this._createBaseSVGMarkup(this._toSVG(h),{reviver:h})},toClipPathSVG:function(h){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(h),{reviver:h})},_createBaseClipPathSVGMarkup:function(h,r){r=r||{};var t=r.reviver,a=r.additionalTransform||"",n=[this.getSvgTransform(!0,a),this.getSvgCommons()].join(""),c=h.indexOf("COMMON_PARTS");return h[c]=n,t?t(h.join("")):h.join("")},_createBaseSVGMarkup:function(h,r){r=r||{};var t=r.noStyle,a=r.reviver,n=t?"":'style="'+this.getSvgStyles()+'" ',c=r.withShadow?'style="'+this.getSvgFilter()+'" ':"",s=this.clipPath,i=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",o=s&&s.absolutePositioned,l=this.stroke,f=this.fill,g=this.shadow,m,v=[],p,_=h.indexOf("COMMON_PARTS"),C=r.additionalTransform;return s&&(s.clipPathId="CLIPPATH_"+d.Object.__uid++,p='<clipPath id="'+s.clipPathId+`" >
`+s.toClipPathSVG(a)+`</clipPath>
`),o&&v.push("<g ",c,this.getSvgCommons(),` >
`),v.push("<g ",this.getSvgTransform(!1),o?"":c+this.getSvgCommons(),` >
`),m=[n,i,t?"":this.addPaintOrder()," ",C?'transform="'+C+'" ':""].join(""),h[_]=m,f&&f.toLive&&v.push(f.toSVG(this)),l&&l.toLive&&v.push(l.toSVG(this)),g&&v.push(g.toSVG(this)),s&&v.push(p),v.push(h.join("")),v.push(`</g>
`),o&&v.push(`</g>
`),a?a(v.join("")):v.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var u=d.util.object.extend,e="stateProperties";function h(t,a,n){var c={},s=!0;n.forEach(function(i){c[i]=t[i]}),u(t[a],c,s)}function r(t,a,n){if(t===a)return!0;if(Array.isArray(t)){if(!Array.isArray(a)||t.length!==a.length)return!1;for(var c=0,s=t.length;c<s;c++)if(!r(t[c],a[c]))return!1;return!0}else if(t&&typeof t=="object"){var i=Object.keys(t),o;if(!a||typeof a!="object"||!n&&i.length!==Object.keys(a).length)return!1;for(var c=0,s=i.length;c<s;c++)if(o=i[c],o!=="canvas"&&!r(t[o],a[o]))return!1;return!0}}d.util.object.extend(d.Object.prototype,{hasStateChanged:function(t){t=t||e;var a="_"+t;return Object.keys(this[a]).length<this[t].length?!0:!r(this[a],this,!0)},saveState:function(t){var a=t&&t.propertySet||e,n="_"+a;return this[n]?(h(this,n,this[a]),t&&t.stateProperties&&h(this,n,t.stateProperties),this):this.setupState(t)},setupState:function(t){t=t||{};var a=t.propertySet||e;return t.propertySet=a,this["_"+a]={},this.saveState(t),this}})}(),function(){var u=d.util.degreesToRadians;d.util.object.extend(d.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(e){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var h=e.x,r=e.y,t,a;this.__corner=0;for(var n in this.oCoords)if(!!this.isControlVisible(n)&&!(n==="mtr"&&!this.hasRotatingPoint)&&!(this.get("lockUniScaling")&&(n==="mt"||n==="mr"||n==="mb"||n==="ml"))&&(a=this._getImageLines(this.oCoords[n].corner),t=this._findCrossPoints({x:h,y:r},a),t!==0&&t%2===1))return this.__corner=n,n;return!1},_setCornerCoords:function(){var e=this.oCoords,h=u(45-this.angle),r=this.cornerSize*.707106,t=r*d.util.cos(h),a=r*d.util.sin(h),n,c;for(var s in e)n=e[s].x,c=e[s].y,e[s].corner={tl:{x:n-a,y:c-t},tr:{x:n+t,y:c-a},bl:{x:n-t,y:c+a},br:{x:n+a,y:c+t}}},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;e.save();var h=this.getCenterPoint(),r=this._calculateCurrentDimensions(),t=this.canvas.viewportTransform;return e.translate(h.x,h.y),e.scale(1/t[0],1/t[3]),e.rotate(u(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-r.x/2,-r.y/2,r.x,r.y),e.restore(),this},drawBorders:function(e,h){h=h||{};var r=this._calculateCurrentDimensions(),t=this.borderScaleFactor,a=r.x+t,n=r.y+t,c=typeof h.hasRotatingPoint<"u"?h.hasRotatingPoint:this.hasRotatingPoint,s=typeof h.hasControls<"u"?h.hasControls:this.hasControls,i=typeof h.rotatingPointOffset<"u"?h.rotatingPointOffset:this.rotatingPointOffset;if(e.save(),e.strokeStyle=h.borderColor||this.borderColor,this._setLineDash(e,h.borderDashArray||this.borderDashArray,null),e.strokeRect(-a/2,-n/2,a,n),c&&this.isControlVisible("mtr")&&s){var o=-n/2;e.beginPath(),e.moveTo(0,o),e.lineTo(0,o-i),e.stroke()}return e.restore(),this},drawBordersInGroup:function(e,h,r){r=r||{};var t={x:this.width,y:this.height},a=d.util.composeMatrix({scaleX:h.scaleX,scaleY:h.scaleY,skewX:h.skewX}),n=d.util.transformPoint(t,a),c=this.strokeWidth,s=this.borderScaleFactor,i=n.x+c*(this.strokeUniform?this.canvas.getZoom():h.scaleX)+s,o=n.y+c*(this.strokeUniform?this.canvas.getZoom():h.scaleY)+s;return e.save(),this._setLineDash(e,r.borderDashArray||this.borderDashArray,null),e.strokeStyle=r.borderColor||this.borderColor,e.strokeRect(-i/2,-o/2,i,o),e.restore(),this},drawControls:function(e,h){h=h||{};var r=this._calculateCurrentDimensions(),t=r.x,a=r.y,n=h.cornerSize||this.cornerSize,c=-(t+n)/2,s=-(a+n)/2,i=typeof h.transparentCorners<"u"?h.transparentCorners:this.transparentCorners,o=typeof h.hasRotatingPoint<"u"?h.hasRotatingPoint:this.hasRotatingPoint,l=i?"stroke":"fill";return e.save(),e.strokeStyle=e.fillStyle=h.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=h.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,h.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",e,l,c,s,h),this._drawControl("tr",e,l,c+t,s,h),this._drawControl("bl",e,l,c,s+a,h),this._drawControl("br",e,l,c+t,s+a,h),this.get("lockUniScaling")||(this._drawControl("mt",e,l,c+t/2,s,h),this._drawControl("mb",e,l,c+t/2,s+a,h),this._drawControl("mr",e,l,c+t,s+a/2,h),this._drawControl("ml",e,l,c,s+a/2,h)),o&&this._drawControl("mtr",e,l,c+t/2,s-this.rotatingPointOffset,h),e.restore(),this},_drawControl:function(e,h,r,t,a,n){if(n=n||{},!!this.isControlVisible(e)){var c=this.cornerSize,s=!this.transparentCorners&&this.cornerStrokeColor;switch(n.cornerStyle||this.cornerStyle){case"circle":h.beginPath(),h.arc(t+c/2,a+c/2,c/2,0,2*Math.PI,!1),h[r](),s&&h.stroke();break;default:this.transparentCorners||h.clearRect(t,a,c,c),h[r+"Rect"](t,a,c,c),s&&h.strokeRect(t,a,c,c)}}},isControlVisible:function(e){return this._getControlsVisibility()[e]},setControlVisible:function(e,h){return this._getControlsVisibility()[e]=h,this},setControlsVisibility:function(e){e||(e={});for(var h in e)this.setControlVisible(h,e[h]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})}(),d.util.object.extend(d.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(u,e){e=e||{};var h=function(){},r=e.onComplete||h,t=e.onChange||h,a=this;return d.util.animate({startValue:u.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(n){u.set("left",n),a.requestRenderAll(),t()},onComplete:function(){u.setCoords(),r()}}),this},fxCenterObjectV:function(u,e){e=e||{};var h=function(){},r=e.onComplete||h,t=e.onChange||h,a=this;return d.util.animate({startValue:u.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(n){u.set("top",n),a.requestRenderAll(),t()},onComplete:function(){u.setCoords(),r()}}),this},fxRemove:function(u,e){e=e||{};var h=function(){},r=e.onComplete||h,t=e.onChange||h,a=this;return d.util.animate({startValue:u.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(n){u.set("opacity",n),a.requestRenderAll(),t()},onComplete:function(){a.remove(u),r()}}),this}}),d.util.object.extend(d.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var u=[],e,h;for(e in arguments[0])u.push(e);for(var r=0,t=u.length;r<t;r++)e=u[r],h=r!==t-1,this._animate(e,arguments[0][e],arguments[1],h)}else this._animate.apply(this,arguments);return this},_animate:function(u,e,h,r){var t=this,a;e=e.toString(),h?h=d.util.object.clone(h):h={},~u.indexOf(".")&&(a=u.split("."));var n=a?this.get(a[0])[a[1]]:this.get(u);"from"in h||(h.from=n),~e.indexOf("=")?e=n+parseFloat(e.replace("=","")):e=parseFloat(e),d.util.animate({startValue:h.from,endValue:e,byValue:h.by,easing:h.easing,duration:h.duration,abort:h.abort&&function(){return h.abort.call(t)},onChange:function(c,s,i){a?t[a[0]][a[1]]=c:t.set(u,c),!r&&h.onChange&&h.onChange(c,s,i)},onComplete:function(c,s,i){r||(t.setCoords(),h.onComplete&&h.onComplete(c,s,i))}})}}),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,r=e.util.object.clone,t={x1:1,x2:1,y1:1,y2:1},a=e.StaticCanvas.supports("setLineDash");if(e.Line){e.warn("fabric.Line is already defined");return}e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:e.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(c,s){c||(c=[0,0,0,0]),this.callSuper("initialize",s),this.set("x1",c[0]),this.set("y1",c[1]),this.set("x2",c[2]),this.set("y2",c[3]),this._setWidthHeight(s)},_setWidthHeight:function(c){c||(c={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in c?c.left:this._getLeftToOriginX(),this.top="top"in c?c.top:this._getTopToOriginY()},_set:function(c,s){return this.callSuper("_set",c,s),typeof t[c]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:n({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:n({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(c){if(c.beginPath(),!this.strokeDashArray||this.strokeDashArray&&a){var s=this.calcLinePoints();c.moveTo(s.x1,s.y1),c.lineTo(s.x2,s.y2)}c.lineWidth=this.strokeWidth;var i=c.strokeStyle;c.strokeStyle=this.stroke||c.fillStyle,this.stroke&&this._renderStroke(c),c.strokeStyle=i},_renderDashedStroke:function(c){var s=this.calcLinePoints();c.beginPath(),e.util.drawDashedLine(c,s.x1,s.y1,s.x2,s.y2,this.strokeDashArray),c.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(c){return h(this.callSuper("toObject",c),this.calcLinePoints())},_getNonTransformedDimensions:function(){var c=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(c.y-=this.strokeWidth),this.height===0&&(c.x-=this.strokeWidth)),c},calcLinePoints:function(){var c=this.x1<=this.x2?-1:1,s=this.y1<=this.y2?-1:1,i=c*this.width*.5,o=s*this.height*.5,l=c*this.width*-.5,f=s*this.height*-.5;return{x1:i,x2:l,y1:o,y2:f}},_toSVG:function(){var c=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`" />
`]}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(c,s,i){i=i||{};var o=e.parseAttributes(c,e.Line.ATTRIBUTE_NAMES),l=[o.x1||0,o.y1||0,o.x2||0,o.y2||0];s(new e.Line(l,h(o,i)))},e.Line.fromObject=function(c,s){function i(l){delete l.points,s&&s(l)}var o=r(c,!0);o.points=[c.x1,c.y1,c.x2,c.y2],e.Object._fromObject("Line",o,i,"points")};function n(c,s){var i=c.origin,o=c.axis1,l=c.axis2,f=c.dimension,g=s.nearest,m=s.center,v=s.farthest;return function(){switch(this.get(i)){case g:return Math.min(this.get(o),this.get(l));case m:return Math.min(this.get(o),this.get(l))+.5*this.get(f);case v:return Math.max(this.get(o),this.get(l))}}}}(W),function(u){var e=u.fabric||(u.fabric={}),h=Math.PI;if(e.Circle){e.warn("fabric.Circle is already defined.");return}e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:h*2,cacheProperties:e.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(t,a){return this.callSuper("_set",t,a),t==="radius"&&this.setRadius(a),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},_toSVG:function(){var t,a=0,n=0,c=(this.endAngle-this.startAngle)%(2*h);if(c===0)t=["<circle ","COMMON_PARTS",'cx="'+a+'" cy="'+n+'" ','r="',this.radius,`" />
`];else{var s=e.util.cos(this.startAngle)*this.radius,i=e.util.sin(this.startAngle)*this.radius,o=e.util.cos(this.endAngle)*this.radius,l=e.util.sin(this.endAngle)*this.radius,f=c>h?"1":"0";t=['<path d="M '+s+" "+i," A "+this.radius+" "+this.radius," 0 ",+f+" 1"," "+o+" "+l,'" ',"COMMON_PARTS",` />
`]}return t},_render:function(t){t.beginPath(),t.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",t*2).set("height",t*2)}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(t,a){var n=e.parseAttributes(t,e.Circle.ATTRIBUTE_NAMES);if(!r(n))throw new Error("value of `r` attribute is required and can not be negative");n.left=(n.left||0)-n.radius,n.top=(n.top||0)-n.radius,a(new e.Circle(n))};function r(t){return"radius"in t&&t.radius>=0}e.Circle.fromObject=function(t,a){return e.Object._fromObject("Circle",t,a)}}(W),function(u){var e=u.fabric||(u.fabric={});if(e.Triangle){e.warn("fabric.Triangle is already defined");return}e.Triangle=e.util.createClass(e.Object,{type:"triangle",width:100,height:100,_render:function(h){var r=this.width/2,t=this.height/2;h.beginPath(),h.moveTo(-r,t),h.lineTo(0,-t),h.lineTo(r,t),h.closePath(),this._renderPaintInOrder(h)},_renderDashedStroke:function(h){var r=this.width/2,t=this.height/2;h.beginPath(),e.util.drawDashedLine(h,-r,t,0,-t,this.strokeDashArray),e.util.drawDashedLine(h,0,-t,r,t,this.strokeDashArray),e.util.drawDashedLine(h,r,t,-r,t,this.strokeDashArray),h.closePath()},_toSVG:function(){var h=this.width/2,r=this.height/2,t=[-h+" "+r,"0 "+-r,h+" "+r].join(",");return["<polygon ","COMMON_PARTS",'points="',t,'" />']}}),e.Triangle.fromObject=function(h,r){return e.Object._fromObject("Triangle",h,r)}}(W),function(u){var e=u.fabric||(u.fabric={}),h=Math.PI*2;if(e.Ellipse){e.warn("fabric.Ellipse is already defined.");return}e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(r){this.callSuper("initialize",r),this.set("rx",r&&r.rx||0),this.set("ry",r&&r.ry||0)},_set:function(r,t){switch(this.callSuper("_set",r,t),r){case"rx":this.rx=t,this.set("width",t*2);break;case"ry":this.ry=t,this.set("height",t*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(r){return this.callSuper("toObject",["rx","ry"].concat(r))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(r){r.beginPath(),r.save(),r.transform(1,0,0,this.ry/this.rx,0,0),r.arc(0,0,this.rx,0,h,!1),r.restore(),this._renderPaintInOrder(r)}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(r,t){var a=e.parseAttributes(r,e.Ellipse.ATTRIBUTE_NAMES);a.left=(a.left||0)-a.rx,a.top=(a.top||0)-a.ry,t(new e.Ellipse(a))},e.Ellipse.fromObject=function(r,t){return e.Object._fromObject("Ellipse",r,t)}}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend;if(e.Rect){e.warn("fabric.Rect is already defined");return}e.Rect=e.util.createClass(e.Object,{stateProperties:e.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(r){this.callSuper("initialize",r),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(r){var t=this.rx?Math.min(this.rx,this.width/2):0,a=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,c=this.height,s=-this.width/2,i=-this.height/2,o=t!==0||a!==0,l=1-.5522847498;r.beginPath(),r.moveTo(s+t,i),r.lineTo(s+n-t,i),o&&r.bezierCurveTo(s+n-l*t,i,s+n,i+l*a,s+n,i+a),r.lineTo(s+n,i+c-a),o&&r.bezierCurveTo(s+n,i+c-l*a,s+n-l*t,i+c,s+n-t,i+c),r.lineTo(s+t,i+c),o&&r.bezierCurveTo(s+l*t,i+c,s,i+c-l*a,s,i+c-a),r.lineTo(s,i+a),o&&r.bezierCurveTo(s,i+l*a,s+l*t,i,s+t,i),r.closePath(),this._renderPaintInOrder(r)},_renderDashedStroke:function(r){var t=-this.width/2,a=-this.height/2,n=this.width,c=this.height;r.beginPath(),e.util.drawDashedLine(r,t,a,t+n,a,this.strokeDashArray),e.util.drawDashedLine(r,t+n,a,t+n,a+c,this.strokeDashArray),e.util.drawDashedLine(r,t+n,a+c,t,a+c,this.strokeDashArray),e.util.drawDashedLine(r,t,a+c,t,a,this.strokeDashArray),r.closePath()},toObject:function(r){return this.callSuper("toObject",["rx","ry"].concat(r))},_toSVG:function(){var r=-this.width/2,t=-this.height/2;return["<rect ","COMMON_PARTS",'x="',r,'" y="',t,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(r,t,a){if(!r)return t(null);a=a||{};var n=e.parseAttributes(r,e.Rect.ATTRIBUTE_NAMES);n.left=n.left||0,n.top=n.top||0,n.height=n.height||0,n.width=n.width||0;var c=new e.Rect(h(a?e.util.object.clone(a):{},n));c.visible=c.visible&&c.width>0&&c.height>0,t(c)},e.Rect.fromObject=function(r,t){return e.Object._fromObject("Rect",r,t)}}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,r=e.util.array.min,t=e.util.array.max,a=e.util.toFixed;if(e.Polyline){e.warn("fabric.Polyline is already defined");return}e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,cacheProperties:e.Object.prototype.cacheProperties.concat("points"),initialize:function(n,c){c=c||{},this.points=n||[],this.callSuper("initialize",c),this._setPositionDimensions(c)},_setPositionDimensions:function(n){var c=this._calcDimensions(n),s;this.width=c.width,this.height=c.height,n.fromSVG||(s=this.translateToGivenOrigin({x:c.left-this.strokeWidth/2,y:c.top-this.strokeWidth/2},"left","top",this.originX,this.originY)),typeof n.left>"u"&&(this.left=n.fromSVG?c.left:s.x),typeof n.top>"u"&&(this.top=n.fromSVG?c.top:s.y),this.pathOffset={x:c.left+this.width/2,y:c.top+this.height/2}},_calcDimensions:function(){var n=this.points,c=r(n,"x")||0,s=r(n,"y")||0,i=t(n,"x")||0,o=t(n,"y")||0,l=i-c,f=o-s;return{left:c,top:s,width:l,height:f}},toObject:function(n){return h(this.callSuper("toObject",n),{points:this.points.concat()})},_toSVG:function(){for(var n=[],c=this.pathOffset.x,s=this.pathOffset.y,i=e.Object.NUM_FRACTION_DIGITS,o=0,l=this.points.length;o<l;o++)n.push(a(this.points[o].x-c,i),",",a(this.points[o].y-s,i)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',n.join(""),`" />
`]},commonRender:function(n){var c,s=this.points.length,i=this.pathOffset.x,o=this.pathOffset.y;if(!s||isNaN(this.points[s-1].y))return!1;n.beginPath(),n.moveTo(this.points[0].x-i,this.points[0].y-o);for(var l=0;l<s;l++)c=this.points[l],n.lineTo(c.x-i,c.y-o);return!0},_render:function(n){!this.commonRender(n)||this._renderPaintInOrder(n)},_renderDashedStroke:function(n){var c,s;n.beginPath();for(var i=0,o=this.points.length;i<o;i++)c=this.points[i],s=this.points[i+1]||c,e.util.drawDashedLine(n,c.x,c.y,s.x,s.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElementGenerator=function(n){return function(c,s,i){if(!c)return s(null);i||(i={});var o=e.parsePointsAttribute(c.getAttribute("points")),l=e.parseAttributes(c,e[n].ATTRIBUTE_NAMES);l.fromSVG=!0,s(new e[n](o,h(l,i)))}},e.Polyline.fromElement=e.Polyline.fromElementGenerator("Polyline"),e.Polyline.fromObject=function(n,c){return e.Object._fromObject("Polyline",n,c,"points")}}(W),function(u){var e=u.fabric||(u.fabric={});if(e.Polygon){e.warn("fabric.Polygon is already defined");return}e.Polygon=e.util.createClass(e.Polyline,{type:"polygon",_render:function(h){!this.commonRender(h)||(h.closePath(),this._renderPaintInOrder(h))},_renderDashedStroke:function(h){this.callSuper("_renderDashedStroke",h),h.closePath()}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=e.Polyline.fromElementGenerator("Polygon"),e.Polygon.fromObject=function(h,r){return e.Object._fromObject("Polygon",h,r,"points")}}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.array.min,r=e.util.array.max,t=e.util.object.extend,a=Object.prototype.toString,n=e.util.drawArc,c=e.util.toFixed,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i={m:"l",M:"L"};if(e.Path){e.warn("fabric.Path is already defined");return}e.Path=e.util.createClass(e.Object,{type:"path",path:null,cacheProperties:e.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:e.Object.prototype.stateProperties.concat("path"),initialize:function(o,l){l=l||{},this.callSuper("initialize",l),o||(o=[]);var f=a.call(o)==="[object Array]";this.path=f?o:o.match&&o.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(f||(this.path=this._parsePath()),e.Polyline.prototype._setPositionDimensions.call(this,l))},_renderPathCommands:function(o){var l,f=null,g=0,m=0,v=0,p=0,_=0,C=0,y,S,w=-this.pathOffset.x,O=-this.pathOffset.y;o.beginPath();for(var E=0,L=this.path.length;E<L;++E){switch(l=this.path[E],l[0]){case"l":v+=l[1],p+=l[2],o.lineTo(v+w,p+O);break;case"L":v=l[1],p=l[2],o.lineTo(v+w,p+O);break;case"h":v+=l[1],o.lineTo(v+w,p+O);break;case"H":v=l[1],o.lineTo(v+w,p+O);break;case"v":p+=l[1],o.lineTo(v+w,p+O);break;case"V":p=l[1],o.lineTo(v+w,p+O);break;case"m":v+=l[1],p+=l[2],g=v,m=p,o.moveTo(v+w,p+O);break;case"M":v=l[1],p=l[2],g=v,m=p,o.moveTo(v+w,p+O);break;case"c":y=v+l[5],S=p+l[6],_=v+l[3],C=p+l[4],o.bezierCurveTo(v+l[1]+w,p+l[2]+O,_+w,C+O,y+w,S+O),v=y,p=S;break;case"C":v=l[5],p=l[6],_=l[3],C=l[4],o.bezierCurveTo(l[1]+w,l[2]+O,_+w,C+O,v+w,p+O);break;case"s":y=v+l[3],S=p+l[4],f[0].match(/[CcSs]/)===null?(_=v,C=p):(_=2*v-_,C=2*p-C),o.bezierCurveTo(_+w,C+O,v+l[1]+w,p+l[2]+O,y+w,S+O),_=v+l[1],C=p+l[2],v=y,p=S;break;case"S":y=l[3],S=l[4],f[0].match(/[CcSs]/)===null?(_=v,C=p):(_=2*v-_,C=2*p-C),o.bezierCurveTo(_+w,C+O,l[1]+w,l[2]+O,y+w,S+O),v=y,p=S,_=l[1],C=l[2];break;case"q":y=v+l[3],S=p+l[4],_=v+l[1],C=p+l[2],o.quadraticCurveTo(_+w,C+O,y+w,S+O),v=y,p=S;break;case"Q":y=l[3],S=l[4],o.quadraticCurveTo(l[1]+w,l[2]+O,y+w,S+O),v=y,p=S,_=l[1],C=l[2];break;case"t":y=v+l[1],S=p+l[2],f[0].match(/[QqTt]/)===null?(_=v,C=p):(_=2*v-_,C=2*p-C),o.quadraticCurveTo(_+w,C+O,y+w,S+O),v=y,p=S;break;case"T":y=l[1],S=l[2],f[0].match(/[QqTt]/)===null?(_=v,C=p):(_=2*v-_,C=2*p-C),o.quadraticCurveTo(_+w,C+O,y+w,S+O),v=y,p=S;break;case"a":n(o,v+w,p+O,[l[1],l[2],l[3],l[4],l[5],l[6]+v+w,l[7]+p+O]),v+=l[6],p+=l[7];break;case"A":n(o,v+w,p+O,[l[1],l[2],l[3],l[4],l[5],l[6]+w,l[7]+O]),v=l[6],p=l[7];break;case"z":case"Z":v=g,p=m,o.closePath();break}f=l}},_render:function(o){this._renderPathCommands(o),this._renderPaintInOrder(o)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(o){return t(this.callSuper("toObject",o),{path:this.path.map(function(l){return l.slice()})})},toDatalessObject:function(o){var l=this.toObject(["sourcePath"].concat(o));return l.sourcePath&&delete l.path,l},_toSVG:function(){var o=this.path.map(function(l){return l.join(" ")}).join(" ");return["<path ","COMMON_PARTS",'d="',o,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var o=e.Object.NUM_FRACTION_DIGITS;return" translate("+c(-this.pathOffset.x,o)+", "+c(-this.pathOffset.y,o)+")"},toClipPathSVG:function(o){var l=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:l})},toSVG:function(o){var l=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:l})},complexity:function(){return this.path.length},_parsePath:function(){for(var o=[],l=[],f,g,m=e.rePathCommand,v,p,_=0,C,y=this.path.length;_<y;_++){for(f=this.path[_],p=f.slice(1).trim(),l.length=0;v=m.exec(p);)l.push(v[0]);C=[f.charAt(0)];for(var S=0,w=l.length;S<w;S++)g=parseFloat(l[S]),isNaN(g)||C.push(g);var O=C[0],E=s[O.toLowerCase()],L=i[O]||O;if(C.length-1>E)for(var B=1,Y=C.length;B<Y;B+=E)o.push([O].concat(C.slice(B,B+E))),O=L;else o.push(C)}return o},_calcDimensions:function(){for(var o=[],l=[],f,g=null,m=0,v=0,p=0,_=0,C=0,y=0,S,w,O,E=0,L=this.path.length;E<L;++E){switch(f=this.path[E],f[0]){case"l":p+=f[1],_+=f[2],O=[];break;case"L":p=f[1],_=f[2],O=[];break;case"h":p+=f[1],O=[];break;case"H":p=f[1],O=[];break;case"v":_+=f[1],O=[];break;case"V":_=f[1],O=[];break;case"m":p+=f[1],_+=f[2],m=p,v=_,O=[];break;case"M":p=f[1],_=f[2],m=p,v=_,O=[];break;case"c":S=p+f[5],w=_+f[6],C=p+f[3],y=_+f[4],O=e.util.getBoundsOfCurve(p,_,p+f[1],_+f[2],C,y,S,w),p=S,_=w;break;case"C":C=f[3],y=f[4],O=e.util.getBoundsOfCurve(p,_,f[1],f[2],C,y,f[5],f[6]),p=f[5],_=f[6];break;case"s":S=p+f[3],w=_+f[4],g[0].match(/[CcSs]/)===null?(C=p,y=_):(C=2*p-C,y=2*_-y),O=e.util.getBoundsOfCurve(p,_,C,y,p+f[1],_+f[2],S,w),C=p+f[1],y=_+f[2],p=S,_=w;break;case"S":S=f[3],w=f[4],g[0].match(/[CcSs]/)===null?(C=p,y=_):(C=2*p-C,y=2*_-y),O=e.util.getBoundsOfCurve(p,_,C,y,f[1],f[2],S,w),p=S,_=w,C=f[1],y=f[2];break;case"q":S=p+f[3],w=_+f[4],C=p+f[1],y=_+f[2],O=e.util.getBoundsOfCurve(p,_,C,y,C,y,S,w),p=S,_=w;break;case"Q":C=f[1],y=f[2],O=e.util.getBoundsOfCurve(p,_,C,y,C,y,f[3],f[4]),p=f[3],_=f[4];break;case"t":S=p+f[1],w=_+f[2],g[0].match(/[QqTt]/)===null?(C=p,y=_):(C=2*p-C,y=2*_-y),O=e.util.getBoundsOfCurve(p,_,C,y,C,y,S,w),p=S,_=w;break;case"T":S=f[1],w=f[2],g[0].match(/[QqTt]/)===null?(C=p,y=_):(C=2*p-C,y=2*_-y),O=e.util.getBoundsOfCurve(p,_,C,y,C,y,S,w),p=S,_=w;break;case"a":O=e.util.getBoundsOfArc(p,_,f[1],f[2],f[3],f[4],f[5],f[6]+p,f[7]+_),p+=f[6],_+=f[7];break;case"A":O=e.util.getBoundsOfArc(p,_,f[1],f[2],f[3],f[4],f[5],f[6],f[7]),p=f[6],_=f[7];break;case"z":case"Z":p=m,_=v;break}g=f,O.forEach(function(F){o.push(F.x),l.push(F.y)}),o.push(p),l.push(_)}var B=h(o)||0,Y=h(l)||0,U=r(o)||0,b=r(l)||0,P=U-B,k=b-Y;return{left:B,top:Y,width:P,height:k}}}),e.Path.fromObject=function(o,l){if(typeof o.sourcePath=="string"){var f=o.sourcePath;e.loadSVGFromURL(f,function(g){var m=g[0];m.setOptions(o),l&&l(m)})}else e.Object._fromObject("Path",o,l,"path")},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(o,l,f){var g=e.parseAttributes(o,e.Path.ATTRIBUTE_NAMES);g.fromSVG=!0,l(new e.Path(g.d,t(g,f)))}}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.array.min,r=e.util.array.max;e.Group||(e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(t,a,n){a=a||{},this._objects=[],n&&this.callSuper("initialize",a),this._objects=t||[];for(var c=this._objects.length;c--;)this._objects[c].group=this;if(n)this._updateObjectsACoords();else{var s=a&&a.centerPoint;a.originX!==void 0&&(this.originX=a.originX),a.originY!==void 0&&(this.originY=a.originY),s||this._calcBounds(),this._updateObjectsCoords(s),delete a.centerPoint,this.callSuper("initialize",a)}this.setCoords()},_updateObjectsACoords:function(){for(var t=!0,a=!0,n=this._objects.length;n--;)this._objects[n].setCoords(t,a)},_updateObjectsCoords:function(a){for(var a=a||this.getCenterPoint(),n=this._objects.length;n--;)this._updateObjectCoords(this._objects[n],a)},_updateObjectCoords:function(t,a){var n=t.left,c=t.top,s=!0,i=!0;t.set({left:n-a.x,top:c-a.y}),t.group=this,t.setCoords(s,i)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),t&&(this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){this.dirty=!0,delete t.group},_set:function(t,a){var n=this._objects.length;if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(t,a);if(t==="canvas")for(;n--;)this._objects[n]._set(t,a);e.Object.prototype._set.call(this,t,a)},toObject:function(t){var a=this.includeDefaultValues,n=this._objects.map(function(s){var i=s.includeDefaultValues;s.includeDefaultValues=a;var o=s.toObject(t);return s.includeDefaultValues=i,o}),c=e.Object.prototype.toObject.call(this,t);return c.objects=n,c},toDatalessObject:function(t){var a,n=this.sourcePath;if(n)a=n;else{var c=this.includeDefaultValues;a=this._objects.map(function(i){var o=i.includeDefaultValues;i.includeDefaultValues=c;var l=i.toDatalessObject(t);return i.includeDefaultValues=o,l})}var s=e.Object.prototype.toDatalessObject.call(this,t);return s.objects=a,s},render:function(t){this._transformDone=!0,this.callSuper("render",t),this._transformDone=!1},shouldCache:function(){var t=e.Object.prototype.shouldCache.call(this);if(t){for(var a=0,n=this._objects.length;a<n;a++)if(this._objects[a].willDrawShadow())return this.ownCaching=!1,!1}return t},willDrawShadow:function(){if(e.Object.prototype.willDrawShadow.call(this))return!0;for(var t=0,a=this._objects.length;t<a;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(t){for(var a=0,n=this._objects.length;a<n;a++)this._objects[a].render(t);this._drawClipPath(t)},isCacheDirty:function(t){if(this.callSuper("isCacheDirty",t))return!0;if(!this.statefullCache)return!1;for(var a=0,n=this._objects.length;a<n;a++)if(this._objects[a].isCacheDirty(!0)){if(this._cacheCanvas){var c=this.cacheWidth/this.zoomX,s=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-c/2,-s/2,c,s)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){var a=t.calcTransformMatrix(),n=e.util.qrDecompose(a),c=new e.Point(n.translateX,n.translateY);return t.flipX=!1,t.flipY=!1,t.set("scaleX",n.scaleX),t.set("scaleY",n.scaleY),t.skewX=n.skewX,t.skewY=n.skewY,t.angle=n.angle,t.setPositionByOrigin(c,"center","center"),t},_restoreObjectState:function(t){return this.realizeTransform(t),t.setCoords(),delete t.group,this},destroy:function(){return this._objects.forEach(function(t){t.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(!!this.canvas){var t=this._objects,a=this.canvas;this._objects=[];var n=this.toObject();delete n.objects;var c=new e.ActiveSelection([]);return c.set(n),c.type="activeSelection",a.remove(this),t.forEach(function(s){s.group=c,s.dirty=!0,a.add(s)}),c.canvas=a,c._objects=t,a._activeObject=c,c.setCoords(),c}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var t=!0,a=!0;return this.forEachObject(function(n){n.setCoords(t,a)}),this},_calcBounds:function(t){for(var a=[],n=[],c,s,i=["tr","br","bl","tl"],o=0,l=this._objects.length,f,g=i.length,m=!0;o<l;++o)for(c=this._objects[o],c.setCoords(m),f=0;f<g;f++)s=i[f],a.push(c.oCoords[s].x),n.push(c.oCoords[s].y);this._getBounds(a,n,t)},_getBounds:function(t,a,n){var c=new e.Point(h(t),h(a)),s=new e.Point(r(t),r(a)),i=c.y||0,o=c.x||0,l=s.x-c.x||0,f=s.y-c.y||0;this.width=l,this.height=f,n||this.setPositionByOrigin({x:o,y:i},"left","top")},_toSVG:function(t){for(var a=["<g ","COMMON_PARTS",` >
`],n=0,c=this._objects.length;n<c;n++)a.push("		",this._objects[n].toSVG(t));return a.push(`</g>
`),a},getSvgStyles:function(){var t=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",a=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),a].join("")},toClipPathSVG:function(t){for(var a=[],n=0,c=this._objects.length;n<c;n++)a.push("	",this._objects[n].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(a,{reviver:t})}}),e.Group.fromObject=function(t,a){var n=t.objects,c=e.util.object.clone(t,!0);if(delete c.objects,typeof n=="string"){e.loadSVGFromURL(n,function(s){var i=e.util.groupSVGElements(s,t,n);i.set(c),a&&a(i)});return}e.util.enlivenObjects(n,function(s){e.util.enlivenObjects([t.clipPath],function(i){var o=e.util.object.clone(t,!0);o.clipPath=i[0],delete o.objects,a&&a(new e.Group(s,o,!0))})})})}(W),function(u){var e=u.fabric||(u.fabric={});e.ActiveSelection||(e.ActiveSelection=e.util.createClass(e.Group,{type:"activeSelection",initialize:function(h,r){r=r||{},this._objects=h||[];for(var t=this._objects.length;t--;)this._objects[t].group=this;r.originX&&(this.originX=r.originX),r.originY&&(this.originY=r.originY),this._calcBounds(),this._updateObjectsCoords(),e.Object.prototype.initialize.call(this,r),this.setCoords()},toGroup:function(){var h=this._objects.concat();this._objects=[];var r=e.Object.prototype.toObject.call(this),t=new e.Group([]);if(delete r.type,t.set(r),h.forEach(function(n){n.canvas.remove(n),n.group=t}),t._objects=h,!this.canvas)return t;var a=this.canvas;return a.add(t),a._activeObject=t,t.setCoords(),t},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(h,r,t){h.save(),h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",h,r),t=t||{},typeof t.hasControls>"u"&&(t.hasControls=!1),typeof t.hasRotatingPoint>"u"&&(t.hasRotatingPoint=!1),t.forActiveSelection=!0;for(var a=0,n=this._objects.length;a<n;a++)this._objects[a]._renderControls(h,t);h.restore()}}),e.ActiveSelection.fromObject=function(h,r){e.util.enlivenObjects(h.objects,function(t){delete h.objects,r&&r(new e.ActiveSelection(t,h,!0))})})}(W),function(u){var e=d.util.object.extend;if(u.fabric||(u.fabric={}),u.fabric.Image){d.warn("fabric.Image is already defined.");return}d.Image=d.util.createClass(d.Object,{type:"image",crossOrigin:"",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:d.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,initialize:function(h,r){r||(r={}),this.filters=[],this.cacheKey="texture"+d.Object.__uid++,this.callSuper("initialize",r),this._initElement(h,r)},getElement:function(){return this._element||{}},setElement:function(h,r){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=h,this._originalElement=h,this._initConfig(r),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(h){var r=d.filterBackend;r&&r.evictCachesForKey&&r.evictCachesForKey(h)},dispose:function(){this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(h){d.util.cleanUpJsdomNode(this[h]),this[h]=void 0}.bind(this))},setCrossOrigin:function(h){return this.crossOrigin=h,this._element.crossOrigin=h,this},getOriginalSize:function(){var h=this.getElement();return{width:h.naturalWidth||h.width,height:h.naturalHeight||h.height}},_stroke:function(h){if(!(!this.stroke||this.strokeWidth===0)){var r=this.width/2,t=this.height/2;h.beginPath(),h.moveTo(-r,-t),h.lineTo(r,-t),h.lineTo(r,t),h.lineTo(-r,t),h.lineTo(-r,-t),h.closePath()}},_renderDashedStroke:function(h){var r=-this.width/2,t=-this.height/2,a=this.width,n=this.height;h.save(),this._setStrokeStyles(h,this),h.beginPath(),d.util.drawDashedLine(h,r,t,r+a,t,this.strokeDashArray),d.util.drawDashedLine(h,r+a,t,r+a,t+n,this.strokeDashArray),d.util.drawDashedLine(h,r+a,t+n,r,t+n,this.strokeDashArray),d.util.drawDashedLine(h,r,t+n,r,t,this.strokeDashArray),h.closePath(),h.restore()},toObject:function(h){var r=[];this.filters.forEach(function(a){a&&r.push(a.toObject())});var t=e(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(h)),{src:this.getSrc(),filters:r});return this.resizeFilter&&(t.resizeFilter=this.resizeFilter.toObject()),t},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var h=[],r=[],t,a=-this.width/2,n=-this.height/2,c="";if(this.hasCrop()){var s=d.Object.__uid++;h.push('<clipPath id="imageCrop_'+s+`">
`,'	<rect x="'+a+'" y="'+n+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),c=' clip-path="url(#imageCrop_'+s+')" '}if(r.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',a-this.cropX,'" y="',n-this.cropY,'" width="',this._element.width||this._element.naturalWidth,'" height="',this._element.height||this._element.height,'"',c,`></image>
`),this.stroke||this.strokeDashArray){var i=this.fill;this.fill=null,t=["	<rect ",'x="',a,'" y="',n,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=i}return this.paintFirst!=="fill"?h=h.concat(t,r):h=h.concat(r,t),h},getSrc:function(h){var r=h?this._element:this._originalElement;return r?r.toDataURL?r.toDataURL():this.srcFromAttribute?r.getAttribute("src"):r.src:this.src||""},setSrc:function(h,r,t){return d.util.loadImage(h,function(a){this.setElement(a,t),this._setWidthHeight(),r&&r(this)},this,t&&t.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var h=this.resizeFilter,r=this.minimumScaleTrigger,t=this.getTotalObjectScaling(),a=t.scaleX,n=t.scaleY,c=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!h||a>r&&n>r){this._element=c,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=a,this._lastScaleY=n;return}d.filterBackend||(d.filterBackend=d.initFilterBackend());var s=d.util.createCanvasElement(),i=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,o=c.width,l=c.height;s.width=o,s.height=l,this._element=s,this._lastScaleX=h.scaleX=a,this._lastScaleY=h.scaleY=n,d.filterBackend.applyFilters([h],c,o,l,this._element,i),this._filterScalingX=s.width/this._originalElement.width,this._filterScalingY=s.height/this._originalElement.height},applyFilters:function(h){if(h=h||this.filters||[],h=h.filter(function(c){return c&&!c.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),h.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var r=this._originalElement,t=r.naturalWidth||r.width,a=r.naturalHeight||r.height;if(this._element===this._originalElement){var n=d.util.createCanvasElement();n.width=t,n.height=a,this._element=n,this._filteredEl=n}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,t,a),this._lastScaleX=1,this._lastScaleY=1;return d.filterBackend||(d.filterBackend=d.initFilterBackend()),d.filterBackend.applyFilters(h,this._originalElement,t,a,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(h){this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(h),this._renderPaintInOrder(h)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(h){var r=this._element;if(!!r){var t=this._filterScalingX,a=this._filterScalingY,n=this.width,c=this.height,s=Math.min,i=Math.max,o=i(this.cropX,0),l=i(this.cropY,0),f=r.naturalWidth||r.width,g=r.naturalHeight||r.height,m=o*t,v=l*a,p=s(n*t,f-m),_=s(c*a,g-v),C=-n/2,y=-c/2,S=s(n,f/t-o),w=s(c,g/t-l);r&&h.drawImage(r,m,v,p,_,C,y,S,w)}},_needsResize:function(){var h=this.getTotalObjectScaling();return h.scaleX!==this._lastScaleX||h.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(h,r){this.setElement(d.util.getById(h),r),d.util.addClass(this.getElement(),d.Image.CSS_CANVAS)},_initConfig:function(h){h||(h={}),this.setOptions(h),this._setWidthHeight(h),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(h,r){h&&h.length?d.util.enlivenObjects(h,function(t){r&&r(t)},"fabric.Image.filters"):r&&r()},_setWidthHeight:function(h){h||(h={});var r=this.getElement();this.width=h.width||r.naturalWidth||r.width||0,this.height=h.height||r.naturalHeight||r.height||0},parsePreserveAspectRatioAttribute:function(){var h=d.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),r=this._element.width,t=this._element.height,a=1,n=1,c=0,s=0,i=0,o=0,l,f=this.width,g=this.height,m={width:f,height:g};return h&&(h.alignX!=="none"||h.alignY!=="none")?(h.meetOrSlice==="meet"&&(a=n=d.util.findScaleToFit(this._element,m),l=(f-r*a)/2,h.alignX==="Min"&&(c=-l),h.alignX==="Max"&&(c=l),l=(g-t*n)/2,h.alignY==="Min"&&(s=-l),h.alignY==="Max"&&(s=l)),h.meetOrSlice==="slice"&&(a=n=d.util.findScaleToCover(this._element,m),l=r-f/a,h.alignX==="Mid"&&(i=l/2),h.alignX==="Max"&&(i=l),l=t-g/n,h.alignY==="Mid"&&(o=l/2),h.alignY==="Max"&&(o=l),r=f/a,t=g/n)):(a=f/r,n=g/t),{width:r,height:t,scaleX:a,scaleY:n,offsetLeft:c,offsetTop:s,cropX:i,cropY:o}}}),d.Image.CSS_CANVAS="canvas-img",d.Image.prototype.getSvgSrc=d.Image.prototype.getSrc,d.Image.fromObject=function(h,r){var t=d.util.object.clone(h);d.util.loadImage(t.src,function(a,n){if(n){r&&r(null,n);return}d.Image.prototype._initFilters.call(t,t.filters,function(c){t.filters=c||[],d.Image.prototype._initFilters.call(t,[t.resizeFilter],function(s){t.resizeFilter=s[0],d.util.enlivenObjects([t.clipPath],function(i){t.clipPath=i[0];var o=new d.Image(a,t);r(o)})})})},null,t.crossOrigin)},d.Image.fromURL=function(h,r,t){d.util.loadImage(h,function(a){r&&r(new d.Image(a,t))},null,t&&t.crossOrigin)},d.Image.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")),d.Image.fromElement=function(h,r,t){var a=d.parseAttributes(h,d.Image.ATTRIBUTE_NAMES);d.Image.fromURL(a["xlink:href"],r,e(t?d.util.object.clone(t):{},a))}}(W),d.util.object.extend(d.Object.prototype,{_getAngleValueForStraighten:function(){var u=this.angle%360;return u>0?Math.round((u-1)/90)*90:Math.round(u/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(u){u=u||{};var e=function(){},h=u.onComplete||e,r=u.onChange||e,t=this;return d.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){t.rotate(a),r()},onComplete:function(){t.setCoords(),h()}}),this}}),d.util.object.extend(d.StaticCanvas.prototype,{straightenObject:function(u){return u.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(u){return u.fxStraighten({onChange:this.requestRenderAllBound}),this}}),function(){function u(h,r){var t="precision "+r+` float;
void main(){}`,a=h.createShader(h.FRAGMENT_SHADER);return h.shaderSource(a,t),h.compileShader(a),!!h.getShaderParameter(a,h.COMPILE_STATUS)}d.isWebglSupported=function(h){if(d.isLikelyNode)return!1;h=h||d.WebglFilterBackend.prototype.tileSize;var r=document.createElement("canvas"),t=r.getContext("webgl")||r.getContext("experimental-webgl"),a=!1;if(t){d.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),a=d.maxTextureSize>=h;for(var n=["highp","mediump","lowp"],c=0;c<3;c++)if(u(t,n[c])){d.webGlPrecision=n[c];break}}return this.isSupported=a,a},d.WebglFilterBackend=e;function e(h){h&&h.tileSize&&(this.tileSize=h.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}e.prototype={tileSize:2048,resources:{},setupGLContext:function(h,r){this.dispose(),this.createWebGLCanvas(h,r),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(h,r)},chooseFastestCopyGLTo2DMethod:function(h,r){var t=typeof window.performance<"u",a;try{new ImageData(1,1),a=!0}catch{a=!1}var n=typeof ArrayBuffer<"u",c=typeof Uint8ClampedArray<"u";if(!!(t&&a&&n&&c)){var s=d.util.createCanvasElement(),i=new ArrayBuffer(h*r*4);if(d.forceGLPutImageData){this.imageBuffer=i,this.copyGLTo2D=M;return}var o={imageBuffer:i,destinationWidth:h,destinationHeight:r,targetCanvas:s},l,f,g;s.width=h,s.height=r,l=window.performance.now(),V.call(o,this.gl,o),f=window.performance.now()-l,l=window.performance.now(),M.call(o,this.gl,o),g=window.performance.now()-l,f>g?(this.imageBuffer=i,this.copyGLTo2D=M):this.copyGLTo2D=V}},createWebGLCanvas:function(h,r){var t=d.util.createCanvasElement();t.width=h,t.height=r;var a={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},n=t.getContext("webgl",a);n||(n=t.getContext("experimental-webgl",a)),n&&(n.clearColor(0,0,0,0),this.canvas=t,this.gl=n)},applyFilters:function(h,r,t,a,n,c){var s=this.gl,i;c&&(i=this.getCachedTexture(c,r));var o={originalWidth:r.width||r.originalWidth,originalHeight:r.height||r.originalHeight,sourceWidth:t,sourceHeight:a,destinationWidth:t,destinationHeight:a,context:s,sourceTexture:this.createTexture(s,t,a,!i&&r),targetTexture:this.createTexture(s,t,a),originalTexture:i||this.createTexture(s,t,a,!i&&r),passes:h.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:n},l=s.createFramebuffer();return s.bindFramebuffer(s.FRAMEBUFFER,l),h.forEach(function(f){f&&f.applyTo(o)}),ot(o),this.copyGLTo2D(s,o),s.bindTexture(s.TEXTURE_2D,null),s.deleteTexture(o.sourceTexture),s.deleteTexture(o.targetTexture),s.deleteFramebuffer(l),n.getContext("2d").setTransform(1,0,0,1,0,0),o},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(h,r,t,a){var n=h.createTexture();return h.bindTexture(h.TEXTURE_2D,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),a?h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,a):h.texImage2D(h.TEXTURE_2D,0,h.RGBA,r,t,0,h.RGBA,h.UNSIGNED_BYTE,null),n},getCachedTexture:function(h,r){if(this.textureCache[h])return this.textureCache[h];var t=this.createTexture(this.gl,r.width,r.height,r);return this.textureCache[h]=t,t},evictCachesForKey:function(h){this.textureCache[h]&&(this.gl.deleteTexture(this.textureCache[h]),delete this.textureCache[h])},copyGLTo2D:V,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var h=this.gl,r={renderer:"",vendor:""};if(!h)return r;var t=h.getExtension("WEBGL_debug_renderer_info");if(t){var a=h.getParameter(t.UNMASKED_RENDERER_WEBGL),n=h.getParameter(t.UNMASKED_VENDOR_WEBGL);a&&(r.renderer=a.toLowerCase()),n&&(r.vendor=n.toLowerCase())}return this.gpuInfo=r,r}}}();function ot(u){var e=u.targetCanvas,h=e.width,r=e.height,t=u.destinationWidth,a=u.destinationHeight;(h!==t||r!==a)&&(e.width=t,e.height=a)}function V(u,e){var h=u.canvas,r=e.targetCanvas,t=r.getContext("2d");t.translate(0,r.height),t.scale(1,-1);var a=h.height-r.height;t.drawImage(h,0,a,r.width,r.height,0,0,r.width,r.height)}function M(u,e){var h=e.targetCanvas,r=h.getContext("2d"),t=e.destinationWidth,a=e.destinationHeight,n=t*a*4,c=new Uint8Array(this.imageBuffer,0,n),s=new Uint8ClampedArray(this.imageBuffer,0,n);u.readPixels(0,0,t,a,u.RGBA,u.UNSIGNED_BYTE,c);var i=new ImageData(s,t,a);r.putImageData(i,0,0)}(function(){var u=function(){};d.Canvas2dFilterBackend=e;function e(){}e.prototype={evictCachesForKey:u,dispose:u,clearWebGLCaches:u,resources:{},applyFilters:function(h,r,t,a,n){var c=n.getContext("2d");c.drawImage(r,0,0,t,a);var s=c.getImageData(0,0,t,a),i=c.getImageData(0,0,t,a),o={sourceWidth:t,sourceHeight:a,imageData:s,originalEl:r,originalImageData:i,canvasEl:n,ctx:c,filterBackend:this};return h.forEach(function(l){l.applyTo(o)}),(o.imageData.width!==t||o.imageData.height!==a)&&(n.width=o.imageData.width,n.height=o.imageData.height),c.putImageData(o.imageData,0,0),o}}})(),d.Image=d.Image||{},d.Image.filters=d.Image.filters||{},d.Image.filters.BaseFilter=d.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(u){u&&this.setOptions(u)},setOptions:function(u){for(var e in u)this[e]=u[e]},createProgram:function(u,e,h){e=e||this.fragmentSource,h=h||this.vertexSource,d.webGlPrecision!=="highp"&&(e=e.replace(/precision highp float/g,"precision "+d.webGlPrecision+" float"));var r=u.createShader(u.VERTEX_SHADER);if(u.shaderSource(r,h),u.compileShader(r),!u.getShaderParameter(r,u.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+u.getShaderInfoLog(r));var t=u.createShader(u.FRAGMENT_SHADER);if(u.shaderSource(t,e),u.compileShader(t),!u.getShaderParameter(t,u.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+u.getShaderInfoLog(t));var a=u.createProgram();if(u.attachShader(a,r),u.attachShader(a,t),u.linkProgram(a),!u.getProgramParameter(a,u.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+u.getProgramInfoLog(a));var n=this.getAttributeLocations(u,a),c=this.getUniformLocations(u,a)||{};return c.uStepW=u.getUniformLocation(a,"uStepW"),c.uStepH=u.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:n,uniformLocations:c}},getAttributeLocations:function(u,e){return{aPosition:u.getAttribLocation(e,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(u,e,h){var r=e.aPosition,t=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,t),u.enableVertexAttribArray(r),u.vertexAttribPointer(r,2,u.FLOAT,!1,0,0),u.bufferData(u.ARRAY_BUFFER,h,u.STATIC_DRAW)},_setupFrameBuffer:function(u){var e=u.context,h,r;u.passes>1?(h=u.destinationWidth,r=u.destinationHeight,(u.sourceWidth!==h||u.sourceHeight!==r)&&(e.deleteTexture(u.targetTexture),u.targetTexture=u.filterBackend.createTexture(e,h,r)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,u.targetTexture,0)):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish())},_swapTextures:function(u){u.passes--,u.pass++;var e=u.targetTexture;u.targetTexture=u.sourceTexture,u.sourceTexture=e},isNeutralState:function(){var u=this.mainParameter,e=d.Image.filters[this.type].prototype;if(u)if(Array.isArray(e[u])){for(var h=e[u].length;h--;)if(this[u][h]!==e[u][h])return!1;return!0}else return e[u]===this[u];else return!1},applyTo:function(u){u.webgl?(this._setupFrameBuffer(u),this.applyToWebGL(u),this._swapTextures(u)):this.applyTo2d(u)},retrieveShader:function(u){return u.programCache.hasOwnProperty(this.type)||(u.programCache[this.type]=this.createProgram(u.context)),u.programCache[this.type]},applyToWebGL:function(u){var e=u.context,h=this.retrieveShader(u);u.pass===0&&u.originalTexture?e.bindTexture(e.TEXTURE_2D,u.originalTexture):e.bindTexture(e.TEXTURE_2D,u.sourceTexture),e.useProgram(h.program),this.sendAttributeData(e,h.attributeLocations,u.aPosition),e.uniform1f(h.uniformLocations.uStepW,1/u.sourceWidth),e.uniform1f(h.uniformLocations.uStepH,1/u.sourceHeight),this.sendUniformData(e,h.uniformLocations),e.viewport(0,0,u.destinationWidth,u.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(u,e,h){u.activeTexture(h),u.bindTexture(u.TEXTURE_2D,e),u.activeTexture(u.TEXTURE0)},unbindAdditionalTexture:function(u,e){u.activeTexture(e),u.bindTexture(u.TEXTURE_2D,null),u.activeTexture(u.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(u){this[this.mainParameter]=u},sendUniformData:function(){},createHelpLayer:function(u){if(!u.helpLayer){var e=document.createElement("canvas");e.width=u.sourceWidth,e.height=u.sourceHeight,u.helpLayer=e}},toObject:function(){var u={type:this.type},e=this.mainParameter;return e&&(u[e]=this[e]),u},toJSON:function(){return this.toObject()}}),d.Image.filters.BaseFilter.fromObject=function(u,e){var h=new d.Image.filters[u.type](u);return e&&e(h),h},function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,r=e.util.createClass;h.ColorMatrix=r(h.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(t){this.callSuper("initialize",t),this.matrix=this.matrix.slice(0)},applyTo2d:function(t){var a=t.imageData,n=a.data,c=n.length,s=this.matrix,i,o,l,f,g,m=this.colorsOnly;for(g=0;g<c;g+=4)i=n[g],o=n[g+1],l=n[g+2],m?(n[g]=i*s[0]+o*s[1]+l*s[2]+s[4]*255,n[g+1]=i*s[5]+o*s[6]+l*s[7]+s[9]*255,n[g+2]=i*s[10]+o*s[11]+l*s[12]+s[14]*255):(f=n[g+3],n[g]=i*s[0]+o*s[1]+l*s[2]+f*s[3]+s[4]*255,n[g+1]=i*s[5]+o*s[6]+l*s[7]+f*s[8]+s[9]*255,n[g+2]=i*s[10]+o*s[11]+l*s[12]+f*s[13]+s[14]*255,n[g+3]=i*s[15]+o*s[16]+l*s[17]+f*s[18]+s[19]*255)},getUniformLocations:function(t,a){return{uColorMatrix:t.getUniformLocation(a,"uColorMatrix"),uConstants:t.getUniformLocation(a,"uConstants")}},sendUniformData:function(t,a){var n=this.matrix,c=[n[0],n[1],n[2],n[3],n[5],n[6],n[7],n[8],n[10],n[11],n[12],n[13],n[15],n[16],n[17],n[18]],s=[n[4],n[9],n[14],n[19]];t.uniformMatrix4fv(a.uColorMatrix,!1,c),t.uniform4fv(a.uConstants,s)}}),e.Image.filters.ColorMatrix.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Brightness=r(h.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(t){if(this.brightness!==0){var a=t.imageData,n=a.data,c,s=n.length,i=Math.round(this.brightness*255);for(c=0;c<s;c+=4)n[c]=n[c]+i,n[c+1]=n[c+1]+i,n[c+2]=n[c+2]+i}},getUniformLocations:function(t,a){return{uBrightness:t.getUniformLocation(a,"uBrightness")}},sendUniformData:function(t,a){t.uniform1f(a.uBrightness,this.brightness)}}),e.Image.filters.Brightness.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,r=e.Image.filters,t=e.util.createClass;r.Convolute=t(r.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(a){var n=Math.sqrt(this.matrix.length),c=this.type+"_"+n+"_"+(this.opaque?1:0),s=this.fragmentSource[c];return a.programCache.hasOwnProperty(c)||(a.programCache[c]=this.createProgram(a.context,s)),a.programCache[c]},applyTo2d:function(a){var n=a.imageData,c=n.data,s=this.matrix,i=Math.round(Math.sqrt(s.length)),o=Math.floor(i/2),l=n.width,f=n.height,g=a.ctx.createImageData(l,f),m=g.data,v=this.opaque?1:0,p,_,C,y,S,w,O,E,L,B,Y,U,b;for(Y=0;Y<f;Y++)for(B=0;B<l;B++){for(S=(Y*l+B)*4,p=0,_=0,C=0,y=0,b=0;b<i;b++)for(U=0;U<i;U++)O=Y+b-o,w=B+U-o,!(O<0||O>=f||w<0||w>=l)&&(E=(O*l+w)*4,L=s[b*i+U],p+=c[E]*L,_+=c[E+1]*L,C+=c[E+2]*L,v||(y+=c[E+3]*L));m[S]=p,m[S+1]=_,m[S+2]=C,v?m[S+3]=c[S+3]:m[S+3]=y}a.imageData=g},getUniformLocations:function(a,n){return{uMatrix:a.getUniformLocation(n,"uMatrix"),uOpaque:a.getUniformLocation(n,"uOpaque"),uHalfSize:a.getUniformLocation(n,"uHalfSize"),uSize:a.getUniformLocation(n,"uSize")}},sendUniformData:function(a,n){a.uniform1fv(n.uMatrix,this.matrix)},toObject:function(){return h(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Grayscale=r(h.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(t){var a=t.imageData,n=a.data,c,s=n.length,i,o=this.mode;for(c=0;c<s;c+=4)o==="average"?i=(n[c]+n[c+1]+n[c+2])/3:o==="lightness"?i=(Math.min(n[c],n[c+1],n[c+2])+Math.max(n[c],n[c+1],n[c+2]))/2:o==="luminosity"&&(i=.21*n[c]+.72*n[c+1]+.07*n[c+2]),n[c]=i,n[c+1]=i,n[c+2]=i},retrieveShader:function(t){var a=this.type+"_"+this.mode;if(!t.programCache.hasOwnProperty(a)){var n=this.fragmentSource[this.mode];t.programCache[a]=this.createProgram(t.context,n)}return t.programCache[a]},getUniformLocations:function(t,a){return{uMode:t.getUniformLocation(a,"uMode")}},sendUniformData:function(t,a){var n=1;t.uniform1i(a.uMode,n)},isNeutralState:function(){return!1}}),e.Image.filters.Grayscale.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Invert=r(h.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(t){var a=t.imageData,n=a.data,c,s=n.length;for(c=0;c<s;c+=4)n[c]=255-n[c],n[c+1]=255-n[c+1],n[c+2]=255-n[c+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(t,a){return{uInvert:t.getUniformLocation(a,"uInvert")}},sendUniformData:function(t,a){t.uniform1i(a.uInvert,this.invert)}}),e.Image.filters.Invert.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,r=e.Image.filters,t=e.util.createClass;r.Noise=t(r.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(a){if(this.noise!==0){var n=a.imageData,c=n.data,s,i=c.length,o=this.noise,l;for(s=0,i=c.length;s<i;s+=4)l=(.5-Math.random())*o,c[s]+=l,c[s+1]+=l,c[s+2]+=l}},getUniformLocations:function(a,n){return{uNoise:a.getUniformLocation(n,"uNoise"),uSeed:a.getUniformLocation(n,"uSeed")}},sendUniformData:function(a,n){a.uniform1f(n.uNoise,this.noise/255),a.uniform1f(n.uSeed,Math.random())},toObject:function(){return h(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Pixelate=r(h.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(t){var a=t.imageData,n=a.data,c=a.height,s=a.width,i,o,l,f,g,m,v,p,_,C,y;for(o=0;o<c;o+=this.blocksize)for(l=0;l<s;l+=this.blocksize)for(i=o*4*s+l*4,f=n[i],g=n[i+1],m=n[i+2],v=n[i+3],C=Math.min(o+this.blocksize,c),y=Math.min(l+this.blocksize,s),p=o;p<C;p++)for(_=l;_<y;_++)i=p*4*s+_*4,n[i]=f,n[i+1]=g,n[i+2]=m,n[i+3]=v},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(t,a){return{uBlocksize:t.getUniformLocation(a,"uBlocksize"),uStepW:t.getUniformLocation(a,"uStepW"),uStepH:t.getUniformLocation(a,"uStepH")}},sendUniformData:function(t,a){t.uniform1f(a.uBlocksize,this.blocksize)}}),e.Image.filters.Pixelate.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,r=e.Image.filters,t=e.util.createClass;r.RemoveColor=t(r.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(a){var n=a.imageData,c=n.data,s,i=this.distance*255,o,l,f,g=new e.Color(this.color).getSource(),m=[g[0]-i,g[1]-i,g[2]-i],v=[g[0]+i,g[1]+i,g[2]+i];for(s=0;s<c.length;s+=4)o=c[s],l=c[s+1],f=c[s+2],o>m[0]&&l>m[1]&&f>m[2]&&o<v[0]&&l<v[1]&&f<v[2]&&(c[s+3]=0)},getUniformLocations:function(a,n){return{uLow:a.getUniformLocation(n,"uLow"),uHigh:a.getUniformLocation(n,"uHigh")}},sendUniformData:function(a,n){var c=new e.Color(this.color).getSource(),s=parseFloat(this.distance),i=[0+c[0]/255-s,0+c[1]/255-s,0+c[2]/255-s,1],o=[c[0]/255+s,c[1]/255+s,c[2]/255+s,1];a.uniform4fv(n.uLow,i),a.uniform4fv(n.uHigh,o)},toObject:function(){return h(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),e.Image.filters.RemoveColor.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,r=e.util.createClass,t={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var a in t)h[a]=r(h.ColorMatrix,{type:a,matrix:t[a],mainParameter:!1,colorsOnly:!0}),e.Image.filters[a].fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric,h=e.Image.filters,r=e.util.createClass;h.BlendColor=r(h.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(t){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[t]+`}
}`},retrieveShader:function(t){var a=this.type+"_"+this.mode,n;return t.programCache.hasOwnProperty(a)||(n=this.buildSource(this.mode),t.programCache[a]=this.createProgram(t.context,n)),t.programCache[a]},applyTo2d:function(t){var a=t.imageData,n=a.data,c=n.length,s,i,o,l,f,g,m,v=1-this.alpha;m=new e.Color(this.color).getSource(),s=m[0]*this.alpha,i=m[1]*this.alpha,o=m[2]*this.alpha;for(var p=0;p<c;p+=4)switch(l=n[p],f=n[p+1],g=n[p+2],this.mode){case"multiply":n[p]=l*s/255,n[p+1]=f*i/255,n[p+2]=g*o/255;break;case"screen":n[p]=255-(255-l)*(255-s)/255,n[p+1]=255-(255-f)*(255-i)/255,n[p+2]=255-(255-g)*(255-o)/255;break;case"add":n[p]=l+s,n[p+1]=f+i,n[p+2]=g+o;break;case"diff":case"difference":n[p]=Math.abs(l-s),n[p+1]=Math.abs(f-i),n[p+2]=Math.abs(g-o);break;case"subtract":n[p]=l-s,n[p+1]=f-i,n[p+2]=g-o;break;case"darken":n[p]=Math.min(l,s),n[p+1]=Math.min(f,i),n[p+2]=Math.min(g,o);break;case"lighten":n[p]=Math.max(l,s),n[p+1]=Math.max(f,i),n[p+2]=Math.max(g,o);break;case"overlay":n[p]=s<128?2*l*s/255:255-2*(255-l)*(255-s)/255,n[p+1]=i<128?2*f*i/255:255-2*(255-f)*(255-i)/255,n[p+2]=o<128?2*g*o/255:255-2*(255-g)*(255-o)/255;break;case"exclusion":n[p]=s+l-2*s*l/255,n[p+1]=i+f-2*i*f/255,n[p+2]=o+g-2*o*g/255;break;case"tint":n[p]=s+l*v,n[p+1]=i+f*v,n[p+2]=o+g*v}},getUniformLocations:function(t,a){return{uColor:t.getUniformLocation(a,"uColor")}},sendUniformData:function(t,a){var n=new e.Color(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,t.uniform4fv(a.uColor,n)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendColor.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric,h=e.Image.filters,r=e.util.createClass;h.BlendImage=r(h.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(t){var a=this.type+"_"+this.mode,n=this.fragmentSource[this.mode];return t.programCache.hasOwnProperty(a)||(t.programCache[a]=this.createProgram(t.context,n)),t.programCache[a]},applyToWebGL:function(t){var a=t.context,n=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(a,n,a.TEXTURE1),this.callSuper("applyToWebGL",t),this.unbindAdditionalTexture(a,a.TEXTURE1)},createTexture:function(t,a){return t.getCachedTexture(a.cacheKey,a._element)},calculateMatrix:function(){var t=this.image,a=t._element.width,n=t._element.height;return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/a,-t.top/n,1]},applyTo2d:function(t){var a=t.imageData,n=t.filterBackend.resources,c=a.data,s=c.length,i=a.width,o=a.height,l,f,g,m,v,p,_,C,y,S,w=this.image,O;n.blendImage||(n.blendImage=e.util.createCanvasElement()),y=n.blendImage,S=y.getContext("2d"),y.width!==i||y.height!==o?(y.width=i,y.height=o):S.clearRect(0,0,i,o),S.setTransform(w.scaleX,0,0,w.scaleY,w.left,w.top),S.drawImage(w._element,0,0,i,o),O=S.getImageData(0,0,i,o).data;for(var E=0;E<s;E+=4)switch(v=c[E],p=c[E+1],_=c[E+2],C=c[E+3],l=O[E],f=O[E+1],g=O[E+2],m=O[E+3],this.mode){case"multiply":c[E]=v*l/255,c[E+1]=p*f/255,c[E+2]=_*g/255,c[E+3]=C*m/255;break;case"mask":c[E+3]=m;break}},getUniformLocations:function(t,a){return{uTransformMatrix:t.getUniformLocation(a,"uTransformMatrix"),uImage:t.getUniformLocation(a,"uImage")}},sendUniformData:function(t,a){var n=this.calculateMatrix();t.uniform1i(a.uImage,1),t.uniformMatrix3fv(a.uTransformMatrix,!1,n)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendImage.fromObject=function(t,a){e.Image.fromObject(t.image,function(n){var c=e.util.object.clone(t);c.image=n,a(new e.Image.filters.BlendImage(c))})}}(W),function(u){var e=u.fabric||(u.fabric={}),h=Math.pow,r=Math.floor,t=Math.sqrt,a=Math.abs,n=Math.round,c=Math.sin,s=Math.ceil,i=e.Image.filters,o=e.util.createClass;i.Resize=o(i.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(l,f){return{uDelta:l.getUniformLocation(f,"uDelta"),uTaps:l.getUniformLocation(f,"uTaps")}},sendUniformData:function(l,f){l.uniform2fv(f.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),l.uniform1fv(f.uTaps,this.taps)},retrieveShader:function(l){var f=this.getFilterWindow(),g=this.type+"_"+f;if(!l.programCache.hasOwnProperty(g)){var m=this.generateShader(f);l.programCache[g]=this.createProgram(l.context,m)}return l.programCache[g]},getFilterWindow:function(){var l=this.tempScale;return Math.ceil(this.lanczosLobes/l)},getTaps:function(){for(var l=this.lanczosCreate(this.lanczosLobes),f=this.tempScale,g=this.getFilterWindow(),m=new Array(g),v=1;v<=g;v++)m[v-1]=l(v*f);return m},generateShader:function(m){for(var f=new Array(m),g=this.fragmentSourceTOP,m,v=1;v<=m;v++)f[v-1]=v+".0 * uDelta";return g+="uniform float uTaps["+m+`];
`,g+=`void main() {
`,g+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,g+=`  float sum = 1.0;
`,f.forEach(function(p,_){g+="  color += texture2D(uTexture, vTexCoord + "+p+") * uTaps["+_+`];
`,g+="  color += texture2D(uTexture, vTexCoord - "+p+") * uTaps["+_+`];
`,g+="  sum += 2.0 * uTaps["+_+`];
`}),g+=`  gl_FragColor = color / sum;
`,g+="}",g},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(l){l.webgl?(l.passes++,this.width=l.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=l.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),l.destinationWidth=this.dW,this._setupFrameBuffer(l),this.applyToWebGL(l),this._swapTextures(l),l.sourceWidth=l.destinationWidth,this.height=l.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),l.destinationHeight=this.dH,this._setupFrameBuffer(l),this.applyToWebGL(l),this._swapTextures(l),l.sourceHeight=l.destinationHeight):this.applyTo2d(l)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(l){return function(f){if(f>=l||f<=-l)return 0;if(f<11920929e-14&&f>-11920929e-14)return 1;f*=Math.PI;var g=f/l;return c(f)/f*c(g)/g}},applyTo2d:function(l){var f=l.imageData,g=this.scaleX,m=this.scaleY;this.rcpScaleX=1/g,this.rcpScaleY=1/m;var v=f.width,p=f.height,_=n(v*g),C=n(p*m),y;this.resizeType==="sliceHack"?y=this.sliceByTwo(l,v,p,_,C):this.resizeType==="hermite"?y=this.hermiteFastResize(l,v,p,_,C):this.resizeType==="bilinear"?y=this.bilinearFiltering(l,v,p,_,C):this.resizeType==="lanczos"&&(y=this.lanczosResize(l,v,p,_,C)),l.imageData=y},sliceByTwo:function(l,f,g,m,v){var p=l.imageData,_=.5,C=!1,y=!1,S=f*_,w=g*_,O=e.filterBackend.resources,E,L,B=0,Y=0,U=f,b=0;for(O.sliceByTwo||(O.sliceByTwo=document.createElement("canvas")),E=O.sliceByTwo,(E.width<f*1.5||E.height<g)&&(E.width=f*1.5,E.height=g),L=E.getContext("2d"),L.clearRect(0,0,f*1.5,g),L.putImageData(p,0,0),m=r(m),v=r(v);!C||!y;)f=S,g=w,m<r(S*_)?S=r(S*_):(S=m,C=!0),v<r(w*_)?w=r(w*_):(w=v,y=!0),L.drawImage(E,B,Y,f,g,U,b,S,w),B=U,Y=b,b+=w;return L.getImageData(B,Y,m,v)},lanczosResize:function(l,f,g,m,v){function p(k){var F,z,x,T,D,A,I,j,R,X,G;for(b.x=(k+.5)*w,P.x=r(b.x),F=0;F<v;F++){for(b.y=(F+.5)*O,P.y=r(b.y),D=0,A=0,I=0,j=0,R=0,z=P.x-B;z<=P.x+B;z++)if(!(z<0||z>=f)){X=r(1e3*a(z-b.x)),U[X]||(U[X]={});for(var H=P.y-Y;H<=P.y+Y;H++)H<0||H>=g||(G=r(1e3*a(H-b.y)),U[X][G]||(U[X][G]=S(t(h(X*E,2)+h(G*L,2))/1e3)),x=U[X][G],x>0&&(T=(H*f+z)*4,D+=x,A+=x*_[T],I+=x*_[T+1],j+=x*_[T+2],R+=x*_[T+3]))}T=(F*m+k)*4,y[T]=A/D,y[T+1]=I/D,y[T+2]=j/D,y[T+3]=R/D}return++k<m?p(k):C}var _=l.imageData.data,C=l.ctx.createImageData(m,v),y=C.data,S=this.lanczosCreate(this.lanczosLobes),w=this.rcpScaleX,O=this.rcpScaleY,E=2/this.rcpScaleX,L=2/this.rcpScaleY,B=s(w*this.lanczosLobes/2),Y=s(O*this.lanczosLobes/2),U={},b={},P={};return p(0)},bilinearFiltering:function(l,f,g,m,v){var p,_,C,y,S,w,O,E,L,B,Y,U,b=0,P,k=this.rcpScaleX,F=this.rcpScaleY,z=4*(f-1),x=l.imageData,T=x.data,D=l.ctx.createImageData(m,v),A=D.data;for(O=0;O<v;O++)for(E=0;E<m;E++)for(S=r(k*E),w=r(F*O),L=k*E-S,B=F*O-w,P=4*(w*f+S),Y=0;Y<4;Y++)p=T[P+Y],_=T[P+4+Y],C=T[P+z+Y],y=T[P+z+4+Y],U=p*(1-L)*(1-B)+_*L*(1-B)+C*B*(1-L)+y*L*B,A[b++]=U;return D},hermiteFastResize:function(l,f,g,m,v){for(var p=this.rcpScaleX,_=this.rcpScaleY,C=s(p/2),y=s(_/2),S=l.imageData,w=S.data,O=l.ctx.createImageData(m,v),E=O.data,L=0;L<v;L++)for(var B=0;B<m;B++){for(var Y=(B+L*m)*4,U=0,b=0,P=0,k=0,F=0,z=0,x=0,T=(L+.5)*_,D=r(L*_);D<(L+1)*_;D++)for(var A=a(T-(D+.5))/y,I=(B+.5)*p,j=A*A,R=r(B*p);R<(B+1)*p;R++){var X=a(I-(R+.5))/C,G=t(j+X*X);G>1&&G<-1||(U=2*G*G*G-3*G*G+1,U>0&&(X=4*(R+D*f),x+=U*w[X+3],P+=U,w[X+3]<255&&(U=U*w[X+3]/250),k+=U*w[X],F+=U*w[X+1],z+=U*w[X+2],b+=U))}E[Y]=k/b,E[Y+1]=F/b,E[Y+2]=z/b,E[Y+3]=x/P}return O},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Contrast=r(h.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(t){if(this.contrast!==0){var a=t.imageData,n,s,c=a.data,s=c.length,i=Math.floor(this.contrast*255),o=259*(i+255)/(255*(259-i));for(n=0;n<s;n+=4)c[n]=o*(c[n]-128)+128,c[n+1]=o*(c[n+1]-128)+128,c[n+2]=o*(c[n+2]-128)+128}},getUniformLocations:function(t,a){return{uContrast:t.getUniformLocation(a,"uContrast")}},sendUniformData:function(t,a){t.uniform1f(a.uContrast,this.contrast)}}),e.Image.filters.Contrast.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Saturation=r(h.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(t){if(this.saturation!==0){var a=t.imageData,n=a.data,c=n.length,s=-this.saturation,i,o;for(i=0;i<c;i+=4)o=Math.max(n[i],n[i+1],n[i+2]),n[i]+=o!==n[i]?(o-n[i])*s:0,n[i+1]+=o!==n[i+1]?(o-n[i+1])*s:0,n[i+2]+=o!==n[i+2]?(o-n[i+2])*s:0}},getUniformLocations:function(t,a){return{uSaturation:t.getUniformLocation(a,"uSaturation")}},sendUniformData:function(t,a){t.uniform1f(a.uSaturation,-this.saturation)}}),e.Image.filters.Saturation.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Blur=r(h.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(t){t.webgl?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},applyTo2d:function(t){t.imageData=this.simpleBlur(t)},simpleBlur:function(t){var a=t.filterBackend.resources,n,c,s=t.imageData.width,i=t.imageData.height;a.blurLayer1||(a.blurLayer1=e.util.createCanvasElement(),a.blurLayer2=e.util.createCanvasElement()),n=a.blurLayer1,c=a.blurLayer2,(n.width!==s||n.height!==i)&&(c.width=n.width=s,c.height=n.height=i);var o=n.getContext("2d"),l=c.getContext("2d"),f=15,g,m,v,p,_=this.blur*.06*.5;for(o.putImageData(t.imageData,0,0),l.clearRect(0,0,s,i),p=-f;p<=f;p++)g=(Math.random()-.5)/4,m=p/f,v=_*m*s+g,l.globalAlpha=1-Math.abs(m),l.drawImage(n,v,g),o.drawImage(c,0,0),l.globalAlpha=1,l.clearRect(0,0,c.width,c.height);for(p=-f;p<=f;p++)g=(Math.random()-.5)/4,m=p/f,v=_*m*i+g,l.globalAlpha=1-Math.abs(m),l.drawImage(n,g,v),o.drawImage(c,0,0),l.globalAlpha=1,l.clearRect(0,0,c.width,c.height);t.ctx.drawImage(n,0,0);var C=t.ctx.getImageData(0,0,n.width,n.height);return o.globalAlpha=1,o.clearRect(0,0,n.width,n.height),C},getUniformLocations:function(t,a){return{delta:t.getUniformLocation(a,"uDelta")}},sendUniformData:function(t,a){var n=this.chooseRightDelta();t.uniform2fv(a.delta,n)},chooseRightDelta:function(){var t=1,a=[0,0],n;return this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio),n=t*this.blur*.12,this.horizontal?a[0]=n:a[1]=n,a}}),h.Blur.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Gamma=r(h.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(t){this.gamma=[1,1,1],h.BaseFilter.prototype.initialize.call(this,t)},applyTo2d:function(t){var a=t.imageData,n=a.data,c=this.gamma,s=n.length,i=1/c[0],o=1/c[1],l=1/c[2],f;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),f=0,s=256;f<s;f++)this.rVals[f]=Math.pow(f/255,i)*255,this.gVals[f]=Math.pow(f/255,o)*255,this.bVals[f]=Math.pow(f/255,l)*255;for(f=0,s=n.length;f<s;f+=4)n[f]=this.rVals[n[f]],n[f+1]=this.gVals[n[f+1]],n[f+2]=this.bVals[n[f+2]]},getUniformLocations:function(t,a){return{uGamma:t.getUniformLocation(a,"uGamma")}},sendUniformData:function(t,a){t.uniform3fv(a.uGamma,this.gamma)}}),e.Image.filters.Gamma.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Composed=r(h.BaseFilter,{type:"Composed",subFilters:[],initialize:function(t){this.callSuper("initialize",t),this.subFilters=this.subFilters.slice(0)},applyTo:function(t){t.passes+=this.subFilters.length-1,this.subFilters.forEach(function(a){a.applyTo(t)})},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(t){return t.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(t){return!t.isNeutralState()})}}),e.Image.filters.Composed.fromObject=function(t,a){var n=t.subFilters||[],c=n.map(function(i){return new e.Image.filters[i.type](i)}),s=new e.Image.filters.Composed({subFilters:c});return a&&a(s),s}}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,r=e.util.createClass;h.HueRotation=r(h.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var t=this.rotation*Math.PI,a=e.util.cos(t),n=e.util.sin(t),c=1/3,s=Math.sqrt(c)*n,i=1-a;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=a+i/3,this.matrix[1]=c*i-s,this.matrix[2]=c*i+s,this.matrix[5]=c*i+s,this.matrix[6]=a+c*i,this.matrix[7]=c*i-s,this.matrix[10]=c*i-s,this.matrix[11]=c*i+s,this.matrix[12]=a+c*i},isNeutralState:function(t){return this.calculateMatrix(),h.BaseFilter.prototype.isNeutralState.call(this,t)},applyTo:function(t){this.calculateMatrix(),h.BaseFilter.prototype.applyTo.call(this,t)}}),e.Image.filters.HueRotation.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.clone;if(e.Text){e.warn("fabric.Text is already defined");return}e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:e.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:e.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,t){this.styles=t?t.styles||{}:{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",t),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return e._measuringContext||(e._measuringContext=this.canvas&&this.canvas.contextCache||e.util.createCanvasElement().getContext("2d")),e._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var r,t,a,n,c,s,i,o=0,l=this._textLines.length;o<l;o++)if(!(this.textAlign!=="justify"&&(o===l-1||this.isEndOfWrapping(o)))&&(n=0,c=this._textLines[o],t=this.getLineWidth(o),t<this.width&&(i=this.textLines[o].match(this._reSpacesAndTabs)))){a=i.length,r=(this.width-t)/a;for(var f=0,g=c.length;f<=g;f++)s=this.__charBounds[o][f],this._reSpaceAndTab.test(c[f])?(s.width+=r,s.kernedWidth+=r,s.left+=n,n+=r):s.left+=n}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),t=this.fontSize;return r.width+=t*r.zoomX,r.height+=t*r.zoomY,r},_render:function(r){this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,t,a){r.textBaseline="alphabetic",r.font=this._getFontDeclaration(t,a)},calcTextWidth:function(){for(var r=this.getLineWidth(0),t=1,a=this._textLines.length;t<a;t++){var n=this.getLineWidth(t);n>r&&(r=n)}return r},_renderTextLine:function(r,t,a,n,c,s){this._renderChars(r,t,a,n,c,s)},_renderTextLinesBackground:function(r){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var t=0,a,n,c=r.fillStyle,s,i,o=this._getLeftOffset(),l=this._getTopOffset(),f=0,g=0,m,v,p=0,_=this._textLines.length;p<_;p++){if(a=this.getHeightOfLine(p),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",p)){t+=a;continue}s=this._textLines[p],n=this._getLineLeftOffset(p),g=0,f=0,i=this.getValueOfPropertyAt(p,0,"textBackgroundColor");for(var C=0,y=s.length;C<y;C++)m=this.__charBounds[p][C],v=this.getValueOfPropertyAt(p,C,"textBackgroundColor"),v!==i?(r.fillStyle=i,i&&r.fillRect(o+n+f,l+t,g,a/this.lineHeight),f=m.left,g=m.width,i=v):g+=m.kernedWidth;v&&(r.fillStyle=v,r.fillRect(o+n+f,l+t,g,a/this.lineHeight)),t+=a}r.fillStyle=c,this._removeShadow(r)}},getFontCache:function(r){var t=r.fontFamily.toLowerCase();e.charWidthsCache[t]||(e.charWidthsCache[t]={});var a=e.charWidthsCache[t],n=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return a[n]||(a[n]={}),a[n]},_applyCharStyles:function(r,t,a,n,c){this._setFillStyles(t,c),this._setStrokeStyles(t,c),t.font=this._getFontDeclaration(c)},_measureChar:function(r,t,a,n){var c=this.getFontCache(t),s=this._getFontDeclaration(t),i=this._getFontDeclaration(n),o=a+r,l=s===i,f,g,m,v=t.fontSize/this.CACHE_FONT_SIZE,p;if(a&&c[a]!==void 0&&(m=c[a]),c[r]!==void 0&&(p=f=c[r]),l&&c[o]!==void 0&&(g=c[o],p=g-m),f===void 0||m===void 0||g===void 0){var _=this.getMeasuringContext();this._setTextStyles(_,t,!0)}return f===void 0&&(p=f=_.measureText(r).width,c[r]=f),m===void 0&&l&&a&&(m=_.measureText(a).width,c[a]=m),l&&g===void 0&&(g=_.measureText(o).width,c[o]=g,p=g-m),{width:f*v,kernedWidth:p*v}},getHeightOfChar:function(r,t){return this.getValueOfPropertyAt(r,t,"fontSize")},measureLine:function(r){var t=this._measureLine(r);return this.charSpacing!==0&&(t.width-=this._getWidthOfCharSpacing()),t.width<0&&(t.width=0),t},_measureLine:function(r){var t=0,a,n,c=this._textLines[r],s,i,o=0,l=new Array(c.length);for(this.__charBounds[r]=l,a=0;a<c.length;a++)n=c[a],i=this._getGraphemeBox(n,r,a,s),l[a]=i,t+=i.kernedWidth,s=n;return l[a]={left:i?i.left+i.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:t,numOfSpaces:o}},_getGraphemeBox:function(r,t,a,n,c){var s=this.getCompleteStyleDeclaration(t,a),i=n?this.getCompleteStyleDeclaration(t,a-1):{},o=this._measureChar(r,s,n,i),l=o.kernedWidth,f=o.width,g;this.charSpacing!==0&&(g=this._getWidthOfCharSpacing(),f+=g,l+=g);var m={width:f,left:0,height:s.fontSize,kernedWidth:l,deltaY:s.deltaY};if(a>0&&!c){var v=this.__charBounds[t][a-1];m.left=v.left+v.width+o.kernedWidth-o.width}return m},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var t=this._textLines[r],a=this.getHeightOfChar(r,0),n=1,c=t.length;n<c;n++)a=Math.max(this.getHeightOfChar(r,n),a);return this.__lineHeights[r]=a*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,t=0,a=0,n=this._textLines.length;a<n;a++)r=this.getHeightOfLine(a),t+=a===n-1?r/this.lineHeight:r;return t},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_applyPatternGradientTransform:function(r,t){if(!t||!t.toLive)return{offsetX:0,offsetY:0};var a=-this.width/2+t.offsetX||0,n=-this.height/2+t.offsetY||0;return r.transform(1,0,0,1,a,n),{offsetX:a,offsetY:n}},_renderTextCommon:function(r,t){r.save();for(var a=0,n=this._getLeftOffset(),c=this._getTopOffset(),s=this._applyPatternGradientTransform(r,t==="fillText"?this.fill:this.stroke),i=0,o=this._textLines.length;i<o;i++){var l=this.getHeightOfLine(i),f=l/this.lineHeight,g=this._getLineLeftOffset(i);this._renderTextLine(t,r,this._textLines[i],n+g-s.offsetX,c+a+f-s.offsetY,i),a+=l}r.restore()},_renderTextFill:function(r){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,t,a,n,c,s){var i=this.getHeightOfLine(s),o=this.textAlign.indexOf("justify")!==-1,l,f,g="",m,v=0,p,_=!o&&this.charSpacing===0&&this.isEmptyStyles(s);if(t.save(),c-=i*this._fontSizeFraction/this.lineHeight,_){this._renderChar(r,t,s,0,this.textLines[s],n,c,i),t.restore();return}for(var C=0,y=a.length-1;C<=y;C++)p=C===y||this.charSpacing,g+=a[C],m=this.__charBounds[s][C],v===0?(n+=m.kernedWidth-m.width,v+=m.width):v+=m.kernedWidth,o&&!p&&this._reSpaceAndTab.test(a[C])&&(p=!0),p||(l=l||this.getCompleteStyleDeclaration(s,C),f=this.getCompleteStyleDeclaration(s,C+1),p=this._hasStyleChanged(l,f)),p&&(this._renderChar(r,t,s,C,g,n,c,i),g="",l=f,n+=v,v=0);t.restore()},_renderChar:function(r,t,a,n,c,s,i){var o=this._getStyleDeclaration(a,n),l=this.getCompleteStyleDeclaration(a,n),f=r==="fillText"&&l.fill,g=r==="strokeText"&&l.stroke&&l.strokeWidth;!g&&!f||(o&&t.save(),this._applyCharStyles(r,t,a,n,l),o&&o.textBackgroundColor&&this._removeShadow(t),o&&o.deltaY&&(i+=o.deltaY),f&&t.fillText(c,s,i),g&&t.strokeText(c,s,i),o&&t.restore())},setSuperscript:function(r,t){return this._setScript(r,t,this.superscript)},setSubscript:function(r,t){return this._setScript(r,t,this.subscript)},_setScript:function(r,t,a){var n=this.get2DCursorLocation(r,!0),c=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"fontSize"),s=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"deltaY"),i={fontSize:c*a.size,deltaY:s+c*a.baseline};return this.setSelectionStyles(i,r,t),this},_hasStyleChanged:function(r,t){return r.fill!==t.fill||r.stroke!==t.stroke||r.strokeWidth!==t.strokeWidth||r.fontSize!==t.fontSize||r.fontFamily!==t.fontFamily||r.fontWeight!==t.fontWeight||r.fontStyle!==t.fontStyle||r.deltaY!==t.deltaY},_hasStyleChangedForSvg:function(r,t){return this._hasStyleChanged(r,t)||r.overline!==t.overline||r.underline!==t.underline||r.linethrough!==t.linethrough},_getLineLeftOffset:function(r){var t=this.getLineWidth(r);return this.textAlign==="center"?(this.width-t)/2:this.textAlign==="right"?this.width-t:this.textAlign==="justify-center"&&this.isEndOfWrapping(r)?(this.width-t)/2:this.textAlign==="justify-right"&&this.isEndOfWrapping(r)?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r])return this.__lineWidths[r];var t,a=this._textLines[r],n;return a===""?t=0:(n=this.measureLine(r),t=n.width),this.__lineWidths[r]=t,t},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,t,a){var n=this._getStyleDeclaration(r,t);return n&&typeof n[a]<"u"?n[a]:this[a]},_renderTextDecoration:function(r,t){if(!(!this[t]&&!this.styleHas(t))){for(var a,n,c,s,i,o,l,f,g=this._getLeftOffset(),m=this._getTopOffset(),v,p,_,C,y,S,w,O,E=this._getWidthOfCharSpacing(),L=0,B=this._textLines.length;L<B;L++){if(a=this.getHeightOfLine(L),!this[t]&&!this.styleHas(t,L)){m+=a;continue}l=this._textLines[L],S=a/this.lineHeight,s=this._getLineLeftOffset(L),p=0,_=0,f=this.getValueOfPropertyAt(L,0,t),O=this.getValueOfPropertyAt(L,0,"fill"),v=m+S*(1-this._fontSizeFraction),n=this.getHeightOfChar(L,0),i=this.getValueOfPropertyAt(L,0,"deltaY");for(var Y=0,U=l.length;Y<U;Y++)C=this.__charBounds[L][Y],y=this.getValueOfPropertyAt(L,Y,t),w=this.getValueOfPropertyAt(L,Y,"fill"),c=this.getHeightOfChar(L,Y),o=this.getValueOfPropertyAt(L,Y,"deltaY"),(y!==f||w!==O||c!==n||o!==i)&&_>0?(r.fillStyle=O,f&&O&&r.fillRect(g+s+p,v+this.offsets[t]*n+i,_,this.fontSize/15),p=C.left,_=C.width,f=y,O=w,n=c,i=o):_+=C.kernedWidth;r.fillStyle=w,y&&w&&r.fillRect(g+s+p,v+this.offsets[t]*n+i,_-E,this.fontSize/15),m+=a}this._removeShadow(r)}},_getFontDeclaration:function(r,t){var a=r||this,n=this.fontFamily,c=e.Text.genericFonts.indexOf(n.toLowerCase())>-1,s=n===void 0||n.indexOf("'")>-1||n.indexOf(",")>-1||n.indexOf('"')>-1||c?a.fontFamily:'"'+a.fontFamily+'"';return[e.isLikelyNode?a.fontWeight:a.fontStyle,e.isLikelyNode?a.fontStyle:a.fontWeight,t?this.CACHE_FONT_SIZE+"px":a.fontSize+"px",s].join(" ")},render:function(r){!this.visible||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r))},_splitTextIntoLines:function(r){for(var t=r.split(this._reNewline),a=new Array(t.length),n=[`
`],c=[],s=0;s<t.length;s++)a[s]=e.util.string.graphemeSplit(t[s]),c=c.concat(a[s],n);return c.pop(),{_unwrappedLines:a,lines:t,graphemeText:c,graphemeLines:a}},toObject:function(r){var t=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(r),a=this.callSuper("toObject",t);return a.styles=h(this.styles,!0),a},set:function(r,t){this.callSuper("set",r,t);var a=!1;if(typeof r=="object")for(var n in r)a=a||this._dimensionAffectingProps.indexOf(n)!==-1;else a=this._dimensionAffectingProps.indexOf(r)!==-1;return a&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(r,t,a){if(!r)return t(null);var n=e.parseAttributes(r,e.Text.ATTRIBUTE_NAMES),c=n.textAnchor||"left";if(a=e.util.object.extend(a?h(a):{},n),a.top=a.top||0,a.left=a.left||0,n.textDecoration){var s=n.textDecoration;s.indexOf("underline")!==-1&&(a.underline=!0),s.indexOf("overline")!==-1&&(a.overline=!0),s.indexOf("line-through")!==-1&&(a.linethrough=!0),delete a.textDecoration}"dx"in n&&(a.left+=n.dx),"dy"in n&&(a.top+=n.dy),"fontSize"in a||(a.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE);var i="";"textContent"in r?i=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(i=r.firstChild.data),i=i.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var o=a.strokeWidth;a.strokeWidth=0;var l=new e.Text(i,a),f=l.getScaledHeight()/l.height,g=(l.height+l.strokeWidth)*l.lineHeight-l.height,m=g*f,v=l.getScaledHeight()+m,p=0;c==="center"&&(p=l.getScaledWidth()/2),c==="right"&&(p=l.getScaledWidth()),l.set({left:l.left-p,top:l.top-(v-l.fontSize*(.07+l._fontSizeFraction))/l.lineHeight,strokeWidth:typeof o<"u"?o:1}),t(l)},e.Text.fromObject=function(r,t){return e.Object._fromObject("Text",r,t,"text")},e.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],e.util.createAccessors&&e.util.createAccessors(e.Text)}(W),function(){d.util.object.extend(d.Text.prototype,{isEmptyStyles:function(u){if(!this.styles||typeof u<"u"&&!this.styles[u])return!0;var e=typeof u>"u"?this.styles:{line:this.styles[u]};for(var h in e)for(var r in e[h])for(var t in e[h][r])return!1;return!0},styleHas:function(u,e){if(!this.styles||!u||u===""||typeof e<"u"&&!this.styles[e])return!1;var h=typeof e>"u"?this.styles:{0:this.styles[e]};for(var r in h)for(var t in h[r])if(typeof h[r][t][u]<"u")return!0;return!1},cleanStyle:function(u){if(!this.styles||!u||u==="")return!1;var e=this.styles,h=0,r,t,a=!0,n=0,c;for(var s in e){r=0;for(var i in e[s]){var c=e[s][i],o=c.hasOwnProperty(u);h++,o?(t?c[u]!==t&&(a=!1):t=c[u],c[u]===this[u]&&delete c[u]):a=!1,Object.keys(c).length!==0?r++:delete e[s][i]}r===0&&delete e[s]}for(var l=0;l<this._textLines.length;l++)n+=this._textLines[l].length;a&&h===n&&(this[u]=t,this.removeStyle(u))},removeStyle:function(u){if(!(!this.styles||!u||u==="")){var e=this.styles,h,r,t;for(r in e){h=e[r];for(t in h)delete h[t][u],Object.keys(h[t]).length===0&&delete h[t];Object.keys(h).length===0&&delete e[r]}}},_extendStyles:function(u,e){var h=this.get2DCursorLocation(u);this._getLineStyle(h.lineIndex)||this._setLineStyle(h.lineIndex),this._getStyleDeclaration(h.lineIndex,h.charIndex)||this._setStyleDeclaration(h.lineIndex,h.charIndex,{}),d.util.object.extend(this._getStyleDeclaration(h.lineIndex,h.charIndex),e)},get2DCursorLocation:function(u,e){typeof u>"u"&&(u=this.selectionStart);for(var h=e?this._unwrappedTextLines:this._textLines,r=h.length,t=0;t<r;t++){if(u<=h[t].length)return{lineIndex:t,charIndex:u};u-=h[t].length+this.missingNewlineOffset(t)}return{lineIndex:t-1,charIndex:h[t-1].length<u?h[t-1].length:u}},getSelectionStyles:function(u,e,h){typeof u>"u"&&(u=this.selectionStart||0),typeof e>"u"&&(e=this.selectionEnd||u);for(var r=[],t=u;t<e;t++)r.push(this.getStyleAtPosition(t,h));return r},getStyleAtPosition:function(u,e){var h=this.get2DCursorLocation(u),r=e?this.getCompleteStyleDeclaration(h.lineIndex,h.charIndex):this._getStyleDeclaration(h.lineIndex,h.charIndex);return r||{}},setSelectionStyles:function(u,e,h){typeof e>"u"&&(e=this.selectionStart||0),typeof h>"u"&&(h=this.selectionEnd||e);for(var r=e;r<h;r++)this._extendStyles(r,u);return this._forceClearCache=!0,this},_getStyleDeclaration:function(u,e){var h=this.styles&&this.styles[u];return h?h[e]:null},getCompleteStyleDeclaration:function(u,e){for(var h=this._getStyleDeclaration(u,e)||{},r={},t,a=0;a<this._styleProperties.length;a++)t=this._styleProperties[a],r[t]=typeof h[t]>"u"?this[t]:h[t];return r},_setStyleDeclaration:function(u,e,h){this.styles[u][e]=h},_deleteStyleDeclaration:function(u,e){delete this.styles[u][e]},_getLineStyle:function(u){return!!this.styles[u]},_setLineStyle:function(u){this.styles[u]={}},_deleteLineStyle:function(u){delete this.styles[u]}})}(),function(){function u(e){e.textDecoration&&(e.textDecoration.indexOf("underline")>-1&&(e.underline=!0),e.textDecoration.indexOf("line-through")>-1&&(e.linethrough=!0),e.textDecoration.indexOf("overline")>-1&&(e.overline=!0),delete e.textDecoration)}d.IText=d.util.createClass(d.Text,d.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(e,h){this.callSuper("initialize",e,h),this.initBehavior()},setSelectionStart:function(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)},setSelectionEnd:function(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)},_updateAndFire:function(e,h){this[e]!==h&&(this._fireSelectionChanged(),this[e]=h),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(e){this.clearContextTop(),this.callSuper("render",e),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(e){this.callSuper("_render",e)},clearContextTop:function(e){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var h=this.canvas.contextTop,r=this.canvas.viewportTransform;h.save(),h.transform(r[0],r[1],r[2],r[3],r[4],r[5]),this.transform(h),this.transformMatrix&&h.transform.apply(h,this.transformMatrix),this._clearTextArea(h),e||h.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var e=this._getCursorBoundaries(),h=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(e,h):this.renderSelection(e,h),h.restore()}},_clearTextArea:function(e){var h=this.width+4,r=this.height+4;e.clearRect(-h/2,-r/2,h,r)},_getCursorBoundaries:function(e){typeof e>"u"&&(e=this.selectionStart);var h=this._getLeftOffset(),r=this._getTopOffset(),t=this._getCursorBoundariesOffsets(e);return{left:h,top:r,leftOffset:t.left,topOffset:t.top}},_getCursorBoundariesOffsets:function(e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var h,r,t,a=0,n=0,c,s=this.get2DCursorLocation(e);t=s.charIndex,r=s.lineIndex;for(var i=0;i<r;i++)a+=this.getHeightOfLine(i);h=this._getLineLeftOffset(r);var o=this.__charBounds[r][t];return o&&(n=o.left),this.charSpacing!==0&&t===this._textLines[r].length&&(n-=this._getWidthOfCharSpacing()),c={top:a,left:h+(n>0?n:0)},this.cursorOffsetCache=c,this.cursorOffsetCache},renderCursor:function(e,h){var r=this.get2DCursorLocation(),t=r.lineIndex,a=r.charIndex>0?r.charIndex-1:0,n=this.getValueOfPropertyAt(t,a,"fontSize"),c=this.scaleX*this.canvas.getZoom(),s=this.cursorWidth/c,i=e.topOffset,o=this.getValueOfPropertyAt(t,a,"deltaY");i+=(1-this._fontSizeFraction)*this.getHeightOfLine(t)/this.lineHeight-n*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(e,h),h.fillStyle=this.getValueOfPropertyAt(t,a,"fill"),h.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,h.fillRect(e.left+e.leftOffset-s/2,i+e.top+o,s,n)},renderSelection:function(e,h){for(var r=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,t=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,a=this.textAlign.indexOf("justify")!==-1,n=this.get2DCursorLocation(r),c=this.get2DCursorLocation(t),s=n.lineIndex,i=c.lineIndex,o=n.charIndex<0?0:n.charIndex,l=c.charIndex<0?0:c.charIndex,f=s;f<=i;f++){var g=this._getLineLeftOffset(f)||0,m=this.getHeightOfLine(f),v=0,p=0,_=0;if(f===s&&(p=this.__charBounds[s][o].left),f>=s&&f<i)_=a&&!this.isEndOfWrapping(f)?this.width:this.getLineWidth(f)||5;else if(f===i)if(l===0)_=this.__charBounds[i][l].left;else{var C=this._getWidthOfCharSpacing();_=this.__charBounds[i][l-1].left+this.__charBounds[i][l-1].width-C}v=m,(this.lineHeight<1||f===i&&this.lineHeight>1)&&(m/=this.lineHeight),this.inCompositionMode?(h.fillStyle=this.compositionColor||"black",h.fillRect(e.left+g+p,e.top+e.topOffset+m,_-p,1)):(h.fillStyle=this.selectionColor,h.fillRect(e.left+g+p,e.top+e.topOffset,_-p,m)),e.topOffset+=v}},getCurrentCharFontSize:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")},getCurrentCharColor:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fill")},_getCurrentCharIndex:function(){var e=this.get2DCursorLocation(this.selectionStart,!0),h=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c:h}}}),d.IText.fromObject=function(e,h){if(u(e),e.styles)for(var r in e.styles)for(var t in e.styles[r])u(e.styles[r][t]);d.Object._fromObject("IText",e,h,"text")}}(),function(){var u=d.util.object.clone;d.util.object.extend(d.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var e=this;this.on("added",function(){var h=e.canvas;h&&(h._hasITextHandlers||(h._hasITextHandlers=!0,e._initCanvasHandlers(h)),h._iTextInstances=h._iTextInstances||[],h._iTextInstances.push(e))})},initRemovedHandler:function(){var e=this;this.on("removed",function(){var h=e.canvas;h&&(h._iTextInstances=h._iTextInstances||[],d.util.removeFromArray(h._iTextInstances,e),h._iTextInstances.length===0&&(h._hasITextHandlers=!1,e._removeCanvasHandlers(h)))})},_initCanvasHandlers:function(e){e._mouseUpITextHandler=function(){e._iTextInstances&&e._iTextInstances.forEach(function(h){h.__isMousedown=!1})},e.on("mouse:up",e._mouseUpITextHandler)},_removeCanvasHandlers:function(e){e.off("mouse:up",e._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,h,r,t){var a;return a={isAborted:!1,abort:function(){this.isAborted=!0}},e.animate("_currentCursorOpacity",h,{duration:r,onComplete:function(){a.isAborted||e[t]()},onChange:function(){e.canvas&&e.selectionStart===e.selectionEnd&&e.renderCursorOrSelection()},abort:function(){return a.isAborted}}),a},_onTickComplete:function(){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){e._currentTickCompleteState=e._animateCursor(e,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(e){var h=this,r=e?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){h._tick()},r)},abortCursorAnimation:function(){var e=this._currentTickState||this._currentTickCompleteState,h=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,e&&h&&h.clearContext(h.contextTop||h.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(e){var h=0,r=e-1;if(this._reSpace.test(this._text[r]))for(;this._reSpace.test(this._text[r]);)h++,r--;for(;/\S/.test(this._text[r])&&r>-1;)h++,r--;return e-h},findWordBoundaryRight:function(e){var h=0,r=e;if(this._reSpace.test(this._text[r]))for(;this._reSpace.test(this._text[r]);)h++,r++;for(;/\S/.test(this._text[r])&&r<this._text.length;)h++,r++;return e+h},findLineBoundaryLeft:function(e){for(var h=0,r=e-1;!/\n/.test(this._text[r])&&r>-1;)h++,r--;return e-h},findLineBoundaryRight:function(e){for(var h=0,r=e;!/\n/.test(this._text[r])&&r<this._text.length;)h++,r++;return e+h},searchWordBoundary:function(e,h){for(var r=this._text,t=this._reSpace.test(r[e])?e-1:e,a=r[t],n=d.reNonWord;!n.test(a)&&t>0&&t<r.length;)t+=h,a=r[t];return n.test(a)&&(t+=h===1?0:1),t},selectWord:function(e){e=e||this.selectionStart;var h=this.searchWordBoundary(e,-1),r=this.searchWordBoundary(e,1);this.selectionStart=h,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(e){e=e||this.selectionStart;var h=this.findLineBoundaryLeft(e),r=this.findLineBoundaryRight(e);return this.selectionStart=h,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(e){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(e),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(e){e._iTextInstances&&e._iTextInstances.forEach(function(h){h.selected=!1,h.isEditing&&h.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(e){if(!(!this.__isMousedown||!this.isEditing)){var h=this.getSelectionStartFromPointer(e.e),r=this.selectionStart,t=this.selectionEnd;(h!==this.__selectionStartOnMouseDown||r===t)&&(r===h||t===h)||(h>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=h):(this.selectionStart=h,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==r||this.selectionEnd!==t)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(e,h,r){var t=r.slice(0,e),a=d.util.string.graphemeSplit(t).length;if(e===h)return{selectionStart:a,selectionEnd:a};var n=r.slice(e,h),c=d.util.string.graphemeSplit(n).length;return{selectionStart:a,selectionEnd:a+c}},fromGraphemeToStringSelection:function(e,h,r){var t=r.slice(0,e),a=t.join("").length;if(e===h)return{selectionStart:a,selectionEnd:a};var n=r.slice(e,h),c=n.join("").length;return{selectionStart:a,selectionEnd:a+c}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(!!this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var e=this.inCompositionMode?this.compositionStart:this.selectionStart,h=this._getCursorBoundaries(e),r=this.get2DCursorLocation(e),t=r.lineIndex,a=r.charIndex,n=this.getValueOfPropertyAt(t,a,"fontSize")*this.lineHeight,c=h.leftOffset,s=this.calcTransformMatrix(),i={x:h.left+c,y:h.top+h.topOffset+n},o=this.canvas.getRetinaScaling(),l=this.canvas.upperCanvasEl,f=l.width/o,g=l.height/o,m=f-n,v=g-n,p=l.clientWidth/f,_=l.clientHeight/g;return i=d.util.transformPoint(i,s),i=d.util.transformPoint(i,this.canvas.viewportTransform),i.x*=p,i.y*=_,i.x<0&&(i.x=0),i.x>m&&(i.x=m),i.y<0&&(i.y=0),i.y>v&&(i.y=v),i.x+=this.canvas._offset.left,i.y+=this.canvas._offset.top,{left:i.x+"px",top:i.y+"px",fontSize:n+"px",charHeight:n}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){!this._savedProps||(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var e=this._textBeforeEdit!==this.text,h=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,h&&(h.blur&&h.blur(),h.parentNode&&h.parentNode.removeChild(h)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),e&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var e in this.styles)this._textLines[e]||delete this.styles[e]},removeStyleFromTo:function(e,h){var r=this.get2DCursorLocation(e,!0),t=this.get2DCursorLocation(h,!0),a=r.lineIndex,n=r.charIndex,c=t.lineIndex,s=t.charIndex,i,o;if(a!==c){if(this.styles[a])for(i=n;i<this._unwrappedTextLines[a].length;i++)delete this.styles[a][i];if(this.styles[c])for(i=s;i<this._unwrappedTextLines[c].length;i++)o=this.styles[c][i],o&&(this.styles[a]||(this.styles[a]={}),this.styles[a][n+i-s]=o);for(i=a+1;i<=c;i++)delete this.styles[i];this.shiftLineStyles(c,a-c)}else if(this.styles[a]){o=this.styles[a];var l=s-n,f,g;for(i=n;i<s;i++)delete o[i];for(g in this.styles[a])f=parseInt(g,10),f>=s&&(o[f-l]=o[g],delete o[g])}},shiftLineStyles:function(e,h){var r=u(this.styles);for(var t in this.styles){var a=parseInt(t,10);a>e&&(this.styles[a+h]=r[a],r[a-h]||delete this.styles[a])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(e,h,r,t){var a,n={},c=!1,s=this._unwrappedTextLines[e].length===h;r||(r=1),this.shiftLineStyles(e,r),this.styles[e]&&(a=this.styles[e][h===0?h:h-1]);for(var i in this.styles[e]){var o=parseInt(i,10);o>=h&&(c=!0,n[o-h]=this.styles[e][i],s&&h===0||delete this.styles[e][i])}var l=!1;for(c&&!s&&(this.styles[e+r]=n,l=!0),l&&r--;r>0;)t&&t[r-1]?this.styles[e+r]={0:u(t[r-1])}:a?this.styles[e+r]={0:u(a)}:delete this.styles[e+r],r--;this._forceClearCache=!0},insertCharStyleObject:function(e,h,r,t){this.styles||(this.styles={});var a=this.styles[e],n=a?u(a):{};r||(r=1);for(var c in n){var s=parseInt(c,10);s>=h&&(a[s+r]=n[s],n[s-r]||delete a[s])}if(this._forceClearCache=!0,t){for(;r--;)!Object.keys(t[r]).length||(this.styles[e]||(this.styles[e]={}),this.styles[e][h+r]=u(t[r]));return}if(!!a)for(var i=a[h?h-1:1];i&&r--;)this.styles[e][h+r]=u(i)},insertNewStyleBlock:function(e,h,r){for(var t=this.get2DCursorLocation(h,!0),a=[0],n=0,c=0;c<e.length;c++)e[c]===`
`?(n++,a[n]=0):a[n]++;a[0]>0&&(this.insertCharStyleObject(t.lineIndex,t.charIndex,a[0],r),r=r&&r.slice(a[0]+1)),n&&this.insertNewlineStyleObject(t.lineIndex,t.charIndex+a[0],n);for(var c=1;c<n;c++)a[c]>0?this.insertCharStyleObject(t.lineIndex+c,0,a[c],r):r&&(this.styles[t.lineIndex+c][0]=r[0]),r=r&&r.slice(a[c]+1);a[c]>0&&this.insertCharStyleObject(t.lineIndex+c,0,a[c],r)},setSelectionStartEndWithShift:function(e,h,r){r<=e?(h===e?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=e),this.selectionStart=r):r>e&&r<h?this._selectionDirection==="right"?this.selectionEnd=r:this.selectionStart=r:(h===e?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=h),this.selectionEnd=r)},setSelectionInBoundaries:function(){var e=this.text.length;this.selectionStart>e?this.selectionStart=e:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>e?this.selectionEnd=e:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),d.util.object.extend(d.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(u){if(!!this.canvas){this.__newClickTime=+new Date;var e=u.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",u),this._stopEvent(u.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(u){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===u.x&&this.__lastPointer.y===u.y},_stopEvent:function(u){u.preventDefault&&u.preventDefault(),u.stopPropagation&&u.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(u){!this.isEditing||this.selectWord(this.getSelectionStartFromPointer(u.e))},tripleClickHandler:function(u){!this.isEditing||this.selectLine(this.getSelectionStartFromPointer(u.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(u){!this.canvas||!this.editable||u.e.button&&u.e.button!==1||(this.__isMousedown=!0,this.selected&&this.setCursorByClick(u.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(u){!this.canvas||!this.editable||u.e.button&&u.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(u){if(this.__isMousedown=!1,!(!this.editable||this.group||u.transform&&u.transform.actionPerformed||u.e.button&&u.e.button!==1)){if(this.canvas){var e=this.canvas._activeObject;if(e&&e!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(u.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(u){var e=this.getSelectionStartFromPointer(u),h=this.selectionStart,r=this.selectionEnd;u.shiftKey?this.setSelectionStartEndWithShift(h,r,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(u){for(var e=this.getLocalPointer(u),h=0,r=0,t=0,a=0,n=0,c,s,i=0,o=this._textLines.length;i<o&&t<=e.y;i++)t+=this.getHeightOfLine(i)*this.scaleY,n=i,i>0&&(a+=this._textLines[i-1].length+this.missingNewlineOffset(i-1));c=this._getLineLeftOffset(n),r=c*this.scaleX,s=this._textLines[n];for(var l=0,f=s.length;l<f&&(h=r,r+=this.__charBounds[n][l].kernedWidth*this.scaleX,r<=e.x);l++)a++;return this._getNewSelectionStartFromOffset(e,h,r,a,f)},_getNewSelectionStartFromOffset:function(u,e,h,r,t){var a=u.x-e,n=h-u.x,c=n>a||n<0?0:1,s=r+c;return this.flipX&&(s=t-s),s>this._text.length&&(s=this._text.length),s}}),d.util.object.extend(d.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=d.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var u=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+u.top+"; left: "+u.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uFF70top: "+u.fontSize+";",d.document.body.appendChild(this.hiddenTextarea),d.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),d.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),d.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),d.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),d.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),d.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),d.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),d.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),d.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(d.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(u){if(!(!this.isEditing||this.inCompositionMode)){if(u.keyCode in this.keysMap)this[this.keysMap[u.keyCode]](u);else if(u.keyCode in this.ctrlKeysMapDown&&(u.ctrlKey||u.metaKey))this[this.ctrlKeysMapDown[u.keyCode]](u);else return;u.stopImmediatePropagation(),u.preventDefault(),u.keyCode>=33&&u.keyCode<=40?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(u){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(u.keyCode in this.ctrlKeysMapUp&&(u.ctrlKey||u.metaKey))this[this.ctrlKeysMapUp[u.keyCode]](u);else return;u.stopImmediatePropagation(),u.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(u){var e=this.fromPaste;if(this.fromPaste=!1,u&&u.stopPropagation(),!!this.isEditing){var h=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,r=this._text.length,t=h.length,a,n,c=t-r,s=this.selectionStart,i=this.selectionEnd,o=s!==i,v,l,f;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var g=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),m=s>g.selectionStart;o?(a=this._text.slice(s,i),c+=i-s):t<r&&(m?a=this._text.slice(i+c,i):a=this._text.slice(s,s-c));var v;n=h.slice(g.selectionEnd-c,g.selectionEnd),a&&a.length&&(n.length&&(v=this.getSelectionStyles(s,s+1,!0),v=n.map(function(){return v[0]})),o?(l=s,f=i):m?(l=i-a.length,f=i):(l=i,f=i+a.length),this.removeStyleFromTo(l,f)),n.length&&(e&&n.join("")===d.copiedText&&!d.disableStyleCopyPaste&&(v=d.copiedTextStyle),this.insertNewStyleBlock(n,s,v)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(u){this.compositionStart=u.target.selectionStart,this.compositionEnd=u.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(d.copiedText=this.getSelectedText(),d.disableStyleCopyPaste?d.copiedTextStyle=null:d.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(u){return u&&u.clipboardData||d.window.clipboardData},_getWidthBeforeCursor:function(u,e){var h=this._getLineLeftOffset(u),r;return e>0&&(r=this.__charBounds[u][e-1],h+=r.left+r.width),h},getDownCursorOffset:function(u,e){var h=this._getSelectionForOffset(u,e),r=this.get2DCursorLocation(h),t=r.lineIndex;if(t===this._textLines.length-1||u.metaKey||u.keyCode===34)return this._text.length-h;var a=r.charIndex,n=this._getWidthBeforeCursor(t,a),c=this._getIndexOnLine(t+1,n),s=this._textLines[t].slice(a);return s.length+c+1+this.missingNewlineOffset(t)},_getSelectionForOffset:function(u,e){return u.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(u,e){var h=this._getSelectionForOffset(u,e),r=this.get2DCursorLocation(h),t=r.lineIndex;if(t===0||u.metaKey||u.keyCode===33)return-h;var a=r.charIndex,n=this._getWidthBeforeCursor(t,a),c=this._getIndexOnLine(t-1,n),s=this._textLines[t].slice(0,a),i=this.missingNewlineOffset(t-1);return-this._textLines[t-1].length+c-s.length+(1-i)},_getIndexOnLine:function(u,e){for(var h=this._textLines[u],r=this._getLineLeftOffset(u),t=r,a=0,n,c,s=0,i=h.length;s<i;s++)if(n=this.__charBounds[u][s].width,t+=n,t>e){c=!0;var o=t-n,l=t,f=Math.abs(o-e),g=Math.abs(l-e);a=g<f?s:s-1;break}return c||(a=h.length-1),a},moveCursorDown:function(u){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",u)},moveCursorUp:function(u){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",u)},_moveCursorUpOrDown:function(u,e){var h="get"+u+"CursorOffset",r=this[h](e,this._selectionDirection==="right");e.shiftKey?this.moveCursorWithShift(r):this.moveCursorWithoutShift(r),r!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(u){var e=this._selectionDirection==="left"?this.selectionStart+u:this.selectionEnd+u;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),u!==0},moveCursorWithoutShift:function(u){return u<0?(this.selectionStart+=u,this.selectionEnd=this.selectionStart):(this.selectionEnd+=u,this.selectionStart=this.selectionEnd),u!==0},moveCursorLeft:function(u){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",u)},_move:function(u,e,h){var r;if(u.altKey)r=this["findWordBoundary"+h](this[e]);else if(u.metaKey||u.keyCode===35||u.keyCode===36)r=this["findLineBoundary"+h](this[e]);else return this[e]+=h==="Left"?-1:1,!0;if(typeof r!==void 0&&this[e]!==r)return this[e]=r,!0},_moveLeft:function(u,e){return this._move(u,e,"Left")},_moveRight:function(u,e){return this._move(u,e,"Right")},moveCursorLeftWithoutShift:function(u){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(e=this._moveLeft(u,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(u){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(u,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(u,"selectionStart")},moveCursorRight:function(u){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",u)},_moveCursorLeftOrRight:function(u,e){var h="moveCursor"+u+"With";this._currentCursorOpacity=1,e.shiftKey?h+="Shift":h+="outShift",this[h](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(u){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(u,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(u,"selectionEnd")},moveCursorRightWithoutShift:function(u){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(u,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(u,e){typeof e>"u"&&(e=u+1),this.removeStyleFromTo(u,e),this._text.splice(u,e-u),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(u,e,h,r){typeof r>"u"&&(r=h),r>h&&this.removeStyleFromTo(h,r);var t=d.util.string.graphemeSplit(u);this.insertNewStyleBlock(t,h,e),this._text=[].concat(this._text.slice(0,h),t,this._text.slice(r)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var u=d.util.toFixed,e=/  +/g;d.util.object.extend(d.Text.prototype,{_toSVG:function(){var h=this._getSVGLeftTopOffsets(),r=this._getSVGTextAndBg(h.textTop,h.textLeft);return this._wrapSVGTextAndBg(r)},toSVG:function(h){return this._createBaseSVGMarkup(this._toSVG(),{reviver:h,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(h){var r=!0,t=this.getSvgTextDecoration(this);return[h.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",t?'text-decoration="'+t+'" ':"",'style="',this.getSvgStyles(r),'"',this.addPaintOrder()," >",h.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(h,r){var t=[],a=[],n=h,c;this._setSVGBg(a);for(var s=0,i=this._textLines.length;s<i;s++)c=this._getLineLeftOffset(s),(this.textBackgroundColor||this.styleHas("textBackgroundColor",s))&&this._setSVGTextLineBg(a,s,r+c,n),this._setSVGTextLineText(t,s,r+c,n),n+=this.getHeightOfLine(s);return{textSpans:t,textBgRects:a}},_createTextCharSpan:function(h,r,t,a){var n=h!==h.trim()||h.match(e),c=this.getSvgSpanStyles(r,n),s=c?'style="'+c+'"':"",i=r.deltaY,o="",l=d.Object.NUM_FRACTION_DIGITS;return i&&(o=' dy="'+u(i,l)+'" '),['<tspan x="',u(t,l),'" y="',u(a,l),'" ',o,s,">",d.util.string.escapeXml(h),"</tspan>"].join("")},_setSVGTextLineText:function(h,r,t,a){var n=this.getHeightOfLine(r),c=this.textAlign.indexOf("justify")!==-1,s,i,o="",l,f,g=0,m=this._textLines[r],v;a+=n*(1-this._fontSizeFraction)/this.lineHeight;for(var p=0,_=m.length-1;p<=_;p++)v=p===_||this.charSpacing,o+=m[p],l=this.__charBounds[r][p],g===0?(t+=l.kernedWidth-l.width,g+=l.width):g+=l.kernedWidth,c&&!v&&this._reSpaceAndTab.test(m[p])&&(v=!0),v||(s=s||this.getCompleteStyleDeclaration(r,p),i=this.getCompleteStyleDeclaration(r,p+1),v=this._hasStyleChangedForSvg(s,i)),v&&(f=this._getStyleDeclaration(r,p)||{},h.push(this._createTextCharSpan(o,f,t,a)),o="",s=i,t+=g,g=0)},_pushTextBgRect:function(h,r,t,a,n,c){var s=d.Object.NUM_FRACTION_DIGITS;h.push("		<rect ",this._getFillAttributes(r),' x="',u(t,s),'" y="',u(a,s),'" width="',u(n,s),'" height="',u(c,s),`"></rect>
`)},_setSVGTextLineBg:function(h,r,t,a){for(var n=this._textLines[r],c=this.getHeightOfLine(r)/this.lineHeight,s=0,i=0,o,l,f=this.getValueOfPropertyAt(r,0,"textBackgroundColor"),g=0,m=n.length;g<m;g++)o=this.__charBounds[r][g],l=this.getValueOfPropertyAt(r,g,"textBackgroundColor"),l!==f?(f&&this._pushTextBgRect(h,f,t+i,a,s,c),i=o.left,s=o.width,f=l):s+=o.kernedWidth;l&&this._pushTextBgRect(h,l,t+i,a,s,c)},_getFillAttributes:function(h){var r=h&&typeof h=="string"?new d.Color(h):"";return!r||!r.getSource()||r.getAlpha()===1?'fill="'+h+'"':'opacity="'+r.getAlpha()+'" fill="'+r.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(h){for(var r=0,t=0,a=0;a<h;a++)r+=this.getHeightOfLine(a);return t=this.getHeightOfLine(a),{lineTop:r,offset:(this._fontSizeMult-this._fontSizeFraction)*t/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(h){var r=d.Object.prototype.getSvgStyles.call(this,h);return r+" white-space: pre;"}})}(),function(u){var e=u.fabric||(u.fabric={});e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:e.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(h){for(var r=0,t=0,a=0,n={},c=0;c<h.graphemeLines.length;c++)h.graphemeText[a]===`
`&&c>0?(t=0,a++,r++):!this.splitByGrapheme&&this._reSpaceAndTab.test(h.graphemeText[a])&&c>0&&(t++,a++),n[c]={line:r,offset:t},a+=h.graphemeLines[c].length,t+=h.graphemeLines[c].length;return n},styleHas:function(h,r){if(this._styleMap&&!this.isWrapping){var t=this._styleMap[r];t&&(r=t.line)}return e.Text.prototype.styleHas.call(this,h,r)},isEmptyStyles:function(h){if(!this.styles)return!0;var r=0,t=h+1,a,n,c=!1,s=this._styleMap[h],i=this._styleMap[h+1];s&&(h=s.line,r=s.offset),i&&(t=i.line,c=t===h,a=i.offset),n=typeof h>"u"?this.styles:{line:this.styles[h]};for(var o in n)for(var l in n[o])if(l>=r&&(!c||l<a))for(var f in n[o][l])return!1;return!0},_getStyleDeclaration:function(h,r){if(this._styleMap&&!this.isWrapping){var t=this._styleMap[h];if(!t)return null;h=t.line,r=t.offset+r}return this.callSuper("_getStyleDeclaration",h,r)},_setStyleDeclaration:function(h,r,t){var a=this._styleMap[h];h=a.line,r=a.offset+r,this.styles[h][r]=t},_deleteStyleDeclaration:function(h,r){var t=this._styleMap[h];h=t.line,r=t.offset+r,delete this.styles[h][r]},_getLineStyle:function(h){var r=this._styleMap[h];return!!this.styles[r.line]},_setLineStyle:function(h){var r=this._styleMap[h];this.styles[r.line]={}},_wrapText:function(h,r){var t=[],a;for(this.isWrapping=!0,a=0;a<h.length;a++)t=t.concat(this._wrapLine(h[a],a,r));return this.isWrapping=!1,t},_measureWord:function(h,r,t){var a=0,n,c=!0;t=t||0;for(var s=0,i=h.length;s<i;s++){var o=this._getGraphemeBox(h[s],r,s+t,n,c);a+=o.kernedWidth,n=h[s]}return a},_wrapLine:function(h,r,t,y){var n=0,c=this.splitByGrapheme,s=[],i=[],o=c?e.util.string.graphemeSplit(h):h.split(this._wordJoiners),l="",f=0,g=c?"":" ",m=0,v=0,p=0,_=!0,C=c?0:this._getWidthOfCharSpacing(),y=y||0;o.length===0&&o.push([]),t-=y;for(var S=0;S<o.length;S++)l=c?o[S]:e.util.string.graphemeSplit(o[S]),m=this._measureWord(l,r,f),f+=l.length,n+=v+m-C,n>=t&&!_?(s.push(i),i=[],n=m,_=!0):n+=C,!_&&!c&&i.push(g),i=i.concat(l),v=this._measureWord([g],r,f),f++,_=!1,m>p&&(p=m);return S&&s.push(i),p+y>this.dynamicMinWidth&&(this.dynamicMinWidth=p-C+y),s},isEndOfWrapping:function(h){return!this._styleMap[h+1]||this._styleMap[h+1].line!==this._styleMap[h].line},missingNewlineOffset:function(h){return this.splitByGrapheme?this.isEndOfWrapping(h)?1:0:1},_splitTextIntoLines:function(h){for(var r=e.Text.prototype._splitTextIntoLines.call(this,h),t=this._wrapText(r.lines,this.width),a=new Array(t.length),n=0;n<t.length;n++)a[n]=t[n].join("");return r.lines=a,r.graphemeLines=t,r},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var h={};for(var r in this._styleMap)this._textLines[r]&&(h[this._styleMap[r].line]=1);for(var r in this.styles)h[r]||delete this.styles[r]},toObject:function(h){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(h))}}),e.Textbox.fromObject=function(h,r){return e.Object._fromObject("Textbox",h,r,"text")}}(W)})(ut);var rt=(W=>(W.Pencil="pencil",W.Line="line",W.DashedLine="dashedLine",W.Arrow="arrow",W.Text="text",W.Rect="rect",W.Circle="circle",W.Ellipse="ellipse",W.Equilateral="equilateral",W.Upload="upload",W.Rubber="rubber",W.Undo="undo",W.Redo="redo",W.Move="move",W.Clear="clear",W.Download="download",W))(rt||{});const ee=[{name:"\u94C5\u7B14",type:"pencil",icon:"icon-pan_icon"},{name:"\u5B9E\u7EBF",type:"line",icon:"icon-xian"},{name:"\u865A\u7EBF",type:"dashedLine",icon:"icon-xian1"},{name:"\u7BAD\u5934",type:"arrow",icon:"icon-jiantou"},{name:"\u6587\u5B57",type:"text",icon:"icon-wenzi"},{name:"\u77E9\u5F62",type:"rect",icon:"icon-juxing"},{name:"\u5706\u5F62",type:"circle",icon:"icon-yuanxing"},{name:"\u692D\u5706\u5F62",type:"ellipse",icon:"icon-tuoyuanxing"},{name:"\u4E09\u89D2\u5F62",type:"equilateral",icon:"icon-sanjiaoxing"},{name:"\u4E0A\u4F20\u56FE\u7247",type:"upload",icon:"icon-seiyw41"},{name:"\u6A61\u76AE",type:"rubber",icon:"icon-xiangpi"},{name:"\u56DE\u9000",type:"undo",icon:"icon-undo"},{name:"\u5411\u524D",type:"redo",icon:"icon-redo"},{name:"\u6E05\u9664",type:"clear",icon:"icon-clear"},{name:"\u79FB\u52A8",type:"move",icon:"icon-yidong"},{name:"\u4E0B\u8F7D",type:"download",icon:"icon-xiazai"}],ie=["onClick"],re={key:0,for:"x-whiteboard-upload"},ne={id:"myCanvas",ref:"myCanvas"},se={name:"x-whiteboard"},ae=Ot({...se,props:{toolPosition:{},canvasWidth:{default:window.innerWidth},canvasHeight:{default:window.innerHeight},canvasBgColor:{default:"#f6f6f6"},strokeColor:{default:"#f30"},strokeWidth:{default:2},showTools:{type:Boolean,default:!0},initData:{default:()=>null}},emits:["save"],setup(W,{emit:d}){const $=W,et=wt({stage:0,data:[]}),ot=wt({width:$.canvasWidth||window.innerWidth,height:$.canvasHeight||window.innerHeight,bgColor:$.canvasBgColor||"#ffffff"}),V=wt({type:rt.Pencil,strokeColor:$.strokeColor||"#f30",strokeWidth:$.strokeWidth||2}),M={boardObj:null,textObj:null,mouseFrom:{},mouseTo:{},isDrawing:!1,drawingObj:null};Bt(()=>{It(()=>{const{initData:y}=$;M.boardObj=new ut.fabric.Canvas("myCanvas",{isDrawingMode:!0,selectable:!0,selection:!0,devicePixelRatio:!0,backgroundColor:ot.bgColor||"#ffffff"}),M.boardObj.freeDrawingBrush.color=V.strokeColor,M.boardObj.freeDrawingBrush.width=V.strokeWidth,M.boardObj.setWidth(ot.width),M.boardObj.setHeight(ot.height),y&&M.boardObj.loadFromJSON(y),u()})});function u(){M.boardObj.on({"mouse:down":y=>{let{x:S,y:w}=y.pointer;M.mouseFrom={x:S,y:w},M.boardObj.getActiveObject()||(M.isDrawing=!0),V.type===rt.Text&&l()},"mouse:up":y=>{let{x:S,y:w}=y.pointer;M.mouseTo={x:S,y:w},M.isDrawing=!1,M.drawingObj=null,f()},"mouse:move":y=>{if(M.isDrawing){let{x:S,y:w}=y.pointer;M.mouseTo={x:S,y:w},e()}},"object:moving":y=>{},"object:scaling":y=>{},"object:rotating":y=>{},"selection:created":y=>{if(V.type===rt.Rubber){if(y.target._objects){const S=y.target._objects.length;for(let w=0;w<S;w++)M.boardObj.remove(y.target._objects[w])}else M.boardObj.remove(y.target);M.boardObj.discardActiveObject()}f()}})}function e(){M.drawingObj&&M.boardObj.remove(M.drawingObj),M.boardObj.isDrawingMode=!1,M.boardObj.selectable=!1,M.boardObj.selection=!1;let y=null;switch(V.type){case rt.Pencil:M.boardObj.isDrawingMode=!0;break;case rt.Line:y=t();break;case rt.DashedLine:y=a();break;case rt.Arrow:y=o();break;case rt.Rect:y=n();break;case rt.Circle:y=c();break;case rt.Ellipse:y=s();break;case rt.Equilateral:y=i();break;default:y=null,M.boardObj.selection=!0,M.boardObj.skipTargetFind=!1,M.boardObj.selectable=!0;break}y&&(M.boardObj.add(y),M.drawingObj=y)}function h(y){switch(M.boardObj.isDrawingMode=!1,r(),M.boardObj.getActiveObject()&&(M.boardObj.discardActiveObject(),M.boardObj.renderAll()),y){case rt.Clear:return M.boardObj.clear();case rt.Upload:return;case rt.Undo:return g();case rt.Redo:return m();case rt.Download:return v();default:switch(V.type=y,y){case rt.Pencil:M.boardObj.isDrawingMode=!0;break;case rt.Rubber:case rt.Move:M.boardObj.selection=!0,M.boardObj.skipTargetFind=!1,M.boardObj.selectable=!0;break}C();break}}function r(){M.boardObj.selectable=!0,M.boardObj.selection=!0,M.boardObj.skipTargetFind=!1,M.textObj&&(M.textObj.exitEditing(),M.textObj=null)}function t(){return new ut.fabric.Line([M.mouseFrom.x,M.mouseFrom.y,M.mouseTo.x,M.mouseTo.y],{stroke:V.strokeColor,strokeWidth:V.strokeWidth})}function a(){return new ut.fabric.Line([M.mouseFrom.x,M.mouseFrom.y,M.mouseTo.x,M.mouseTo.y],{stroke:V.strokeColor,strokeWidth:V.strokeWidth,strokeDashArray:[10,3]})}function n(){return new ut.fabric.Rect({left:M.mouseFrom.x,top:M.mouseFrom.y,height:Math.abs(M.mouseTo.y-M.mouseFrom.y),width:Math.abs(M.mouseTo.x-M.mouseFrom.x),stroke:V.strokeColor,strokeWidth:V.strokeWidth,fill:"rgba(255, 255, 255, 0)"})}function c(){let y=M.mouseTo.x-M.mouseFrom.x,S=M.mouseTo.y-M.mouseFrom.y,w=Math.sqrt(Math.pow(y,2)+Math.pow(S,2))/2;return new ut.fabric.Circle({left:M.mouseFrom.x,top:M.mouseFrom.y,stroke:V.strokeColor,fill:"rgba(255, 255, 255, 0)",radius:w,strokeWidth:V.strokeWidth})}function s(){let y=M.mouseFrom.x,S=M.mouseFrom.y;return new ut.fabric.Ellipse({left:y,top:S,fill:"rgba(255, 255, 255, 0)",originX:"center",originY:"center",rx:Math.abs(y-M.mouseTo.x),ry:Math.abs(S-M.mouseTo.y),stroke:V.strokeColor,strokeWidth:V.strokeWidth})}function i(){let y=M.mouseTo.y-M.mouseFrom.y;return new ut.fabric.Triangle({top:M.mouseFrom.y,left:M.mouseFrom.x,width:Math.sqrt(Math.pow(y,2)+Math.pow(y/2,2)),height:y,stroke:V.strokeColor,strokeWidth:V.strokeWidth,fill:"rgba(255,255,255,0)"})}function o(){let[y,S]=[M.mouseFrom.x,M.mouseFrom.y],[w,O]=[M.mouseTo.x,M.mouseTo.y],E=S-O,L=y-w,B=30,Y=30,U=Math.atan2(E,L)*180/Math.PI,b=(U+B)*Math.PI/180,P=(U-B)*Math.PI/180,k=Y*Math.cos(b),F=Y*Math.sin(b),z=Y*Math.cos(P),x=Y*Math.sin(P),T=y-k,D=S-F,A=" M "+y+" "+S;return A+=" L "+w+" "+O,T=w+k,D=O+F,A+=" M "+T+" "+D,A+=" L "+w+" "+O,T=w+z,D=O+x,A+=" L "+T+" "+D,new ut.fabric.Path(A,{stroke:V.strokeColor,strokeWidth:V.strokeWidth,fill:"rgba(255,255,255,0)"})}function l(){let{x:y,y:S}=M.mouseFrom;M.textObj=new ut.fabric.Textbox("",{left:y,top:S,width:"",height:"",fill:V.strokeColor,hasControls:!0}),M.boardObj.add(M.textObj),M.textObj.enterEditing(),M.textObj.hiddenTextarea.focus(),f()}function f(){et.data.push(JSON.stringify(M.boardObj)),C()}function g(){let y=et.data;et.stage<y.length&&(M.boardObj.clear().renderAll(),M.boardObj.loadFromJSON(y[y.length-1-et.stage-1]),M.boardObj.renderAll(),et.stage+=1,C())}function m(){let y=et.data;et.stage>0&&(M.boardObj.clear().renderAll(),M.boardObj.loadFromJSON(y[y.length-1-et.stage+1]),M.boardObj.renderAll(),et.stage-=1,C())}function v(){let S=M.boardObj.toDataURL({formart:"png",multiplier:2}).split(","),w=S[0].match(/:(.*?);/)[1],O=atob(S[1]),E=O.length,L=new Uint8Array(E);for(;E--;)L[E]=O.charCodeAt(E);let B=new Blob([L],{type:w});$t.saveAs(B,"sketchpad.png")}const p=Rt(null);function _(y){let S=y.target.files[0],w=new FileReader;w.onload=O=>{let E=O.target.result,L=new Image;L.src=E,L.onload=()=>{const B=new ut.fabric.Image(L);B.scale(.5),M.boardObj.centerObject(B).add(B).renderAll(),p.value.value=""}},w.readAsDataURL(S)}function C(){const y={set:{canvas:{width:ot.width,height:ot.height,bgColor:ot.bgColor},stroke:{size:V.strokeWidth,color:V.strokeColor}},json:M.boardObj.toJSON()};d("save",y)}return(y,S)=>(lt(),dt("div",{class:"x-whiteboard",style:Ft({width:ot.width+"px",height:ot.height+"px"})},[_t("input",{type:"file",accept:"image/*",id:"x-whiteboard-upload",ref_key:"upload",ref:p,onChange:S[0]||(S[0]=w=>_(w))},null,544),_t("ul",{class:"x-tool-bar",style:Ft(y.toolPosition)},[(lt(!0),dt(Xt,null,Yt(tt(ee),w=>(lt(),dt("li",{key:w.type,class:Dt(["tool-con",{active:V.type===w.type}]),onClick:O=>h(w.type)},[w.type==="upload"?(lt(),dt("label",re,[_t("i",{class:Dt(["iconfont",w.icon])},null,2)])):(lt(),dt("i",{key:1,class:Dt(["iconfont",w.icon])},null,2))],10,ie))),128))],4),_t("canvas",ne,null,512)],4))}});const oe=Mt(ae,[["__scopeId","data-v-809d19fe"]]),he={name:"WhiteboardEditor"},le=Ot({...he,setup(W){const d=At("contentName"),$=At("contentIdentity");Zt(ft,$,["content"],d);const et=Pt(()=>ft.item[$.value].content.setting.canvas),ot=Pt(()=>ft.item[$.value].content.setting.stroke),V=Pt(()=>({left:ct.menuDrawer.collapse?"28px":"228px",top:"58px"}));function M(u){const{set:{canvas:e,stroke:h},json:r}=u,t={canvas:{width:e.width,height:e.height,bgColor:e.bgColor},stroke:{size:h.size,color:h.color}};ft.item[$.value].content.setting=t,ft.item[$.value].content.content=r}return(u,e)=>(lt(),Tt(oe,{"tool-position":V.value,"canvas-width":et.value.width,"canvas-height":et.value.height,"canvas-bg-color":et.value.bgColor,"stroke-color":ot.value.color,"stroke-width":ot.value.size,"init-data":tt(ft).item[tt($)].content.content,onSave:M},null,8,["tool-position","canvas-width","canvas-height","canvas-bg-color","stroke-color","stroke-width","init-data"]))}}),ce={class:"warp_bigger whiteboard_area"},ue={key:0,class:"show_area"},fe={class:"tw-flex tw-justify-end tw-items-center"},de={key:0},ge={class:"tw-ml-4"},me={key:0,class:"editor-area"},ve={name:"ModuleWhiteboard"},pe=Ot({...ve,setup(W){const d=At("storeIDB"),{curContentIdentity:$,curContentName:et,curContentFolderIdentity:ot,curFolders:V,curHistoryFolders:M,curIsSaved:u,addFolder:e,renameFolder:h,deleteFolder:r,sortFolder:t,createContent:a,saveContent:n,showContent:c,renameContent:s,copyContent:i,deleteContent:o,autoSaveContent:l,importContent:f,getContent:g,saveFolder:m,saveContentItem:v}=Jt(d,Qt,ft,te());st("contentIsSaved",u),st("contentFolderIdentity",ot),st("contentIdentity",$),st("contentName",et),st("historyFolders",M),st("folders",V),st("addFolder",e),st("renameFolder",h),st("deleteFolder",r),st("showContent",c),st("copyContent",i),st("renameContent",s),st("deleteContent",o),st("sortFolder",t),st("saveContent",n),st("autoSaveContent",l),st("getContent",g),st("saveFolder",m),st("saveContentItem",v);function p(){a()}function _(C){ct.loading=!0;const{name:y,content:S,isSave:w,folderIdentity:O}=C;f(y,S,w,O,xt).then(()=>{ct.loading=!1}).catch(()=>{ct.loading=!1})}return(C,y)=>(lt(),dt("div",ce,[yt(Kt,{collapse:tt(ct).historyDrawer.collapse,"onUpdate:collapse":y[2]||(y[2]=S=>tt(ct).historyDrawer.collapse=S),history:tt(ct).historyDrawer,suffix:tt(xt)},{default:kt(()=>[tt($)?(lt(),dt("div",ue,[yt(Gt,{title:tt(Wt)(`module.${tt(ct).module}`),contentName:tt(et),"onUpdate:contentName":y[1]||(y[1]=S=>Ut(et)?et.value=S:null),"is-has-name":!0},{titleRight:kt(()=>[_t("div",fe,[tt($)?(lt(),dt("span",de,[yt(Nt,{"store-item-data":tt(ft).item[tt($)]},null,8,["store-item-data"])])):St("",!0),_t("span",ge,[yt(Ht,{"support-types":["text/plain"],accept:[tt(xt)],"store-item-data":tt(ft).item[tt($)],suffix:tt(xt),onSelect:p,onContent:_},null,8,["accept","store-item-data","suffix"])]),yt(Vt,zt({class:"tw-ml-2"},C.$attrs),null,16),tt(ct).historyDrawer.collapse?(lt(),Tt(qt,{key:1,class:"tw-ml-2",visible:tt(ct).historyDrawer.visible,"onUpdate:visible":y[0]||(y[0]=S=>tt(ct).historyDrawer.visible=S)},null,8,["visible"])):St("",!0)])]),default:kt(()=>[tt($)?(lt(),dt("div",me,[(lt(),Tt(le,{key:tt($)}))])):St("",!0)]),_:1},8,["title","contentName"])])):St("",!0)]),_:1},8,["collapse","history","suffix"])]))}});const _e=Mt(pe,[["__scopeId","data-v-2536e434"]]),$e=Ot({__name:"Whiteboard",setup(W){return(d,$)=>(lt(),Tt(_e))}});export{$e as default};
