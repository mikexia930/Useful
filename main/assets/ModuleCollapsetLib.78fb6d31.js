import{aL as F,d as ee,P as ne,s as j,ab as te,N as oe,M as re,aM as K,U as ie,O as ae,a as ue,aN as ce,j as se,a8 as le,b as S,E as L,aO as fe,aj as P,g as de}from"./index.1da778f9.js";import{P as me}from"./DTooltip.63413dc2.js";import{b as ve,c as pe,w as X}from"./Interface.adbaf245.js";import{E as Y,g as q,c as ge,r as G,a as J}from"./routeLib.b1a3bf91.js";import{f as he}from"./findIndex.4ace8958.js";var B;function Z(m){if(typeof document>"u")return 0;if(m||B===void 0){var e=document.createElement("div");e.style.width="100%",e.style.height="200px";var i=document.createElement("div"),o=i.style;o.position="absolute",o.top="0",o.left="0",o.pointerEvents="none",o.visibility="hidden",o.width="200px",o.height="150px",o.overflow="hidden",i.appendChild(e),document.body.appendChild(i);var t=e.offsetWidth;i.style.overflow="scroll";var a=e.offsetWidth;t===a&&(a=i.clientWidth),document.body.removeChild(i),B=t-a}return B}function _(m){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=e.element,o=i===void 0?document.body:i,t={},a=Object.keys(m);return a.forEach(function(l){t[l]=o.style[l]}),a.forEach(function(l){o.style[l]=m[l]}),t}function Ce(){return document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&window.innerWidth>document.body.offsetWidth}var V={};const Q=function(m){if(!(!Ce()&&!m)){var e="ant-scrolling-effect",i=new RegExp("".concat(e),"g"),o=document.body.className;if(m){if(!i.test(o))return;_(V),V={},document.body.className=o.replace(i,"").trim();return}var t=Z();if(t&&(V=_({position:"relative",width:"calc(100% - ".concat(t,"px)")}),!i.test(o))){var a="".concat(o," ").concat(e);document.body.className=a.trim()}}};var C=[],D="ant-scrolling-effect",$=new RegExp("".concat(D),"g"),ye=0,z=new Map,we=ve(function m(e){var i=this;pe(this,m),this.getContainer=function(){var o;return(o=i.options)===null||o===void 0?void 0:o.container},this.reLock=function(o){var t=C.find(function(a){var l=a.target;return l===i.lockTarget});t&&i.unLock(),i.options=o,t&&(t.options=o,i.lock())},this.lock=function(){var o;if(!C.some(function(s){var c=s.target;return c===i.lockTarget})){if(C.some(function(s){var c=s.options,h;return(c==null?void 0:c.container)===((h=i.options)===null||h===void 0?void 0:h.container)})){C=[].concat(F(C),[{target:i.lockTarget,options:i.options}]);return}var t=0,a=((o=i.options)===null||o===void 0?void 0:o.container)||document.body;(a===document.body&&window.innerWidth-document.documentElement.clientWidth>0||a.scrollHeight>a.clientHeight)&&(t=Z());var l=a.className;if(C.filter(function(s){var c=s.options,h;return(c==null?void 0:c.container)===((h=i.options)===null||h===void 0?void 0:h.container)}).length===0&&z.set(a,_({width:t!==0?"calc(100% - ".concat(t,"px)"):void 0,overflow:"hidden",overflowX:"hidden",overflowY:"hidden"},{element:a})),!$.test(l)){var p="".concat(l," ").concat(D);a.className=p.trim()}C=[].concat(F(C),[{target:i.lockTarget,options:i.options}])}},this.unLock=function(){var o,t=C.find(function(p){var s=p.target;return s===i.lockTarget});if(C=C.filter(function(p){var s=p.target;return s!==i.lockTarget}),!(!t||C.some(function(p){var s=p.options,c;return(s==null?void 0:s.container)===((c=t.options)===null||c===void 0?void 0:c.container)}))){var a=((o=i.options)===null||o===void 0?void 0:o.container)||document.body,l=a.className;!$.test(l)||(_(z.get(a),{element:a}),z.delete(a),a.className=a.className.replace($,"").trim())}},this.lockTarget=ye++,this.options=e}),w=0,x=ce(),H={},k=function(e){if(!x)return null;if(e){if(typeof e=="string")return document.querySelectorAll(e)[0];if(typeof e=="function")return e();if(se(e)==="object"&&e instanceof window.HTMLElement)return e}return document.body};const ke=ee({name:"PortalWrapper",inheritAttrs:!1,props:{wrapperClassName:String,forceRender:{type:Boolean,default:void 0},getContainer:ne.any,visible:{type:Boolean,default:void 0}},setup:function(e,i){var o=i.slots,t=j(),a=j(),l=j(),p=new we({container:k(e.getContainer)}),s=function(){var f,g;(g=(f=t.value)===null||f===void 0?void 0:f.parentNode)===null||g===void 0||g.removeChild(t.value)},c=function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(f||t.value&&!t.value.parentNode){var g=k(e.getContainer);return g?(g.appendChild(t.value),!0):!1}return!0},h=function(){return x?(t.value||(t.value=document.createElement("div"),c(!0)),R(),t.value):null},R=function(){var f=e.wrapperClassName;t.value&&f&&f!==t.value.className&&(t.value.className=f)};te(function(){R(),c()});var I=function(){w===1&&!Object.keys(H).length?(Q(),H=_({overflow:"hidden",overflowX:"hidden",overflowY:"hidden"})):w||(_(H),H={},Q(!0))},O=le();return oe(function(){var v=!1;re([function(){return e.visible},function(){return e.getContainer}],function(f,g){var N=K(f,2),b=N[0],y=N[1],r=K(g,2),d=r[0],u=r[1];if(x&&k(e.getContainer)===document.body&&(b&&!d?w+=1:v&&(w-=1)),v){var n=typeof y=="function"&&typeof u=="function";(n?y.toString()!==u.toString():y!==u)&&s(),b&&b!==d&&x&&k(y)!==p.getContainer()&&p.reLock({container:k(y)})}v=!0},{immediate:!0,flush:"post"}),ie(function(){c()||(l.value=X(function(){O.update()}))})}),ae(function(){var v=e.visible,f=e.getContainer;x&&k(f)===document.body&&(w=v&&w?w-1:w),s(),X.cancel(l.value)}),function(){var v=e.forceRender,f=e.visible,g=null,N={getOpenCount:function(){return w},getContainer:h,switchScrollingEffect:I,scrollLocker:p};return(v||f||a.value)&&(g=ue(me,{getContainer:h,ref:a},{default:function(){var y;return(y=o.default)===null||y===void 0?void 0:y.call(o,N)}})),g}}});function _e(m,e){function i(r){e.theme=r}function o(r){e.autoSave=r}const t=S(()=>e.module);function a(r){e.module=r}const l=S(()=>e.documentModule);function p(r=""){e.documentModule=r}const s=S(()=>e.historyDrawer.collapse);function c(r){e.historyDrawer.collapse=r}const h=S(()=>e.menuDrawer.collapse);function R(r){e.menuDrawer.collapse=r}const I=S(()=>e.menuDrawer.visible);function O(r){e.menuDrawer.visible=r}function v(){const r=[],d=q(),u=[];return P(e.menus,n=>{const{module:E,label:T,isUse:A,customLabel:U}=n;u.push(n.module);const W=he(d,M=>M.value===E);if(W>-1){const M={...d[W],isUse:A};M.label=U||T||de(`module.${E}`)||"",r.push(M)}}),u.length<d.length&&P(d,n=>{u.includes(n.value)||r.push({...n,isUse:!1})}),r}const f=S(()=>{const r=v();let d=!1,u=!1;return t.value===L.Setting||t.value===L._Document?(d=!0,u=!0):P(r,n=>{const{isUse:E,value:T}=n;E&&(u=!0,t.value===T&&(d=!0))}),u?d||G(J.Push,{name:"notfound",params:{module:String(t.value)}}):G(J.Replace,{name:"notfound"}),r});function g(r){e.menus=[...r]}function N(){return new Promise((r,d)=>{m.getStorageData(Y.Common).then(u=>{if(u){const{value:n}=u;e.menuDrawer.collapse=!!(n!=null&&n.menu),e.menuDrawer.cooperate=n!=null&&n.menuIconCooperate?{...n.menuIconCooperate}:{x:0,y:50},e.historyDrawer.collapse=!!(n!=null&&n.history),e.module=(n==null?void 0:n.module)||L.Format,e.autoSave=n!=null&&n.autoSave?{...n.autoSave}:{isAuto:!1,saveTime:10},e.theme=n!=null&&n.theme?{...n.theme}:{current:fe.Light},e.group=n!=null&&n.group?{...n.group}:{current:""},e.menus=n!=null&&n.menus?[...n.menus]:b(),r(e.module)}else e.menus=b(),r(L.Format)}).catch(u=>{console.log("getStoreCommon",u),r(L.Format)})})}function b(){const r=[],d=q();return P(d,u=>{r.push({module:u.value,label:u.label,isUse:!0})}),r}function y(){const{menuDrawer:r,historyDrawer:d,module:u,autoSave:n,theme:E,group:T,menus:A}=e,U=[];P(A,M=>{U.push({module:M.module,isUse:M.isUse,customLabel:M.customLabel})});const W={key:Y.Common,type:ge.Config,value:{menu:r.collapse,menuIconCooperate:{...r.cooperate},history:d.collapse,module:u,autoSave:{...n},theme:{...E},group:{...T},menus:U}};m.saveStorage(W)}return{curModule:t,setModule:a,curMenuCollapse:h,curMenuVisible:I,setMenuVisible:O,setMenuCollapse:R,curHistoryCollapse:s,setHistoryCollapse:c,curMenus:f,setMenus:g,getStoreCommon:N,setStoreCommon:y,setTheme:i,setAutoSave:o,setDocumentModule:p,curDocumentModule:l}}export{ke as P,Z as g,_e as u};
