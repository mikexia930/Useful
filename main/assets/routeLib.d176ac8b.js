var w=Object.defineProperty;var v=(n,e,t)=>e in n?w(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var p=(n,e,t)=>(v(n,typeof e!="symbol"?e+"":e,t),t);import{g as S}from"./dateLib.63528a18.js";import{f as P}from"./forEach.79d0bc65.js";import{E as l,r as D}from"./index.3deece30.js";import{g as m}from"./lib.5292314e.js";var g=(n=>(n.INDEXEDDB="indexedDB",n.LOCALSTORAGE="localstorage",n))(g||{}),d=(n=>(n.ReadOnly="readonly",n.ReadWrite="readwrite",n))(d||{});class E{constructor(e){if(this.version=0,this.dbName=e,!this.isSupport)throw Error("Browser not support indexDB.")}isSupport(){return!!window.indexedDB}connect(e=0){return new Promise((t,a)=>{if(this.isSupport()){e&&(this.version=e);const r=window.indexedDB.open(this.dbName,this.version);r.onblocked=()=>{alert("Close other Tab for change version")},r.onerror=s=>{console.log("e",s),a(s)},e?r.onupgradeneeded=s=>{t(s.target.result)}:r.onsuccess=()=>{t(r.result)}}})}checkTableIsExists(e,t){return new Promise((a,r)=>{this.connect(t).then(s=>{let o=!1;s.objectStoreNames.contains(e)&&(o=!0),a({db:s,isContain:o})}).catch(s=>{r(s)})})}createTable(e,t,a,r=[]){return new Promise((s,o)=>{this.checkTableIsExists(t,e).then(i=>{const{db:c,isContain:u}=i;if(!u){let h;a==="autoIncrement"?h={autoIncrement:!0}:h={keyPath:a};const b=c.createObjectStore(t,h);r.length>0&&r.forEach(f=>{b.createIndex(f.name,f.keyPath,f.option||{})})}s(!0)}).catch(i=>{o(i)})})}getTransaction(e,t){return new Promise((a,r)=>{this.connect().then(s=>{const o=s.transaction([e],t);o.onerror=i=>{r(i)},a(o.objectStore(e))})})}get(e,t,a=""){return new Promise((r,s)=>{this.getTransaction(e,d.ReadOnly).then(o=>{let i;a?i=o.index(a).get(t):i=o.get(t),i.onsuccess=c=>{r(c.target.result)},i.onerror=c=>{s(c)}})})}set(e,t){return new Promise(a=>{this.getTransaction(e,d.ReadWrite).then(r=>{const s={success:[],failed:[]};t.forEach(o=>{const i=r.put(o);i.onsuccess=()=>{s.success.push(o)},i.onerror=()=>{s.failed.push(o)}}),a(s)})})}add(e,t){return new Promise(a=>{this.getTransaction(e,d.ReadWrite).then(r=>{const s={success:[],failed:[]};t.forEach(o=>{const i=r.add(o);i.onsuccess=()=>{s.success.push(o)},i.onerror=()=>{s.failed.push(o)}}),a(s)})})}delete(e,t){return new Promise(a=>{this.getTransaction(e,d.ReadWrite).then(r=>{const s={success:[],failed:[]};t.forEach(o=>{const i=r.delete(o);i.onsuccess=()=>{s.success.push(o)},i.onerror=()=>{s.failed.push(o)}}),a(s)})})}clear(e){return new Promise((t,a)=>{this.getTransaction(e,d.ReadWrite).then(r=>{const s=r.clear();s.onsuccess=()=>{t(!0)},s.onerror=()=>{a(!1)}})})}getAll(e){return new Promise((t,a)=>{this.getTransaction(e,d.ReadOnly).then(r=>{let s=[],o;r.getAll?(o=r.getAll(),o.onsuccess=i=>{s=i.target.result,t(s)},o.onerror=i=>{a(i)}):(o=r.openCursor(),o.onsuccess=i=>{const c=i.target.result;c?(s.push(c.value),c.continue()):t(s)},o.onerror=i=>{a(i)})})})}}class N{constructor(e){if(this.tableKeyPath={},this.dbName=e,!this.isSupport)throw Error("Browser not support LocalStorage.")}isSupport(){return!!window.localStorage}createTable(e,t,a){return new Promise(r=>{this.tableKeyPath[t]=a,r(!0)})}_get(e){return localStorage.getItem(e)}_set(e,t){return localStorage.setItem(e,t)}_getDBData(){return new Promise((e,t)=>{try{let a={};const r=this._get(this.dbName);if(r)try{a=JSON.parse(r)}catch{a={}}e(a)}catch(a){t(a)}})}_setDBData(e){return new Promise((t,a)=>{try{this._set(this.dbName,JSON.stringify(e)),t("")}catch(r){a(r)}})}get(e,t,a=""){return new Promise((r,s)=>{this._getDBData().then(o=>{const i=o[e]||[],c=a||this.tableKeyPath[e];let u;i.forEach(h=>{h[c]===t&&(u=h)}),r(u)}).catch(o=>{s(o)})})}getAll(e){return new Promise((t,a)=>{this._getDBData().then(r=>{t((r==null?void 0:r[e])||"")}).catch(r=>{a(r)})})}set(e,t){return new Promise((a,r)=>{this._getDBData().then(s=>{const o=s,i=o[e]||[],c=this.tableKeyPath[e],u=[];i.forEach(h=>{u.push(h[c])}),t.forEach(h=>{const b=u.indexOf(h[c]);b>-1?i[b]=h:i.push(h)}),o[e]=i,this._setDBData(o).then(()=>{a(!0)}).catch(h=>{r(h)})}).catch(s=>{r(s)})})}add(e,t){return new Promise((a,r)=>{this._getDBData().then(s=>{const o=s,i=o[e]||[],c=[],u=this.tableKeyPath[e];i.forEach(h=>{c.push(h[u])}),t.forEach(h=>{c.includes(h[u])||i.push(h)}),o[e]=i,this._setDBData(o).then(()=>{a(!0)}).catch(h=>{r(h)})}).catch(s=>{r(s)})})}delete(e,t){return new Promise((a,r)=>{this._getDBData().then(s=>{const o=[],i=s[e]||[],c=this.tableKeyPath[e];i.forEach(u=>{t.includes(u[c])||o.push(u)}),s[e]=o,this._setDBData(s).then(()=>{a("")}).catch(u=>{r(u)})}).catch(s=>{r(s)})})}clear(e){return new Promise((t,a)=>{this._getDBData().then(r=>{const s={...r};delete s[e],this._setDBData(s).then(()=>{t("")}).catch(o=>{a(o)})}).catch(r=>{a(r)})})}}class y{constructor(e){this.version=1,this.dbName="x_db",this.tableName="x_table",this.useStores=[g.INDEXEDDB,g.LOCALSTORAGE];try{e!=null&&e.dbName&&(this.dbName=e.dbName),e!=null&&e.tableName&&(this.tableName=e.tableName),e!=null&&e.useStores&&(this.useStores=e.useStores);for(let t=0;t<this.useStores.length;t+=1){switch(this.useStores[t]){case g.INDEXEDDB:this.storeIns=new E(this.dbName);break;case g.LOCALSTORAGE:this.storeIns=new N(this.dbName);break}if(this.storeIns.isSupport())break}}catch(t){throw new Error(t)}if(!this.storeIns.isSupport())throw new Error("browser not support")}getVersion(){return this.version}createTable(e,t=[],a=0){this.version=a,this.storeIns.createTable(this.version,this.tableName,e,t)}set(e){return this.storeIns.set(this.tableName,e)}add(e){return this.storeIns.add(this.tableName,e)}get(e,t=""){return this.storeIns.get(this.tableName,e,t)}getAll(){return this.storeIns.getAll(this.tableName)}delete(e){return this.storeIns.delete(this.tableName,e)}clear(){return this.storeIns.clear(this.tableName)}}var I=(n=>(n.Config="config",n.Folder="folder",n.Content="content",n.Env="env",n))(I||{}),C=(n=>(n.Key="key",n.Type="type",n.Value="value",n.Datetime="datetime",n))(C||{});class U{constructor(e,t=1){p(this,"storeIns");p(this,"storageName","");p(this,"version",1);this.storageName=e,this.version=t}getStorageConfig(){return{dbName:"useful",tableName:this.storageName,useStores:["indexedDB","localstorage"]}}initStorageIns(){this.storeIns=new y(this.getStorageConfig()),this.storeIns.createTable("key",[{name:"key",keyPath:"key"},{name:"type",keyPath:"type"},{name:"value",keyPath:"value"},{name:"datetime",keyPath:"datetime"}],this.version)}getStoreIns(){return this.storeIns||this.initStorageIns(),this.storeIns}getStorageName(){return this.storageName}getStorageAllData(){return this.getStoreIns().getAll()}getStorageData(e,t="key"){return this.getStoreIns().get(e,t)}saveStorage(e){const t=[{...e,datetime:S()}];return this.getStoreIns().set(t)}saveStoragePatch(e){const t=[];return P(e,a=>{t.push({...a,datetime:S()})}),this.getStoreIns().set(t)}delStorage(e){return this.getStoreIns().delete(e)}}function $(){return[{value:l.Format,label:m(`module.${l.Format}`),path:{name:l.Format},isEditLabel:!1,isUse:!0},{value:l.Coding,label:m(`module.${l.Coding}`),path:{name:l.Coding},isEditLabel:!1,isUse:!0},{value:l.Compare,label:m(`module.${l.Compare}`),path:{name:l.Compare},isEditLabel:!1,isUse:!0},{value:l.Regex,label:m(`module.${l.Regex}`),path:{name:l.Regex},isEditLabel:!1,isUse:!0},{value:l.Timestamp,label:m(`module.${l.Timestamp}`),path:{name:l.Timestamp},isEditLabel:!1,isUse:!0},{value:l.Decimal,label:m(`module.${l.Decimal}`),path:{name:l.Decimal},isEditLabel:!1,isUse:!0},{value:l.Poster,label:m(`module.${l.Poster}`),path:{name:l.Poster},isEditLabel:!1,isUse:!0},{value:l.Socket,label:m(`module.${l.Socket}`),path:{name:l.Socket},isEditLabel:!1,isUse:!0},{value:l.Typing,label:m(`module.${l.Typing}`),path:{name:l.Typing},isEditLabel:!1,isUse:!0},{value:l.Whiteboard,label:m(`module.${l.Whiteboard}`),path:{name:l.Whiteboard},isEditLabel:!1,isUse:!0},{value:l.QRCode,label:m(`module.${l.QRCode}`),path:{name:l.QRCode},isEditLabel:!1,isUse:!0},{value:l.Har,label:m(`module.${l.Har}`),path:{name:l.Har},isEditLabel:!1,isUse:!0}]}var k=(n=>(n.Config="config",n))(k||{}),T=(n=>(n.Common="common",n))(T||{}),L=(n=>(n.Replace="replace",n.Push="push",n))(L||{});function x(n,e){switch(n){case"push":D.push(e);break;case"replace":D.replace(e);break}}export{U as C,T as E,L as a,k as b,I as c,C as d,$ as g,x as r};
