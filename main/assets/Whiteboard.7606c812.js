import{y as Tt,d as Dt,B as It,Q as Xt,z as Yt,o as lt,c as dt,F as _t,aa as Wt,af as Ut,as as kt,ag as et,a3 as Mt,a8 as Ft,m as Pt,s as ct,H as Ot,ab as st,k as yt,G as Et,aw as zt,I as St,ai as Gt}from"./index.286357e0.js";import{d as wt}from"./routeLib.4927cad7.js";import{U as Ht}from"./UIWithTitle.8dc65e39.js";import{u as Nt,b as Vt,c as qt,d as Kt,e as Jt,U as $t}from"./UICreateImport.vue_vue_type_script_setup_true_lang.2128243a.js";import{g as Zt}from"./lib.5173e56c.js";import{r as At}from"./___vite-browser-external_commonjs-proxy.b9c2fd7c.js";import{c as Ct}from"./dayjs.min.6c47bd3a.js";import{_ as jt}from"./_plugin-vue_export-helper.cdc0426e.js";import{u as Qt}from"./ModuleAutoSaveLib.f0f70820.js";import"./dateLib.63528a18.js";import"./advancedFormat.16ff0fee.js";import"./forEach.78ceb588.js";import"./identity.bfdea954.js";import"./Interface.d7af1223.js";import"./DButton.vue_vue_type_script_setup_true_lang.793ae897.js";import"./DInput.vue_vue_type_script_setup_true_lang.5ea82556.js";import"./_baseIsEqual.ecb1efce.js";import"./DSpin.f68cef5b.js";import"./hasIn.0707db01.js";import"./memoize.64cb1933.js";import"./findIndex.8a999be9.js";import"./styleChecker.9da7f8d9.js";import"./index.55a51bb0.js";import"./pick.e9f1a41d.js";import"./isEmpty.bacb74f3.js";import"./config.f197c6bf.js";import"./randomLib.04c6c9cc.js";import"./stringify.15412eb9.js";const ft=Tt({folders:[],item:{}}),xt=".wb",te={[wt.Config]:"whiteboard_config",[wt.Folder]:"whiteboard_folder",[wt.Content]:"whiteboard_content",[wt.Env]:"whiteboard_env"};function ee(){return{content:{setting:{canvas:{width:0,height:0,bgColor:""},stroke:{size:0,color:""}},content:""},isSaved:0}}var ut={};(function(W){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var d=d||{version:"3.6.6"};if(W.fabric=d,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?d.document=document:d.document=document.implementation.createHTMLDocument(""),d.window=window;else{var $=At,Z=new $.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;d.document=Z.document,d.jsdomImplForWrapper=At.implForWrapper,d.nodeCanvas=At.Canvas,d.window=Z,DOMParser=d.window.DOMParser}d.isTouchSupported="ontouchstart"in d.window||"ontouchstart"in d.document||d.window&&d.window.navigator&&d.window.navigator.maxTouchPoints>0,d.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",d.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],d.DPI=96,d.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",d.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,d.reNonWord=/[ \n\.,;!\?\-]/,d.fontPaths={},d.iMatrix=[1,0,0,1,0,0],d.svgNS="http://www.w3.org/2000/svg",d.perfLimitSizeTotal=2097152,d.maxCacheSideLimit=4096,d.minCacheSideLimit=256,d.charWidthsCache={},d.textureSize=2048,d.disableStyleCopyPaste=!1,d.enableGLFiltering=!0,d.devicePixelRatio=d.window.devicePixelRatio||d.window.webkitDevicePixelRatio||d.window.mozDevicePixelRatio||1,d.browserShadowBlurConstant=1,d.arcToSegmentsCache={},d.boundsOfCurveCache={},d.cachesBoundsOfCurve=!0,d.forceGLPutImageData=!1,d.initFilterBackend=function(){if(d.enableGLFiltering&&d.isWebglSupported&&d.isWebglSupported(d.textureSize))return console.log("max texture size: "+d.maxTextureSize),new d.WebglFilterBackend({tileSize:d.textureSize});if(d.Canvas2dFilterBackend)return new d.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=d),function(){function u(t,s){if(!!this.__eventListeners[t]){var n=this.__eventListeners[t];s?n[n.indexOf(s)]=!1:d.util.array.fill(n,!1)}}function e(t,s){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var n in t)this.on(n,t[n]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(s);return this}function h(t,s){if(!this.__eventListeners)return this;if(arguments.length===0)for(t in this.__eventListeners)u.call(this,t);else if(arguments.length===1&&typeof arguments[0]=="object")for(var n in t)u.call(this,n,t[n]);else u.call(this,t,s);return this}function i(t,s){if(!this.__eventListeners)return this;var n=this.__eventListeners[t];if(!n)return this;for(var c=0,a=n.length;c<a;c++)n[c]&&n[c].call(this,s||{});return this.__eventListeners[t]=n.filter(function(r){return r!==!1}),this}d.Observable={observe:e,stopObserving:h,fire:i,on:e,off:h,trigger:i}}(),d.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var u=0,e=arguments.length;u<e;u++)this._onObjectAdded(arguments[u]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(u,e,h){var i=this._objects;return h?i[e]=u:i.splice(e,0,u),this._onObjectAdded&&this._onObjectAdded(u),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var u=this._objects,e,h=!1,i=0,t=arguments.length;i<t;i++)e=u.indexOf(arguments[i]),e!==-1&&(h=!0,u.splice(e,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[i]));return this.renderOnAddRemove&&h&&this.requestRenderAll(),this},forEachObject:function(u,e){for(var h=this.getObjects(),i=0,t=h.length;i<t;i++)u.call(e,h[i],i,h);return this},getObjects:function(u){return typeof u>"u"?this._objects.concat():this._objects.filter(function(e){return e.type===u})},item:function(u){return this._objects[u]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(u){return this._objects.indexOf(u)>-1},complexity:function(){return this._objects.reduce(function(u,e){return u+=e.complexity?e.complexity():0,u},0)}},d.CommonMethods={_setOptions:function(u){for(var e in u)this.set(e,u[e])},_initGradient:function(u,e){u&&u.colorStops&&!(u instanceof d.Gradient)&&this.set(e,new d.Gradient(u))},_initPattern:function(u,e,h){u&&u.source&&!(u instanceof d.Pattern)?this.set(e,new d.Pattern(u,h)):h&&h()},_initClipping:function(u){if(!(!u.clipTo||typeof u.clipTo!="string")){var e=d.util.getFunctionBody(u.clipTo);typeof e<"u"&&(this.clipTo=new Function("ctx",e))}},_setObject:function(u){for(var e in u)this._set(e,u[e])},set:function(u,e){return typeof u=="object"?this._setObject(u):typeof e=="function"&&u!=="clipTo"?this._set(u,e(this.get(u))):this._set(u,e),this},_set:function(u,e){this[u]=e},toggle:function(u){var e=this.get(u);return typeof e=="boolean"&&this.set(u,!e),this},get:function(u){return this[u]}},function(u){var e=Math.sqrt,h=Math.atan2,i=Math.pow,t=Math.PI/180,s=Math.PI/2;d.util={cos:function(n){if(n===0)return 1;n<0&&(n=-n);var c=n/s;switch(c){case 1:case 3:return 0;case 2:return-1}return Math.cos(n)},sin:function(n){if(n===0)return 0;var c=n/s,a=1;switch(n<0&&(a=-1),c){case 1:return a;case 2:return 0;case 3:return-a}return Math.sin(n)},removeFromArray:function(n,c){var a=n.indexOf(c);return a!==-1&&n.splice(a,1),n},getRandomInt:function(n,c){return Math.floor(Math.random()*(c-n+1))+n},degreesToRadians:function(n){return n*t},radiansToDegrees:function(n){return n/t},rotatePoint:function(n,c,a){n.subtractEquals(c);var r=d.util.rotateVector(n,a);return new d.Point(r.x,r.y).addEquals(c)},rotateVector:function(n,c){var a=d.util.sin(c),r=d.util.cos(c),o=n.x*r-n.y*a,l=n.x*a+n.y*r;return{x:o,y:l}},transformPoint:function(n,c,a){return a?new d.Point(c[0]*n.x+c[2]*n.y,c[1]*n.x+c[3]*n.y):new d.Point(c[0]*n.x+c[2]*n.y+c[4],c[1]*n.x+c[3]*n.y+c[5])},makeBoundingBoxFromPoints:function(n,c){if(c)for(var a=0;a<n.length;a++)n[a]=d.util.transformPoint(n[a],c);var r=[n[0].x,n[1].x,n[2].x,n[3].x],o=d.util.array.min(r),l=d.util.array.max(r),f=l-o,g=[n[0].y,n[1].y,n[2].y,n[3].y],m=d.util.array.min(g),v=d.util.array.max(g),p=v-m;return{left:o,top:m,width:f,height:p}},invertTransform:function(n){var c=1/(n[0]*n[3]-n[1]*n[2]),a=[c*n[3],-c*n[1],-c*n[2],c*n[0]],r=d.util.transformPoint({x:n[4],y:n[5]},a,!0);return a[4]=-r.x,a[5]=-r.y,a},toFixed:function(n,c){return parseFloat(Number(n).toFixed(c))},parseUnit:function(n,c){var a=/\D{0,2}$/.exec(n),r=parseFloat(n);switch(c||(c=d.Text.DEFAULT_SVG_FONT_SIZE),a[0]){case"mm":return r*d.DPI/25.4;case"cm":return r*d.DPI/2.54;case"in":return r*d.DPI;case"pt":return r*d.DPI/72;case"pc":return r*d.DPI/72*12;case"em":return r*c;default:return r}},falseFunction:function(){return!1},getKlass:function(n,c){return n=d.util.string.camelize(n.charAt(0).toUpperCase()+n.slice(1)),d.util.resolveNamespace(c)[n]},getSvgAttributes:function(n){var c=["instantiated_by_use","style","id","class"];switch(n){case"linearGradient":c=c.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":c=c.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":c=c.concat(["offset","stop-color","stop-opacity"]);break}return c},resolveNamespace:function(n){if(!n)return d;var c=n.split("."),a=c.length,r,o=u||d.window;for(r=0;r<a;++r)o=o[c[r]];return o},loadImage:function(n,c,a,r){if(!n){c&&c.call(a,n);return}var o=d.util.createImage(),l=function(){c&&c.call(a,o),o=o.onload=o.onerror=null};o.onload=l,o.onerror=function(){d.log("Error loading "+o.src),c&&c.call(a,null,!0),o=o.onload=o.onerror=null},n.indexOf("data")!==0&&r&&(o.crossOrigin=r),n.substring(0,14)==="data:image/svg"&&(o.onload=null,d.util.loadImageInDom(o,l)),o.src=n},loadImageInDom:function(n,c){var a=d.document.createElement("div");a.style.width=a.style.height="1px",a.style.left=a.style.top="-100%",a.style.position="absolute",a.appendChild(n),d.document.querySelector("body").appendChild(a),n.onload=function(){c(),a.parentNode.removeChild(a),a=null}},enlivenObjects:function(n,c,a,r){n=n||[];var o=[],l=0,f=n.length;function g(){++l===f&&c&&c(o.filter(function(m){return m}))}if(!f){c&&c(o);return}n.forEach(function(m,v){if(!m||!m.type){g();return}var p=d.util.getKlass(m.type,a);p.fromObject(m,function(_,C){C||(o[v]=_),r&&r(m,_,C),g()})})},enlivenPatterns:function(n,c){n=n||[];function a(){++o===l&&c&&c(r)}var r=[],o=0,l=n.length;if(!l){c&&c(r);return}n.forEach(function(f,g){f&&f.source?new d.Pattern(f,function(m){r[g]=m,a()}):(r[g]=f,a())})},groupSVGElements:function(n,c,a){var r;return n&&n.length===1?n[0]:(c&&(c.width&&c.height?c.centerPoint={x:c.width/2,y:c.height/2}:(delete c.width,delete c.height)),r=new d.Group(n,c),typeof a<"u"&&(r.sourcePath=a),r)},populateWithProperties:function(n,c,a){if(a&&Object.prototype.toString.call(a)==="[object Array]")for(var r=0,o=a.length;r<o;r++)a[r]in n&&(c[a[r]]=n[a[r]])},drawDashedLine:function(n,c,a,r,o,l){var f=r-c,g=o-a,m=e(f*f+g*g),v=h(g,f),p=l.length,_=0,C=!0;for(n.save(),n.translate(c,a),n.moveTo(0,0),n.rotate(v),c=0;m>c;)c+=l[_++%p],c>m&&(c=m),n[C?"lineTo":"moveTo"](c,0),C=!C;n.restore()},createCanvasElement:function(){return d.document.createElement("canvas")},copyCanvasElement:function(n){var c=d.util.createCanvasElement();return c.width=n.width,c.height=n.height,c.getContext("2d").drawImage(n,0,0),c},toDataURL:function(n,c,a){return n.toDataURL("image/"+c,a)},createImage:function(){return d.document.createElement("img")},clipContext:function(n,c){c.save(),c.beginPath(),n.clipTo(c),c.clip()},multiplyTransformMatrices:function(n,c,a){return[n[0]*c[0]+n[2]*c[1],n[1]*c[0]+n[3]*c[1],n[0]*c[2]+n[2]*c[3],n[1]*c[2]+n[3]*c[3],a?0:n[0]*c[4]+n[2]*c[5]+n[4],a?0:n[1]*c[4]+n[3]*c[5]+n[5]]},qrDecompose:function(n){var c=h(n[1],n[0]),a=i(n[0],2)+i(n[1],2),r=e(a),o=(n[0]*n[3]-n[2]*n[1])/r,l=h(n[0]*n[2]+n[1]*n[3],a);return{angle:c/t,scaleX:r,scaleY:o,skewX:l/t,skewY:0,translateX:n[4],translateY:n[5]}},calcRotateMatrix:function(n){if(!n.angle)return d.iMatrix.concat();var c=d.util.degreesToRadians(n.angle),a=d.util.cos(c),r=d.util.sin(c);return[a,r,-r,a,0,0]},calcDimensionsMatrix:function(n){var c=typeof n.scaleX>"u"?1:n.scaleX,a=typeof n.scaleY>"u"?1:n.scaleY,r=[n.flipX?-c:c,0,0,n.flipY?-a:a,0,0],o=d.util.multiplyTransformMatrices,l=d.util.degreesToRadians;return n.skewX&&(r=o(r,[1,0,Math.tan(l(n.skewX)),1],!0)),n.skewY&&(r=o(r,[1,Math.tan(l(n.skewY)),0,1],!0)),r},composeMatrix:function(n){var c=[1,0,0,1,n.translateX||0,n.translateY||0],a=d.util.multiplyTransformMatrices;return n.angle&&(c=a(c,d.util.calcRotateMatrix(n))),(n.scaleX||n.scaleY||n.skewX||n.skewY||n.flipX||n.flipY)&&(c=a(c,d.util.calcDimensionsMatrix(n))),c},customTransformMatrix:function(n,c,a){return d.util.composeMatrix({scaleX:n,scaleY:c,skewX:a})},resetObjectTransform:function(n){n.scaleX=1,n.scaleY=1,n.skewX=0,n.skewY=0,n.flipX=!1,n.flipY=!1,n.rotate(0)},saveObjectTransform:function(n){return{scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,angle:n.angle,left:n.left,flipX:n.flipX,flipY:n.flipY,top:n.top}},getFunctionBody:function(n){return(String(n).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(n,c,a,r){r>0&&(c>r?c-=r:c=0,a>r?a-=r:a=0);var o=!0,l,f,g=n.getImageData(c,a,r*2||1,r*2||1),m=g.data.length;for(l=3;l<m&&(f=g.data[l],o=f<=0,o!==!1);l+=4);return g=null,o},parsePreserveAspectRatioAttribute:function(n){var c="meet",a="Mid",r="Mid",o=n.split(" "),l;return o&&o.length&&(c=o.pop(),c!=="meet"&&c!=="slice"?(l=c,c="meet"):o.length&&(l=o.pop())),a=l!=="none"?l.slice(1,4):"none",r=l!=="none"?l.slice(5,8):"none",{meetOrSlice:c,alignX:a,alignY:r}},clearFabricFontCache:function(n){n=(n||"").toLowerCase(),n?d.charWidthsCache[n]&&delete d.charWidthsCache[n]:d.charWidthsCache={}},limitDimsByArea:function(n,c){var a=Math.sqrt(c*n),r=Math.floor(c/a);return{x:Math.floor(a),y:r}},capValue:function(n,c,a){return Math.max(n,Math.min(c,a))},findScaleToFit:function(n,c){return Math.min(c.width/n.width,c.height/n.height)},findScaleToCover:function(n,c){return Math.max(c.width/n.width,c.height/n.height)},matrixToSVG:function(n){return"matrix("+n.map(function(c){return d.util.toFixed(c,d.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"}}}(W),function(){var u=Array.prototype.join;function e(s,n,c,a,r,o,l){var f=u.call(arguments);if(d.arcToSegmentsCache[f])return d.arcToSegmentsCache[f];var g=Math.PI,m=l*g/180,v=d.util.sin(m),p=d.util.cos(m),_=0,C=0;c=Math.abs(c),a=Math.abs(a);var y=-p*s*.5-v*n*.5,S=-p*n*.5+v*s*.5,x=c*c,O=a*a,E=S*S,L=y*y,B=x*O-x*E-O*L,Y=0;if(B<0){var U=Math.sqrt(1-B/(x*O));c*=U,a*=U}else Y=(r===o?-1:1)*Math.sqrt(B/(x*E+O*L));var b=Y*c*S/a,k=-Y*a*y/c,P=p*b-v*k+s*.5,M=v*b+p*k+n*.5,z=i(1,0,(y-b)/c,(S-k)/a),w=i((y-b)/c,(S-k)/a,(-y-b)/c,(-S-k)/a);o===0&&w>0?w-=2*g:o===1&&w<0&&(w+=2*g);for(var T=Math.ceil(Math.abs(w/g*2)),D=[],F=w/T,R=8/3*Math.sin(F/4)*Math.sin(F/4)/Math.sin(F/2),j=z+F,I=0;I<T;I++)D[I]=h(z,j,p,v,c,a,P,M,R,_,C),_=D[I][4],C=D[I][5],z=j,j+=F;return d.arcToSegmentsCache[f]=D,D}function h(s,n,c,a,r,o,l,f,g,m,v){var p=d.util.cos(s),_=d.util.sin(s),C=d.util.cos(n),y=d.util.sin(n),S=c*r*C-a*o*y+l,x=a*r*C+c*o*y+f,O=m+g*(-c*r*_-a*o*p),E=v+g*(-a*r*_+c*o*p),L=S+g*(c*r*y+a*o*C),B=x+g*(a*r*y-c*o*C);return[O,E,L,B,S,x]}function i(s,n,c,a){var r=Math.atan2(n,s),o=Math.atan2(a,c);return o>=r?o-r:2*Math.PI-(r-o)}d.util.drawArc=function(s,n,c,a){for(var r=a[0],o=a[1],l=a[2],f=a[3],g=a[4],m=a[5],v=a[6],p=[[],[],[],[]],_=e(m-n,v-c,r,o,f,g,l),C=0,y=_.length;C<y;C++)p[C][0]=_[C][0]+n,p[C][1]=_[C][1]+c,p[C][2]=_[C][2]+n,p[C][3]=_[C][3]+c,p[C][4]=_[C][4]+n,p[C][5]=_[C][5]+c,s.bezierCurveTo.apply(s,p[C])},d.util.getBoundsOfArc=function(s,n,c,a,r,o,l,f,g){for(var m=0,v=0,p,_=[],C=e(f-s,g-n,c,a,o,l,r),y=0,S=C.length;y<S;y++)p=t(m,v,C[y][0],C[y][1],C[y][2],C[y][3],C[y][4],C[y][5]),_.push({x:p[0].x+s,y:p[0].y+n}),_.push({x:p[1].x+s,y:p[1].y+n}),m=C[y][4],v=C[y][5];return _};function t(s,n,c,a,r,o,l,f){var g;if(d.cachesBoundsOfCurve&&(g=u.call(arguments),d.boundsOfCurveCache[g]))return d.boundsOfCurveCache[g];var m=Math.sqrt,v=Math.min,p=Math.max,_=Math.abs,C=[],y=[[],[]],S,x,O,E,L,B,Y,U;x=6*s-12*c+6*r,S=-3*s+9*c-9*r+3*l,O=3*c-3*s;for(var b=0;b<2;++b){if(b>0&&(x=6*n-12*a+6*o,S=-3*n+9*a-9*o+3*f,O=3*a-3*n),_(S)<1e-12){if(_(x)<1e-12)continue;E=-O/x,0<E&&E<1&&C.push(E);continue}Y=x*x-4*O*S,!(Y<0)&&(U=m(Y),L=(-x+U)/(2*S),0<L&&L<1&&C.push(L),B=(-x-U)/(2*S),0<B&&B<1&&C.push(B))}for(var k,P,M=C.length,z=M,w;M--;)E=C[M],w=1-E,k=w*w*w*s+3*w*w*E*c+3*w*E*E*r+E*E*E*l,y[0][M]=k,P=w*w*w*n+3*w*w*E*a+3*w*E*E*o+E*E*E*f,y[1][M]=P;y[0][z]=s,y[1][z]=n,y[0][z+1]=l,y[1][z+1]=f;var T=[{x:v.apply(null,y[0]),y:v.apply(null,y[1])},{x:p.apply(null,y[0]),y:p.apply(null,y[1])}];return d.cachesBoundsOfCurve&&(d.boundsOfCurveCache[g]=T),T}d.util.getBoundsOfCurve=t}(),function(){var u=Array.prototype.slice;function e(n,c){for(var a=u.call(arguments,2),r=[],o=0,l=n.length;o<l;o++)r[o]=a.length?n[o][c].apply(n[o],a):n[o][c].call(n[o]);return r}function h(n,c){return s(n,c,function(a,r){return a>=r})}function i(n,c){return s(n,c,function(a,r){return a<r})}function t(n,c){for(var a=n.length;a--;)n[a]=c;return n}function s(n,c,a){if(!(!n||n.length===0)){var r=n.length-1,o=c?n[r][c]:n[r];if(c)for(;r--;)a(n[r][c],o)&&(o=n[r][c]);else for(;r--;)a(n[r],o)&&(o=n[r]);return o}}d.util.array={fill:t,invoke:e,min:i,max:h}}(),function(){function u(h,i,t){if(t)if(!d.isLikelyNode&&i instanceof Element)h=i;else if(i instanceof Array){h=[];for(var s=0,n=i.length;s<n;s++)h[s]=u({},i[s],t)}else if(i&&typeof i=="object")for(var c in i)c==="canvas"?h[c]=u({},i[c]):i.hasOwnProperty(c)&&(h[c]=u({},i[c],t));else h=i;else for(var c in i)h[c]=i[c];return h}function e(h,i){return u({},h,i)}d.util.object={extend:u,clone:e},d.util.object.extend(d.util,d.Observable)}(),function(){function u(s){return s.replace(/-+(.)?/g,function(n,c){return c?c.toUpperCase():""})}function e(s,n){return s.charAt(0).toUpperCase()+(n?s.slice(1):s.slice(1).toLowerCase())}function h(s){return s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(s){var n=0,c,a=[];for(n=0,c;n<s.length;n++)(c=t(s,n))!==!1&&a.push(c);return a}function t(s,n){var c=s.charCodeAt(n);if(isNaN(c))return"";if(c<55296||c>57343)return s.charAt(n);if(55296<=c&&c<=56319){if(s.length<=n+1)throw"High surrogate without following low surrogate";var a=s.charCodeAt(n+1);if(56320>a||a>57343)throw"High surrogate without following low surrogate";return s.charAt(n)+s.charAt(n+1)}if(n===0)throw"Low surrogate without preceding high surrogate";var r=s.charCodeAt(n-1);if(55296>r||r>56319)throw"Low surrogate without preceding high surrogate";return!1}d.util.string={camelize:u,capitalize:e,escapeXml:h,graphemeSplit:i}}(),function(){var u=Array.prototype.slice,e=function(){},h=function(){for(var c in{toString:1})if(c==="toString")return!1;return!0}(),i=function(c,a,r){for(var o in a)o in c.prototype&&typeof c.prototype[o]=="function"&&(a[o]+"").indexOf("callSuper")>-1?c.prototype[o]=function(l){return function(){var f=this.constructor.superclass;this.constructor.superclass=r;var g=a[l].apply(this,arguments);if(this.constructor.superclass=f,l!=="initialize")return g}}(o):c.prototype[o]=a[o],h&&(a.toString!==Object.prototype.toString&&(c.prototype.toString=a.toString),a.valueOf!==Object.prototype.valueOf&&(c.prototype.valueOf=a.valueOf))};function t(){}function s(c){for(var a=null,r=this;r.constructor.superclass;){var o=r.constructor.superclass.prototype[c];if(r[c]!==o){a=o;break}r=r.constructor.superclass.prototype}return a?arguments.length>1?a.apply(this,u.call(arguments,1)):a.call(this):console.log("tried to callSuper "+c+", method not found in prototype chain",this)}function n(){var c=null,a=u.call(arguments,0);typeof a[0]=="function"&&(c=a.shift());function r(){this.initialize.apply(this,arguments)}r.superclass=c,r.subclasses=[],c&&(t.prototype=c.prototype,r.prototype=new t,c.subclasses.push(r));for(var o=0,l=a.length;o<l;o++)i(r,a[o],c);return r.prototype.initialize||(r.prototype.initialize=e),r.prototype.constructor=r,r.prototype.callSuper=s,r}d.util.createClass=n}(),function(){var u=!!d.document.createElement("div").attachEvent;d.util.addListener=function(h,i,t,s){h&&h.addEventListener(i,t,u?!1:s)},d.util.removeListener=function(h,i,t,s){h&&h.removeEventListener(i,t,u?!1:s)};function e(h){var i=h.changedTouches;return i&&i[0]?i[0]:h}d.util.getPointer=function(h){var i=h.target,t=d.util.getScrollLeftTop(i),s=e(h);return{x:s.clientX+t.left,y:s.clientY+t.top}}}(),function(){function u(n,c){var a=n.style;if(!a)return n;if(typeof c=="string")return n.style.cssText+=";"+c,c.indexOf("opacity")>-1?s(n,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):n;for(var r in c)if(r==="opacity")s(n,c[r]);else{var o=r==="float"||r==="cssFloat"?typeof a.styleFloat>"u"?"cssFloat":"styleFloat":r;a[o]=c[r]}return n}var e=d.document.createElement("div"),h=typeof e.style.opacity=="string",i=typeof e.style.filter=="string",t=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,s=function(n){return n};h?s=function(n,c){return n.style.opacity=c,n}:i&&(s=function(n,c){var a=n.style;return n.currentStyle&&!n.currentStyle.hasLayout&&(a.zoom=1),t.test(a.filter)?(c=c>=.9999?"":"alpha(opacity="+c*100+")",a.filter=a.filter.replace(t,c)):a.filter+=" alpha(opacity="+c*100+")",n}),d.util.setStyle=u}(),function(){var u=Array.prototype.slice;function e(f){return typeof f=="string"?d.document.getElementById(f):f}var h,i=function(f){return u.call(f,0)};try{h=i(d.document.childNodes)instanceof Array}catch{}h||(i=function(f){for(var g=new Array(f.length),m=f.length;m--;)g[m]=f[m];return g});function t(f,g){var m=d.document.createElement(f);for(var v in g)v==="class"?m.className=g[v]:v==="for"?m.htmlFor=g[v]:m.setAttribute(v,g[v]);return m}function s(f,g){f&&(" "+f.className+" ").indexOf(" "+g+" ")===-1&&(f.className+=(f.className?" ":"")+g)}function n(f,g,m){return typeof g=="string"&&(g=t(g,m)),f.parentNode&&f.parentNode.replaceChild(g,f),g.appendChild(f),g}function c(f){for(var g=0,m=0,v=d.document.documentElement,p=d.document.body||{scrollLeft:0,scrollTop:0};f&&(f.parentNode||f.host)&&(f=f.parentNode||f.host,f===d.document?(g=p.scrollLeft||v.scrollLeft||0,m=p.scrollTop||v.scrollTop||0):(g+=f.scrollLeft||0,m+=f.scrollTop||0),!(f.nodeType===1&&f.style.position==="fixed")););return{left:g,top:m}}function a(f){var g,m=f&&f.ownerDocument,v={left:0,top:0},p={left:0,top:0},_,C={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!m)return p;for(var y in C)p[C[y]]+=parseInt(r(f,y),10)||0;return g=m.documentElement,typeof f.getBoundingClientRect<"u"&&(v=f.getBoundingClientRect()),_=c(f),{left:v.left+_.left-(g.clientLeft||0)+p.left,top:v.top+_.top-(g.clientTop||0)+p.top}}var r;d.document.defaultView&&d.document.defaultView.getComputedStyle?r=function(f,g){var m=d.document.defaultView.getComputedStyle(f,null);return m?m[g]:void 0}:r=function(f,g){var m=f.style[g];return!m&&f.currentStyle&&(m=f.currentStyle[g]),m},function(){var f=d.document.documentElement.style,g="userSelect"in f?"userSelect":"MozUserSelect"in f?"MozUserSelect":"WebkitUserSelect"in f?"WebkitUserSelect":"KhtmlUserSelect"in f?"KhtmlUserSelect":"";function m(p){return typeof p.onselectstart<"u"&&(p.onselectstart=d.util.falseFunction),g?p.style[g]="none":typeof p.unselectable=="string"&&(p.unselectable="on"),p}function v(p){return typeof p.onselectstart<"u"&&(p.onselectstart=null),g?p.style[g]="":typeof p.unselectable=="string"&&(p.unselectable=""),p}d.util.makeElementUnselectable=m,d.util.makeElementSelectable=v}(),function(){function f(g,m){var v=d.document.getElementsByTagName("head")[0],p=d.document.createElement("script"),_=!0;p.onload=p.onreadystatechange=function(C){if(_){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")return;_=!1,m(C||d.window.event),p=p.onload=p.onreadystatechange=null}},p.src=g,v.appendChild(p)}d.util.getScript=f}();function o(f){var g=d.jsdomImplForWrapper(f);return g._canvas||g._image}function l(f){if(!!d.isLikelyNode){var g=d.jsdomImplForWrapper(f);g&&(g._image=null,g._canvas=null,g._currentSrc=null,g._attributes=null,g._classList=null)}}d.util.getById=e,d.util.toArray=i,d.util.makeElement=t,d.util.addClass=s,d.util.wrapElement=n,d.util.getScrollLeftTop=c,d.util.getElementOffset=a,d.util.getElementStyle=r,d.util.getNodeCanvas=o,d.util.cleanUpJsdomNode=l}(),function(){function u(i,t){return i+(/\?/.test(i)?"&":"?")+t}function e(){}function h(i,t){t||(t={});var s=t.method?t.method.toUpperCase():"GET",n=t.onComplete||function(){},c=new d.window.XMLHttpRequest,a=t.body||t.parameters;return c.onreadystatechange=function(){c.readyState===4&&(n(c),c.onreadystatechange=e)},s==="GET"&&(a=null,typeof t.parameters=="string"&&(i=u(i,t.parameters))),c.open(s,i,!0),(s==="POST"||s==="PUT")&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(a),c}d.util.request=h}(),d.log=console.log,d.warn=console.warn,function(){function u(){return!1}function e(c,a,r,o){return-r*Math.cos(c/o*(Math.PI/2))+r+a}function h(c){s(function(a){c||(c={});var r=a||+new Date,o=c.duration||500,l=r+o,f,g=c.onChange||u,m=c.abort||u,v=c.onComplete||u,p=c.easing||e,_="startValue"in c?c.startValue:0,C="endValue"in c?c.endValue:100,y=c.byValue||C-_;c.onStart&&c.onStart(),function S(x){f=x||+new Date;var O=f>l?o:f-r,E=O/o,L=p(O,_,y,o),B=Math.abs((L-_)/y);if(m()){v(C,1,1);return}if(f>l){g(C,1,1),v(C,1,1);return}else g(L,B,E),s(S)}(r)})}var i=d.window.requestAnimationFrame||d.window.webkitRequestAnimationFrame||d.window.mozRequestAnimationFrame||d.window.oRequestAnimationFrame||d.window.msRequestAnimationFrame||function(c){return d.window.setTimeout(c,1e3/60)},t=d.window.cancelAnimationFrame||d.window.clearTimeout;function s(){return i.apply(d.window,arguments)}function n(){return t.apply(d.window,arguments)}d.util.animate=h,d.util.requestAnimFrame=s,d.util.cancelAnimFrame=n}(),function(){function u(h,i,t){var s="rgba("+parseInt(h[0]+t*(i[0]-h[0]),10)+","+parseInt(h[1]+t*(i[1]-h[1]),10)+","+parseInt(h[2]+t*(i[2]-h[2]),10);return s+=","+(h&&i?parseFloat(h[3]+t*(i[3]-h[3])):1),s+=")",s}function e(h,i,t,s){var n=new d.Color(h).getSource(),c=new d.Color(i).getSource();s=s||{},d.util.animate(d.util.object.extend(s,{duration:t||500,startValue:n,endValue:c,byValue:c,easing:function(a,r,o,l){var f=s.colorEasing?s.colorEasing(a,l):1-Math.cos(a/l*(Math.PI/2));return u(r,o,f)}}))}d.util.animateColor=e}(),function(){function u(b,k,P,M){return b<Math.abs(k)?(b=k,M=P/4):k===0&&b===0?M=P/(2*Math.PI)*Math.asin(1):M=P/(2*Math.PI)*Math.asin(k/b),{a:b,c:k,p:P,s:M}}function e(b,k,P){return b.a*Math.pow(2,10*(k-=1))*Math.sin((k*P-b.s)*(2*Math.PI)/b.p)}function h(b,k,P,M){return P*((b=b/M-1)*b*b+1)+k}function i(b,k,P,M){return b/=M/2,b<1?P/2*b*b*b+k:P/2*((b-=2)*b*b+2)+k}function t(b,k,P,M){return P*(b/=M)*b*b*b+k}function s(b,k,P,M){return-P*((b=b/M-1)*b*b*b-1)+k}function n(b,k,P,M){return b/=M/2,b<1?P/2*b*b*b*b+k:-P/2*((b-=2)*b*b*b-2)+k}function c(b,k,P,M){return P*(b/=M)*b*b*b*b+k}function a(b,k,P,M){return P*((b=b/M-1)*b*b*b*b+1)+k}function r(b,k,P,M){return b/=M/2,b<1?P/2*b*b*b*b*b+k:P/2*((b-=2)*b*b*b*b+2)+k}function o(b,k,P,M){return-P*Math.cos(b/M*(Math.PI/2))+P+k}function l(b,k,P,M){return P*Math.sin(b/M*(Math.PI/2))+k}function f(b,k,P,M){return-P/2*(Math.cos(Math.PI*b/M)-1)+k}function g(b,k,P,M){return b===0?k:P*Math.pow(2,10*(b/M-1))+k}function m(b,k,P,M){return b===M?k+P:P*(-Math.pow(2,-10*b/M)+1)+k}function v(b,k,P,M){return b===0?k:b===M?k+P:(b/=M/2,b<1?P/2*Math.pow(2,10*(b-1))+k:P/2*(-Math.pow(2,-10*--b)+2)+k)}function p(b,k,P,M){return-P*(Math.sqrt(1-(b/=M)*b)-1)+k}function _(b,k,P,M){return P*Math.sqrt(1-(b=b/M-1)*b)+k}function C(b,k,P,M){return b/=M/2,b<1?-P/2*(Math.sqrt(1-b*b)-1)+k:P/2*(Math.sqrt(1-(b-=2)*b)+1)+k}function y(b,k,P,M){var z=1.70158,w=0,T=P;if(b===0)return k;if(b/=M,b===1)return k+P;w||(w=M*.3);var D=u(T,P,w,z);return-e(D,b,M)+k}function S(b,k,P,M){var z=1.70158,w=0,T=P;if(b===0)return k;if(b/=M,b===1)return k+P;w||(w=M*.3);var D=u(T,P,w,z);return D.a*Math.pow(2,-10*b)*Math.sin((b*M-D.s)*(2*Math.PI)/D.p)+D.c+k}function x(b,k,P,M){var z=1.70158,w=0,T=P;if(b===0)return k;if(b/=M/2,b===2)return k+P;w||(w=M*(.3*1.5));var D=u(T,P,w,z);return b<1?-.5*e(D,b,M)+k:D.a*Math.pow(2,-10*(b-=1))*Math.sin((b*M-D.s)*(2*Math.PI)/D.p)*.5+D.c+k}function O(b,k,P,M,z){return z===void 0&&(z=1.70158),P*(b/=M)*b*((z+1)*b-z)+k}function E(b,k,P,M,z){return z===void 0&&(z=1.70158),P*((b=b/M-1)*b*((z+1)*b+z)+1)+k}function L(b,k,P,M,z){return z===void 0&&(z=1.70158),b/=M/2,b<1?P/2*(b*b*(((z*=1.525)+1)*b-z))+k:P/2*((b-=2)*b*(((z*=1.525)+1)*b+z)+2)+k}function B(b,k,P,M){return P-Y(M-b,0,P,M)+k}function Y(b,k,P,M){return(b/=M)<1/2.75?P*(7.5625*b*b)+k:b<2/2.75?P*(7.5625*(b-=1.5/2.75)*b+.75)+k:b<2.5/2.75?P*(7.5625*(b-=2.25/2.75)*b+.9375)+k:P*(7.5625*(b-=2.625/2.75)*b+.984375)+k}function U(b,k,P,M){return b<M/2?B(b*2,0,P,M)*.5+k:Y(b*2-M,0,P,M)*.5+P*.5+k}d.util.ease={easeInQuad:function(b,k,P,M){return P*(b/=M)*b+k},easeOutQuad:function(b,k,P,M){return-P*(b/=M)*(b-2)+k},easeInOutQuad:function(b,k,P,M){return b/=M/2,b<1?P/2*b*b+k:-P/2*(--b*(b-2)-1)+k},easeInCubic:function(b,k,P,M){return P*(b/=M)*b*b+k},easeOutCubic:h,easeInOutCubic:i,easeInQuart:t,easeOutQuart:s,easeInOutQuart:n,easeInQuint:c,easeOutQuint:a,easeInOutQuint:r,easeInSine:o,easeOutSine:l,easeInOutSine:f,easeInExpo:g,easeOutExpo:m,easeInOutExpo:v,easeInCirc:p,easeOutCirc:_,easeInOutCirc:C,easeInElastic:y,easeOutElastic:S,easeInOutElastic:x,easeInBack:O,easeOutBack:E,easeInOutBack:L,easeInBounce:B,easeOutBounce:Y,easeInOutBounce:U}}(),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,i=e.util.object.clone,t=e.util.toFixed,s=e.util.parseUnit,n=e.util.multiplyTransformMatrices,c=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],a=["symbol","image","marker","pattern","view","svg"],r=["pattern","defs","symbol","metadata","clipPath","mask","desc"],o=["symbol","g","a","svg","clipPath","defs"],l={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform"},f={stroke:"strokeOpacity",fill:"fillOpacity"},g="font-size",m="clip-path";e.svgValidTagNamesRegEx=_(c),e.svgViewBoxElementsRegEx=_(a),e.svgInvalidAncestorsRegEx=_(r),e.svgValidParentsRegEx=_(o),e.cssRules={},e.gradientDefs={},e.clipPaths={};function v(w){return w in l?l[w]:w}function p(w,T,D,F){var R=Object.prototype.toString.call(T)==="[object Array]",j;if((w==="fill"||w==="stroke")&&T==="none")T="";else if(w==="vector-effect")T=T==="non-scaling-stroke";else if(w==="strokeDashArray")T==="none"?T=null:T=T.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(w==="transformMatrix")D&&D.transformMatrix?T=n(D.transformMatrix,e.parseTransformAttribute(T)):T=e.parseTransformAttribute(T);else if(w==="visible")T=T!=="none"&&T!=="hidden",D&&D.visible===!1&&(T=!1);else if(w==="opacity")T=parseFloat(T),D&&typeof D.opacity<"u"&&(T*=D.opacity);else if(w==="textAnchor")T=T==="start"?"left":T==="end"?"right":"center";else if(w==="charSpacing")j=s(T,F)/F*1e3;else if(w==="paintFirst"){var I=T.indexOf("fill"),X=T.indexOf("stroke"),T="fill";(I>-1&&X>-1&&X<I||I===-1&&X>-1)&&(T="stroke")}else{if(w==="href"||w==="xlink:href")return T;j=R?T.map(s):s(T,F)}return!R&&isNaN(j)?T:j}function _(w){return new RegExp("^("+w.join("|")+")\\b","i")}function C(w){for(var T in f)if(!(typeof w[f[T]]>"u"||w[T]==="")){if(typeof w[T]>"u"){if(!e.Object.prototype[T])continue;w[T]=e.Object.prototype[T]}if(w[T].indexOf("url(")!==0){var D=new e.Color(w[T]);w[T]=D.setAlpha(t(D.getAlpha()*w[f[T]],2)).toRgba()}}return w}function y(w,T){var D,F=[],R,j,I;for(j=0,I=T.length;j<I;j++)D=T[j],R=w.getElementsByTagName(D),F=F.concat(Array.prototype.slice.call(R));return F}e.parseTransformAttribute=function(){function w(H,J){var nt=e.util.cos(J[0]),ht=e.util.sin(J[0]),pt=0,vt=0;J.length===3&&(pt=J[1],vt=J[2]),H[0]=nt,H[1]=ht,H[2]=-ht,H[3]=nt,H[4]=pt-(nt*pt-ht*vt),H[5]=vt-(ht*pt+nt*vt)}function T(H,J){var nt=J[0],ht=J.length===2?J[1]:J[0];H[0]=nt,H[3]=ht}function D(H,J,nt){H[nt]=Math.tan(e.util.degreesToRadians(J[0]))}function F(H,J){H[4]=J[0],J.length===2&&(H[5]=J[1])}var R=e.iMatrix,j=e.reNum,I="(?:\\s+,?\\s*|,\\s*)",X="(?:(skewX)\\s*\\(\\s*("+j+")\\s*\\))",G="(?:(skewY)\\s*\\(\\s*("+j+")\\s*\\))",V="(?:(rotate)\\s*\\(\\s*("+j+")(?:"+I+"("+j+")"+I+"("+j+"))?\\s*\\))",it="(?:(scale)\\s*\\(\\s*("+j+")(?:"+I+"("+j+"))?\\s*\\))",q="(?:(translate)\\s*\\(\\s*("+j+")(?:"+I+"("+j+"))?\\s*\\))",K="(?:(matrix)\\s*\\(\\s*("+j+")"+I+"("+j+")"+I+"("+j+")"+I+"("+j+")"+I+"("+j+")"+I+"("+j+")\\s*\\))",Q="(?:"+K+"|"+q+"|"+it+"|"+V+"|"+X+"|"+G+")",tt="(?:"+Q+"(?:"+I+"*"+Q+")*)",ot="^\\s*(?:"+tt+"?)\\s*$",gt=new RegExp(ot),bt=new RegExp(Q,"g");return function(H){var J=R.concat(),nt=[];if(!H||H&&!gt.test(H))return J;H.replace(bt,function(pt){var vt=new RegExp(Q).exec(pt).filter(function(Rt){return!!Rt}),Bt=vt[1],mt=vt.slice(2).map(parseFloat);switch(Bt){case"translate":F(J,mt);break;case"rotate":mt[0]=e.util.degreesToRadians(mt[0]),w(J,mt);break;case"scale":T(J,mt);break;case"skewX":D(J,mt,2);break;case"skewY":D(J,mt,1);break;case"matrix":J=mt;break}nt.push(J.concat()),J=R.concat()});for(var ht=nt[0];nt.length>1;)nt.shift(),ht=e.util.multiplyTransformMatrices(ht,nt[0]);return ht}}();function S(w,T){var D,F;w.replace(/;\s*$/,"").split(";").forEach(function(R){var j=R.split(":");D=j[0].trim().toLowerCase(),F=j[1].trim(),T[D]=F})}function x(w,T){var D,F;for(var R in w)typeof w[R]>"u"||(D=R.toLowerCase(),F=w[R],T[D]=F)}function O(w,T){var D={};for(var F in e.cssRules[T])if(E(w,F.split(" ")))for(var R in e.cssRules[T][F])D[R]=e.cssRules[T][F][R];return D}function E(w,T){var D,F=!0;return D=B(w,T.pop()),D&&T.length&&(F=L(w,T)),D&&F&&T.length===0}function L(w,T){for(var D,F=!0;w.parentNode&&w.parentNode.nodeType===1&&T.length;)F&&(D=T.pop()),w=w.parentNode,F=B(w,D);return T.length===0}function B(w,T){var D=w.nodeName,F=w.getAttribute("class"),R=w.getAttribute("id"),j,I;if(j=new RegExp("^"+D,"i"),T=T.replace(j,""),R&&T.length&&(j=new RegExp("#"+R+"(?![a-zA-Z\\-]+)","i"),T=T.replace(j,"")),F&&T.length)for(F=F.split(" "),I=F.length;I--;)j=new RegExp("\\."+F[I]+"(?![a-zA-Z\\-]+)","i"),T=T.replace(j,"");return T.length===0}function Y(w,T){var D;if(w.getElementById&&(D=w.getElementById(T)),D)return D;var F,R,j,I=w.getElementsByTagName("*");for(R=0,j=I.length;R<j;R++)if(F=I[R],T===F.getAttribute("id"))return F}function U(w){for(var T=y(w,["use","svg:use"]),D=0;T.length&&D<T.length;){var F=T[D],R=(F.getAttribute("xlink:href")||F.getAttribute("href")).substr(1),j=F.getAttribute("x")||0,I=F.getAttribute("y")||0,X=Y(w,R).cloneNode(!0),G=(X.getAttribute("transform")||"")+" translate("+j+", "+I+")",V,it=T.length,q,K,Q,tt,ot=e.svgNS;if(k(X),/^svg$/i.test(X.nodeName)){var gt=X.ownerDocument.createElementNS(ot,"g");for(K=0,Q=X.attributes,tt=Q.length;K<tt;K++)q=Q.item(K),gt.setAttributeNS(ot,q.nodeName,q.nodeValue);for(;X.firstChild;)gt.appendChild(X.firstChild);X=gt}for(K=0,Q=F.attributes,tt=Q.length;K<tt;K++)q=Q.item(K),!(q.nodeName==="x"||q.nodeName==="y"||q.nodeName==="xlink:href"||q.nodeName==="href")&&(q.nodeName==="transform"?G=q.nodeValue+" "+G:X.setAttribute(q.nodeName,q.nodeValue));X.setAttribute("transform",G),X.setAttribute("instantiated_by_use","1"),X.removeAttribute("id"),V=F.parentNode,V.replaceChild(X,F),T.length===it&&D++}}var b=new RegExp("^\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*$");function k(w){var T=w.getAttribute("viewBox"),D=1,F=1,R=0,j=0,I,X,G,V,it=w.getAttribute("width"),q=w.getAttribute("height"),K=w.getAttribute("x")||0,Q=w.getAttribute("y")||0,tt=w.getAttribute("preserveAspectRatio")||"",ot=!T||!e.svgViewBoxElementsRegEx.test(w.nodeName)||!(T=T.match(b)),gt=!it||!q||it==="100%"||q==="100%",bt=ot&&gt,H={},J="",nt=0,ht=0;if(H.width=0,H.height=0,H.toBeParsed=bt,bt)return H;if(ot)return H.width=s(it),H.height=s(q),H;if(R=-parseFloat(T[1]),j=-parseFloat(T[2]),I=parseFloat(T[3]),X=parseFloat(T[4]),H.minX=R,H.minY=j,H.viewBoxWidth=I,H.viewBoxHeight=X,gt?(H.width=I,H.height=X):(H.width=s(it),H.height=s(q),D=H.width/I,F=H.height/X),tt=e.util.parsePreserveAspectRatioAttribute(tt),tt.alignX!=="none"&&(tt.meetOrSlice==="meet"&&(F=D=D>F?F:D),tt.meetOrSlice==="slice"&&(F=D=D>F?D:F),nt=H.width-I*D,ht=H.height-X*D,tt.alignX==="Mid"&&(nt/=2),tt.alignY==="Mid"&&(ht/=2),tt.alignX==="Min"&&(nt=0),tt.alignY==="Min"&&(ht=0)),D===1&&F===1&&R===0&&j===0&&K===0&&Q===0)return H;if((K||Q)&&(J=" translate("+s(K)+" "+s(Q)+") "),G=J+" matrix("+D+" 0 0 "+F+" "+(R*D+nt)+" "+(j*F+ht)+") ",H.viewboxTransform=e.parseTransformAttribute(G),w.nodeName==="svg"){for(V=w.ownerDocument.createElementNS(e.svgNS,"g");w.firstChild;)V.appendChild(w.firstChild);w.appendChild(V)}else V=w,G=V.getAttribute("transform")+G;return V.setAttribute("transform",G),H}function P(w,T){for(;w&&(w=w.parentNode);)if(w.nodeName&&T.test(w.nodeName.replace("svg:",""))&&!w.getAttribute("instantiated_by_use"))return!0;return!1}e.parseSVGDocument=function(w,T,D,F){if(!!w){U(w);var R=e.Object.__uid++,j,I,X=k(w),G=e.util.toArray(w.getElementsByTagName("*"));if(X.crossOrigin=F&&F.crossOrigin,X.svgUid=R,G.length===0&&e.isLikelyNode){G=w.selectNodes('//*[name(.)!="svg"]');var V=[];for(j=0,I=G.length;j<I;j++)V[j]=G[j];G=V}var it=G.filter(function(K){return k(K),e.svgValidTagNamesRegEx.test(K.nodeName.replace("svg:",""))&&!P(K,e.svgInvalidAncestorsRegEx)});if(!it||it&&!it.length){T&&T([],{});return}var q={};G.filter(function(K){return K.nodeName.replace("svg:","")==="clipPath"}).forEach(function(K){var Q=K.getAttribute("id");q[Q]=e.util.toArray(K.getElementsByTagName("*")).filter(function(tt){return e.svgValidTagNamesRegEx.test(tt.nodeName.replace("svg:",""))})}),e.gradientDefs[R]=e.getGradientDefs(w),e.cssRules[R]=e.getCSSRules(w),e.clipPaths[R]=q,e.parseElements(it,function(K,Q){T&&(T(K,X,Q,G),delete e.gradientDefs[R],delete e.cssRules[R],delete e.clipPaths[R])},i(X),D,F)}};function M(w,T){var D=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],F="xlink:href",R=T.getAttribute(F).substr(1),j=Y(w,R);if(j&&j.getAttribute(F)&&M(w,j),D.forEach(function(X){j&&!T.hasAttribute(X)&&j.hasAttribute(X)&&T.setAttribute(X,j.getAttribute(X))}),!T.children.length)for(var I=j.cloneNode(!0);I.firstChild;)T.appendChild(I.firstChild);T.removeAttribute(F)}var z=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+e.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+e.reNum+"))?\\s+(.*)");h(e,{parseFontDeclaration:function(w,T){var D=w.match(z);if(!!D){var F=D[1],R=D[3],j=D[4],I=D[5],X=D[6];F&&(T.fontStyle=F),R&&(T.fontWeight=isNaN(parseFloat(R))?R:parseFloat(R)),j&&(T.fontSize=s(j)),X&&(T.fontFamily=X),I&&(T.lineHeight=I==="normal"?1:I)}},getGradientDefs:function(w){var T=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],D=y(w,T),F,R=0,j={};for(R=D.length;R--;)F=D[R],F.getAttribute("xlink:href")&&M(w,F),j[F.getAttribute("id")]=F;return j},parseAttributes:function(w,T,D){if(!!w){var F,R={},j,I;typeof D>"u"&&(D=w.getAttribute("svgUid")),w.parentNode&&e.svgValidParentsRegEx.test(w.parentNode.nodeName)&&(R=e.parseAttributes(w.parentNode,T,D));var X=T.reduce(function(tt,ot){return F=w.getAttribute(ot),F&&(tt[ot]=F),tt},{}),G=h(O(w,D),e.parseStyleAttribute(w));X=h(X,G),G[m]&&w.setAttribute(m,G[m]),j=I=R.fontSize||e.Text.DEFAULT_SVG_FONT_SIZE,X[g]&&(X[g]=j=s(X[g],I));var V,it,q={};for(var K in X)V=v(K),it=p(V,X[K],R,j),q[V]=it;q&&q.font&&e.parseFontDeclaration(q.font,q);var Q=h(R,q);return e.svgValidParentsRegEx.test(w.nodeName)?Q:C(Q)}},parseElements:function(w,T,D,F,R){new e.ElementsParser(w,T,D,F,R).parse()},parseStyleAttribute:function(w){var T={},D=w.getAttribute("style");return D&&(typeof D=="string"?S(D,T):x(D,T)),T},parsePointsAttribute:function(w){if(!w)return null;w=w.replace(/,/g," ").trim(),w=w.split(/\s+/);var T=[],D,F;for(D=0,F=w.length;D<F;D+=2)T.push({x:parseFloat(w[D]),y:parseFloat(w[D+1])});return T},getCSSRules:function(w){var T=w.getElementsByTagName("style"),D,F,R={},j;for(D=0,F=T.length;D<F;D++){var I=T[D].textContent||"";I=I.replace(/\/\*[\s\S]*?\*\//g,""),I.trim()!==""&&(j=I.match(/[^{]*\{[\s\S]*?\}/g),j=j.map(function(X){return X.trim()}),j.forEach(function(X){var G=X.match(/([\s\S]*?)\s*\{([^}]*)\}/),V={},it=G[2].trim(),q=it.replace(/;$/,"").split(/\s*;\s*/);for(D=0,F=q.length;D<F;D++){var K=q[D].split(/\s*:\s*/),Q=K[0],tt=K[1];V[Q]=tt}X=G[1],X.split(",").forEach(function(ot){ot=ot.replace(/^svg/i,"").trim(),ot!==""&&(R[ot]?e.util.object.extend(R[ot],V):R[ot]=e.util.object.clone(V))})}))}return R},loadSVGFromURL:function(w,T,D,F){w=w.replace(/^\n\s*/,"").trim(),new e.util.request(w,{method:"get",onComplete:R});function R(j){var I=j.responseXML;if(I&&!I.documentElement&&e.window.ActiveXObject&&j.responseText&&(I=new ActiveXObject("Microsoft.XMLDOM"),I.async="false",I.loadXML(j.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),!I||!I.documentElement)return T&&T(null),!1;e.parseSVGDocument(I.documentElement,function(X,G,V,it){T&&T(X,G,V,it)},D,F)}},loadSVGFromString:function(w,T,D,F){w=w.trim();var R;if(typeof e.window.DOMParser<"u"){var j=new e.window.DOMParser;j&&j.parseFromString&&(R=j.parseFromString(w,"text/xml"))}else e.window.ActiveXObject&&(R=new ActiveXObject("Microsoft.XMLDOM"),R.async="false",R.loadXML(w.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));e.parseSVGDocument(R.documentElement,function(I,X,G,V){T(I,X,G,V)},D,F)}})}(W),d.ElementsParser=function(u,e,h,i,t,s){this.elements=u,this.callback=e,this.options=h,this.reviver=i,this.svgUid=h&&h.svgUid||0,this.parsingOptions=t,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=s},function(u){u.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},u.createObjects=function(){var e=this;this.elements.forEach(function(h,i){h.setAttribute("svgUid",e.svgUid),e.createObject(h,i)})},u.findTag=function(e){return d[d.util.string.capitalize(e.tagName.replace("svg:",""))]},u.createObject=function(e,h){var i=this.findTag(e);if(i&&i.fromElement)try{i.fromElement(e,this.createCallback(h,e),this.options)}catch(t){d.log(t)}else this.checkIfDone()},u.createCallback=function(e,h){var i=this;return function(t){var s;i.resolveGradient(t,h,"fill"),i.resolveGradient(t,h,"stroke"),t instanceof d.Image&&t._originalElement&&(s=t.parsePreserveAspectRatioAttribute(h)),t._removeTransformMatrix(s),i.resolveClipPath(t,h),i.reviver&&i.reviver(h,t),i.instances[e]=t,i.checkIfDone()}},u.extractPropertyDefinition=function(e,h,i){var t=e[h],s=this.regexUrl;if(!!s.test(t)){s.lastIndex=0;var n=s.exec(t)[1];return s.lastIndex=0,d[i][this.svgUid][n]}},u.resolveGradient=function(e,h,i){var t=this.extractPropertyDefinition(e,i,"gradientDefs");if(t){var s=h.getAttribute(i+"-opacity"),n=d.Gradient.fromElement(t,e,s,this.options);e.set(i,n)}},u.createClipPathCallback=function(e,h){return function(i){i._removeTransformMatrix(),i.fillRule=i.clipRule,h.push(i)}},u.resolveClipPath=function(e,h){var i=this.extractPropertyDefinition(e,"clipPath","clipPaths"),t,s,n,c,a,r;if(i){c=[],n=d.util.invertTransform(e.calcTransformMatrix());for(var o=i[0].parentNode,l=h;l.parentNode&&l.getAttribute("clip-path")!==e.clipPath;)l=l.parentNode;l.parentNode.appendChild(o);for(var f=0;f<i.length;f++)t=i[f],s=this.findTag(t),s.fromElement(t,this.createClipPathCallback(e,c),this.options);c.length===1?i=c[0]:i=new d.Group(c),a=d.util.multiplyTransformMatrices(n,i.calcTransformMatrix()),i.clipPath&&this.resolveClipPath(i,l);var r=d.util.qrDecompose(a);i.flipX=!1,i.flipY=!1,i.set("scaleX",r.scaleX),i.set("scaleY",r.scaleY),i.angle=r.angle,i.skewX=r.skewX,i.skewY=0,i.setPositionByOrigin({x:r.translateX,y:r.translateY},"center","center"),e.clipPath=i}else delete e.clipPath},u.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(e){return e!=null}),this.callback(this.instances,this.elements))}}(d.ElementsParser.prototype),function(u){var e=u.fabric||(u.fabric={});if(e.Point){e.warn("fabric.Point is already defined");return}e.Point=h;function h(i,t){this.x=i,this.y=t}h.prototype={type:"point",constructor:h,add:function(i){return new h(this.x+i.x,this.y+i.y)},addEquals:function(i){return this.x+=i.x,this.y+=i.y,this},scalarAdd:function(i){return new h(this.x+i,this.y+i)},scalarAddEquals:function(i){return this.x+=i,this.y+=i,this},subtract:function(i){return new h(this.x-i.x,this.y-i.y)},subtractEquals:function(i){return this.x-=i.x,this.y-=i.y,this},scalarSubtract:function(i){return new h(this.x-i,this.y-i)},scalarSubtractEquals:function(i){return this.x-=i,this.y-=i,this},multiply:function(i){return new h(this.x*i,this.y*i)},multiplyEquals:function(i){return this.x*=i,this.y*=i,this},divide:function(i){return new h(this.x/i,this.y/i)},divideEquals:function(i){return this.x/=i,this.y/=i,this},eq:function(i){return this.x===i.x&&this.y===i.y},lt:function(i){return this.x<i.x&&this.y<i.y},lte:function(i){return this.x<=i.x&&this.y<=i.y},gt:function(i){return this.x>i.x&&this.y>i.y},gte:function(i){return this.x>=i.x&&this.y>=i.y},lerp:function(i,t){return typeof t>"u"&&(t=.5),t=Math.max(Math.min(1,t),0),new h(this.x+(i.x-this.x)*t,this.y+(i.y-this.y)*t)},distanceFrom:function(i){var t=this.x-i.x,s=this.y-i.y;return Math.sqrt(t*t+s*s)},midPointFrom:function(i){return this.lerp(i)},min:function(i){return new h(Math.min(this.x,i.x),Math.min(this.y,i.y))},max:function(i){return new h(Math.max(this.x,i.x),Math.max(this.y,i.y))},toString:function(){return this.x+","+this.y},setXY:function(i,t){return this.x=i,this.y=t,this},setX:function(i){return this.x=i,this},setY:function(i){return this.y=i,this},setFromPoint:function(i){return this.x=i.x,this.y=i.y,this},swap:function(i){var t=this.x,s=this.y;this.x=i.x,this.y=i.y,i.x=t,i.y=s},clone:function(){return new h(this.x,this.y)}}}(W),function(u){var e=u.fabric||(u.fabric={});if(e.Intersection){e.warn("fabric.Intersection is already defined");return}function h(i){this.status=i,this.points=[]}e.Intersection=h,e.Intersection.prototype={constructor:h,appendPoint:function(i){return this.points.push(i),this},appendPoints:function(i){return this.points=this.points.concat(i),this}},e.Intersection.intersectLineLine=function(i,t,s,n){var c,a=(n.x-s.x)*(i.y-s.y)-(n.y-s.y)*(i.x-s.x),r=(t.x-i.x)*(i.y-s.y)-(t.y-i.y)*(i.x-s.x),o=(n.y-s.y)*(t.x-i.x)-(n.x-s.x)*(t.y-i.y);if(o!==0){var l=a/o,f=r/o;0<=l&&l<=1&&0<=f&&f<=1?(c=new h("Intersection"),c.appendPoint(new e.Point(i.x+l*(t.x-i.x),i.y+l*(t.y-i.y)))):c=new h}else a===0||r===0?c=new h("Coincident"):c=new h("Parallel");return c},e.Intersection.intersectLinePolygon=function(i,t,s){var n=new h,c=s.length,a,r,o,l;for(l=0;l<c;l++)a=s[l],r=s[(l+1)%c],o=h.intersectLineLine(i,t,a,r),n.appendPoints(o.points);return n.points.length>0&&(n.status="Intersection"),n},e.Intersection.intersectPolygonPolygon=function(i,t){var s=new h,n=i.length,c;for(c=0;c<n;c++){var a=i[c],r=i[(c+1)%n],o=h.intersectLinePolygon(a,r,t);s.appendPoints(o.points)}return s.points.length>0&&(s.status="Intersection"),s},e.Intersection.intersectPolygonRectangle=function(i,t,s){var n=t.min(s),c=t.max(s),a=new e.Point(c.x,n.y),r=new e.Point(n.x,c.y),o=h.intersectLinePolygon(n,a,i),l=h.intersectLinePolygon(a,c,i),f=h.intersectLinePolygon(c,r,i),g=h.intersectLinePolygon(r,n,i),m=new h;return m.appendPoints(o.points),m.appendPoints(l.points),m.appendPoints(f.points),m.appendPoints(g.points),m.points.length>0&&(m.status="Intersection"),m}}(W),function(u){var e=u.fabric||(u.fabric={});if(e.Color){e.warn("fabric.Color is already defined.");return}function h(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}e.Color=h,e.Color.prototype={_tryParsingColor:function(t){var s;t in h.colorNameMap&&(t=h.colorNameMap[t]),t==="transparent"&&(s=[255,255,255,0]),s||(s=h.sourceFromHex(t)),s||(s=h.sourceFromRgb(t)),s||(s=h.sourceFromHsl(t)),s||(s=[0,0,0,1]),s&&this.setSource(s)},_rgbToHsl:function(t,s,n){t/=255,s/=255,n/=255;var c,a,r,o=e.util.array.max([t,s,n]),l=e.util.array.min([t,s,n]);if(r=(o+l)/2,o===l)c=a=0;else{var f=o-l;switch(a=r>.5?f/(2-o-l):f/(o+l),o){case t:c=(s-n)/f+(s<n?6:0);break;case s:c=(n-t)/f+2;break;case n:c=(t-s)/f+4;break}c/=6}return[Math.round(c*360),Math.round(a*100),Math.round(r*100)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),s=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+s[0]+","+s[1]+"%,"+s[2]+"%)"},toHsla:function(){var t=this.getSource(),s=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+s[0]+","+s[1]+"%,"+s[2]+"%,"+t[3]+")"},toHex:function(){var t=this.getSource(),s,n,c;return s=t[0].toString(16),s=s.length===1?"0"+s:s,n=t[1].toString(16),n=n.length===1?"0"+n:n,c=t[2].toString(16),c=c.length===1?"0"+c:c,s.toUpperCase()+n.toUpperCase()+c.toUpperCase()},toHexa:function(){var t=this.getSource(),s;return s=Math.round(t[3]*255),s=s.toString(16),s=s.length===1?"0"+s:s,this.toHex()+s.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var s=this.getSource();return s[3]=t,this.setSource(s),this},toGrayscale:function(){var t=this.getSource(),s=parseInt((t[0]*.3+t[1]*.59+t[2]*.11).toFixed(0),10),n=t[3];return this.setSource([s,s,s,n]),this},toBlackWhite:function(t){var s=this.getSource(),n=(s[0]*.3+s[1]*.59+s[2]*.11).toFixed(0),c=s[3];return t=t||127,n=Number(n)<Number(t)?0:255,this.setSource([n,n,n,c]),this},overlayWith:function(t){t instanceof h||(t=new h(t));var s=[],n=this.getAlpha(),c=.5,a=this.getSource(),r=t.getSource(),o;for(o=0;o<3;o++)s.push(Math.round(a[o]*(1-c)+r[o]*c));return s[3]=n,this.setSource(s),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function i(t,s,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(s-t)*6*n:n<1/2?s:n<2/3?t+(s-t)*(2/3-n)*6:t}e.Color.fromRgb=function(t){return h.fromSource(h.sourceFromRgb(t))},e.Color.sourceFromRgb=function(t){var s=t.match(h.reRGBa);if(s){var n=parseInt(s[1],10)/(/%$/.test(s[1])?100:1)*(/%$/.test(s[1])?255:1),c=parseInt(s[2],10)/(/%$/.test(s[2])?100:1)*(/%$/.test(s[2])?255:1),a=parseInt(s[3],10)/(/%$/.test(s[3])?100:1)*(/%$/.test(s[3])?255:1);return[parseInt(n,10),parseInt(c,10),parseInt(a,10),s[4]?parseFloat(s[4]):1]}},e.Color.fromRgba=h.fromRgb,e.Color.fromHsl=function(t){return h.fromSource(h.sourceFromHsl(t))},e.Color.sourceFromHsl=function(t){var s=t.match(h.reHSLa);if(!!s){var n=(parseFloat(s[1])%360+360)%360/360,c=parseFloat(s[2])/(/%$/.test(s[2])?100:1),a=parseFloat(s[3])/(/%$/.test(s[3])?100:1),r,o,l;if(c===0)r=o=l=a;else{var f=a<=.5?a*(c+1):a+c-a*c,g=a*2-f;r=i(g,f,n+1/3),o=i(g,f,n),l=i(g,f,n-1/3)}return[Math.round(r*255),Math.round(o*255),Math.round(l*255),s[4]?parseFloat(s[4]):1]}},e.Color.fromHsla=h.fromHsl,e.Color.fromHex=function(t){return h.fromSource(h.sourceFromHex(t))},e.Color.sourceFromHex=function(t){if(t.match(h.reHex)){var s=t.slice(t.indexOf("#")+1),n=s.length===3||s.length===4,c=s.length===8||s.length===4,a=n?s.charAt(0)+s.charAt(0):s.substring(0,2),r=n?s.charAt(1)+s.charAt(1):s.substring(2,4),o=n?s.charAt(2)+s.charAt(2):s.substring(4,6),l=c?n?s.charAt(3)+s.charAt(3):s.substring(6,8):"FF";return[parseInt(a,16),parseInt(r,16),parseInt(o,16),parseFloat((parseInt(l,16)/255).toFixed(2))]}},e.Color.fromSource=function(t){var s=new h;return s.setSource(t),s}}(W),function(){function u(s,n){var c=s.getAttribute("style"),a=s.getAttribute("offset")||0,r,o,l,f;if(a=parseFloat(a)/(/%$/.test(a)?100:1),a=a<0?0:a>1?1:a,c){var g=c.split(/\s*;\s*/);for(g[g.length-1]===""&&g.pop(),f=g.length;f--;){var m=g[f].split(/\s*:\s*/),v=m[0].trim(),p=m[1].trim();v==="stop-color"?r=p:v==="stop-opacity"&&(l=p)}}return r||(r=s.getAttribute("stop-color")||"rgb(0,0,0)"),l||(l=s.getAttribute("stop-opacity")),r=new d.Color(r),o=r.getAlpha(),l=isNaN(parseFloat(l))?1:parseFloat(l),l*=o*n,{offset:a,color:r.toRgb(),opacity:l}}function e(s){return{x1:s.getAttribute("x1")||0,y1:s.getAttribute("y1")||0,x2:s.getAttribute("x2")||"100%",y2:s.getAttribute("y2")||0}}function h(s){return{x1:s.getAttribute("fx")||s.getAttribute("cx")||"50%",y1:s.getAttribute("fy")||s.getAttribute("cy")||"50%",r1:0,x2:s.getAttribute("cx")||"50%",y2:s.getAttribute("cy")||"50%",r2:s.getAttribute("r")||"50%"}}var i=d.util.object.clone;d.Gradient=d.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(s){s||(s={}),s.coords||(s.coords={});var n,c=this;Object.keys(s).forEach(function(a){c[a]=s[a]}),this.id?this.id+="_"+d.Object.__uid++:this.id=d.Object.__uid++,n={x1:s.coords.x1||0,y1:s.coords.y1||0,x2:s.coords.x2||0,y2:s.coords.y2||0},this.type==="radial"&&(n.r1=s.coords.r1||0,n.r2=s.coords.r2||0),this.coords=n,this.colorStops=s.colorStops.slice()},addColorStop:function(s){for(var n in s){var c=new d.Color(s[n]);this.colorStops.push({offset:parseFloat(n),color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(s){var n={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return d.util.populateWithProperties(this,n,s),n},toSVG:function(s,o){var c=i(this.coords,!0),a,r,o=o||{},l,f,g=i(this.colorStops,!0),m=c.r1>c.r2,v=this.gradientTransform?this.gradientTransform.concat():d.iMatrix.concat(),p=-this.offsetX,_=-this.offsetY,C=!!o.additionalTransform,y=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(g.sort(function(L,B){return L.offset-B.offset}),y==="objectBoundingBox"?(p/=s.width,_/=s.height):(p+=s.width/2,_+=s.height/2),s.type==="path"&&(p-=s.pathOffset.x,_-=s.pathOffset.y),v[4]-=p,v[5]-=_,f='id="SVGID_'+this.id+'" gradientUnits="'+y+'"',f+=' gradientTransform="'+(C?o.additionalTransform+" ":"")+d.util.matrixToSVG(v)+'" ',this.type==="linear"?l=["<linearGradient ",f,' x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`">
`]:this.type==="radial"&&(l=["<radialGradient ",f,' cx="',m?c.x1:c.x2,'" cy="',m?c.y1:c.y2,'" r="',m?c.r1:c.r2,'" fx="',m?c.x2:c.x1,'" fy="',m?c.y2:c.y1,`">
`]),this.type==="radial"){if(m)for(g=g.concat(),g.reverse(),a=0,r=g.length;a<r;a++)g[a].offset=1-g[a].offset;var S=Math.min(c.r1,c.r2);if(S>0){var x=Math.max(c.r1,c.r2),O=S/x;for(a=0,r=g.length;a<r;a++)g[a].offset+=O*(1-g[a].offset)}}for(a=0,r=g.length;a<r;a++){var E=g[a];l.push("<stop ",'offset="',E.offset*100+"%",'" style="stop-color:',E.color,typeof E.opacity<"u"?";stop-opacity: "+E.opacity:";",`"/>
`)}return l.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),l.join("")},toLive:function(s,n){var c,a=d.util.object.clone(this.coords),r,o,l=a.x1,f=a.y1,g=a.x2,m=a.y2,v=this.colorStops;if(!!this.type){for(n instanceof d.Text&&this.gradientUnits==="percentage"&&(l*=n.width,f*=n.height,g*=n.width,m*=n.height),this.type==="linear"?c=s.createLinearGradient(l,f,g,m):this.type==="radial"&&(c=s.createRadialGradient(l,f,a.r1,g,m,a.r2)),r=0,o=v.length;r<o;r++){var p=v[r].color,_=v[r].opacity,C=v[r].offset;typeof _<"u"&&(p=new d.Color(p).setAlpha(_).toRgba()),c.addColorStop(C,p)}return c}}}),d.util.object.extend(d.Gradient,{fromElement:function(s,n,c,a){var r=parseFloat(c)/(/%$/.test(c)?100:1);r=r<0?0:r>1?1:r,isNaN(r)&&(r=1);var o=s.getElementsByTagName("stop"),l,f=s.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",g=s.getAttribute("gradientTransform")||"",m=[],v,p,_=0,C=0,y;for(s.nodeName==="linearGradient"||s.nodeName==="LINEARGRADIENT"?(l="linear",v=e(s)):(l="radial",v=h(s)),p=o.length;p--;)m.push(u(o[p],r));y=d.parseTransformAttribute(g),t(n,v,a,f),f==="pixels"&&(_=-n.left,C=-n.top);var S=new d.Gradient({id:s.getAttribute("id"),type:l,coords:v,colorStops:m,gradientUnits:f,gradientTransform:y,offsetX:_,offsetY:C});return S},forObject:function(s,n){return n||(n={}),t(s,n.coords,n.gradientUnits,{viewBoxWidth:100,viewBoxHeight:100}),new d.Gradient(n)}});function t(s,n,c,a){var r,o;Object.keys(n).forEach(function(l){r=n[l],r==="Infinity"?o=1:r==="-Infinity"?o=0:(o=parseFloat(n[l],10),typeof r=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(r)&&(o*=.01,a==="pixels"&&((l==="x1"||l==="x2"||l==="r2")&&(o*=c.viewBoxWidth||c.width),(l==="y1"||l==="y2")&&(o*=c.viewBoxHeight||c.height)))),n[l]=o})}}(),function(){var u=d.util.toFixed;d.Pattern=d.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(e,h){if(e||(e={}),this.id=d.Object.__uid++,this.setOptions(e),!e.source||e.source&&typeof e.source!="string"){h&&h(this);return}if(typeof d.util.getFunctionBody(e.source)<"u")this.source=new Function(d.util.getFunctionBody(e.source)),h&&h(this);else{var i=this;this.source=d.util.createImage(),d.util.loadImage(e.source,function(t){i.source=t,h&&h(i)},null,this.crossOrigin)}},toObject:function(e){var h=d.Object.NUM_FRACTION_DIGITS,i,t;return typeof this.source=="function"?i=String(this.source):typeof this.source.src=="string"?i=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(i=this.source.toDataURL()),t={type:"pattern",source:i,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:u(this.offsetX,h),offsetY:u(this.offsetY,h),patternTransform:this.patternTransform?this.patternTransform.concat():null},d.util.populateWithProperties(this,t,e),t},toSVG:function(e){var h=typeof this.source=="function"?this.source():this.source,i=h.width/e.width,t=h.height/e.height,s=this.offsetX/e.width,n=this.offsetY/e.height,c="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(t=1,n&&(t+=Math.abs(n))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(i=1,s&&(i+=Math.abs(s))),h.src?c=h.src:h.toDataURL&&(c=h.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+s+'" y="'+n+'" width="'+i+'" height="'+t+`">
<image x="0" y="0" width="`+h.width+'" height="'+h.height+'" xlink:href="'+c+`"></image>
</pattern>
`},setOptions:function(e){for(var h in e)this[h]=e[h]},toLive:function(e){var h=typeof this.source=="function"?this.source():this.source;return!h||typeof h.src<"u"&&(!h.complete||h.naturalWidth===0||h.naturalHeight===0)?"":e.createPattern(h,this.repeat)}})}(),function(u){var e=u.fabric||(u.fabric={}),h=e.util.toFixed;if(e.Shadow){e.warn("fabric.Shadow is already defined.");return}e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(i){typeof i=="string"&&(i=this._parseShadow(i));for(var t in i)this[t]=i[t];this.id=e.Object.__uid++},_parseShadow:function(i){var t=i.trim(),s=e.Shadow.reOffsetsAndBlur.exec(t)||[],n=t.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:n.trim(),offsetX:parseInt(s[1],10)||0,offsetY:parseInt(s[2],10)||0,blur:parseInt(s[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(i){var t=40,s=40,n=e.Object.NUM_FRACTION_DIGITS,c=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-i.angle)),a=20,r=new e.Color(this.color);return i.width&&i.height&&(t=h((Math.abs(c.x)+this.blur)/i.width,n)*100+a,s=h((Math.abs(c.y)+this.blur)/i.height,n)*100+a),i.flipX&&(c.x*=-1),i.flipY&&(c.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+s+'%" height="'+(100+2*s)+'%" x="-'+t+'%" width="'+(100+2*t)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+h(this.blur?this.blur/2:0,n)+`"></feGaussianBlur>
	<feOffset dx="`+h(c.x,n)+'" dy="'+h(c.y,n)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+r.toRgb()+'" flood-opacity="'+r.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var i={},t=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(s){this[s]!==t[s]&&(i[s]=this[s])},this),i}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/}(W),function(){if(d.StaticCanvas){d.warn("fabric.StaticCanvas is already defined.");return}var u=d.util.object.extend,e=d.util.getElementOffset,h=d.util.removeFromArray,i=d.util.toFixed,t=d.util.transformPoint,s=d.util.invertTransform,n=d.util.getNodeCanvas,c=d.util.createCanvasElement,a=new Error("Could not initialize `canvas` element");d.StaticCanvas=d.util.createClass(d.CommonMethods,{initialize:function(r,o){o||(o={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,o)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:d.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(r,o){var l=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(r),this._initOptions(o),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),o.overlayImage&&this.setOverlayImage(o.overlayImage,l),o.backgroundImage&&this.setBackgroundImage(o.backgroundImage,l),o.backgroundColor&&this.setBackgroundColor(o.backgroundColor,l),o.overlayColor&&this.setOverlayColor(o.overlayColor,l),this.calcOffset()},_isRetinaScaling:function(){return d.devicePixelRatio!==1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?d.devicePixelRatio:1},_initRetinaScaling:function(){if(!!this._isRetinaScaling()){var r=d.devicePixelRatio;this.__initRetinaScaling(r,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(r,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(r,o,l){o.setAttribute("width",this.width*r),o.setAttribute("height",this.height*r),l.scale(r,r)},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(r,o,l){return this.__setBgOverlayImage("overlayImage",r,o,l)},setBackgroundImage:function(r,o,l){return this.__setBgOverlayImage("backgroundImage",r,o,l)},setOverlayColor:function(r,o){return this.__setBgOverlayColor("overlayColor",r,o)},setBackgroundColor:function(r,o){return this.__setBgOverlayColor("backgroundColor",r,o)},_setImageSmoothing:function(){var r=this.getContext();r.imageSmoothingEnabled=r.imageSmoothingEnabled||r.webkitImageSmoothingEnabled||r.mozImageSmoothingEnabled||r.msImageSmoothingEnabled||r.oImageSmoothingEnabled,r.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(r,o,l,f){return typeof o=="string"?d.util.loadImage(o,function(g){if(g){var m=new d.Image(g,f);this[r]=m,m.canvas=this}l&&l(g)},this,f&&f.crossOrigin):(f&&o.setOptions(f),this[r]=o,o&&(o.canvas=this),l&&l(o)),this},__setBgOverlayColor:function(r,o,l){return this[r]=o,this._initGradient(o,r),this._initPattern(o,r,l),this},_createCanvasElement:function(){var r=c();if(!r||(r.style||(r.style={}),typeof r.getContext>"u"))throw a;return r},_initOptions:function(r){var o=this.lowerCanvasEl;this._setOptions(r),this.width=this.width||parseInt(o.width,10)||0,this.height=this.height||parseInt(o.height,10)||0,this.lowerCanvasEl.style&&(o.width=this.width,o.height=this.height,o.style.width=this.width+"px",o.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(r){r&&r.getContext?this.lowerCanvasEl=r:this.lowerCanvasEl=d.util.getById(r)||this._createCanvasElement(),d.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(r,o){return this.setDimensions({width:r},o)},setHeight:function(r,o){return this.setDimensions({height:r},o)},setDimensions:function(r,o){var l;o=o||{};for(var f in r)l=r[f],o.cssOnly||(this._setBackstoreDimension(f,r[f]),l+="px",this.hasLostContext=!0),o.backstoreOnly||this._setCssDimension(f,l);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(),this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),o.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(r,o){return this.lowerCanvasEl[r]=o,this.upperCanvasEl&&(this.upperCanvasEl[r]=o),this.cacheCanvasEl&&(this.cacheCanvasEl[r]=o),this[r]=o,this},_setCssDimension:function(r,o){return this.lowerCanvasEl.style[r]=o,this.upperCanvasEl&&(this.upperCanvasEl.style[r]=o),this.wrapperEl&&(this.wrapperEl.style[r]=o),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(r){var o=this._activeObject,l,f=!1,g=!0,m,v;for(this.viewportTransform=r,m=0,v=this._objects.length;m<v;m++)l=this._objects[m],l.group||l.setCoords(f,g);return o&&o.type==="activeSelection"&&o.setCoords(f,g),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(r,o){var l=r,f=this.viewportTransform.slice(0);r=t(r,s(this.viewportTransform)),f[0]=o,f[3]=o;var g=t(r,f);return f[4]+=l.x-g.x,f[5]+=l.y-g.y,this.setViewportTransform(f)},setZoom:function(r){return this.zoomToPoint(new d.Point(0,0),r),this},absolutePan:function(r){var o=this.viewportTransform.slice(0);return o[4]=-r.x,o[5]=-r.y,this.setViewportTransform(o)},relativePan:function(r){return this.absolutePan(new d.Point(-r.x-this.viewportTransform[4],-r.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(r){this.stateful&&r.setupState(),r._set("canvas",this),r.setCoords(),this.fire("object:added",{target:r}),r.fire("added")},_onObjectRemoved:function(r){this.fire("object:removed",{target:r}),r.fire("removed"),delete r.canvas},clearContext:function(r){return r.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var r=this.contextContainer;return this.renderCanvas(r,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=d.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var r={},o=this.width,l=this.height,f=s(this.viewportTransform);return r.tl=t({x:0,y:0},f),r.br=t({x:o,y:l},f),r.tr=new d.Point(r.br.x,r.tl.y),r.bl=new d.Point(r.tl.x,r.br.y),this.vptCoords=r,r},cancelRequestedRender:function(){this.isRendering&&(d.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(r,o){var l=this.viewportTransform,f=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(r),this.fire("before:render",{ctx:r}),this.clipTo&&d.util.clipContext(this,r),this._renderBackground(r),r.save(),r.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._renderObjects(r,o),r.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(r),this.clipTo&&r.restore(),f&&(f.canvas=this,f.shouldCache(),f._transformDone=!0,f.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(r)),this._renderOverlay(r),this.controlsAboveOverlay&&this.interactive&&this.drawControls(r),this.fire("after:render",{ctx:r})},drawClipPathOnCanvas:function(r){var o=this.viewportTransform,l=this.clipPath;r.save(),r.transform(o[0],o[1],o[2],o[3],o[4],o[5]),r.globalCompositeOperation="destination-in",l.transform(r),r.scale(1/l.zoomX,1/l.zoomY),r.drawImage(l._cacheCanvas,-l.cacheTranslationX,-l.cacheTranslationY),r.restore()},_renderObjects:function(r,o){var l,f;for(l=0,f=o.length;l<f;++l)o[l]&&o[l].render(r)},_renderBackgroundOrOverlay:function(r,o){var l=this[o+"Color"],f=this[o+"Image"],g=this.viewportTransform,m=this[o+"Vpt"];if(!(!l&&!f)){if(l){r.save(),r.beginPath(),r.moveTo(0,0),r.lineTo(this.width,0),r.lineTo(this.width,this.height),r.lineTo(0,this.height),r.closePath(),r.fillStyle=l.toLive?l.toLive(r,this):l,m&&r.transform(g[0],g[1],g[2],g[3],g[4],g[5]),r.transform(1,0,0,1,l.offsetX||0,l.offsetY||0);var v=l.gradientTransform||l.patternTransform;v&&r.transform(v[0],v[1],v[2],v[3],v[4],v[5]),r.fill(),r.restore()}f&&(r.save(),m&&r.transform(g[0],g[1],g[2],g[3],g[4],g[5]),f.render(r),r.restore())}},_renderBackground:function(r){this._renderBackgroundOrOverlay(r,"background")},_renderOverlay:function(r){this._renderBackgroundOrOverlay(r,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(r){return this._centerObject(r,new d.Point(this.getCenter().left,r.getCenterPoint().y))},centerObjectV:function(r){return this._centerObject(r,new d.Point(r.getCenterPoint().x,this.getCenter().top))},centerObject:function(r){var o=this.getCenter();return this._centerObject(r,new d.Point(o.left,o.top))},viewportCenterObject:function(r){var o=this.getVpCenter();return this._centerObject(r,o)},viewportCenterObjectH:function(r){var o=this.getVpCenter();return this._centerObject(r,new d.Point(o.x,r.getCenterPoint().y)),this},viewportCenterObjectV:function(r){var o=this.getVpCenter();return this._centerObject(r,new d.Point(r.getCenterPoint().x,o.y))},getVpCenter:function(){var r=this.getCenter(),o=s(this.viewportTransform);return t({x:r.left,y:r.top},o)},_centerObject:function(r,o){return r.setPositionByOrigin(o,"center","center"),r.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(r){return this.toDatalessObject(r)},toObject:function(r){return this._toObjectMethod("toObject",r)},toDatalessObject:function(r){return this._toObjectMethod("toDatalessObject",r)},_toObjectMethod:function(r,o){var l=this.clipPath,f={version:d.version,objects:this._toObjects(r,o)};return l&&(f.clipPath=this._toObject(this.clipPath,r,o)),u(f,this.__serializeBgOverlay(r,o)),d.util.populateWithProperties(this,f,o),f},_toObjects:function(r,o){return this._objects.filter(function(l){return!l.excludeFromExport}).map(function(l){return this._toObject(l,r,o)},this)},_toObject:function(r,o,l){var f;this.includeDefaultValues||(f=r.includeDefaultValues,r.includeDefaultValues=!1);var g=r[o](l);return this.includeDefaultValues||(r.includeDefaultValues=f),g},__serializeBgOverlay:function(r,o){var l={},f=this.backgroundImage,g=this.overlayImage;return this.backgroundColor&&(l.background=this.backgroundColor.toObject?this.backgroundColor.toObject(o):this.backgroundColor),this.overlayColor&&(l.overlay=this.overlayColor.toObject?this.overlayColor.toObject(o):this.overlayColor),f&&!f.excludeFromExport&&(l.backgroundImage=this._toObject(f,r,o)),g&&!g.excludeFromExport&&(l.overlayImage=this._toObject(g,r,o)),l},svgViewportTransformation:!0,toSVG:function(r,o){r||(r={}),r.reviver=o;var l=[];return this._setSVGPreamble(l,r),this._setSVGHeader(l,r),this.clipPath&&l.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(l,"background"),this._setSVGBgOverlayImage(l,"backgroundImage",o),this._setSVGObjects(l,o),this.clipPath&&l.push(`</g>
`),this._setSVGBgOverlayColor(l,"overlay"),this._setSVGBgOverlayImage(l,"overlayImage",o),l.push("</svg>"),l.join("")},_setSVGPreamble:function(r,o){o.suppressPreamble||r.push('<?xml version="1.0" encoding="',o.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(r,o){var l=o.width||this.width,f=o.height||this.height,g,m='viewBox="0 0 '+this.width+" "+this.height+'" ',v=d.Object.NUM_FRACTION_DIGITS;o.viewBox?m='viewBox="'+o.viewBox.x+" "+o.viewBox.y+" "+o.viewBox.width+" "+o.viewBox.height+'" ':this.svgViewportTransformation&&(g=this.viewportTransform,m='viewBox="'+i(-g[4]/g[0],v)+" "+i(-g[5]/g[3],v)+" "+i(this.width/g[0],v)+" "+i(this.height/g[3],v)+'" '),r.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',l,'" ','height="',f,'" ',m,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",d.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(o),`</defs>
`)},createSVGClipPathMarkup:function(r){var o=this.clipPath;return o?(o.clipPathId="CLIPPATH_"+d.Object.__uid++,'<clipPath id="'+o.clipPathId+`" >
`+this.clipPath.toClipPathSVG(r.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var r=this,o=["background","overlay"].map(function(l){var f=r[l+"Color"];if(f&&f.toLive){var g=r[l+"Vpt"],m=r.viewportTransform,v={width:r.width/(g?m[0]:1),height:r.height/(g?m[3]:1)};return f.toSVG(v,{additionalTransform:g?d.util.matrixToSVG(m):""})}});return o.join("")},createSVGFontFacesMarkup:function(){var r="",o={},l,f,g,m,v,p,_,C,y,S=d.fontPaths,x=[];for(this._objects.forEach(function E(L){x.push(L),L._objects&&L._objects.forEach(E)}),C=0,y=x.length;C<y;C++)if(l=x[C],f=l.fontFamily,!(l.type.indexOf("text")===-1||o[f]||!S[f])&&(o[f]=!0,!!l.styles)){g=l.styles;for(v in g){m=g[v];for(_ in m)p=m[_],f=p.fontFamily,!o[f]&&S[f]&&(o[f]=!0)}}for(var O in o)r+=[`		@font-face {
`,"			font-family: '",O,`';
`,"			src: url('",S[O],`');
`,`		}
`].join("");return r&&(r=['	<style type="text/css">',`<![CDATA[
`,r,"]]>",`</style>
`].join("")),r},_setSVGObjects:function(r,o){var l,f,g,m=this._objects;for(f=0,g=m.length;f<g;f++)l=m[f],!l.excludeFromExport&&this._setSVGObject(r,l,o)},_setSVGObject:function(r,o,l){r.push(o.toSVG(l))},_setSVGBgOverlayImage:function(r,o,l){this[o]&&!this[o].excludeFromExport&&this[o].toSVG&&r.push(this[o].toSVG(l))},_setSVGBgOverlayColor:function(r,o){var l=this[o+"Color"],f=this.viewportTransform,g=this.width,m=this.height;if(!!l)if(l.toLive){var v=l.repeat,p=d.util.invertTransform(f),_=this[o+"Vpt"],C=_?d.util.matrixToSVG(p):"";r.push('<rect transform="'+C+" translate(",g/2,",",m/2,')"',' x="',l.offsetX-g/2,'" y="',l.offsetY-m/2,'" ','width="',v==="repeat-y"||v==="no-repeat"?l.source.width:g,'" height="',v==="repeat-x"||v==="no-repeat"?l.source.height:m,'" fill="url(#SVGID_'+l.id+')"',`></rect>
`)}else r.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',l,'"',`></rect>
`)},sendToBack:function(r){if(!r)return this;var o=this._activeObject,l,f,g;if(r===o&&r.type==="activeSelection")for(g=o._objects,l=g.length;l--;)f=g[l],h(this._objects,f),this._objects.unshift(f);else h(this._objects,r),this._objects.unshift(r);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(r){if(!r)return this;var o=this._activeObject,l,f,g;if(r===o&&r.type==="activeSelection")for(g=o._objects,l=0;l<g.length;l++)f=g[l],h(this._objects,f),this._objects.push(f);else h(this._objects,r),this._objects.push(r);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(r,o){if(!r)return this;var l=this._activeObject,f,g,m,v,p,_=0;if(r===l&&r.type==="activeSelection")for(p=l._objects,f=0;f<p.length;f++)g=p[f],m=this._objects.indexOf(g),m>0+_&&(v=m-1,h(this._objects,g),this._objects.splice(v,0,g)),_++;else m=this._objects.indexOf(r),m!==0&&(v=this._findNewLowerIndex(r,m,o),h(this._objects,r),this._objects.splice(v,0,r));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(r,o,l){var f,g;if(l)for(f=o,g=o-1;g>=0;--g){var m=r.intersectsWithObject(this._objects[g])||r.isContainedWithinObject(this._objects[g])||this._objects[g].isContainedWithinObject(r);if(m){f=g;break}}else f=o-1;return f},bringForward:function(r,o){if(!r)return this;var l=this._activeObject,f,g,m,v,p,_=0;if(r===l&&r.type==="activeSelection")for(p=l._objects,f=p.length;f--;)g=p[f],m=this._objects.indexOf(g),m<this._objects.length-1-_&&(v=m+1,h(this._objects,g),this._objects.splice(v,0,g)),_++;else m=this._objects.indexOf(r),m!==this._objects.length-1&&(v=this._findNewUpperIndex(r,m,o),h(this._objects,r),this._objects.splice(v,0,r));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(r,o,l){var f,g,m;if(l)for(f=o,g=o+1,m=this._objects.length;g<m;++g){var v=r.intersectsWithObject(this._objects[g])||r.isContainedWithinObject(this._objects[g])||this._objects[g].isContainedWithinObject(r);if(v){f=g;break}}else f=o+1;return f},moveTo:function(r,o){return h(this._objects,r),this._objects.splice(o,0,r),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(d.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,d.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),u(d.StaticCanvas.prototype,d.Observable),u(d.StaticCanvas.prototype,d.Collection),u(d.StaticCanvas.prototype,d.DataURLExporter),u(d.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(r){var o=c();if(!o||!o.getContext)return null;var l=o.getContext("2d");if(!l)return null;switch(r){case"setLineDash":return typeof l.setLineDash<"u";default:return null}}}),d.StaticCanvas.prototype.toJSON=d.StaticCanvas.prototype.toObject,d.isLikelyNode&&(d.StaticCanvas.prototype.createPNGStream=function(){var r=n(this.lowerCanvasEl);return r&&r.createPNGStream()},d.StaticCanvas.prototype.createJPEGStream=function(r){var o=n(this.lowerCanvasEl);return o&&o.createJPEGStream(r)})}(),d.BaseBrush=d.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,setShadow:function(u){return this.shadow=new d.Shadow(u),this},_setBrushStyles:function(){var u=this.canvas.contextTop;u.strokeStyle=this.color,u.lineWidth=this.width,u.lineCap=this.strokeLineCap,u.miterLimit=this.strokeMiterLimit,u.lineJoin=this.strokeLineJoin,d.StaticCanvas.supports("setLineDash")&&u.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(u){var e=this.canvas.viewportTransform;u.save(),u.transform(e[0],e[1],e[2],e[3],e[4],e[5])},_setShadow:function(){if(!!this.shadow){var u=this.canvas,e=this.shadow,h=u.contextTop,i=u.getZoom();u&&u._isRetinaScaling()&&(i*=d.devicePixelRatio),h.shadowColor=e.color,h.shadowBlur=e.blur*i,h.shadowOffsetX=e.offsetX*i,h.shadowOffsetY=e.offsetY*i}},needsFullRender:function(){var u=new d.Color(this.color);return u.getAlpha()<1||!!this.shadow},_resetShadow:function(){var u=this.canvas.contextTop;u.shadowColor="",u.shadowBlur=u.shadowOffsetX=u.shadowOffsetY=0}}),function(){d.PencilBrush=d.util.createClass(d.BaseBrush,{decimate:.4,initialize:function(u){this.canvas=u,this._points=[]},_drawSegment:function(u,e,h){var i=e.midPointFrom(h);return u.quadraticCurveTo(e.x,e.y,i.x,i.y),i},onMouseDown:function(u,e){!this.canvas._isMainEvent(e.e)||(this._prepareForDrawing(u),this._captureDrawingPath(u),this._render())},onMouseMove:function(u,e){if(!!this.canvas._isMainEvent(e.e)&&this._captureDrawingPath(u)&&this._points.length>1)if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var h=this._points,i=h.length,t=this.canvas.contextTop;this._saveAndTransform(t),this.oldEnd&&(t.beginPath(),t.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(t,h[i-2],h[i-1],!0),t.stroke(),t.restore()}},onMouseUp:function(u){return this.canvas._isMainEvent(u.e)?(this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(u){var e=new d.Point(u.x,u.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(u){return this._points.length>1&&u.eq(this._points[this._points.length-1])?!1:(this._points.push(u),!0)},_reset:function(){this._points=[],this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(u){var e=new d.Point(u.x,u.y);return this._addPoint(e)},_render:function(){var u=this.canvas.contextTop,e,h,i=this._points[0],t=this._points[1];if(this._saveAndTransform(u),u.beginPath(),this._points.length===2&&i.x===t.x&&i.y===t.y){var s=this.width/1e3;i=new d.Point(i.x,i.y),t=new d.Point(t.x,t.y),i.x-=s,t.x+=s}for(u.moveTo(i.x,i.y),e=1,h=this._points.length;e<h;e++)this._drawSegment(u,i,t),i=this._points[e],t=this._points[e+1];u.lineTo(i.x,i.y),u.stroke(),u.restore()},convertPointsToSVGPath:function(u){var e=[],h,i=this.width/1e3,t=new d.Point(u[0].x,u[0].y),s=new d.Point(u[1].x,u[1].y),n=u.length,c=1,a=0,r=n>2;for(r&&(c=u[2].x<s.x?-1:u[2].x===s.x?0:1,a=u[2].y<s.y?-1:u[2].y===s.y?0:1),e.push("M ",t.x-c*i," ",t.y-a*i," "),h=1;h<n;h++){if(!t.eq(s)){var o=t.midPointFrom(s);e.push("Q ",t.x," ",t.y," ",o.x," ",o.y," ")}t=u[h],h+1<u.length&&(s=u[h+1])}return r&&(c=t.x>u[h-2].x?1:t.x===u[h-2].x?0:-1,a=t.y>u[h-2].y?1:t.y===u[h-2].y?0:-1),e.push("L ",t.x+c*i," ",t.y+a*i),e},createPath:function(u){var e=new d.Path(u,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},decimatePoints:function(u,e){if(u.length<=2)return u;var h=this.canvas.getZoom(),i=Math.pow(e/h,2),t,s=u.length-1,n=u[0],c=[n],a;for(t=1;t<s;t++)a=Math.pow(n.x-u[t].x,2)+Math.pow(n.y-u[t].y,2),a>=i&&(n=u[t],c.push(n));return c.length===1&&c.push(new d.Point(c[0].x,c[0].y)),c},_finalizeAndAddPath:function(){var u=this.canvas.contextTop;u.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var e=this.convertPointsToSVGPath(this._points).join("");if(e==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.requestRenderAll();return}var h=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.add(h),this.canvas.requestRenderAll(),h.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:h})}})}(),d.CircleBrush=d.util.createClass(d.BaseBrush,{width:10,initialize:function(u){this.canvas=u,this.points=[]},drawDot:function(u){var e=this.addPoint(u),h=this.canvas.contextTop;this._saveAndTransform(h),this.dot(h,e),h.restore()},dot:function(u,e){u.fillStyle=e.fill,u.beginPath(),u.arc(e.x,e.y,e.radius,0,Math.PI*2,!1),u.closePath(),u.fill()},onMouseDown:function(u){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(u)},_render:function(){var u=this.canvas.contextTop,e,h,i=this.points;for(this._saveAndTransform(u),e=0,h=i.length;e<h;e++)this.dot(u,i[e]);u.restore()},onMouseMove:function(u){this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(u),this._render()):this.drawDot(u)},onMouseUp:function(){var u=this.canvas.renderOnAddRemove,e,h;this.canvas.renderOnAddRemove=!1;var i=[];for(e=0,h=this.points.length;e<h;e++){var t=this.points[e],s=new d.Circle({radius:t.radius,left:t.x,top:t.y,originX:"center",originY:"center",fill:t.fill});this.shadow&&s.setShadow(this.shadow),i.push(s)}var n=new d.Group(i);n.canvas=this.canvas,this.canvas.add(n),this.canvas.fire("path:created",{path:n}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=u,this.canvas.requestRenderAll()},addPoint:function(u){var e=new d.Point(u.x,u.y),h=d.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,i=new d.Color(this.color).setAlpha(d.util.getRandomInt(0,100)/100).toRgba();return e.radius=h,e.fill=i,this.points.push(e),e}}),d.SprayBrush=d.util.createClass(d.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(u){this.canvas=u,this.sprayChunks=[]},onMouseDown:function(u){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(u),this.render(this.sprayChunkPoints)},onMouseMove:function(u){this.addSprayChunk(u),this.render(this.sprayChunkPoints)},onMouseUp:function(){var u=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],h=0,i=this.sprayChunks.length;h<i;h++)for(var t=this.sprayChunks[h],s=0,n=t.length;s<n;s++){var c=new d.Rect({width:t[s].width,height:t[s].width,left:t[s].x+1,top:t[s].y+1,originX:"center",originY:"center",fill:this.color});e.push(c)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var a=new d.Group(e);this.shadow&&a.setShadow(this.shadow),this.canvas.add(a),this.canvas.fire("path:created",{path:a}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=u,this.canvas.requestRenderAll()},_getOptimizedRects:function(u){var e={},h,i,t;for(i=0,t=u.length;i<t;i++)h=u[i].left+""+u[i].top,e[h]||(e[h]=u[i]);var s=[];for(h in e)s.push(e[h]);return s},render:function(u){var e=this.canvas.contextTop,h,i;for(e.fillStyle=this.color,this._saveAndTransform(e),h=0,i=u.length;h<i;h++){var t=u[h];typeof t.opacity<"u"&&(e.globalAlpha=t.opacity),e.fillRect(t.x,t.y,t.width,t.width)}e.restore()},_render:function(){var u=this.canvas.contextTop,e,h;for(u.fillStyle=this.color,this._saveAndTransform(u),e=0,h=this.sprayChunks.length;e<h;e++)this.render(this.sprayChunks[e]);u.restore()},addSprayChunk:function(u){this.sprayChunkPoints=[];var e,h,i,t=this.width/2,s;for(s=0;s<this.density;s++){e=d.util.getRandomInt(u.x-t,u.x+t),h=d.util.getRandomInt(u.y-t,u.y+t),this.dotWidthVariance?i=d.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):i=this.dotWidth;var n=new d.Point(e,h);n.width=i,this.randomOpacity&&(n.opacity=d.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(n)}this.sprayChunks.push(this.sprayChunkPoints)}}),d.PatternBrush=d.util.createClass(d.PencilBrush,{getPatternSrc:function(){var u=20,e=5,h=d.util.createCanvasElement(),i=h.getContext("2d");return h.width=h.height=u+e,i.fillStyle=this.color,i.beginPath(),i.arc(u/2,u/2,u/2,0,Math.PI*2,!1),i.closePath(),i.fill(),h},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(u){var e=this.callSuper("createPath",u),h=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new d.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-h.x,offsetY:-h.y}),e}}),function(){var u=d.util.getPointer,e=d.util.degreesToRadians,h=d.util.radiansToDegrees,i=Math.atan2,t=Math.abs,s=d.StaticCanvas.supports("setLineDash"),n=.5;d.Canvas=d.util.createClass(d.StaticCanvas,{initialize:function(a,r){r||(r={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(a,r),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=d.PencilBrush&&new d.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var a=this.getActiveObjects(),r,o,l;if(a.length>0&&!this.preserveObjectStacking){o=[],l=[];for(var f=0,g=this._objects.length;f<g;f++)r=this._objects[f],a.indexOf(r)===-1?o.push(r):l.push(r);a.length>1&&(this._activeObject._objects=l),o.push.apply(o,l)}else o=this._objects;return o},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var a=this.contextContainer;return this.renderCanvas(a,this._chooseObjectsToRender()),this},renderTopLayer:function(a){a.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(a),this.contextTopDirty=!0),a.restore()},renderTop:function(){var a=this.contextTop;return this.clearContext(a),this.renderTopLayer(a),this.fire("after:render"),this},_resetCurrentTransform:function(){var a=this._currentTransform;a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,skewX:a.original.skewX,skewY:a.original.skewY,left:a.original.left,top:a.original.top}),this._shouldCenterTransform(a.target)?(a.originX!=="center"&&(a.originX==="right"?a.mouseXSign=-1:a.mouseXSign=1),a.originY!=="center"&&(a.originY==="bottom"?a.mouseYSign=-1:a.mouseYSign=1),a.originX="center",a.originY="center"):(a.originX=a.original.originX,a.originY=a.original.originY)},containsPoint:function(a,r,o){var l=!0,f=o||this.getPointer(a,l),g;return r.group&&r.group===this._activeObject&&r.group.type==="activeSelection"?g=this._normalizePointer(r.group,f):g={x:f.x,y:f.y},r.containsPoint(g)||r._findTargetCorner(f)},_normalizePointer:function(a,r){var o=a.calcTransformMatrix(),l=d.util.invertTransform(o),f=this.restorePointerVpt(r);return d.util.transformPoint(f,l)},isTargetTransparent:function(a,r,o){if(a.shouldCache()&&a._cacheCanvas&&a!==this._activeObject){var l=this._normalizePointer(a,{x:r,y:o}),f=Math.max(a.cacheTranslationX+l.x*a.zoomX,0),g=Math.max(a.cacheTranslationY+l.y*a.zoomY,0),_=d.util.isTransparent(a._cacheContext,Math.round(f),Math.round(g),this.targetFindTolerance);return _}var m=this.contextCache,v=a.selectionBackgroundColor,p=this.viewportTransform;a.selectionBackgroundColor="",this.clearContext(m),m.save(),m.transform(p[0],p[1],p[2],p[3],p[4],p[5]),a.render(m),m.restore(),a===this._activeObject&&a._renderControls(m,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),a.selectionBackgroundColor=v;var _=d.util.isTransparent(m,r,o,this.targetFindTolerance);return _},_isSelectionKeyPressed:function(a){var r=!1;return Object.prototype.toString.call(this.selectionKey)==="[object Array]"?r=!!this.selectionKey.find(function(o){return a[o]===!0}):r=a[this.selectionKey],r},_shouldClearSelection:function(a,r){var o=this.getActiveObjects(),l=this._activeObject;return!r||r&&l&&o.length>1&&o.indexOf(r)===-1&&l!==r&&!this._isSelectionKeyPressed(a)||r&&!r.evented||r&&!r.selectable&&l&&l!==r},_shouldCenterTransform:function(a){if(!!a){var r=this._currentTransform,o;return r.action==="scale"||r.action==="scaleX"||r.action==="scaleY"?o=this.centeredScaling||a.centeredScaling:r.action==="rotate"&&(o=this.centeredRotation||a.centeredRotation),o?!r.altKey:r.altKey}},_getOriginFromCorner:function(a,r){var o={x:a.originX,y:a.originY};return r==="ml"||r==="tl"||r==="bl"?o.x="right":(r==="mr"||r==="tr"||r==="br")&&(o.x="left"),r==="tl"||r==="mt"||r==="tr"?o.y="bottom":(r==="bl"||r==="mb"||r==="br")&&(o.y="top"),o},_getActionFromCorner:function(a,r,o){if(!r||!a)return"drag";switch(r){case"mtr":return"rotate";case"ml":case"mr":return o[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return o[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(a,r,o){if(!!r){var l=this.getPointer(a),f=r._findTargetCorner(this.getPointer(a,!0)),g=this._getActionFromCorner(o,f,a,r),m=this._getOriginFromCorner(r,f);this._currentTransform={target:r,action:g,corner:f,scaleX:r.scaleX,scaleY:r.scaleY,skewX:r.skewX,skewY:r.skewY,offsetX:l.x-r.left,offsetY:l.y-r.top,originX:m.x,originY:m.y,ex:l.x,ey:l.y,lastX:l.x,lastY:l.y,theta:e(r.angle),width:r.width*r.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:a.shiftKey,altKey:a[this.centeredKey],original:d.util.saveObjectTransform(r)},this._currentTransform.original.originX=m.x,this._currentTransform.original.originY=m.y,this._resetCurrentTransform(),this._beforeTransform(a)}},_translateObject:function(a,r){var o=this._currentTransform,l=o.target,f=a-o.offsetX,g=r-o.offsetY,m=!l.get("lockMovementX")&&l.left!==f,v=!l.get("lockMovementY")&&l.top!==g;return m&&l.set("left",f),v&&l.set("top",g),m||v},_changeSkewTransformOrigin:function(a,r,o){var l="originX",f={0:"center"},g=r.target.skewX,m="left",v="right",p=r.corner==="mt"||r.corner==="ml"?1:-1,_=1;a=a>0?1:-1,o==="y"&&(g=r.target.skewY,m="top",v="bottom",l="originY"),f[-1]=m,f[1]=v,r.target.flipX&&(_*=-1),r.target.flipY&&(_*=-1),g===0?(r.skewSign=-p*a*_,r[l]=f[-a]):(g=g>0?1:-1,r.skewSign=g,r[l]=f[g*p*_])},_skewObject:function(a,r,o){var l=this._currentTransform,f=l.target,g=!1,m=f.get("lockSkewingX"),v=f.get("lockSkewingY");if(m&&o==="x"||v&&o==="y")return!1;var p=f.getCenterPoint(),_=f.toLocalPoint(new d.Point(a,r),"center","center")[o],C=f.toLocalPoint(new d.Point(l.lastX,l.lastY),"center","center")[o],y,S,x=f._getTransformedDimensions();return this._changeSkewTransformOrigin(_-C,l,o),y=f.toLocalPoint(new d.Point(a,r),l.originX,l.originY)[o],S=f.translateToOriginPoint(p,l.originX,l.originY),g=this._setObjectSkew(y,l,o,x),l.lastX=a,l.lastY=r,f.setPositionByOrigin(S,l.originX,l.originY),g},_setObjectSkew:function(a,r,o,l){var f=r.target,g,m=!1,v=r.skewSign,p,_,C,y,S,x,O,E;return o==="x"?(C="y",y="Y",S="X",O=0,E=f.skewY):(C="x",y="X",S="Y",O=f.skewX,E=0),_=f._getTransformedDimensions(O,E),x=2*Math.abs(a)-_[o],x<=2?g=0:(g=v*Math.atan(x/f["scale"+S]/(_[C]/f["scale"+y])),g=d.util.radiansToDegrees(g)),m=f["skew"+S]!==g,f.set("skew"+S,g),f["skew"+y]!==0&&(p=f._getTransformedDimensions(),g=l[C]/p[C]*f["scale"+y],f.set("scale"+y,g)),m},_scaleObject:function(a,r,o){var l=this._currentTransform,f=l.target,g=f.lockScalingX,m=f.lockScalingY,v=f.lockScalingFlip;if(g&&m)return!1;var p=f.translateToOriginPoint(f.getCenterPoint(),l.originX,l.originY),_=f.toLocalPoint(new d.Point(a,r),l.originX,l.originY),C=f._getTransformedDimensions(),y=!1;return this._setLocalMouse(_,l),y=this._setObjectScale(_,l,g,m,o,v,C),f.setPositionByOrigin(p,l.originX,l.originY),y},_setObjectScale:function(a,r,o,l,f,g,m){var v=r.target,p=!1,_=!1,C=!1,y=a.x*v.scaleX/m.x,S=a.y*v.scaleY/m.y,x=v.scaleX!==y,O=v.scaleY!==S;if(r.newScaleX=y,r.newScaleY=S,d.Textbox&&f==="x"&&v instanceof d.Textbox){var E=v.width*(a.x/m.x);return E>=v.getMinWidth()?(C=E!==v.width,v.set("width",E),C):!1}return g&&y<=0&&y<v.scaleX&&(p=!0,a.x=0),g&&S<=0&&S<v.scaleY&&(_=!0,a.y=0),f==="equally"&&!o&&!l?C=this._scaleObjectEqually(a,v,r,m):f?f==="x"&&!v.get("lockUniScaling")?p||o||v.set("scaleX",y)&&(C=x):f==="y"&&!v.get("lockUniScaling")&&(_||l||v.set("scaleY",S)&&(C=O)):(p||o||v.set("scaleX",y)&&(C=C||x),_||l||v.set("scaleY",S)&&(C=C||O)),p||_||this._flipObject(r,f),C},_scaleObjectEqually:function(a,r,o,l){var f=a.y+a.x,g=l.y*o.original.scaleY/r.scaleY+l.x*o.original.scaleX/r.scaleX,m,v=a.x<0?-1:1,p=a.y<0?-1:1,_,C;return _=v*Math.abs(o.original.scaleX*f/g),C=p*Math.abs(o.original.scaleY*f/g),m=_!==r.scaleX||C!==r.scaleY,r.set("scaleX",_),r.set("scaleY",C),m},_flipObject:function(a,r){a.newScaleX<0&&r!=="y"&&(a.originX==="left"?a.originX="right":a.originX==="right"&&(a.originX="left")),a.newScaleY<0&&r!=="x"&&(a.originY==="top"?a.originY="bottom":a.originY==="bottom"&&(a.originY="top"))},_setLocalMouse:function(a,r){var o=r.target,l=this.getZoom(),f=o.padding/l;r.originX==="right"?a.x*=-1:r.originX==="center"&&(a.x*=r.mouseXSign*2,a.x<0&&(r.mouseXSign=-r.mouseXSign)),r.originY==="bottom"?a.y*=-1:r.originY==="center"&&(a.y*=r.mouseYSign*2,a.y<0&&(r.mouseYSign=-r.mouseYSign)),t(a.x)>f?a.x<0?a.x+=f:a.x-=f:a.x=0,t(a.y)>f?a.y<0?a.y+=f:a.y-=f:a.y=0},_rotateObject:function(a,r){var o=this._currentTransform,l=o.target,f,f=l.translateToOriginPoint(l.getCenterPoint(),o.originX,o.originY);if(l.lockRotation)return!1;var g=i(o.ey-f.y,o.ex-f.x),m=i(r-f.y,a-f.x),v=h(m-g+o.theta),p=!0;if(l.snapAngle>0){var _=l.snapAngle,C=l.snapThreshold||_,y=Math.ceil(v/_)*_,S=Math.floor(v/_)*_;Math.abs(v-S)<C?v=S:Math.abs(v-y)<C&&(v=y)}return v<0&&(v=360+v),v%=360,l.angle===v?p=!1:(l.angle=v,l.setPositionByOrigin(f,o.originX,o.originY)),p},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_drawSelection:function(a){var r=this._groupSelector,o=r.left,l=r.top,f=t(o),g=t(l);if(this.selectionColor&&(a.fillStyle=this.selectionColor,a.fillRect(r.ex-(o>0?0:-o),r.ey-(l>0?0:-l),f,g)),!(!this.selectionLineWidth||!this.selectionBorderColor))if(a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!s){var m=r.ex+n-(o>0?0:f),v=r.ey+n-(l>0?0:g);a.beginPath(),d.util.drawDashedLine(a,m,v,m+f,v,this.selectionDashArray),d.util.drawDashedLine(a,m,v+g-1,m+f,v+g-1,this.selectionDashArray),d.util.drawDashedLine(a,m,v,m,v+g,this.selectionDashArray),d.util.drawDashedLine(a,m+f-1,v,m+f-1,v+g,this.selectionDashArray),a.closePath(),a.stroke()}else d.Object.prototype._setLineDash.call(this,a,this.selectionDashArray),a.strokeRect(r.ex+n-(o>0?0:f),r.ey+n-(l>0?0:g),f,g)},findTarget:function(a,r){if(!this.skipTargetFind){var o=!0,l=this.getPointer(a,o),f=this._activeObject,g=this.getActiveObjects(),m,v;if(this.targets=[],g.length>1&&!r&&f===this._searchPossibleTargets([f],l)||g.length===1&&f._findTargetCorner(l))return f;if(g.length===1&&f===this._searchPossibleTargets([f],l))if(this.preserveObjectStacking)m=f,v=this.targets,this.targets=[];else return f;var p=this._searchPossibleTargets(this._objects,l);return a[this.altSelectionKey]&&p&&m&&p!==m&&(p=m,this.targets=v),p}},_checkTarget:function(a,r,o){if(r&&r.visible&&r.evented&&this.containsPoint(null,r,a))if((this.perPixelTargetFind||r.perPixelTargetFind)&&!r.isEditing){var l=this.isTargetTransparent(r,o.x,o.y);if(!l)return!0}else return!0},_searchPossibleTargets:function(a,r){for(var o,l=a.length,f;l--;){var g=a[l],m=g.group&&g.group.type!=="activeSelection"?this._normalizePointer(g.group,r):r;if(this._checkTarget(m,g,r)){o=a[l],o.subTargetCheck&&o instanceof d.Group&&(f=this._searchPossibleTargets(o._objects,r),f&&this.targets.push(f));break}}return o},restorePointerVpt:function(a){return d.util.transformPoint(a,d.util.invertTransform(this.viewportTransform))},getPointer:function(a,r){if(this._absolutePointer&&!r)return this._absolutePointer;if(this._pointer&&r)return this._pointer;var o=u(a),l=this.upperCanvasEl,f=l.getBoundingClientRect(),g=f.width||0,m=f.height||0,v;(!g||!m)&&("top"in f&&"bottom"in f&&(m=Math.abs(f.top-f.bottom)),"right"in f&&"left"in f&&(g=Math.abs(f.right-f.left))),this.calcOffset(),o.x=o.x-this._offset.left,o.y=o.y-this._offset.top,r||(o=this.restorePointerVpt(o));var p=this.getRetinaScaling();return p!==1&&(o.x/=p,o.y/=p),g===0||m===0?v={width:1,height:1}:v={width:l.width/g,height:l.height/m},{x:o.x*v.width,y:o.y*v.height}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),r=this.lowerCanvasEl,o=this.upperCanvasEl;o?o.className="":(o=this._createCanvasElement(),this.upperCanvasEl=o),d.util.addClass(o,"upper-canvas "+a),this.wrapperEl.appendChild(o),this._copyCanvasStyle(r,o),this._applyCanvasStyle(o),this.contextTop=o.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=d.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),d.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),d.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var r=this.width||a.width,o=this.height||a.height;d.util.setStyle(a,{position:"absolute",width:r+"px",height:o+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),a.width=r,a.height=o,d.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,r){r.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var a=this._activeObject;return a?a.type==="activeSelection"&&a._objects?a._objects.slice(0):[a]:[]},_onObjectRemoved:function(a){a===this._activeObject&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared",{target:a}),a.fire("deselected")),a===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",a)},_fireSelectionEvents:function(a,r){var o=!1,l=this.getActiveObjects(),f=[],g=[],m={e:r};a.forEach(function(v){l.indexOf(v)===-1&&(o=!0,v.fire("deselected",m),g.push(v))}),l.forEach(function(v){a.indexOf(v)===-1&&(o=!0,v.fire("selected",m),f.push(v))}),a.length>0&&l.length>0?(m.selected=f,m.deselected=g,m.updated=f[0]||g[0],m.target=this._activeObject,o&&this.fire("selection:updated",m)):l.length>0?(l.length===1&&(m.target=f[0],this.fire("object:selected",m)),m.selected=f,m.target=this._activeObject,this.fire("selection:created",m)):a.length>0&&(m.deselected=g,this.fire("selection:cleared",m))},setActiveObject:function(a,r){var o=this.getActiveObjects();return this._setActiveObject(a,r),this._fireSelectionEvents(o,r),this},_setActiveObject:function(a,r){return this._activeObject===a||!this._discardActiveObject(r,a)||a.onSelect({e:r})?!1:(this._activeObject=a,!0)},_discardActiveObject:function(a,r){var o=this._activeObject;if(o){if(o.onDeselect({e:a,object:r}))return!1;this._activeObject=null}return!0},discardActiveObject:function(a){var r=this.getActiveObjects(),o=this.getActiveObject();return r.length&&this.fire("before:selection:cleared",{target:o,e:a}),this._discardActiveObject(a),this._fireSelectionEvents(r,a),this},dispose:function(){var a=this.wrapperEl;return this.removeListeners(),a.removeChild(this.upperCanvasEl),a.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(r){d.util.cleanUpJsdomNode(this[r]),this[r]=void 0}.bind(this)),a.parentNode&&a.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,d.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(a){var r=this._activeObject;r&&r._renderControls(a)},_toObject:function(a,r,o){var l=this._realizeGroupTransformOnObject(a),f=this.callSuper("_toObject",a,r,o);return this._unwindGroupTransformOnObject(a,l),f},_realizeGroupTransformOnObject:function(a){if(a.group&&a.group.type==="activeSelection"&&this._activeObject===a.group){var r=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],o={};return r.forEach(function(l){o[l]=a[l]}),this._activeObject.realizeTransform(a),o}else return null},_unwindGroupTransformOnObject:function(a,r){r&&a.set(r)},_setSVGObject:function(a,r,o){var l=this._realizeGroupTransformOnObject(r);this.callSuper("_setSVGObject",a,r,o),this._unwindGroupTransformOnObject(r,l)},setViewportTransform:function(a){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),d.StaticCanvas.prototype.setViewportTransform.call(this,a)}});for(var c in d.StaticCanvas)c!=="prototype"&&(d.Canvas[c]=d.StaticCanvas[c])}(),function(){var u={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=d.util.addListener,h=d.util.removeListener,i=3,t=2,s=1,n={passive:!1};function c(a,r){return a.button&&a.button===r-1}d.util.object.extend(d.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(e,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(a,r){var o=this.upperCanvasEl,l=this._getEventPrefix();a(d.window,"resize",this._onResize),a(o,l+"down",this._onMouseDown),a(o,l+"move",this._onMouseMove,n),a(o,l+"out",this._onMouseOut),a(o,l+"enter",this._onMouseEnter),a(o,"wheel",this._onMouseWheel),a(o,"contextmenu",this._onContextMenu),a(o,"dblclick",this._onDoubleClick),a(o,"dragover",this._onDragOver),a(o,"dragenter",this._onDragEnter),a(o,"dragleave",this._onDragLeave),a(o,"drop",this._onDrop),this.enablePointerEvents||a(o,"touchstart",this._onTouchStart,n),typeof eventjs<"u"&&r in eventjs&&(eventjs[r](o,"gesture",this._onGesture),eventjs[r](o,"drag",this._onDrag),eventjs[r](o,"orientation",this._onOrientationChange),eventjs[r](o,"shake",this._onShake),eventjs[r](o,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(h,"remove");var a=this._getEventPrefix();h(d.document,a+"up",this._onMouseUp),h(d.document,"touchend",this._onTouchEnd,n),h(d.document,a+"move",this._onMouseMove,n),h(d.document,"touchmove",this._onMouseMove,n)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0)},_onGesture:function(a,r){this.__onTransformGesture&&this.__onTransformGesture(a,r)},_onDrag:function(a,r){this.__onDrag&&this.__onDrag(a,r)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var r=this._hoveredTarget;this.fire("mouse:out",{target:r,e:a}),this._hoveredTarget=null,r&&r.fire("mouseout",{e:a});var o=this;this._hoveredTargets.forEach(function(l){o.fire("mouse:out",{target:r,e:a}),l&&r.fire("mouseout",{e:a})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(l){l.isEditing&&l.hiddenTextarea.focus()})},_onMouseEnter:function(a){!this.currentTransform&&!this.findTarget(a)&&(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(a,r){this.__onOrientationChange&&this.__onOrientationChange(a,r)},_onShake:function(a,r){this.__onShake&&this.__onShake(a,r)},_onLongPress:function(a,r){this.__onLongPress&&this.__onLongPress(a,r)},_onDragOver:function(a){a.preventDefault();var r=this._simpleEventHandler("dragover",a);this._fireEnterLeaveEvents(r,a)},_onContextMenu:function(a){return this.stopContextMenu&&(a.stopPropagation(),a.preventDefault()),!1},_onDoubleClick:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"dblclick"),this._resetTransformEventData(a)},getPointerId:function(a){var r=a.changedTouches;return r?r[0]&&r[0].identifier:this.enablePointerEvents?a.pointerId:-1},_isMainEvent:function(a){return a.isPrimary===!0?!0:a.isPrimary===!1?!1:a.type==="touchend"&&a.touches.length===0?!0:a.changedTouches?a.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(a){a.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(a)),this.__onMouseDown(a),this._resetTransformEventData();var r=this.upperCanvasEl,o=this._getEventPrefix();e(d.document,"touchend",this._onTouchEnd,n),e(d.document,"touchmove",this._onMouseMove,n),h(r,o+"down",this._onMouseDown)},_onMouseDown:function(a){this.__onMouseDown(a),this._resetTransformEventData();var r=this.upperCanvasEl,o=this._getEventPrefix();h(r,o+"move",this._onMouseMove,n),e(d.document,o+"up",this._onMouseUp),e(d.document,o+"move",this._onMouseMove,n)},_onTouchEnd:function(a){if(!(a.touches.length>0)){this.__onMouseUp(a),this._resetTransformEventData(),this.mainTouchId=null;var r=this._getEventPrefix();h(d.document,"touchend",this._onTouchEnd,n),h(d.document,"touchmove",this._onMouseMove,n);var o=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){e(o.upperCanvasEl,r+"down",o._onMouseDown),o._willAddMouseDown=0},400)}},_onMouseUp:function(a){this.__onMouseUp(a),this._resetTransformEventData();var r=this.upperCanvasEl,o=this._getEventPrefix();this._isMainEvent(a)&&(h(d.document,o+"up",this._onMouseUp),h(d.document,o+"move",this._onMouseMove,n),e(r,o+"move",this._onMouseMove,n))},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a){var r=this._activeObject;return!!r!=!!a||r&&a&&r!==a?!0:(r&&r.isEditing,!1)},__onMouseUp:function(a){var r,o=this._currentTransform,l=this._groupSelector,f=!1,g=!l||l.left===0&&l.top===0;if(this._cacheTransformEventData(a),r=this._target,this._handleEvent(a,"up:before"),c(a,i)){this.fireRightClick&&this._handleEvent(a,"up",i,g);return}if(c(a,t)){this.fireMiddleClick&&this._handleEvent(a,"up",t,g),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(a);return}!this._isMainEvent(a)||(o&&(this._finalizeCurrentTransform(a),f=o.actionPerformed),g||(this._maybeGroupObjects(a),f||(f=this._shouldRender(r))),r&&(r.isMoving=!1),this._setCursorFromEvent(a,r),this._handleEvent(a,"up",s,g),this._groupSelector=null,this._currentTransform=null,r&&(r.__corner=0),f?this.requestRenderAll():g||this.renderTop())},_simpleEventHandler:function(a,r){var o=this.findTarget(r),l=this.targets,f={e:r,target:o,subTargets:l};if(this.fire(a,f),o&&o.fire(a,f),!l)return o;for(var g=0;g<l.length;g++)l[g].fire(a,f);return o},_handleEvent:function(a,r,o,l){var f=this._target,g=this.targets||[],m={e:a,target:f,subTargets:g,button:o||s,isClick:l||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+r,m),f&&f.fire("mouse"+r,m);for(var v=0;v<g.length;v++)g[v].fire("mouse"+r,m)},_finalizeCurrentTransform:function(a){var r=this._currentTransform,o=r.target,l,f={e:a,target:o,transform:r};o._scaling&&(o._scaling=!1),o.setCoords(),(r.actionPerformed||this.stateful&&o.hasStateChanged())&&(r.actionPerformed&&(l=this._addEventOptions(f,r),this._fire(l,f)),this._fire("modified",f))},_addEventOptions:function(a,r){var o,l;switch(r.action){case"scaleX":o="scaled",l="x";break;case"scaleY":o="scaled",l="y";break;case"skewX":o="skewed",l="x";break;case"skewY":o="skewed",l="y";break;case"scale":o="scaled",l="equally";break;case"rotate":o="rotated";break;case"drag":o="moved";break}return a.by=l,o},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(a).requestRenderAll(),this.clipTo&&d.util.clipContext(this,this.contextTop);var r=this.getPointer(a);this.freeDrawingBrush.onMouseDown(r,{e:a,pointer:r}),this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var r=this.getPointer(a);this.freeDrawingBrush.onMouseMove(r,{e:a,pointer:r})}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){this.clipTo&&this.contextTop.restore();var r=this.getPointer(a);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:a,pointer:r}),this._handleEvent(a,"up")},__onMouseDown:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"down:before");var r=this._target;if(c(a,i)){this.fireRightClick&&this._handleEvent(a,"down",i);return}if(c(a,t)){this.fireMiddleClick&&this._handleEvent(a,"down",t);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(a);return}if(!!this._isMainEvent(a)&&!this._currentTransform){var o=this._pointer;this._previousPointer=o;var l=this._shouldRender(r),f=this._shouldGroup(a,r);if(this._shouldClearSelection(a,r)?this.discardActiveObject(a):f&&(this._handleGrouping(a,r),r=this._activeObject),this.selection&&(!r||!r.selectable&&!r.isEditing&&r!==this._activeObject)&&(this._groupSelector={ex:o.x,ey:o.y,top:0,left:0}),r){var g=r===this._activeObject;r.selectable&&this.setActiveObject(r,a),r===this._activeObject&&(r.__corner||!f)&&this._setupCurrentTransform(a,r,g)}this._handleEvent(a,"down"),(l||f)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(a){this._resetTransformEventData(),this._pointer=this.getPointer(a,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(a)||null},_beforeTransform:function(a){var r=this._currentTransform;this.stateful&&r.target.saveState(),this.fire("before:transform",{e:a,transform:r}),r.corner&&this.onBeforeScaleRotate(r.target)},__onMouseMove:function(a){this._handleEvent(a,"move:before"),this._cacheTransformEventData(a);var r,o;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(a);return}if(!!this._isMainEvent(a)){var l=this._groupSelector;l?(o=this._pointer,l.left=o.x-l.ex,l.top=o.y-l.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(r=this.findTarget(a)||null,this._setCursorFromEvent(a,r),this._fireOverOutEvents(r,a)),this._handleEvent(a,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(a,r){var o=this._hoveredTarget,l=this._hoveredTargets,f=this.targets,g=Math.max(l.length,f.length);this.fireSyntheticInOutEvents(a,r,{oldTarget:o,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var m=0;m<g;m++)this.fireSyntheticInOutEvents(f[m],r,{oldTarget:l[m],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=a,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(a,r){var o=this._draggedoverTarget,l=this._hoveredTargets,f=this.targets,g=Math.max(l.length,f.length);this.fireSyntheticInOutEvents(a,r,{oldTarget:o,evtOut:"dragleave",evtIn:"dragenter"});for(var m=0;m<g;m++)this.fireSyntheticInOutEvents(f[m],r,{oldTarget:l[m],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=a},fireSyntheticInOutEvents:function(a,r,o){var l,f,g=o.oldTarget,m,v,p=g!==a,_=o.canvasEvtIn,C=o.canvasEvtOut;p&&(l={e:r,target:a,previousTarget:g},f={e:r,target:g,nextTarget:a}),v=a&&p,m=g&&p,m&&(C&&this.fire(C,f),g.fire(o.evtOut,f)),v&&(_&&this.fire(_,l),a.fire(o.evtIn,l))},__onMouseWheel:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"wheel"),this._resetTransformEventData()},_transformObject:function(a){var r=this.getPointer(a),o=this._currentTransform;o.reset=!1,o.target.isMoving=!0,o.shiftKey=a.shiftKey,o.altKey=a[this.centeredKey],this._beforeScaleTransform(a,o),this._performTransformAction(a,o,r),o.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(a,r,o){var l=o.x,f=o.y,g=r.action,m=!1,v={target:r.target,e:a,transform:r,pointer:o};g==="rotate"?(m=this._rotateObject(l,f))&&this._fire("rotating",v):g==="scale"?(m=this._onScale(a,r,l,f))&&this._fire("scaling",v):g==="scaleX"?(m=this._scaleObject(l,f,"x"))&&this._fire("scaling",v):g==="scaleY"?(m=this._scaleObject(l,f,"y"))&&this._fire("scaling",v):g==="skewX"?(m=this._skewObject(l,f,"x"))&&this._fire("skewing",v):g==="skewY"?(m=this._skewObject(l,f,"y"))&&this._fire("skewing",v):(m=this._translateObject(l,f),m&&(this._fire("moving",v),this.setCursor(v.target.moveCursor||this.moveCursor))),r.actionPerformed=r.actionPerformed||m},_fire:function(a,r){this.fire("object:"+a,r),r.target.fire(a,r)},_beforeScaleTransform:function(a,r){if(r.action==="scale"||r.action==="scaleX"||r.action==="scaleY"){var o=this._shouldCenterTransform(r.target);(o&&(r.originX!=="center"||r.originY!=="center")||!o&&r.originX==="center"&&r.originY==="center")&&(this._resetCurrentTransform(),r.reset=!0)}},_onScale:function(a,r,o,l){return this._isUniscalePossible(a,r.target)?(r.currentAction="scale",this._scaleObject(o,l)):(!r.reset&&r.currentAction==="scale"&&this._resetCurrentTransform(),r.currentAction="scaleEqually",this._scaleObject(o,l,"equally"))},_isUniscalePossible:function(a,r){return(a[this.uniScaleKey]||this.uniScaleTransform)&&!r.get("lockUniScaling")},_setCursorFromEvent:function(a,r){if(!r)return this.setCursor(this.defaultCursor),!1;var o=r.hoverCursor||this.hoverCursor,l=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,f=(!l||!l.contains(r))&&r._findTargetCorner(this.getPointer(a,!0));f?this.setCursor(this.getCornerCursor(f,r,a)):(r.subTargetCheck&&this.targets.concat().reverse().map(function(g){o=g.hoverCursor||o}),this.setCursor(o))},getCornerCursor:function(a,r,o){return this.actionIsDisabled(a,r,o)?this.notAllowedCursor:a in u?this._getRotatedCornerCursor(a,r,o):a==="mtr"&&r.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(a,r,o){return a==="mt"||a==="mb"?o[this.altActionKey]?r.lockSkewingX:r.lockScalingY:a==="ml"||a==="mr"?o[this.altActionKey]?r.lockSkewingY:r.lockScalingX:a==="mtr"?r.lockRotation:this._isUniscalePossible(o,r)?r.lockScalingX&&r.lockScalingY:r.lockScalingX||r.lockScalingY},_getRotatedCornerCursor:function(a,r,o){var l=Math.round(r.angle%360/45);return l<0&&(l+=8),l+=u[a],o[this.altActionKey]&&u[a]%2===0&&(l+=2),l%=8,this.cursorMap[l]}})}(),function(){var u=Math.min,e=Math.max;d.util.object.extend(d.Canvas.prototype,{_shouldGroup:function(h,i){var t=this._activeObject;return t&&this._isSelectionKeyPressed(h)&&i&&i.selectable&&this.selection&&(t!==i||t.type==="activeSelection")&&!i.onSelect({e:h})},_handleGrouping:function(h,i){var t=this._activeObject;t.__corner||i===t&&(i=this.findTarget(h,!0),!i||!i.selectable)||(t&&t.type==="activeSelection"?this._updateActiveSelection(i,h):this._createActiveSelection(i,h))},_updateActiveSelection:function(h,i){var t=this._activeObject,s=t._objects.slice(0);t.contains(h)?(t.removeWithUpdate(h),this._hoveredTarget=h,this._hoveredTargets=this.targets.concat(),t.size()===1&&this._setActiveObject(t.item(0),i)):(t.addWithUpdate(h),this._hoveredTarget=t,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(s,i)},_createActiveSelection:function(h,i){var t=this.getActiveObjects(),s=this._createGroup(h);this._hoveredTarget=s,this._setActiveObject(s,i),this._fireSelectionEvents(t,i)},_createGroup:function(h){var i=this._objects,t=i.indexOf(this._activeObject)<i.indexOf(h),s=t?[this._activeObject,h]:[h,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new d.ActiveSelection(s,{canvas:this})},_groupSelectedObjects:function(h){var i=this._collectObjects(h),t;i.length===1?this.setActiveObject(i[0],h):i.length>1&&(t=new d.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(t,h))},_collectObjects:function(h){for(var i=[],t,s=this._groupSelector.ex,n=this._groupSelector.ey,c=s+this._groupSelector.left,a=n+this._groupSelector.top,r=new d.Point(u(s,c),u(n,a)),o=new d.Point(e(s,c),e(n,a)),l=!this.selectionFullyContained,f=s===c&&n===a,g=this._objects.length;g--&&(t=this._objects[g],!(!(!t||!t.selectable||!t.visible)&&(l&&t.intersectsWithRect(r,o)||t.isContainedWithinRect(r,o)||l&&t.containsPoint(r)||l&&t.containsPoint(o))&&(i.push(t),f))););return i.length>1&&(i=i.filter(function(m){return!m.onSelect({e:h})})),i},_maybeGroupObjects:function(h){this.selection&&this._groupSelector&&this._groupSelectedObjects(h),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){d.util.object.extend(d.StaticCanvas.prototype,{toDataURL:function(u){u||(u={});var e=u.format||"png",h=u.quality||1,i=(u.multiplier||1)*(u.enableRetinaScaling?this.getRetinaScaling():1),t=this.toCanvasElement(i,u);return d.util.toDataURL(t,e,h)},toCanvasElement:function(u,e){u=u||1,e=e||{};var h=(e.width||this.width)*u,i=(e.height||this.height)*u,t=this.getZoom(),s=this.width,n=this.height,c=t*u,a=this.viewportTransform,r=(a[4]-(e.left||0))*u,o=(a[5]-(e.top||0))*u,l=this.interactive,f=[c,0,0,c,r,o],g=this.enableRetinaScaling,m=d.util.createCanvasElement(),v=this.contextTop;return m.width=h,m.height=i,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=f,this.width=h,this.height=i,this.calcViewportBoundaries(),this.renderCanvas(m.getContext("2d"),this._objects),this.viewportTransform=a,this.width=s,this.height=n,this.calcViewportBoundaries(),this.interactive=l,this.enableRetinaScaling=g,this.contextTop=v,m}})}(),d.util.object.extend(d.StaticCanvas.prototype,{loadFromDatalessJSON:function(u,e,h){return this.loadFromJSON(u,e,h)},loadFromJSON:function(u,e,h){if(!!u){var i=typeof u=="string"?JSON.parse(u):d.util.object.clone(u),t=this,s=i.clipPath,n=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete i.clipPath,this._enlivenObjects(i.objects,function(c){t.clear(),t._setBgOverlay(i,function(){s?t._enlivenObjects([s],function(a){t.clipPath=a[0],t.__setupCanvas.call(t,i,c,n,e)}):t.__setupCanvas.call(t,i,c,n,e)})},h),this}},__setupCanvas:function(u,e,h,i){var t=this;e.forEach(function(s,n){t.insertAt(s,n)}),this.renderOnAddRemove=h,delete u.objects,delete u.backgroundImage,delete u.overlayImage,delete u.background,delete u.overlay,this._setOptions(u),this.renderAll(),i&&i()},_setBgOverlay:function(u,e){var h={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!u.backgroundImage&&!u.overlayImage&&!u.background&&!u.overlay){e&&e();return}var i=function(){h.backgroundImage&&h.overlayImage&&h.backgroundColor&&h.overlayColor&&e&&e()};this.__setBgOverlay("backgroundImage",u.backgroundImage,h,i),this.__setBgOverlay("overlayImage",u.overlayImage,h,i),this.__setBgOverlay("backgroundColor",u.background,h,i),this.__setBgOverlay("overlayColor",u.overlay,h,i)},__setBgOverlay:function(u,e,h,i){var t=this;if(!e){h[u]=!0,i&&i();return}u==="backgroundImage"||u==="overlayImage"?d.util.enlivenObjects([e],function(s){t[u]=s[0],h[u]=!0,i&&i()}):this["set"+d.util.string.capitalize(u,!0)](e,function(){h[u]=!0,i&&i()})},_enlivenObjects:function(u,e,h){if(!u||u.length===0){e&&e([]);return}d.util.enlivenObjects(u,function(i){e&&e(i)},null,h)},_toDataURL:function(u,e){this.clone(function(h){e(h.toDataURL(u))})},_toDataURLWithMultiplier:function(u,e,h){this.clone(function(i){h(i.toDataURLWithMultiplier(u,e))})},clone:function(u,e){var h=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(i){i.loadFromJSON(h,function(){u&&u(i)})})},cloneWithoutData:function(u){var e=d.util.createCanvasElement();e.width=this.width,e.height=this.height;var h=new d.Canvas(e);h.clipTo=this.clipTo,this.backgroundImage?(h.setBackgroundImage(this.backgroundImage.src,function(){h.renderAll(),u&&u(h)}),h.backgroundImageOpacity=this.backgroundImageOpacity,h.backgroundImageStretch=this.backgroundImageStretch):u&&u(h)}}),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,i=e.util.object.clone,t=e.util.toFixed,s=e.util.string.capitalize,n=e.util.degreesToRadians,c=e.StaticCanvas.supports("setLineDash"),a=!e.isLikelyNode,r=2;e.Object||(e.Object=e.util.createClass(e.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:a,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(o){o&&this.setOptions(o)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=e.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(o){var l=e.perfLimitSizeTotal,f=o.width,g=o.height,m=e.maxCacheSideLimit,v=e.minCacheSideLimit;if(f<=m&&g<=m&&f*g<=l)return f<v&&(o.width=v),g<v&&(o.height=v),o;var p=f/g,_=e.util.limitDimsByArea(p,l),C=e.util.capValue,y=C(v,_.x,m),S=C(v,_.y,m);return f>y&&(o.zoomX/=f/y,o.width=y,o.capped=!0),g>S&&(o.zoomY/=g/S,o.height=S,o.capped=!0),o},_getCacheCanvasDimensions:function(){var o=this.getTotalObjectScaling(),l=this._getTransformedDimensions(0,0),f=l.x*o.scaleX/this.scaleX,g=l.y*o.scaleY/this.scaleY;return{width:f+r,height:g+r,zoomX:o.scaleX,zoomY:o.scaleY,x:f,y:g}},_updateCacheCanvas:function(){var o=this.canvas;if(this.noScaleCache&&o&&o._currentTransform){var l=o._currentTransform.target,f=o._currentTransform.action;if(this===l&&f.slice&&f.slice(0,5)==="scale")return!1}var g=this._cacheCanvas,m=this._limitCacheSize(this._getCacheCanvasDimensions()),v=e.minCacheSideLimit,p=m.width,_=m.height,C,y,S=m.zoomX,x=m.zoomY,O=p!==this.cacheWidth||_!==this.cacheHeight,E=this.zoomX!==S||this.zoomY!==x,L=O||E,B=0,Y=0,U=!1;if(O){var b=this._cacheCanvas.width,k=this._cacheCanvas.height,P=p>b||_>k,M=(p<b*.9||_<k*.9)&&b>v&&k>v;U=P||M,P&&!m.capped&&(p>v||_>v)&&(B=p*.1,Y=_*.1)}return L?(U?(g.width=Math.ceil(p+B),g.height=Math.ceil(_+Y)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,g.width,g.height)),C=m.x/2,y=m.y/2,this.cacheTranslationX=Math.round(g.width/2-C)+C,this.cacheTranslationY=Math.round(g.height/2-y)+y,this.cacheWidth=p,this.cacheHeight=_,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(S,x),this.zoomX=S,this.zoomY=x,!0):!1},setOptions:function(o){this._setOptions(o),this._initGradient(o.fill,"fill"),this._initGradient(o.stroke,"stroke"),this._initClipping(o),this._initPattern(o.fill,"fill"),this._initPattern(o.stroke,"stroke")},transform:function(o){var l;this.group&&!this.group._transformDone?l=this.calcTransformMatrix():l=this.calcOwnMatrix(),o.transform(l[0],l[1],l[2],l[3],l[4],l[5])},toObject:function(o){var l=e.Object.NUM_FRACTION_DIGITS,f={type:this.type,version:e.version,originX:this.originX,originY:this.originY,left:t(this.left,l),top:t(this.top,l),width:t(this.width,l),height:t(this.height,l),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:t(this.strokeWidth,l),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:t(this.strokeMiterLimit,l),scaleX:t(this.scaleX,l),scaleY:t(this.scaleY,l),angle:t(this.angle,l),flipX:this.flipX,flipY:this.flipY,opacity:t(this.opacity,l),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:t(this.skewX,l),skewY:t(this.skewY,l)};return this.clipPath&&(f.clipPath=this.clipPath.toObject(o),f.clipPath.inverted=this.clipPath.inverted,f.clipPath.absolutePositioned=this.clipPath.absolutePositioned),e.util.populateWithProperties(this,f,o),this.includeDefaultValues||(f=this._removeDefaultValues(f)),f},toDatalessObject:function(o){return this.toObject(o)},_removeDefaultValues:function(o){var l=e.util.getKlass(o.type).prototype,f=l.stateProperties;return f.forEach(function(g){if(!(g==="left"||g==="top")){o[g]===l[g]&&delete o[g];var m=Object.prototype.toString.call(o[g])==="[object Array]"&&Object.prototype.toString.call(l[g])==="[object Array]";m&&o[g].length===0&&l[g].length===0&&delete o[g]}}),o},toString:function(){return"#<fabric."+s(this.type)+">"},getObjectScaling:function(){var o=e.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(o.scaleX),scaleY:Math.abs(o.scaleY)}},getTotalObjectScaling:function(){var o=this.getObjectScaling(),l=o.scaleX,f=o.scaleY;if(this.canvas){var g=this.canvas.getZoom(),m=this.canvas.getRetinaScaling();l*=g*m,f*=g*m}return{scaleX:l,scaleY:f}},getObjectOpacity:function(){var o=this.opacity;return this.group&&(o*=this.group.getObjectOpacity()),o},_set:function(o,l){var f=o==="scaleX"||o==="scaleY",g=this[o]!==l,m=!1;return f&&(l=this._constrainScale(l)),o==="scaleX"&&l<0?(this.flipX=!this.flipX,l*=-1):o==="scaleY"&&l<0?(this.flipY=!this.flipY,l*=-1):o==="shadow"&&l&&!(l instanceof e.Shadow)?l=new e.Shadow(l):o==="dirty"&&this.group&&this.group.set("dirty",l),this[o]=l,g&&(m=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(o)>-1?(this.dirty=!0,m&&this.group.set("dirty",!0)):m&&this.stateProperties.indexOf(o)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:e.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||this.width===0&&this.height===0&&this.strokeWidth===0||!this.visible},render:function(o){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(o.save(),this._setupCompositeOperation(o),this.drawSelectionBackground(o),this.transform(o),this._setOpacity(o),this._setShadow(o,this),this.transformMatrix&&o.transform.apply(o,this.transformMatrix),this.clipTo&&e.util.clipContext(this,o),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(o)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(o),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&o.restore(),o.restore())},renderCache:function(o){o=o||{},this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,o.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(o){var l=this.clipPath;if(o.save(),l.inverted?o.globalCompositeOperation="destination-out":o.globalCompositeOperation="destination-in",l.absolutePositioned){var f=e.util.invertTransform(this.calcTransformMatrix());o.transform(f[0],f[1],f[2],f[3],f[4],f[5])}l.transform(o),o.scale(1/l.zoomX,1/l.zoomY),o.drawImage(l._cacheCanvas,-l.cacheTranslationX,-l.cacheTranslationY),o.restore()},drawObject:function(o,l){var f=this.fill,g=this.stroke;l?(this.fill="black",this.stroke="",this._setClippingProperties(o)):(this._renderBackground(o),this._setStrokeStyles(o,this),this._setFillStyles(o,this)),this._render(o),this._drawClipPath(o),this.fill=f,this.stroke=g},_drawClipPath:function(o){var l=this.clipPath;!l||(l.canvas=this.canvas,l.shouldCache(),l._transformDone=!0,l.renderCache({forClipping:!0}),this.drawClipPathOnCache(o))},drawCacheOnCanvas:function(o){o.scale(1/this.zoomX,1/this.zoomY),o.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(o){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!o&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!o){var l=this.cacheWidth/this.zoomX,f=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-l/2,-f/2,l,f)}return!0}return!1},_renderBackground:function(o){if(!!this.backgroundColor){var l=this._getNonTransformedDimensions();o.fillStyle=this.backgroundColor,o.fillRect(-l.x/2,-l.y/2,l.x,l.y),this._removeShadow(o)}},_setOpacity:function(o){this.group&&!this.group._transformDone?o.globalAlpha=this.getObjectOpacity():o.globalAlpha*=this.opacity},_setStrokeStyles:function(o,l){l.stroke&&(o.lineWidth=l.strokeWidth,o.lineCap=l.strokeLineCap,o.lineDashOffset=l.strokeDashOffset,o.lineJoin=l.strokeLineJoin,o.miterLimit=l.strokeMiterLimit,o.strokeStyle=l.stroke.toLive?l.stroke.toLive(o,this):l.stroke)},_setFillStyles:function(o,l){l.fill&&(o.fillStyle=l.fill.toLive?l.fill.toLive(o,this):l.fill)},_setClippingProperties:function(o){o.globalAlpha=1,o.strokeStyle="transparent",o.fillStyle="#000000"},_setLineDash:function(o,l,f){!l||l.length===0||(1&l.length&&l.push.apply(l,l),c?o.setLineDash(l):f&&f(o))},_renderControls:function(o,l){var f=this.getViewportTransform(),g=this.calcTransformMatrix(),m,v,p;l=l||{},v=typeof l.hasBorders<"u"?l.hasBorders:this.hasBorders,p=typeof l.hasControls<"u"?l.hasControls:this.hasControls,g=e.util.multiplyTransformMatrices(f,g),m=e.util.qrDecompose(g),o.save(),o.translate(m.translateX,m.translateY),o.lineWidth=1*this.borderScaleFactor,this.group||(o.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),l.forActiveSelection?(o.rotate(n(m.angle)),v&&this.drawBordersInGroup(o,m,l)):(o.rotate(n(this.angle)),v&&this.drawBorders(o,l)),p&&this.drawControls(o,l),o.restore()},_setShadow:function(o){if(!!this.shadow){var l=this.shadow,f=this.canvas,g,m=f&&f.viewportTransform[0]||1,v=f&&f.viewportTransform[3]||1;l.nonScaling?g={scaleX:1,scaleY:1}:g=this.getObjectScaling(),f&&f._isRetinaScaling()&&(m*=e.devicePixelRatio,v*=e.devicePixelRatio),o.shadowColor=l.color,o.shadowBlur=l.blur*e.browserShadowBlurConstant*(m+v)*(g.scaleX+g.scaleY)/4,o.shadowOffsetX=l.offsetX*m*g.scaleX,o.shadowOffsetY=l.offsetY*v*g.scaleY}},_removeShadow:function(o){!this.shadow||(o.shadowColor="",o.shadowBlur=o.shadowOffsetX=o.shadowOffsetY=0)},_applyPatternGradientTransform:function(o,l){if(!l||!l.toLive)return{offsetX:0,offsetY:0};var f=l.gradientTransform||l.patternTransform,g=-this.width/2+l.offsetX||0,m=-this.height/2+l.offsetY||0;return l.gradientUnits==="percentage"?o.transform(this.width,0,0,this.height,g,m):o.transform(1,0,0,1,g,m),f&&o.transform(f[0],f[1],f[2],f[3],f[4],f[5]),{offsetX:g,offsetY:m}},_renderPaintInOrder:function(o){this.paintFirst==="stroke"?(this._renderStroke(o),this._renderFill(o)):(this._renderFill(o),this._renderStroke(o))},_render:function(){},_renderFill:function(o){!this.fill||(o.save(),this._applyPatternGradientTransform(o,this.fill),this.fillRule==="evenodd"?o.fill("evenodd"):o.fill(),o.restore())},_renderStroke:function(o){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(o),o.save(),this.strokeUniform&&this.group){var l=this.getObjectScaling();o.scale(1/l.scaleX,1/l.scaleY)}else this.strokeUniform&&o.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(o,this.strokeDashArray,this._renderDashedStroke),this.stroke.toLive&&this.stroke.gradientUnits==="percentage"?this._applyPatternForTransformedGradient(o,this.stroke):this._applyPatternGradientTransform(o,this.stroke),o.stroke(),o.restore()}},_applyPatternForTransformedGradient:function(o,l){var f=this._limitCacheSize(this._getCacheCanvasDimensions()),g=e.util.createCanvasElement(),m,v=this.canvas.getRetinaScaling(),p=f.x/this.scaleX/v,_=f.y/this.scaleY/v;g.width=p,g.height=_,m=g.getContext("2d"),m.beginPath(),m.moveTo(0,0),m.lineTo(p,0),m.lineTo(p,_),m.lineTo(0,_),m.closePath(),m.translate(p/2,_/2),m.scale(f.zoomX/this.scaleX/v,f.zoomY/this.scaleY/v),this._applyPatternGradientTransform(m,l),m.fillStyle=l.toLive(o),m.fill(),o.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),o.scale(v*this.scaleX/f.zoomX,v*this.scaleY/f.zoomY),o.strokeStyle=m.createPattern(g,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var o=e.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",o.scaleX),this.set("scaleY",o.scaleY),this.angle=o.angle,this.skewX=o.skewX,this.skewY=0}},_removeTransformMatrix:function(o){var l=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),l=e.util.transformPoint(l,this.transformMatrix)),this.transformMatrix=null,o&&(this.scaleX*=o.scaleX,this.scaleY*=o.scaleY,this.cropX=o.cropX,this.cropY=o.cropY,l.x+=o.offsetLeft,l.y+=o.offsetTop,this.width=o.width,this.height=o.height),this.setPositionByOrigin(l,"center","center")},clone:function(o,l){var f=this.toObject(l);this.constructor.fromObject?this.constructor.fromObject(f,o):e.Object._fromObject("Object",f,o)},cloneAsImage:function(o,l){var f=this.toCanvasElement(l);return o&&o(new e.Image(f)),this},toCanvasElement:function(o){o||(o={});var l=e.util,f=l.saveObjectTransform(this),g=this.group,m=this.shadow,v=Math.abs,p=(o.multiplier||1)*(o.enableRetinaScaling?e.devicePixelRatio:1);delete this.group,o.withoutTransform&&l.resetObjectTransform(this),o.withoutShadow&&(this.shadow=null);var _=e.util.createCanvasElement(),C=this.getBoundingRect(!0,!0),y=this.shadow,S,x={x:0,y:0},O,E,L;y&&(O=y.blur,y.nonScaling?S={scaleX:1,scaleY:1}:S=this.getObjectScaling(),x.x=2*Math.round(v(y.offsetX)+O)*v(S.scaleX),x.y=2*Math.round(v(y.offsetY)+O)*v(S.scaleY)),E=C.width+x.x,L=C.height+x.y,_.width=Math.ceil(E),_.height=Math.ceil(L);var B=new e.StaticCanvas(_,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});o.format==="jpeg"&&(B.backgroundColor="#fff"),this.setPositionByOrigin(new e.Point(B.width/2,B.height/2),"center","center");var Y=this.canvas;B.add(this);var U=B.toCanvasElement(p||1,o);return this.shadow=m,this.set("canvas",Y),g&&(this.group=g),this.set(f).setCoords(),B._objects=[],B.dispose(),B=null,U},toDataURL:function(o){return o||(o={}),e.util.toDataURL(this.toCanvasElement(o),o.format||"png",o.quality||1)},isType:function(o){return this.type===o},complexity:function(){return 1},toJSON:function(o){return this.toObject(o)},setGradient:function(o,l){l||(l={});var f={colorStops:[]};return f.type=l.type||(l.r1||l.r2?"radial":"linear"),f.coords={x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2},f.gradientUnits=l.gradientUnits||"pixels",(l.r1||l.r2)&&(f.coords.r1=l.r1,f.coords.r2=l.r2),f.gradientTransform=l.gradientTransform,e.Gradient.prototype.addColorStop.call(f,l.colorStops),this.set(o,e.Gradient.forObject(this,f))},setPatternFill:function(o,l){return this.set("fill",new e.Pattern(o,l))},setShadow:function(o){return this.set("shadow",o?new e.Shadow(o):null)},setColor:function(o){return this.set("fill",o),this},rotate:function(o){var l=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return l&&this._setOriginToCenter(),this.set("angle",o),l&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(o,l){l=l||this.canvas.getPointer(o);var f=new e.Point(l.x,l.y),g=this._getLeftTopCoords();return this.angle&&(f=e.util.rotatePoint(f,g,n(-this.angle))),{x:f.x-g.x,y:f.y-g.y}},_setupCompositeOperation:function(o){this.globalCompositeOperation&&(o.globalCompositeOperation=this.globalCompositeOperation)}}),e.util.createAccessors&&e.util.createAccessors(e.Object),h(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object._fromObject=function(o,l,f,g){var m=e[o];l=i(l,!0),e.util.enlivenPatterns([l.fill,l.stroke],function(v){typeof v[0]<"u"&&(l.fill=v[0]),typeof v[1]<"u"&&(l.stroke=v[1]),e.util.enlivenObjects([l.clipPath],function(p){l.clipPath=p[0];var _=g?new m(l[g],l):new m(l);f&&f(_)})})},e.Object.__uid=0)}(W),function(){var u=d.util.degreesToRadians,e={left:-.5,center:0,right:.5},h={top:-.5,center:0,bottom:.5};d.util.object.extend(d.Object.prototype,{translateToGivenOrigin:function(i,t,s,n,c){var a=i.x,r=i.y,o,l,f;return typeof t=="string"?t=e[t]:t-=.5,typeof n=="string"?n=e[n]:n-=.5,o=n-t,typeof s=="string"?s=h[s]:s-=.5,typeof c=="string"?c=h[c]:c-=.5,l=c-s,(o||l)&&(f=this._getTransformedDimensions(),a=i.x+o*f.x,r=i.y+l*f.y),new d.Point(a,r)},translateToCenterPoint:function(i,t,s){var n=this.translateToGivenOrigin(i,t,s,"center","center");return this.angle?d.util.rotatePoint(n,i,u(this.angle)):n},translateToOriginPoint:function(i,t,s){var n=this.translateToGivenOrigin(i,"center","center",t,s);return this.angle?d.util.rotatePoint(n,i,u(this.angle)):n},getCenterPoint:function(){var i=new d.Point(this.left,this.top);return this.translateToCenterPoint(i,this.originX,this.originY)},getPointByOrigin:function(i,t){var s=this.getCenterPoint();return this.translateToOriginPoint(s,i,t)},toLocalPoint:function(i,t,s){var n=this.getCenterPoint(),c,a;return typeof t<"u"&&typeof s<"u"?c=this.translateToGivenOrigin(n,"center","center",t,s):c=new d.Point(this.left,this.top),a=new d.Point(i.x,i.y),this.angle&&(a=d.util.rotatePoint(a,n,-u(this.angle))),a.subtractEquals(c)},setPositionByOrigin:function(i,t,s){var n=this.translateToCenterPoint(i,t,s),c=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",c.x),this.set("top",c.y)},adjustPosition:function(i){var t=u(this.angle),s=this.getScaledWidth(),n=d.util.cos(t)*s,c=d.util.sin(t)*s,a,r;typeof this.originX=="string"?a=e[this.originX]:a=this.originX-.5,typeof i=="string"?r=e[i]:r=i-.5,this.left+=n*(r-a),this.top+=c*(r-a),this.setCoords(),this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var i=this.getCenterPoint();this.originX="center",this.originY="center",this.left=i.x,this.top=i.y},_resetOrigin:function(){var i=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=i.x,this.top=i.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function u(t){return[new d.Point(t.tl.x,t.tl.y),new d.Point(t.tr.x,t.tr.y),new d.Point(t.br.x,t.br.y),new d.Point(t.bl.x,t.bl.y)]}var e=d.util.degreesToRadians,h=d.util.multiplyTransformMatrices,i=d.util.transformPoint;d.util.object.extend(d.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(t,s){this.oCoords||this.setCoords();var n=t?this.aCoords:this.oCoords;return u(s?this.calcCoords(t):n)},intersectsWithRect:function(t,s,n,c){var a=this.getCoords(n,c),r=d.Intersection.intersectPolygonRectangle(a,t,s);return r.status==="Intersection"},intersectsWithObject:function(t,s,n){var c=d.Intersection.intersectPolygonPolygon(this.getCoords(s,n),t.getCoords(s,n));return c.status==="Intersection"||t.isContainedWithinObject(this,s,n)||this.isContainedWithinObject(t,s,n)},isContainedWithinObject:function(t,s,n){for(var c=this.getCoords(s,n),a=0,r=t._getImageLines(n?t.calcCoords(s):s?t.aCoords:t.oCoords);a<4;a++)if(!t.containsPoint(c[a],r))return!1;return!0},isContainedWithinRect:function(t,s,n,c){var a=this.getBoundingRect(n,c);return a.left>=t.x&&a.left+a.width<=s.x&&a.top>=t.y&&a.top+a.height<=s.y},containsPoint:function(t,a,n,c){var a=a||this._getImageLines(c?this.calcCoords(n):n?this.aCoords:this.oCoords),r=this._findCrossPoints(t,a);return r!==0&&r%2===1},isOnScreen:function(t){if(!this.canvas)return!1;for(var s=this.canvas.vptCoords.tl,n=this.canvas.vptCoords.br,c=this.getCoords(!0,t),a,r=0;r<4;r++)if(a=c[r],a.x<=n.x&&a.x>=s.x&&a.y<=n.y&&a.y>=s.y)return!0;return this.intersectsWithRect(s,n,!0,t)?!0:this._containsCenterOfCanvas(s,n,t)},_containsCenterOfCanvas:function(t,s,n){var c={x:(t.x+s.x)/2,y:(t.y+s.y)/2};return!!this.containsPoint(c,null,!0,n)},isPartiallyOnScreen:function(t){if(!this.canvas)return!1;var s=this.canvas.vptCoords.tl,n=this.canvas.vptCoords.br;return this.intersectsWithRect(s,n,!0,t)?!0:this._containsCenterOfCanvas(s,n,t)},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,s){var n,c,a,r,o,l=0,f;for(var g in s)if(f=s[g],!(f.o.y<t.y&&f.d.y<t.y)&&!(f.o.y>=t.y&&f.d.y>=t.y)&&(f.o.x===f.d.x&&f.o.x>=t.x?o=f.o.x:(n=0,c=(f.d.y-f.o.y)/(f.d.x-f.o.x),a=t.y-n*t.x,r=f.o.y-c*f.o.x,o=-(a-r)/(n-c)),o>=t.x&&(l+=1),l===2))break;return l},getBoundingRect:function(t,s){var n=this.getCoords(t,s);return d.util.makeBoundingBoxFromPoints(n)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t===0?1e-4:t},scale:function(t){return this._set("scaleX",t),this._set("scaleY",t),this.setCoords()},scaleToWidth:function(t,s){var n=this.getBoundingRect(s).width/this.getScaledWidth();return this.scale(t/this.width/n)},scaleToHeight:function(t,s){var n=this.getBoundingRect(s).height/this.getScaledHeight();return this.scale(t/this.height/n)},calcCoords:function(t){var s=this._calcRotateMatrix(),n=this._calcTranslateMatrix(),c=h(n,s),a=this.getViewportTransform(),r=t?c:h(a,c),o=this._getTransformedDimensions(),l=o.x/2,f=o.y/2,g=i({x:-l,y:-f},r),m=i({x:l,y:-f},r),v=i({x:-l,y:f},r),p=i({x:l,y:f},r);if(!t){var _=this.padding,C=e(this.angle),y=d.util.cos(C),S=d.util.sin(C),x=y*_,O=S*_,E=x+O,L=x-O;_&&(g.x-=L,g.y-=E,m.x+=E,m.y-=L,v.x-=E,v.y+=L,p.x+=L,p.y+=E);var B=new d.Point((g.x+v.x)/2,(g.y+v.y)/2),Y=new d.Point((m.x+g.x)/2,(m.y+g.y)/2),U=new d.Point((p.x+m.x)/2,(p.y+m.y)/2),b=new d.Point((p.x+v.x)/2,(p.y+v.y)/2),k=new d.Point(Y.x+S*this.rotatingPointOffset,Y.y-y*this.rotatingPointOffset)}var P={tl:g,tr:m,br:p,bl:v};return t||(P.ml=B,P.mt=Y,P.mr=U,P.mb=b,P.mtr=k),P},setCoords:function(t,s){return this.oCoords=this.calcCoords(t),s||(this.aCoords=this.calcCoords(!0)),t||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){return d.util.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var t=this.getCenterPoint();return[1,0,0,1,t.x,t.y]},transformMatrixKey:function(t){var s="_",n="";return!t&&this.group&&(n=this.group.transformMatrixKey(t)+s),n+this.top+s+this.left+s+this.scaleX+s+this.scaleY+s+this.skewX+s+this.skewY+s+this.angle+s+this.originX+s+this.originY+s+this.width+s+this.height+s+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(t){if(t)return this.calcOwnMatrix();var s=this.transformMatrixKey(),n=this.matrixCache||(this.matrixCache={});if(n.key===s)return n.value;var c=this.calcOwnMatrix();return this.group&&(c=h(this.group.calcTransformMatrix(),c)),n.key=s,n.value=c,c},calcOwnMatrix:function(){var t=this.transformMatrixKey(!0),s=this.ownMatrixCache||(this.ownMatrixCache={});if(s.key===t)return s.value;var n=this._calcTranslateMatrix();return this.translateX=n[4],this.translateY=n[5],s.key=t,s.value=d.util.composeMatrix(this),s.value},_calcDimensionsTransformMatrix:function(t,s,n){return d.util.calcDimensionsMatrix({skewX:t,skewY:s,scaleX:this.scaleX*(n&&this.flipX?-1:1),scaleY:this.scaleY*(n&&this.flipY?-1:1)})},_getNonTransformedDimensions:function(){var t=this.strokeWidth,s=this.width+t,n=this.height+t;return{x:s,y:n}},_getTransformedDimensions:function(t,s){typeof t>"u"&&(t=this.skewX),typeof s>"u"&&(s=this.skewY);var n=this._getNonTransformedDimensions(),c,a,r=t===0&&s===0;if(this.strokeUniform?(c=this.width,a=this.height):(c=n.x,a=n.y),r)return this._finalizeDimensions(c*this.scaleX,a*this.scaleY);c/=2,a/=2;var o=[{x:-c,y:-a},{x:c,y:-a},{x:-c,y:a},{x:c,y:a}],l=d.util.calcDimensionsMatrix({scaleX:this.scaleX,scaleY:this.scaleY,skewX:t,skewY:s}),f=d.util.makeBoundingBoxFromPoints(o,l);return this._finalizeDimensions(f.width,f.height)},_finalizeDimensions:function(t,s){return this.strokeUniform?{x:t+this.strokeWidth,y:s+this.strokeWidth}:{x:t,y:s}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),s=this._getTransformedDimensions(),n=d.util.transformPoint(s,t,!0);return n.scalarAdd(2*this.padding)}})}(),d.util.object.extend(d.Object.prototype,{sendToBack:function(){return this.group?d.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?d.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(u){return this.group?d.StaticCanvas.prototype.sendBackwards.call(this.group,this,u):this.canvas&&this.canvas.sendBackwards(this,u),this},bringForward:function(u){return this.group?d.StaticCanvas.prototype.bringForward.call(this.group,this,u):this.canvas&&this.canvas.bringForward(this,u),this},moveTo:function(u){return this.group&&this.group.type!=="activeSelection"?d.StaticCanvas.prototype.moveTo.call(this.group,this,u):this.canvas&&this.canvas.moveTo(this,u),this}}),function(){function u(h,i){if(i){if(i.toLive)return h+": url(#SVGID_"+i.id+"); ";var t=new d.Color(i),s=h+": "+t.toRgb()+"; ",n=t.getAlpha();return n!==1&&(s+=h+"-opacity: "+n.toString()+"; "),s}else return h+": none; "}var e=d.util.toFixed;d.util.object.extend(d.Object.prototype,{getSvgStyles:function(h){var i=this.fillRule?this.fillRule:"nonzero",t=this.strokeWidth?this.strokeWidth:"0",s=this.strokeDashArray?this.strokeDashArray.join(" "):"none",n=this.strokeDashOffset?this.strokeDashOffset:"0",c=this.strokeLineCap?this.strokeLineCap:"butt",a=this.strokeLineJoin?this.strokeLineJoin:"miter",r=this.strokeMiterLimit?this.strokeMiterLimit:"4",o=typeof this.opacity<"u"?this.opacity:"1",l=this.visible?"":" visibility: hidden;",f=h?"":this.getSvgFilter(),g=u("fill",this.fill),m=u("stroke",this.stroke);return[m,"stroke-width: ",t,"; ","stroke-dasharray: ",s,"; ","stroke-linecap: ",c,"; ","stroke-dashoffset: ",n,"; ","stroke-linejoin: ",a,"; ","stroke-miterlimit: ",r,"; ",g,"fill-rule: ",i,"; ","opacity: ",o,";",f,l].join("")},getSvgSpanStyles:function(h,i){var t="; ",n=h.fontFamily?"font-family: "+(h.fontFamily.indexOf("'")===-1&&h.fontFamily.indexOf('"')===-1?"'"+h.fontFamily+"'":h.fontFamily)+t:"",s=h.strokeWidth?"stroke-width: "+h.strokeWidth+t:"",n=n,c=h.fontSize?"font-size: "+h.fontSize+"px"+t:"",a=h.fontStyle?"font-style: "+h.fontStyle+t:"",r=h.fontWeight?"font-weight: "+h.fontWeight+t:"",o=h.fill?u("fill",h.fill):"",l=h.stroke?u("stroke",h.stroke):"",f=this.getSvgTextDecoration(h),g=h.deltaY?"baseline-shift: "+-h.deltaY+"; ":"";return f&&(f="text-decoration: "+f+t),[l,s,n,c,a,r,f,o,g,i?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(h){return["overline","underline","line-through"].filter(function(i){return h[i.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(h,i){var t=h?this.calcTransformMatrix():this.calcOwnMatrix(),s='transform="'+d.util.matrixToSVG(t);return s+(i||"")+this.getSvgTransformMatrix()+'" '},getSvgTransformMatrix:function(){return this.transformMatrix?" "+d.util.matrixToSVG(this.transformMatrix):""},_setSVGBg:function(h){if(this.backgroundColor){var i=d.Object.NUM_FRACTION_DIGITS;h.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,i),'" y="',e(-this.height/2,i),'" width="',e(this.width,i),'" height="',e(this.height,i),`"></rect>
`)}},toSVG:function(h){return this._createBaseSVGMarkup(this._toSVG(h),{reviver:h})},toClipPathSVG:function(h){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(h),{reviver:h})},_createBaseClipPathSVGMarkup:function(h,i){i=i||{};var t=i.reviver,s=i.additionalTransform||"",n=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),c=h.indexOf("COMMON_PARTS");return h[c]=n,t?t(h.join("")):h.join("")},_createBaseSVGMarkup:function(h,i){i=i||{};var t=i.noStyle,s=i.reviver,n=t?"":'style="'+this.getSvgStyles()+'" ',c=i.withShadow?'style="'+this.getSvgFilter()+'" ':"",a=this.clipPath,r=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",o=a&&a.absolutePositioned,l=this.stroke,f=this.fill,g=this.shadow,m,v=[],p,_=h.indexOf("COMMON_PARTS"),C=i.additionalTransform;return a&&(a.clipPathId="CLIPPATH_"+d.Object.__uid++,p='<clipPath id="'+a.clipPathId+`" >
`+a.toClipPathSVG(s)+`</clipPath>
`),o&&v.push("<g ",c,this.getSvgCommons(),` >
`),v.push("<g ",this.getSvgTransform(!1),o?"":c+this.getSvgCommons(),` >
`),m=[n,r,t?"":this.addPaintOrder()," ",C?'transform="'+C+'" ':""].join(""),h[_]=m,f&&f.toLive&&v.push(f.toSVG(this)),l&&l.toLive&&v.push(l.toSVG(this)),g&&v.push(g.toSVG(this)),a&&v.push(p),v.push(h.join("")),v.push(`</g>
`),o&&v.push(`</g>
`),s?s(v.join("")):v.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var u=d.util.object.extend,e="stateProperties";function h(t,s,n){var c={},a=!0;n.forEach(function(r){c[r]=t[r]}),u(t[s],c,a)}function i(t,s,n){if(t===s)return!0;if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(var c=0,a=t.length;c<a;c++)if(!i(t[c],s[c]))return!1;return!0}else if(t&&typeof t=="object"){var r=Object.keys(t),o;if(!s||typeof s!="object"||!n&&r.length!==Object.keys(s).length)return!1;for(var c=0,a=r.length;c<a;c++)if(o=r[c],o!=="canvas"&&!i(t[o],s[o]))return!1;return!0}}d.util.object.extend(d.Object.prototype,{hasStateChanged:function(t){t=t||e;var s="_"+t;return Object.keys(this[s]).length<this[t].length?!0:!i(this[s],this,!0)},saveState:function(t){var s=t&&t.propertySet||e,n="_"+s;return this[n]?(h(this,n,this[s]),t&&t.stateProperties&&h(this,n,t.stateProperties),this):this.setupState(t)},setupState:function(t){t=t||{};var s=t.propertySet||e;return t.propertySet=s,this["_"+s]={},this.saveState(t),this}})}(),function(){var u=d.util.degreesToRadians;d.util.object.extend(d.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(e){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var h=e.x,i=e.y,t,s;this.__corner=0;for(var n in this.oCoords)if(!!this.isControlVisible(n)&&!(n==="mtr"&&!this.hasRotatingPoint)&&!(this.get("lockUniScaling")&&(n==="mt"||n==="mr"||n==="mb"||n==="ml"))&&(s=this._getImageLines(this.oCoords[n].corner),t=this._findCrossPoints({x:h,y:i},s),t!==0&&t%2===1))return this.__corner=n,n;return!1},_setCornerCoords:function(){var e=this.oCoords,h=u(45-this.angle),i=this.cornerSize*.707106,t=i*d.util.cos(h),s=i*d.util.sin(h),n,c;for(var a in e)n=e[a].x,c=e[a].y,e[a].corner={tl:{x:n-s,y:c-t},tr:{x:n+t,y:c-s},bl:{x:n-t,y:c+s},br:{x:n+s,y:c+t}}},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;e.save();var h=this.getCenterPoint(),i=this._calculateCurrentDimensions(),t=this.canvas.viewportTransform;return e.translate(h.x,h.y),e.scale(1/t[0],1/t[3]),e.rotate(u(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-i.x/2,-i.y/2,i.x,i.y),e.restore(),this},drawBorders:function(e,h){h=h||{};var i=this._calculateCurrentDimensions(),t=this.borderScaleFactor,s=i.x+t,n=i.y+t,c=typeof h.hasRotatingPoint<"u"?h.hasRotatingPoint:this.hasRotatingPoint,a=typeof h.hasControls<"u"?h.hasControls:this.hasControls,r=typeof h.rotatingPointOffset<"u"?h.rotatingPointOffset:this.rotatingPointOffset;if(e.save(),e.strokeStyle=h.borderColor||this.borderColor,this._setLineDash(e,h.borderDashArray||this.borderDashArray,null),e.strokeRect(-s/2,-n/2,s,n),c&&this.isControlVisible("mtr")&&a){var o=-n/2;e.beginPath(),e.moveTo(0,o),e.lineTo(0,o-r),e.stroke()}return e.restore(),this},drawBordersInGroup:function(e,h,i){i=i||{};var t={x:this.width,y:this.height},s=d.util.composeMatrix({scaleX:h.scaleX,scaleY:h.scaleY,skewX:h.skewX}),n=d.util.transformPoint(t,s),c=this.strokeWidth,a=this.borderScaleFactor,r=n.x+c*(this.strokeUniform?this.canvas.getZoom():h.scaleX)+a,o=n.y+c*(this.strokeUniform?this.canvas.getZoom():h.scaleY)+a;return e.save(),this._setLineDash(e,i.borderDashArray||this.borderDashArray,null),e.strokeStyle=i.borderColor||this.borderColor,e.strokeRect(-r/2,-o/2,r,o),e.restore(),this},drawControls:function(e,h){h=h||{};var i=this._calculateCurrentDimensions(),t=i.x,s=i.y,n=h.cornerSize||this.cornerSize,c=-(t+n)/2,a=-(s+n)/2,r=typeof h.transparentCorners<"u"?h.transparentCorners:this.transparentCorners,o=typeof h.hasRotatingPoint<"u"?h.hasRotatingPoint:this.hasRotatingPoint,l=r?"stroke":"fill";return e.save(),e.strokeStyle=e.fillStyle=h.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=h.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,h.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",e,l,c,a,h),this._drawControl("tr",e,l,c+t,a,h),this._drawControl("bl",e,l,c,a+s,h),this._drawControl("br",e,l,c+t,a+s,h),this.get("lockUniScaling")||(this._drawControl("mt",e,l,c+t/2,a,h),this._drawControl("mb",e,l,c+t/2,a+s,h),this._drawControl("mr",e,l,c+t,a+s/2,h),this._drawControl("ml",e,l,c,a+s/2,h)),o&&this._drawControl("mtr",e,l,c+t/2,a-this.rotatingPointOffset,h),e.restore(),this},_drawControl:function(e,h,i,t,s,n){if(n=n||{},!!this.isControlVisible(e)){var c=this.cornerSize,a=!this.transparentCorners&&this.cornerStrokeColor;switch(n.cornerStyle||this.cornerStyle){case"circle":h.beginPath(),h.arc(t+c/2,s+c/2,c/2,0,2*Math.PI,!1),h[i](),a&&h.stroke();break;default:this.transparentCorners||h.clearRect(t,s,c,c),h[i+"Rect"](t,s,c,c),a&&h.strokeRect(t,s,c,c)}}},isControlVisible:function(e){return this._getControlsVisibility()[e]},setControlVisible:function(e,h){return this._getControlsVisibility()[e]=h,this},setControlsVisibility:function(e){e||(e={});for(var h in e)this.setControlVisible(h,e[h]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})}(),d.util.object.extend(d.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(u,e){e=e||{};var h=function(){},i=e.onComplete||h,t=e.onChange||h,s=this;return d.util.animate({startValue:u.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(n){u.set("left",n),s.requestRenderAll(),t()},onComplete:function(){u.setCoords(),i()}}),this},fxCenterObjectV:function(u,e){e=e||{};var h=function(){},i=e.onComplete||h,t=e.onChange||h,s=this;return d.util.animate({startValue:u.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(n){u.set("top",n),s.requestRenderAll(),t()},onComplete:function(){u.setCoords(),i()}}),this},fxRemove:function(u,e){e=e||{};var h=function(){},i=e.onComplete||h,t=e.onChange||h,s=this;return d.util.animate({startValue:u.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(n){u.set("opacity",n),s.requestRenderAll(),t()},onComplete:function(){s.remove(u),i()}}),this}}),d.util.object.extend(d.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var u=[],e,h;for(e in arguments[0])u.push(e);for(var i=0,t=u.length;i<t;i++)e=u[i],h=i!==t-1,this._animate(e,arguments[0][e],arguments[1],h)}else this._animate.apply(this,arguments);return this},_animate:function(u,e,h,i){var t=this,s;e=e.toString(),h?h=d.util.object.clone(h):h={},~u.indexOf(".")&&(s=u.split("."));var n=s?this.get(s[0])[s[1]]:this.get(u);"from"in h||(h.from=n),~e.indexOf("=")?e=n+parseFloat(e.replace("=","")):e=parseFloat(e),d.util.animate({startValue:h.from,endValue:e,byValue:h.by,easing:h.easing,duration:h.duration,abort:h.abort&&function(){return h.abort.call(t)},onChange:function(c,a,r){s?t[s[0]][s[1]]=c:t.set(u,c),!i&&h.onChange&&h.onChange(c,a,r)},onComplete:function(c,a,r){i||(t.setCoords(),h.onComplete&&h.onComplete(c,a,r))}})}}),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,i=e.util.object.clone,t={x1:1,x2:1,y1:1,y2:1},s=e.StaticCanvas.supports("setLineDash");if(e.Line){e.warn("fabric.Line is already defined");return}e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:e.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(c,a){c||(c=[0,0,0,0]),this.callSuper("initialize",a),this.set("x1",c[0]),this.set("y1",c[1]),this.set("x2",c[2]),this.set("y2",c[3]),this._setWidthHeight(a)},_setWidthHeight:function(c){c||(c={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in c?c.left:this._getLeftToOriginX(),this.top="top"in c?c.top:this._getTopToOriginY()},_set:function(c,a){return this.callSuper("_set",c,a),typeof t[c]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:n({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:n({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(c){if(c.beginPath(),!this.strokeDashArray||this.strokeDashArray&&s){var a=this.calcLinePoints();c.moveTo(a.x1,a.y1),c.lineTo(a.x2,a.y2)}c.lineWidth=this.strokeWidth;var r=c.strokeStyle;c.strokeStyle=this.stroke||c.fillStyle,this.stroke&&this._renderStroke(c),c.strokeStyle=r},_renderDashedStroke:function(c){var a=this.calcLinePoints();c.beginPath(),e.util.drawDashedLine(c,a.x1,a.y1,a.x2,a.y2,this.strokeDashArray),c.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(c){return h(this.callSuper("toObject",c),this.calcLinePoints())},_getNonTransformedDimensions:function(){var c=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(c.y-=this.strokeWidth),this.height===0&&(c.x-=this.strokeWidth)),c},calcLinePoints:function(){var c=this.x1<=this.x2?-1:1,a=this.y1<=this.y2?-1:1,r=c*this.width*.5,o=a*this.height*.5,l=c*this.width*-.5,f=a*this.height*-.5;return{x1:r,x2:l,y1:o,y2:f}},_toSVG:function(){var c=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`" />
`]}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(c,a,r){r=r||{};var o=e.parseAttributes(c,e.Line.ATTRIBUTE_NAMES),l=[o.x1||0,o.y1||0,o.x2||0,o.y2||0];a(new e.Line(l,h(o,r)))},e.Line.fromObject=function(c,a){function r(l){delete l.points,a&&a(l)}var o=i(c,!0);o.points=[c.x1,c.y1,c.x2,c.y2],e.Object._fromObject("Line",o,r,"points")};function n(c,a){var r=c.origin,o=c.axis1,l=c.axis2,f=c.dimension,g=a.nearest,m=a.center,v=a.farthest;return function(){switch(this.get(r)){case g:return Math.min(this.get(o),this.get(l));case m:return Math.min(this.get(o),this.get(l))+.5*this.get(f);case v:return Math.max(this.get(o),this.get(l))}}}}(W),function(u){var e=u.fabric||(u.fabric={}),h=Math.PI;if(e.Circle){e.warn("fabric.Circle is already defined.");return}e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:h*2,cacheProperties:e.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(t,s){return this.callSuper("_set",t,s),t==="radius"&&this.setRadius(s),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},_toSVG:function(){var t,s=0,n=0,c=(this.endAngle-this.startAngle)%(2*h);if(c===0)t=["<circle ","COMMON_PARTS",'cx="'+s+'" cy="'+n+'" ','r="',this.radius,`" />
`];else{var a=e.util.cos(this.startAngle)*this.radius,r=e.util.sin(this.startAngle)*this.radius,o=e.util.cos(this.endAngle)*this.radius,l=e.util.sin(this.endAngle)*this.radius,f=c>h?"1":"0";t=['<path d="M '+a+" "+r," A "+this.radius+" "+this.radius," 0 ",+f+" 1"," "+o+" "+l,'" ',"COMMON_PARTS",` />
`]}return t},_render:function(t){t.beginPath(),t.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",t*2).set("height",t*2)}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(t,s){var n=e.parseAttributes(t,e.Circle.ATTRIBUTE_NAMES);if(!i(n))throw new Error("value of `r` attribute is required and can not be negative");n.left=(n.left||0)-n.radius,n.top=(n.top||0)-n.radius,s(new e.Circle(n))};function i(t){return"radius"in t&&t.radius>=0}e.Circle.fromObject=function(t,s){return e.Object._fromObject("Circle",t,s)}}(W),function(u){var e=u.fabric||(u.fabric={});if(e.Triangle){e.warn("fabric.Triangle is already defined");return}e.Triangle=e.util.createClass(e.Object,{type:"triangle",width:100,height:100,_render:function(h){var i=this.width/2,t=this.height/2;h.beginPath(),h.moveTo(-i,t),h.lineTo(0,-t),h.lineTo(i,t),h.closePath(),this._renderPaintInOrder(h)},_renderDashedStroke:function(h){var i=this.width/2,t=this.height/2;h.beginPath(),e.util.drawDashedLine(h,-i,t,0,-t,this.strokeDashArray),e.util.drawDashedLine(h,0,-t,i,t,this.strokeDashArray),e.util.drawDashedLine(h,i,t,-i,t,this.strokeDashArray),h.closePath()},_toSVG:function(){var h=this.width/2,i=this.height/2,t=[-h+" "+i,"0 "+-i,h+" "+i].join(",");return["<polygon ","COMMON_PARTS",'points="',t,'" />']}}),e.Triangle.fromObject=function(h,i){return e.Object._fromObject("Triangle",h,i)}}(W),function(u){var e=u.fabric||(u.fabric={}),h=Math.PI*2;if(e.Ellipse){e.warn("fabric.Ellipse is already defined.");return}e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(i){this.callSuper("initialize",i),this.set("rx",i&&i.rx||0),this.set("ry",i&&i.ry||0)},_set:function(i,t){switch(this.callSuper("_set",i,t),i){case"rx":this.rx=t,this.set("width",t*2);break;case"ry":this.ry=t,this.set("height",t*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(i){return this.callSuper("toObject",["rx","ry"].concat(i))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(i){i.beginPath(),i.save(),i.transform(1,0,0,this.ry/this.rx,0,0),i.arc(0,0,this.rx,0,h,!1),i.restore(),this._renderPaintInOrder(i)}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(i,t){var s=e.parseAttributes(i,e.Ellipse.ATTRIBUTE_NAMES);s.left=(s.left||0)-s.rx,s.top=(s.top||0)-s.ry,t(new e.Ellipse(s))},e.Ellipse.fromObject=function(i,t){return e.Object._fromObject("Ellipse",i,t)}}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend;if(e.Rect){e.warn("fabric.Rect is already defined");return}e.Rect=e.util.createClass(e.Object,{stateProperties:e.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(i){this.callSuper("initialize",i),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(i){var t=this.rx?Math.min(this.rx,this.width/2):0,s=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,c=this.height,a=-this.width/2,r=-this.height/2,o=t!==0||s!==0,l=1-.5522847498;i.beginPath(),i.moveTo(a+t,r),i.lineTo(a+n-t,r),o&&i.bezierCurveTo(a+n-l*t,r,a+n,r+l*s,a+n,r+s),i.lineTo(a+n,r+c-s),o&&i.bezierCurveTo(a+n,r+c-l*s,a+n-l*t,r+c,a+n-t,r+c),i.lineTo(a+t,r+c),o&&i.bezierCurveTo(a+l*t,r+c,a,r+c-l*s,a,r+c-s),i.lineTo(a,r+s),o&&i.bezierCurveTo(a,r+l*s,a+l*t,r,a+t,r),i.closePath(),this._renderPaintInOrder(i)},_renderDashedStroke:function(i){var t=-this.width/2,s=-this.height/2,n=this.width,c=this.height;i.beginPath(),e.util.drawDashedLine(i,t,s,t+n,s,this.strokeDashArray),e.util.drawDashedLine(i,t+n,s,t+n,s+c,this.strokeDashArray),e.util.drawDashedLine(i,t+n,s+c,t,s+c,this.strokeDashArray),e.util.drawDashedLine(i,t,s+c,t,s,this.strokeDashArray),i.closePath()},toObject:function(i){return this.callSuper("toObject",["rx","ry"].concat(i))},_toSVG:function(){var i=-this.width/2,t=-this.height/2;return["<rect ","COMMON_PARTS",'x="',i,'" y="',t,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(i,t,s){if(!i)return t(null);s=s||{};var n=e.parseAttributes(i,e.Rect.ATTRIBUTE_NAMES);n.left=n.left||0,n.top=n.top||0,n.height=n.height||0,n.width=n.width||0;var c=new e.Rect(h(s?e.util.object.clone(s):{},n));c.visible=c.visible&&c.width>0&&c.height>0,t(c)},e.Rect.fromObject=function(i,t){return e.Object._fromObject("Rect",i,t)}}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,i=e.util.array.min,t=e.util.array.max,s=e.util.toFixed;if(e.Polyline){e.warn("fabric.Polyline is already defined");return}e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,cacheProperties:e.Object.prototype.cacheProperties.concat("points"),initialize:function(n,c){c=c||{},this.points=n||[],this.callSuper("initialize",c),this._setPositionDimensions(c)},_setPositionDimensions:function(n){var c=this._calcDimensions(n),a;this.width=c.width,this.height=c.height,n.fromSVG||(a=this.translateToGivenOrigin({x:c.left-this.strokeWidth/2,y:c.top-this.strokeWidth/2},"left","top",this.originX,this.originY)),typeof n.left>"u"&&(this.left=n.fromSVG?c.left:a.x),typeof n.top>"u"&&(this.top=n.fromSVG?c.top:a.y),this.pathOffset={x:c.left+this.width/2,y:c.top+this.height/2}},_calcDimensions:function(){var n=this.points,c=i(n,"x")||0,a=i(n,"y")||0,r=t(n,"x")||0,o=t(n,"y")||0,l=r-c,f=o-a;return{left:c,top:a,width:l,height:f}},toObject:function(n){return h(this.callSuper("toObject",n),{points:this.points.concat()})},_toSVG:function(){for(var n=[],c=this.pathOffset.x,a=this.pathOffset.y,r=e.Object.NUM_FRACTION_DIGITS,o=0,l=this.points.length;o<l;o++)n.push(s(this.points[o].x-c,r),",",s(this.points[o].y-a,r)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',n.join(""),`" />
`]},commonRender:function(n){var c,a=this.points.length,r=this.pathOffset.x,o=this.pathOffset.y;if(!a||isNaN(this.points[a-1].y))return!1;n.beginPath(),n.moveTo(this.points[0].x-r,this.points[0].y-o);for(var l=0;l<a;l++)c=this.points[l],n.lineTo(c.x-r,c.y-o);return!0},_render:function(n){!this.commonRender(n)||this._renderPaintInOrder(n)},_renderDashedStroke:function(n){var c,a;n.beginPath();for(var r=0,o=this.points.length;r<o;r++)c=this.points[r],a=this.points[r+1]||c,e.util.drawDashedLine(n,c.x,c.y,a.x,a.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElementGenerator=function(n){return function(c,a,r){if(!c)return a(null);r||(r={});var o=e.parsePointsAttribute(c.getAttribute("points")),l=e.parseAttributes(c,e[n].ATTRIBUTE_NAMES);l.fromSVG=!0,a(new e[n](o,h(l,r)))}},e.Polyline.fromElement=e.Polyline.fromElementGenerator("Polyline"),e.Polyline.fromObject=function(n,c){return e.Object._fromObject("Polyline",n,c,"points")}}(W),function(u){var e=u.fabric||(u.fabric={});if(e.Polygon){e.warn("fabric.Polygon is already defined");return}e.Polygon=e.util.createClass(e.Polyline,{type:"polygon",_render:function(h){!this.commonRender(h)||(h.closePath(),this._renderPaintInOrder(h))},_renderDashedStroke:function(h){this.callSuper("_renderDashedStroke",h),h.closePath()}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=e.Polyline.fromElementGenerator("Polygon"),e.Polygon.fromObject=function(h,i){return e.Object._fromObject("Polygon",h,i,"points")}}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.array.min,i=e.util.array.max,t=e.util.object.extend,s=Object.prototype.toString,n=e.util.drawArc,c=e.util.toFixed,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},r={m:"l",M:"L"};if(e.Path){e.warn("fabric.Path is already defined");return}e.Path=e.util.createClass(e.Object,{type:"path",path:null,cacheProperties:e.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:e.Object.prototype.stateProperties.concat("path"),initialize:function(o,l){l=l||{},this.callSuper("initialize",l),o||(o=[]);var f=s.call(o)==="[object Array]";this.path=f?o:o.match&&o.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(f||(this.path=this._parsePath()),e.Polyline.prototype._setPositionDimensions.call(this,l))},_renderPathCommands:function(o){var l,f=null,g=0,m=0,v=0,p=0,_=0,C=0,y,S,x=-this.pathOffset.x,O=-this.pathOffset.y;o.beginPath();for(var E=0,L=this.path.length;E<L;++E){switch(l=this.path[E],l[0]){case"l":v+=l[1],p+=l[2],o.lineTo(v+x,p+O);break;case"L":v=l[1],p=l[2],o.lineTo(v+x,p+O);break;case"h":v+=l[1],o.lineTo(v+x,p+O);break;case"H":v=l[1],o.lineTo(v+x,p+O);break;case"v":p+=l[1],o.lineTo(v+x,p+O);break;case"V":p=l[1],o.lineTo(v+x,p+O);break;case"m":v+=l[1],p+=l[2],g=v,m=p,o.moveTo(v+x,p+O);break;case"M":v=l[1],p=l[2],g=v,m=p,o.moveTo(v+x,p+O);break;case"c":y=v+l[5],S=p+l[6],_=v+l[3],C=p+l[4],o.bezierCurveTo(v+l[1]+x,p+l[2]+O,_+x,C+O,y+x,S+O),v=y,p=S;break;case"C":v=l[5],p=l[6],_=l[3],C=l[4],o.bezierCurveTo(l[1]+x,l[2]+O,_+x,C+O,v+x,p+O);break;case"s":y=v+l[3],S=p+l[4],f[0].match(/[CcSs]/)===null?(_=v,C=p):(_=2*v-_,C=2*p-C),o.bezierCurveTo(_+x,C+O,v+l[1]+x,p+l[2]+O,y+x,S+O),_=v+l[1],C=p+l[2],v=y,p=S;break;case"S":y=l[3],S=l[4],f[0].match(/[CcSs]/)===null?(_=v,C=p):(_=2*v-_,C=2*p-C),o.bezierCurveTo(_+x,C+O,l[1]+x,l[2]+O,y+x,S+O),v=y,p=S,_=l[1],C=l[2];break;case"q":y=v+l[3],S=p+l[4],_=v+l[1],C=p+l[2],o.quadraticCurveTo(_+x,C+O,y+x,S+O),v=y,p=S;break;case"Q":y=l[3],S=l[4],o.quadraticCurveTo(l[1]+x,l[2]+O,y+x,S+O),v=y,p=S,_=l[1],C=l[2];break;case"t":y=v+l[1],S=p+l[2],f[0].match(/[QqTt]/)===null?(_=v,C=p):(_=2*v-_,C=2*p-C),o.quadraticCurveTo(_+x,C+O,y+x,S+O),v=y,p=S;break;case"T":y=l[1],S=l[2],f[0].match(/[QqTt]/)===null?(_=v,C=p):(_=2*v-_,C=2*p-C),o.quadraticCurveTo(_+x,C+O,y+x,S+O),v=y,p=S;break;case"a":n(o,v+x,p+O,[l[1],l[2],l[3],l[4],l[5],l[6]+v+x,l[7]+p+O]),v+=l[6],p+=l[7];break;case"A":n(o,v+x,p+O,[l[1],l[2],l[3],l[4],l[5],l[6]+x,l[7]+O]),v=l[6],p=l[7];break;case"z":case"Z":v=g,p=m,o.closePath();break}f=l}},_render:function(o){this._renderPathCommands(o),this._renderPaintInOrder(o)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(o){return t(this.callSuper("toObject",o),{path:this.path.map(function(l){return l.slice()})})},toDatalessObject:function(o){var l=this.toObject(["sourcePath"].concat(o));return l.sourcePath&&delete l.path,l},_toSVG:function(){var o=this.path.map(function(l){return l.join(" ")}).join(" ");return["<path ","COMMON_PARTS",'d="',o,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var o=e.Object.NUM_FRACTION_DIGITS;return" translate("+c(-this.pathOffset.x,o)+", "+c(-this.pathOffset.y,o)+")"},toClipPathSVG:function(o){var l=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:l})},toSVG:function(o){var l=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:l})},complexity:function(){return this.path.length},_parsePath:function(){for(var o=[],l=[],f,g,m=e.rePathCommand,v,p,_=0,C,y=this.path.length;_<y;_++){for(f=this.path[_],p=f.slice(1).trim(),l.length=0;v=m.exec(p);)l.push(v[0]);C=[f.charAt(0)];for(var S=0,x=l.length;S<x;S++)g=parseFloat(l[S]),isNaN(g)||C.push(g);var O=C[0],E=a[O.toLowerCase()],L=r[O]||O;if(C.length-1>E)for(var B=1,Y=C.length;B<Y;B+=E)o.push([O].concat(C.slice(B,B+E))),O=L;else o.push(C)}return o},_calcDimensions:function(){for(var o=[],l=[],f,g=null,m=0,v=0,p=0,_=0,C=0,y=0,S,x,O,E=0,L=this.path.length;E<L;++E){switch(f=this.path[E],f[0]){case"l":p+=f[1],_+=f[2],O=[];break;case"L":p=f[1],_=f[2],O=[];break;case"h":p+=f[1],O=[];break;case"H":p=f[1],O=[];break;case"v":_+=f[1],O=[];break;case"V":_=f[1],O=[];break;case"m":p+=f[1],_+=f[2],m=p,v=_,O=[];break;case"M":p=f[1],_=f[2],m=p,v=_,O=[];break;case"c":S=p+f[5],x=_+f[6],C=p+f[3],y=_+f[4],O=e.util.getBoundsOfCurve(p,_,p+f[1],_+f[2],C,y,S,x),p=S,_=x;break;case"C":C=f[3],y=f[4],O=e.util.getBoundsOfCurve(p,_,f[1],f[2],C,y,f[5],f[6]),p=f[5],_=f[6];break;case"s":S=p+f[3],x=_+f[4],g[0].match(/[CcSs]/)===null?(C=p,y=_):(C=2*p-C,y=2*_-y),O=e.util.getBoundsOfCurve(p,_,C,y,p+f[1],_+f[2],S,x),C=p+f[1],y=_+f[2],p=S,_=x;break;case"S":S=f[3],x=f[4],g[0].match(/[CcSs]/)===null?(C=p,y=_):(C=2*p-C,y=2*_-y),O=e.util.getBoundsOfCurve(p,_,C,y,f[1],f[2],S,x),p=S,_=x,C=f[1],y=f[2];break;case"q":S=p+f[3],x=_+f[4],C=p+f[1],y=_+f[2],O=e.util.getBoundsOfCurve(p,_,C,y,C,y,S,x),p=S,_=x;break;case"Q":C=f[1],y=f[2],O=e.util.getBoundsOfCurve(p,_,C,y,C,y,f[3],f[4]),p=f[3],_=f[4];break;case"t":S=p+f[1],x=_+f[2],g[0].match(/[QqTt]/)===null?(C=p,y=_):(C=2*p-C,y=2*_-y),O=e.util.getBoundsOfCurve(p,_,C,y,C,y,S,x),p=S,_=x;break;case"T":S=f[1],x=f[2],g[0].match(/[QqTt]/)===null?(C=p,y=_):(C=2*p-C,y=2*_-y),O=e.util.getBoundsOfCurve(p,_,C,y,C,y,S,x),p=S,_=x;break;case"a":O=e.util.getBoundsOfArc(p,_,f[1],f[2],f[3],f[4],f[5],f[6]+p,f[7]+_),p+=f[6],_+=f[7];break;case"A":O=e.util.getBoundsOfArc(p,_,f[1],f[2],f[3],f[4],f[5],f[6],f[7]),p=f[6],_=f[7];break;case"z":case"Z":p=m,_=v;break}g=f,O.forEach(function(M){o.push(M.x),l.push(M.y)}),o.push(p),l.push(_)}var B=h(o)||0,Y=h(l)||0,U=i(o)||0,b=i(l)||0,k=U-B,P=b-Y;return{left:B,top:Y,width:k,height:P}}}),e.Path.fromObject=function(o,l){if(typeof o.sourcePath=="string"){var f=o.sourcePath;e.loadSVGFromURL(f,function(g){var m=g[0];m.setOptions(o),l&&l(m)})}else e.Object._fromObject("Path",o,l,"path")},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(o,l,f){var g=e.parseAttributes(o,e.Path.ATTRIBUTE_NAMES);g.fromSVG=!0,l(new e.Path(g.d,t(g,f)))}}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.array.min,i=e.util.array.max;e.Group||(e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(t,s,n){s=s||{},this._objects=[],n&&this.callSuper("initialize",s),this._objects=t||[];for(var c=this._objects.length;c--;)this._objects[c].group=this;if(n)this._updateObjectsACoords();else{var a=s&&s.centerPoint;s.originX!==void 0&&(this.originX=s.originX),s.originY!==void 0&&(this.originY=s.originY),a||this._calcBounds(),this._updateObjectsCoords(a),delete s.centerPoint,this.callSuper("initialize",s)}this.setCoords()},_updateObjectsACoords:function(){for(var t=!0,s=!0,n=this._objects.length;n--;)this._objects[n].setCoords(t,s)},_updateObjectsCoords:function(s){for(var s=s||this.getCenterPoint(),n=this._objects.length;n--;)this._updateObjectCoords(this._objects[n],s)},_updateObjectCoords:function(t,s){var n=t.left,c=t.top,a=!0,r=!0;t.set({left:n-s.x,top:c-s.y}),t.group=this,t.setCoords(a,r)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),t&&(this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){this.dirty=!0,delete t.group},_set:function(t,s){var n=this._objects.length;if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(t,s);if(t==="canvas")for(;n--;)this._objects[n]._set(t,s);e.Object.prototype._set.call(this,t,s)},toObject:function(t){var s=this.includeDefaultValues,n=this._objects.map(function(a){var r=a.includeDefaultValues;a.includeDefaultValues=s;var o=a.toObject(t);return a.includeDefaultValues=r,o}),c=e.Object.prototype.toObject.call(this,t);return c.objects=n,c},toDatalessObject:function(t){var s,n=this.sourcePath;if(n)s=n;else{var c=this.includeDefaultValues;s=this._objects.map(function(r){var o=r.includeDefaultValues;r.includeDefaultValues=c;var l=r.toDatalessObject(t);return r.includeDefaultValues=o,l})}var a=e.Object.prototype.toDatalessObject.call(this,t);return a.objects=s,a},render:function(t){this._transformDone=!0,this.callSuper("render",t),this._transformDone=!1},shouldCache:function(){var t=e.Object.prototype.shouldCache.call(this);if(t){for(var s=0,n=this._objects.length;s<n;s++)if(this._objects[s].willDrawShadow())return this.ownCaching=!1,!1}return t},willDrawShadow:function(){if(e.Object.prototype.willDrawShadow.call(this))return!0;for(var t=0,s=this._objects.length;t<s;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(t){for(var s=0,n=this._objects.length;s<n;s++)this._objects[s].render(t);this._drawClipPath(t)},isCacheDirty:function(t){if(this.callSuper("isCacheDirty",t))return!0;if(!this.statefullCache)return!1;for(var s=0,n=this._objects.length;s<n;s++)if(this._objects[s].isCacheDirty(!0)){if(this._cacheCanvas){var c=this.cacheWidth/this.zoomX,a=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-c/2,-a/2,c,a)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){var s=t.calcTransformMatrix(),n=e.util.qrDecompose(s),c=new e.Point(n.translateX,n.translateY);return t.flipX=!1,t.flipY=!1,t.set("scaleX",n.scaleX),t.set("scaleY",n.scaleY),t.skewX=n.skewX,t.skewY=n.skewY,t.angle=n.angle,t.setPositionByOrigin(c,"center","center"),t},_restoreObjectState:function(t){return this.realizeTransform(t),t.setCoords(),delete t.group,this},destroy:function(){return this._objects.forEach(function(t){t.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(!!this.canvas){var t=this._objects,s=this.canvas;this._objects=[];var n=this.toObject();delete n.objects;var c=new e.ActiveSelection([]);return c.set(n),c.type="activeSelection",s.remove(this),t.forEach(function(a){a.group=c,a.dirty=!0,s.add(a)}),c.canvas=s,c._objects=t,s._activeObject=c,c.setCoords(),c}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var t=!0,s=!0;return this.forEachObject(function(n){n.setCoords(t,s)}),this},_calcBounds:function(t){for(var s=[],n=[],c,a,r=["tr","br","bl","tl"],o=0,l=this._objects.length,f,g=r.length,m=!0;o<l;++o)for(c=this._objects[o],c.setCoords(m),f=0;f<g;f++)a=r[f],s.push(c.oCoords[a].x),n.push(c.oCoords[a].y);this._getBounds(s,n,t)},_getBounds:function(t,s,n){var c=new e.Point(h(t),h(s)),a=new e.Point(i(t),i(s)),r=c.y||0,o=c.x||0,l=a.x-c.x||0,f=a.y-c.y||0;this.width=l,this.height=f,n||this.setPositionByOrigin({x:o,y:r},"left","top")},_toSVG:function(t){for(var s=["<g ","COMMON_PARTS",` >
`],n=0,c=this._objects.length;n<c;n++)s.push("		",this._objects[n].toSVG(t));return s.push(`</g>
`),s},getSvgStyles:function(){var t=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",s=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),s].join("")},toClipPathSVG:function(t){for(var s=[],n=0,c=this._objects.length;n<c;n++)s.push("	",this._objects[n].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(s,{reviver:t})}}),e.Group.fromObject=function(t,s){var n=t.objects,c=e.util.object.clone(t,!0);if(delete c.objects,typeof n=="string"){e.loadSVGFromURL(n,function(a){var r=e.util.groupSVGElements(a,t,n);r.set(c),s&&s(r)});return}e.util.enlivenObjects(n,function(a){e.util.enlivenObjects([t.clipPath],function(r){var o=e.util.object.clone(t,!0);o.clipPath=r[0],delete o.objects,s&&s(new e.Group(a,o,!0))})})})}(W),function(u){var e=u.fabric||(u.fabric={});e.ActiveSelection||(e.ActiveSelection=e.util.createClass(e.Group,{type:"activeSelection",initialize:function(h,i){i=i||{},this._objects=h||[];for(var t=this._objects.length;t--;)this._objects[t].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),e.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var h=this._objects.concat();this._objects=[];var i=e.Object.prototype.toObject.call(this),t=new e.Group([]);if(delete i.type,t.set(i),h.forEach(function(n){n.canvas.remove(n),n.group=t}),t._objects=h,!this.canvas)return t;var s=this.canvas;return s.add(t),s._activeObject=t,t.setCoords(),t},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(h,i,t){h.save(),h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",h,i),t=t||{},typeof t.hasControls>"u"&&(t.hasControls=!1),typeof t.hasRotatingPoint>"u"&&(t.hasRotatingPoint=!1),t.forActiveSelection=!0;for(var s=0,n=this._objects.length;s<n;s++)this._objects[s]._renderControls(h,t);h.restore()}}),e.ActiveSelection.fromObject=function(h,i){e.util.enlivenObjects(h.objects,function(t){delete h.objects,i&&i(new e.ActiveSelection(t,h,!0))})})}(W),function(u){var e=d.util.object.extend;if(u.fabric||(u.fabric={}),u.fabric.Image){d.warn("fabric.Image is already defined.");return}d.Image=d.util.createClass(d.Object,{type:"image",crossOrigin:"",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:d.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,initialize:function(h,i){i||(i={}),this.filters=[],this.cacheKey="texture"+d.Object.__uid++,this.callSuper("initialize",i),this._initElement(h,i)},getElement:function(){return this._element||{}},setElement:function(h,i){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=h,this._originalElement=h,this._initConfig(i),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(h){var i=d.filterBackend;i&&i.evictCachesForKey&&i.evictCachesForKey(h)},dispose:function(){this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(h){d.util.cleanUpJsdomNode(this[h]),this[h]=void 0}.bind(this))},setCrossOrigin:function(h){return this.crossOrigin=h,this._element.crossOrigin=h,this},getOriginalSize:function(){var h=this.getElement();return{width:h.naturalWidth||h.width,height:h.naturalHeight||h.height}},_stroke:function(h){if(!(!this.stroke||this.strokeWidth===0)){var i=this.width/2,t=this.height/2;h.beginPath(),h.moveTo(-i,-t),h.lineTo(i,-t),h.lineTo(i,t),h.lineTo(-i,t),h.lineTo(-i,-t),h.closePath()}},_renderDashedStroke:function(h){var i=-this.width/2,t=-this.height/2,s=this.width,n=this.height;h.save(),this._setStrokeStyles(h,this),h.beginPath(),d.util.drawDashedLine(h,i,t,i+s,t,this.strokeDashArray),d.util.drawDashedLine(h,i+s,t,i+s,t+n,this.strokeDashArray),d.util.drawDashedLine(h,i+s,t+n,i,t+n,this.strokeDashArray),d.util.drawDashedLine(h,i,t+n,i,t,this.strokeDashArray),h.closePath(),h.restore()},toObject:function(h){var i=[];this.filters.forEach(function(s){s&&i.push(s.toObject())});var t=e(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(h)),{src:this.getSrc(),filters:i});return this.resizeFilter&&(t.resizeFilter=this.resizeFilter.toObject()),t},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var h=[],i=[],t,s=-this.width/2,n=-this.height/2,c="";if(this.hasCrop()){var a=d.Object.__uid++;h.push('<clipPath id="imageCrop_'+a+`">
`,'	<rect x="'+s+'" y="'+n+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),c=' clip-path="url(#imageCrop_'+a+')" '}if(i.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',s-this.cropX,'" y="',n-this.cropY,'" width="',this._element.width||this._element.naturalWidth,'" height="',this._element.height||this._element.height,'"',c,`></image>
`),this.stroke||this.strokeDashArray){var r=this.fill;this.fill=null,t=["	<rect ",'x="',s,'" y="',n,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=r}return this.paintFirst!=="fill"?h=h.concat(t,i):h=h.concat(i,t),h},getSrc:function(h){var i=h?this._element:this._originalElement;return i?i.toDataURL?i.toDataURL():this.srcFromAttribute?i.getAttribute("src"):i.src:this.src||""},setSrc:function(h,i,t){return d.util.loadImage(h,function(s){this.setElement(s,t),this._setWidthHeight(),i&&i(this)},this,t&&t.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var h=this.resizeFilter,i=this.minimumScaleTrigger,t=this.getTotalObjectScaling(),s=t.scaleX,n=t.scaleY,c=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!h||s>i&&n>i){this._element=c,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=s,this._lastScaleY=n;return}d.filterBackend||(d.filterBackend=d.initFilterBackend());var a=d.util.createCanvasElement(),r=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,o=c.width,l=c.height;a.width=o,a.height=l,this._element=a,this._lastScaleX=h.scaleX=s,this._lastScaleY=h.scaleY=n,d.filterBackend.applyFilters([h],c,o,l,this._element,r),this._filterScalingX=a.width/this._originalElement.width,this._filterScalingY=a.height/this._originalElement.height},applyFilters:function(h){if(h=h||this.filters||[],h=h.filter(function(c){return c&&!c.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),h.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var i=this._originalElement,t=i.naturalWidth||i.width,s=i.naturalHeight||i.height;if(this._element===this._originalElement){var n=d.util.createCanvasElement();n.width=t,n.height=s,this._element=n,this._filteredEl=n}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,t,s),this._lastScaleX=1,this._lastScaleY=1;return d.filterBackend||(d.filterBackend=d.initFilterBackend()),d.filterBackend.applyFilters(h,this._originalElement,t,s,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(h){this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(h),this._renderPaintInOrder(h)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(h){var i=this._element;if(!!i){var t=this._filterScalingX,s=this._filterScalingY,n=this.width,c=this.height,a=Math.min,r=Math.max,o=r(this.cropX,0),l=r(this.cropY,0),f=i.naturalWidth||i.width,g=i.naturalHeight||i.height,m=o*t,v=l*s,p=a(n*t,f-m),_=a(c*s,g-v),C=-n/2,y=-c/2,S=a(n,f/t-o),x=a(c,g/t-l);i&&h.drawImage(i,m,v,p,_,C,y,S,x)}},_needsResize:function(){var h=this.getTotalObjectScaling();return h.scaleX!==this._lastScaleX||h.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(h,i){this.setElement(d.util.getById(h),i),d.util.addClass(this.getElement(),d.Image.CSS_CANVAS)},_initConfig:function(h){h||(h={}),this.setOptions(h),this._setWidthHeight(h),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(h,i){h&&h.length?d.util.enlivenObjects(h,function(t){i&&i(t)},"fabric.Image.filters"):i&&i()},_setWidthHeight:function(h){h||(h={});var i=this.getElement();this.width=h.width||i.naturalWidth||i.width||0,this.height=h.height||i.naturalHeight||i.height||0},parsePreserveAspectRatioAttribute:function(){var h=d.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,t=this._element.height,s=1,n=1,c=0,a=0,r=0,o=0,l,f=this.width,g=this.height,m={width:f,height:g};return h&&(h.alignX!=="none"||h.alignY!=="none")?(h.meetOrSlice==="meet"&&(s=n=d.util.findScaleToFit(this._element,m),l=(f-i*s)/2,h.alignX==="Min"&&(c=-l),h.alignX==="Max"&&(c=l),l=(g-t*n)/2,h.alignY==="Min"&&(a=-l),h.alignY==="Max"&&(a=l)),h.meetOrSlice==="slice"&&(s=n=d.util.findScaleToCover(this._element,m),l=i-f/s,h.alignX==="Mid"&&(r=l/2),h.alignX==="Max"&&(r=l),l=t-g/n,h.alignY==="Mid"&&(o=l/2),h.alignY==="Max"&&(o=l),i=f/s,t=g/n)):(s=f/i,n=g/t),{width:i,height:t,scaleX:s,scaleY:n,offsetLeft:c,offsetTop:a,cropX:r,cropY:o}}}),d.Image.CSS_CANVAS="canvas-img",d.Image.prototype.getSvgSrc=d.Image.prototype.getSrc,d.Image.fromObject=function(h,i){var t=d.util.object.clone(h);d.util.loadImage(t.src,function(s,n){if(n){i&&i(null,n);return}d.Image.prototype._initFilters.call(t,t.filters,function(c){t.filters=c||[],d.Image.prototype._initFilters.call(t,[t.resizeFilter],function(a){t.resizeFilter=a[0],d.util.enlivenObjects([t.clipPath],function(r){t.clipPath=r[0];var o=new d.Image(s,t);i(o)})})})},null,t.crossOrigin)},d.Image.fromURL=function(h,i,t){d.util.loadImage(h,function(s){i&&i(new d.Image(s,t))},null,t&&t.crossOrigin)},d.Image.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")),d.Image.fromElement=function(h,i,t){var s=d.parseAttributes(h,d.Image.ATTRIBUTE_NAMES);d.Image.fromURL(s["xlink:href"],i,e(t?d.util.object.clone(t):{},s))}}(W),d.util.object.extend(d.Object.prototype,{_getAngleValueForStraighten:function(){var u=this.angle%360;return u>0?Math.round((u-1)/90)*90:Math.round(u/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(u){u=u||{};var e=function(){},h=u.onComplete||e,i=u.onChange||e,t=this;return d.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(s){t.rotate(s),i()},onComplete:function(){t.setCoords(),h()}}),this}}),d.util.object.extend(d.StaticCanvas.prototype,{straightenObject:function(u){return u.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(u){return u.fxStraighten({onChange:this.requestRenderAllBound}),this}}),function(){function u(h,i){var t="precision "+i+` float;
void main(){}`,s=h.createShader(h.FRAGMENT_SHADER);return h.shaderSource(s,t),h.compileShader(s),!!h.getShaderParameter(s,h.COMPILE_STATUS)}d.isWebglSupported=function(h){if(d.isLikelyNode)return!1;h=h||d.WebglFilterBackend.prototype.tileSize;var i=document.createElement("canvas"),t=i.getContext("webgl")||i.getContext("experimental-webgl"),s=!1;if(t){d.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),s=d.maxTextureSize>=h;for(var n=["highp","mediump","lowp"],c=0;c<3;c++)if(u(t,n[c])){d.webGlPrecision=n[c];break}}return this.isSupported=s,s},d.WebglFilterBackend=e;function e(h){h&&h.tileSize&&(this.tileSize=h.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}e.prototype={tileSize:2048,resources:{},setupGLContext:function(h,i){this.dispose(),this.createWebGLCanvas(h,i),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(h,i)},chooseFastestCopyGLTo2DMethod:function(h,i){var t=typeof window.performance<"u",s;try{new ImageData(1,1),s=!0}catch{s=!1}var n=typeof ArrayBuffer<"u",c=typeof Uint8ClampedArray<"u";if(!!(t&&s&&n&&c)){var a=d.util.createCanvasElement(),r=new ArrayBuffer(h*i*4);if(d.forceGLPutImageData){this.imageBuffer=r,this.copyGLTo2D=A;return}var o={imageBuffer:r,destinationWidth:h,destinationHeight:i,targetCanvas:a},l,f,g;a.width=h,a.height=i,l=window.performance.now(),N.call(o,this.gl,o),f=window.performance.now()-l,l=window.performance.now(),A.call(o,this.gl,o),g=window.performance.now()-l,f>g?(this.imageBuffer=r,this.copyGLTo2D=A):this.copyGLTo2D=N}},createWebGLCanvas:function(h,i){var t=d.util.createCanvasElement();t.width=h,t.height=i;var s={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},n=t.getContext("webgl",s);n||(n=t.getContext("experimental-webgl",s)),n&&(n.clearColor(0,0,0,0),this.canvas=t,this.gl=n)},applyFilters:function(h,i,t,s,n,c){var a=this.gl,r;c&&(r=this.getCachedTexture(c,i));var o={originalWidth:i.width||i.originalWidth,originalHeight:i.height||i.originalHeight,sourceWidth:t,sourceHeight:s,destinationWidth:t,destinationHeight:s,context:a,sourceTexture:this.createTexture(a,t,s,!r&&i),targetTexture:this.createTexture(a,t,s),originalTexture:r||this.createTexture(a,t,s,!r&&i),passes:h.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:n},l=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,l),h.forEach(function(f){f&&f.applyTo(o)}),at(o),this.copyGLTo2D(a,o),a.bindTexture(a.TEXTURE_2D,null),a.deleteTexture(o.sourceTexture),a.deleteTexture(o.targetTexture),a.deleteFramebuffer(l),n.getContext("2d").setTransform(1,0,0,1,0,0),o},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(h,i,t,s){var n=h.createTexture();return h.bindTexture(h.TEXTURE_2D,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),s?h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,s):h.texImage2D(h.TEXTURE_2D,0,h.RGBA,i,t,0,h.RGBA,h.UNSIGNED_BYTE,null),n},getCachedTexture:function(h,i){if(this.textureCache[h])return this.textureCache[h];var t=this.createTexture(this.gl,i.width,i.height,i);return this.textureCache[h]=t,t},evictCachesForKey:function(h){this.textureCache[h]&&(this.gl.deleteTexture(this.textureCache[h]),delete this.textureCache[h])},copyGLTo2D:N,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var h=this.gl,i={renderer:"",vendor:""};if(!h)return i;var t=h.getExtension("WEBGL_debug_renderer_info");if(t){var s=h.getParameter(t.UNMASKED_RENDERER_WEBGL),n=h.getParameter(t.UNMASKED_VENDOR_WEBGL);s&&(i.renderer=s.toLowerCase()),n&&(i.vendor=n.toLowerCase())}return this.gpuInfo=i,i}}}();function at(u){var e=u.targetCanvas,h=e.width,i=e.height,t=u.destinationWidth,s=u.destinationHeight;(h!==t||i!==s)&&(e.width=t,e.height=s)}function N(u,e){var h=u.canvas,i=e.targetCanvas,t=i.getContext("2d");t.translate(0,i.height),t.scale(1,-1);var s=h.height-i.height;t.drawImage(h,0,s,i.width,i.height,0,0,i.width,i.height)}function A(u,e){var h=e.targetCanvas,i=h.getContext("2d"),t=e.destinationWidth,s=e.destinationHeight,n=t*s*4,c=new Uint8Array(this.imageBuffer,0,n),a=new Uint8ClampedArray(this.imageBuffer,0,n);u.readPixels(0,0,t,s,u.RGBA,u.UNSIGNED_BYTE,c);var r=new ImageData(a,t,s);i.putImageData(r,0,0)}(function(){var u=function(){};d.Canvas2dFilterBackend=e;function e(){}e.prototype={evictCachesForKey:u,dispose:u,clearWebGLCaches:u,resources:{},applyFilters:function(h,i,t,s,n){var c=n.getContext("2d");c.drawImage(i,0,0,t,s);var a=c.getImageData(0,0,t,s),r=c.getImageData(0,0,t,s),o={sourceWidth:t,sourceHeight:s,imageData:a,originalEl:i,originalImageData:r,canvasEl:n,ctx:c,filterBackend:this};return h.forEach(function(l){l.applyTo(o)}),(o.imageData.width!==t||o.imageData.height!==s)&&(n.width=o.imageData.width,n.height=o.imageData.height),c.putImageData(o.imageData,0,0),o}}})(),d.Image=d.Image||{},d.Image.filters=d.Image.filters||{},d.Image.filters.BaseFilter=d.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(u){u&&this.setOptions(u)},setOptions:function(u){for(var e in u)this[e]=u[e]},createProgram:function(u,e,h){e=e||this.fragmentSource,h=h||this.vertexSource,d.webGlPrecision!=="highp"&&(e=e.replace(/precision highp float/g,"precision "+d.webGlPrecision+" float"));var i=u.createShader(u.VERTEX_SHADER);if(u.shaderSource(i,h),u.compileShader(i),!u.getShaderParameter(i,u.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+u.getShaderInfoLog(i));var t=u.createShader(u.FRAGMENT_SHADER);if(u.shaderSource(t,e),u.compileShader(t),!u.getShaderParameter(t,u.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+u.getShaderInfoLog(t));var s=u.createProgram();if(u.attachShader(s,i),u.attachShader(s,t),u.linkProgram(s),!u.getProgramParameter(s,u.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+u.getProgramInfoLog(s));var n=this.getAttributeLocations(u,s),c=this.getUniformLocations(u,s)||{};return c.uStepW=u.getUniformLocation(s,"uStepW"),c.uStepH=u.getUniformLocation(s,"uStepH"),{program:s,attributeLocations:n,uniformLocations:c}},getAttributeLocations:function(u,e){return{aPosition:u.getAttribLocation(e,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(u,e,h){var i=e.aPosition,t=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,t),u.enableVertexAttribArray(i),u.vertexAttribPointer(i,2,u.FLOAT,!1,0,0),u.bufferData(u.ARRAY_BUFFER,h,u.STATIC_DRAW)},_setupFrameBuffer:function(u){var e=u.context,h,i;u.passes>1?(h=u.destinationWidth,i=u.destinationHeight,(u.sourceWidth!==h||u.sourceHeight!==i)&&(e.deleteTexture(u.targetTexture),u.targetTexture=u.filterBackend.createTexture(e,h,i)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,u.targetTexture,0)):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish())},_swapTextures:function(u){u.passes--,u.pass++;var e=u.targetTexture;u.targetTexture=u.sourceTexture,u.sourceTexture=e},isNeutralState:function(){var u=this.mainParameter,e=d.Image.filters[this.type].prototype;if(u)if(Array.isArray(e[u])){for(var h=e[u].length;h--;)if(this[u][h]!==e[u][h])return!1;return!0}else return e[u]===this[u];else return!1},applyTo:function(u){u.webgl?(this._setupFrameBuffer(u),this.applyToWebGL(u),this._swapTextures(u)):this.applyTo2d(u)},retrieveShader:function(u){return u.programCache.hasOwnProperty(this.type)||(u.programCache[this.type]=this.createProgram(u.context)),u.programCache[this.type]},applyToWebGL:function(u){var e=u.context,h=this.retrieveShader(u);u.pass===0&&u.originalTexture?e.bindTexture(e.TEXTURE_2D,u.originalTexture):e.bindTexture(e.TEXTURE_2D,u.sourceTexture),e.useProgram(h.program),this.sendAttributeData(e,h.attributeLocations,u.aPosition),e.uniform1f(h.uniformLocations.uStepW,1/u.sourceWidth),e.uniform1f(h.uniformLocations.uStepH,1/u.sourceHeight),this.sendUniformData(e,h.uniformLocations),e.viewport(0,0,u.destinationWidth,u.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(u,e,h){u.activeTexture(h),u.bindTexture(u.TEXTURE_2D,e),u.activeTexture(u.TEXTURE0)},unbindAdditionalTexture:function(u,e){u.activeTexture(e),u.bindTexture(u.TEXTURE_2D,null),u.activeTexture(u.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(u){this[this.mainParameter]=u},sendUniformData:function(){},createHelpLayer:function(u){if(!u.helpLayer){var e=document.createElement("canvas");e.width=u.sourceWidth,e.height=u.sourceHeight,u.helpLayer=e}},toObject:function(){var u={type:this.type},e=this.mainParameter;return e&&(u[e]=this[e]),u},toJSON:function(){return this.toObject()}}),d.Image.filters.BaseFilter.fromObject=function(u,e){var h=new d.Image.filters[u.type](u);return e&&e(h),h},function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,i=e.util.createClass;h.ColorMatrix=i(h.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(t){this.callSuper("initialize",t),this.matrix=this.matrix.slice(0)},applyTo2d:function(t){var s=t.imageData,n=s.data,c=n.length,a=this.matrix,r,o,l,f,g,m=this.colorsOnly;for(g=0;g<c;g+=4)r=n[g],o=n[g+1],l=n[g+2],m?(n[g]=r*a[0]+o*a[1]+l*a[2]+a[4]*255,n[g+1]=r*a[5]+o*a[6]+l*a[7]+a[9]*255,n[g+2]=r*a[10]+o*a[11]+l*a[12]+a[14]*255):(f=n[g+3],n[g]=r*a[0]+o*a[1]+l*a[2]+f*a[3]+a[4]*255,n[g+1]=r*a[5]+o*a[6]+l*a[7]+f*a[8]+a[9]*255,n[g+2]=r*a[10]+o*a[11]+l*a[12]+f*a[13]+a[14]*255,n[g+3]=r*a[15]+o*a[16]+l*a[17]+f*a[18]+a[19]*255)},getUniformLocations:function(t,s){return{uColorMatrix:t.getUniformLocation(s,"uColorMatrix"),uConstants:t.getUniformLocation(s,"uConstants")}},sendUniformData:function(t,s){var n=this.matrix,c=[n[0],n[1],n[2],n[3],n[5],n[6],n[7],n[8],n[10],n[11],n[12],n[13],n[15],n[16],n[17],n[18]],a=[n[4],n[9],n[14],n[19]];t.uniformMatrix4fv(s.uColorMatrix,!1,c),t.uniform4fv(s.uConstants,a)}}),e.Image.filters.ColorMatrix.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,i=e.util.createClass;h.Brightness=i(h.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(t){if(this.brightness!==0){var s=t.imageData,n=s.data,c,a=n.length,r=Math.round(this.brightness*255);for(c=0;c<a;c+=4)n[c]=n[c]+r,n[c+1]=n[c+1]+r,n[c+2]=n[c+2]+r}},getUniformLocations:function(t,s){return{uBrightness:t.getUniformLocation(s,"uBrightness")}},sendUniformData:function(t,s){t.uniform1f(s.uBrightness,this.brightness)}}),e.Image.filters.Brightness.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,i=e.Image.filters,t=e.util.createClass;i.Convolute=t(i.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(s){var n=Math.sqrt(this.matrix.length),c=this.type+"_"+n+"_"+(this.opaque?1:0),a=this.fragmentSource[c];return s.programCache.hasOwnProperty(c)||(s.programCache[c]=this.createProgram(s.context,a)),s.programCache[c]},applyTo2d:function(s){var n=s.imageData,c=n.data,a=this.matrix,r=Math.round(Math.sqrt(a.length)),o=Math.floor(r/2),l=n.width,f=n.height,g=s.ctx.createImageData(l,f),m=g.data,v=this.opaque?1:0,p,_,C,y,S,x,O,E,L,B,Y,U,b;for(Y=0;Y<f;Y++)for(B=0;B<l;B++){for(S=(Y*l+B)*4,p=0,_=0,C=0,y=0,b=0;b<r;b++)for(U=0;U<r;U++)O=Y+b-o,x=B+U-o,!(O<0||O>=f||x<0||x>=l)&&(E=(O*l+x)*4,L=a[b*r+U],p+=c[E]*L,_+=c[E+1]*L,C+=c[E+2]*L,v||(y+=c[E+3]*L));m[S]=p,m[S+1]=_,m[S+2]=C,v?m[S+3]=c[S+3]:m[S+3]=y}s.imageData=g},getUniformLocations:function(s,n){return{uMatrix:s.getUniformLocation(n,"uMatrix"),uOpaque:s.getUniformLocation(n,"uOpaque"),uHalfSize:s.getUniformLocation(n,"uHalfSize"),uSize:s.getUniformLocation(n,"uSize")}},sendUniformData:function(s,n){s.uniform1fv(n.uMatrix,this.matrix)},toObject:function(){return h(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,i=e.util.createClass;h.Grayscale=i(h.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(t){var s=t.imageData,n=s.data,c,a=n.length,r,o=this.mode;for(c=0;c<a;c+=4)o==="average"?r=(n[c]+n[c+1]+n[c+2])/3:o==="lightness"?r=(Math.min(n[c],n[c+1],n[c+2])+Math.max(n[c],n[c+1],n[c+2]))/2:o==="luminosity"&&(r=.21*n[c]+.72*n[c+1]+.07*n[c+2]),n[c]=r,n[c+1]=r,n[c+2]=r},retrieveShader:function(t){var s=this.type+"_"+this.mode;if(!t.programCache.hasOwnProperty(s)){var n=this.fragmentSource[this.mode];t.programCache[s]=this.createProgram(t.context,n)}return t.programCache[s]},getUniformLocations:function(t,s){return{uMode:t.getUniformLocation(s,"uMode")}},sendUniformData:function(t,s){var n=1;t.uniform1i(s.uMode,n)},isNeutralState:function(){return!1}}),e.Image.filters.Grayscale.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,i=e.util.createClass;h.Invert=i(h.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(t){var s=t.imageData,n=s.data,c,a=n.length;for(c=0;c<a;c+=4)n[c]=255-n[c],n[c+1]=255-n[c+1],n[c+2]=255-n[c+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(t,s){return{uInvert:t.getUniformLocation(s,"uInvert")}},sendUniformData:function(t,s){t.uniform1i(s.uInvert,this.invert)}}),e.Image.filters.Invert.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,i=e.Image.filters,t=e.util.createClass;i.Noise=t(i.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(s){if(this.noise!==0){var n=s.imageData,c=n.data,a,r=c.length,o=this.noise,l;for(a=0,r=c.length;a<r;a+=4)l=(.5-Math.random())*o,c[a]+=l,c[a+1]+=l,c[a+2]+=l}},getUniformLocations:function(s,n){return{uNoise:s.getUniformLocation(n,"uNoise"),uSeed:s.getUniformLocation(n,"uSeed")}},sendUniformData:function(s,n){s.uniform1f(n.uNoise,this.noise/255),s.uniform1f(n.uSeed,Math.random())},toObject:function(){return h(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,i=e.util.createClass;h.Pixelate=i(h.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(t){var s=t.imageData,n=s.data,c=s.height,a=s.width,r,o,l,f,g,m,v,p,_,C,y;for(o=0;o<c;o+=this.blocksize)for(l=0;l<a;l+=this.blocksize)for(r=o*4*a+l*4,f=n[r],g=n[r+1],m=n[r+2],v=n[r+3],C=Math.min(o+this.blocksize,c),y=Math.min(l+this.blocksize,a),p=o;p<C;p++)for(_=l;_<y;_++)r=p*4*a+_*4,n[r]=f,n[r+1]=g,n[r+2]=m,n[r+3]=v},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(t,s){return{uBlocksize:t.getUniformLocation(s,"uBlocksize"),uStepW:t.getUniformLocation(s,"uStepW"),uStepH:t.getUniformLocation(s,"uStepH")}},sendUniformData:function(t,s){t.uniform1f(s.uBlocksize,this.blocksize)}}),e.Image.filters.Pixelate.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.extend,i=e.Image.filters,t=e.util.createClass;i.RemoveColor=t(i.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(s){var n=s.imageData,c=n.data,a,r=this.distance*255,o,l,f,g=new e.Color(this.color).getSource(),m=[g[0]-r,g[1]-r,g[2]-r],v=[g[0]+r,g[1]+r,g[2]+r];for(a=0;a<c.length;a+=4)o=c[a],l=c[a+1],f=c[a+2],o>m[0]&&l>m[1]&&f>m[2]&&o<v[0]&&l<v[1]&&f<v[2]&&(c[a+3]=0)},getUniformLocations:function(s,n){return{uLow:s.getUniformLocation(n,"uLow"),uHigh:s.getUniformLocation(n,"uHigh")}},sendUniformData:function(s,n){var c=new e.Color(this.color).getSource(),a=parseFloat(this.distance),r=[0+c[0]/255-a,0+c[1]/255-a,0+c[2]/255-a,1],o=[c[0]/255+a,c[1]/255+a,c[2]/255+a,1];s.uniform4fv(n.uLow,r),s.uniform4fv(n.uHigh,o)},toObject:function(){return h(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),e.Image.filters.RemoveColor.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,i=e.util.createClass,t={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var s in t)h[s]=i(h.ColorMatrix,{type:s,matrix:t[s],mainParameter:!1,colorsOnly:!0}),e.Image.filters[s].fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric,h=e.Image.filters,i=e.util.createClass;h.BlendColor=i(h.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(t){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[t]+`}
}`},retrieveShader:function(t){var s=this.type+"_"+this.mode,n;return t.programCache.hasOwnProperty(s)||(n=this.buildSource(this.mode),t.programCache[s]=this.createProgram(t.context,n)),t.programCache[s]},applyTo2d:function(t){var s=t.imageData,n=s.data,c=n.length,a,r,o,l,f,g,m,v=1-this.alpha;m=new e.Color(this.color).getSource(),a=m[0]*this.alpha,r=m[1]*this.alpha,o=m[2]*this.alpha;for(var p=0;p<c;p+=4)switch(l=n[p],f=n[p+1],g=n[p+2],this.mode){case"multiply":n[p]=l*a/255,n[p+1]=f*r/255,n[p+2]=g*o/255;break;case"screen":n[p]=255-(255-l)*(255-a)/255,n[p+1]=255-(255-f)*(255-r)/255,n[p+2]=255-(255-g)*(255-o)/255;break;case"add":n[p]=l+a,n[p+1]=f+r,n[p+2]=g+o;break;case"diff":case"difference":n[p]=Math.abs(l-a),n[p+1]=Math.abs(f-r),n[p+2]=Math.abs(g-o);break;case"subtract":n[p]=l-a,n[p+1]=f-r,n[p+2]=g-o;break;case"darken":n[p]=Math.min(l,a),n[p+1]=Math.min(f,r),n[p+2]=Math.min(g,o);break;case"lighten":n[p]=Math.max(l,a),n[p+1]=Math.max(f,r),n[p+2]=Math.max(g,o);break;case"overlay":n[p]=a<128?2*l*a/255:255-2*(255-l)*(255-a)/255,n[p+1]=r<128?2*f*r/255:255-2*(255-f)*(255-r)/255,n[p+2]=o<128?2*g*o/255:255-2*(255-g)*(255-o)/255;break;case"exclusion":n[p]=a+l-2*a*l/255,n[p+1]=r+f-2*r*f/255,n[p+2]=o+g-2*o*g/255;break;case"tint":n[p]=a+l*v,n[p+1]=r+f*v,n[p+2]=o+g*v}},getUniformLocations:function(t,s){return{uColor:t.getUniformLocation(s,"uColor")}},sendUniformData:function(t,s){var n=new e.Color(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,t.uniform4fv(s.uColor,n)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendColor.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric,h=e.Image.filters,i=e.util.createClass;h.BlendImage=i(h.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(t){var s=this.type+"_"+this.mode,n=this.fragmentSource[this.mode];return t.programCache.hasOwnProperty(s)||(t.programCache[s]=this.createProgram(t.context,n)),t.programCache[s]},applyToWebGL:function(t){var s=t.context,n=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(s,n,s.TEXTURE1),this.callSuper("applyToWebGL",t),this.unbindAdditionalTexture(s,s.TEXTURE1)},createTexture:function(t,s){return t.getCachedTexture(s.cacheKey,s._element)},calculateMatrix:function(){var t=this.image,s=t._element.width,n=t._element.height;return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/s,-t.top/n,1]},applyTo2d:function(t){var s=t.imageData,n=t.filterBackend.resources,c=s.data,a=c.length,r=s.width,o=s.height,l,f,g,m,v,p,_,C,y,S,x=this.image,O;n.blendImage||(n.blendImage=e.util.createCanvasElement()),y=n.blendImage,S=y.getContext("2d"),y.width!==r||y.height!==o?(y.width=r,y.height=o):S.clearRect(0,0,r,o),S.setTransform(x.scaleX,0,0,x.scaleY,x.left,x.top),S.drawImage(x._element,0,0,r,o),O=S.getImageData(0,0,r,o).data;for(var E=0;E<a;E+=4)switch(v=c[E],p=c[E+1],_=c[E+2],C=c[E+3],l=O[E],f=O[E+1],g=O[E+2],m=O[E+3],this.mode){case"multiply":c[E]=v*l/255,c[E+1]=p*f/255,c[E+2]=_*g/255,c[E+3]=C*m/255;break;case"mask":c[E+3]=m;break}},getUniformLocations:function(t,s){return{uTransformMatrix:t.getUniformLocation(s,"uTransformMatrix"),uImage:t.getUniformLocation(s,"uImage")}},sendUniformData:function(t,s){var n=this.calculateMatrix();t.uniform1i(s.uImage,1),t.uniformMatrix3fv(s.uTransformMatrix,!1,n)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendImage.fromObject=function(t,s){e.Image.fromObject(t.image,function(n){var c=e.util.object.clone(t);c.image=n,s(new e.Image.filters.BlendImage(c))})}}(W),function(u){var e=u.fabric||(u.fabric={}),h=Math.pow,i=Math.floor,t=Math.sqrt,s=Math.abs,n=Math.round,c=Math.sin,a=Math.ceil,r=e.Image.filters,o=e.util.createClass;r.Resize=o(r.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(l,f){return{uDelta:l.getUniformLocation(f,"uDelta"),uTaps:l.getUniformLocation(f,"uTaps")}},sendUniformData:function(l,f){l.uniform2fv(f.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),l.uniform1fv(f.uTaps,this.taps)},retrieveShader:function(l){var f=this.getFilterWindow(),g=this.type+"_"+f;if(!l.programCache.hasOwnProperty(g)){var m=this.generateShader(f);l.programCache[g]=this.createProgram(l.context,m)}return l.programCache[g]},getFilterWindow:function(){var l=this.tempScale;return Math.ceil(this.lanczosLobes/l)},getTaps:function(){for(var l=this.lanczosCreate(this.lanczosLobes),f=this.tempScale,g=this.getFilterWindow(),m=new Array(g),v=1;v<=g;v++)m[v-1]=l(v*f);return m},generateShader:function(m){for(var f=new Array(m),g=this.fragmentSourceTOP,m,v=1;v<=m;v++)f[v-1]=v+".0 * uDelta";return g+="uniform float uTaps["+m+`];
`,g+=`void main() {
`,g+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,g+=`  float sum = 1.0;
`,f.forEach(function(p,_){g+="  color += texture2D(uTexture, vTexCoord + "+p+") * uTaps["+_+`];
`,g+="  color += texture2D(uTexture, vTexCoord - "+p+") * uTaps["+_+`];
`,g+="  sum += 2.0 * uTaps["+_+`];
`}),g+=`  gl_FragColor = color / sum;
`,g+="}",g},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(l){l.webgl?(l.passes++,this.width=l.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=l.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),l.destinationWidth=this.dW,this._setupFrameBuffer(l),this.applyToWebGL(l),this._swapTextures(l),l.sourceWidth=l.destinationWidth,this.height=l.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),l.destinationHeight=this.dH,this._setupFrameBuffer(l),this.applyToWebGL(l),this._swapTextures(l),l.sourceHeight=l.destinationHeight):this.applyTo2d(l)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(l){return function(f){if(f>=l||f<=-l)return 0;if(f<11920929e-14&&f>-11920929e-14)return 1;f*=Math.PI;var g=f/l;return c(f)/f*c(g)/g}},applyTo2d:function(l){var f=l.imageData,g=this.scaleX,m=this.scaleY;this.rcpScaleX=1/g,this.rcpScaleY=1/m;var v=f.width,p=f.height,_=n(v*g),C=n(p*m),y;this.resizeType==="sliceHack"?y=this.sliceByTwo(l,v,p,_,C):this.resizeType==="hermite"?y=this.hermiteFastResize(l,v,p,_,C):this.resizeType==="bilinear"?y=this.bilinearFiltering(l,v,p,_,C):this.resizeType==="lanczos"&&(y=this.lanczosResize(l,v,p,_,C)),l.imageData=y},sliceByTwo:function(l,f,g,m,v){var p=l.imageData,_=.5,C=!1,y=!1,S=f*_,x=g*_,O=e.filterBackend.resources,E,L,B=0,Y=0,U=f,b=0;for(O.sliceByTwo||(O.sliceByTwo=document.createElement("canvas")),E=O.sliceByTwo,(E.width<f*1.5||E.height<g)&&(E.width=f*1.5,E.height=g),L=E.getContext("2d"),L.clearRect(0,0,f*1.5,g),L.putImageData(p,0,0),m=i(m),v=i(v);!C||!y;)f=S,g=x,m<i(S*_)?S=i(S*_):(S=m,C=!0),v<i(x*_)?x=i(x*_):(x=v,y=!0),L.drawImage(E,B,Y,f,g,U,b,S,x),B=U,Y=b,b+=x;return L.getImageData(B,Y,m,v)},lanczosResize:function(l,f,g,m,v){function p(P){var M,z,w,T,D,F,R,j,I,X,G;for(b.x=(P+.5)*x,k.x=i(b.x),M=0;M<v;M++){for(b.y=(M+.5)*O,k.y=i(b.y),D=0,F=0,R=0,j=0,I=0,z=k.x-B;z<=k.x+B;z++)if(!(z<0||z>=f)){X=i(1e3*s(z-b.x)),U[X]||(U[X]={});for(var V=k.y-Y;V<=k.y+Y;V++)V<0||V>=g||(G=i(1e3*s(V-b.y)),U[X][G]||(U[X][G]=S(t(h(X*E,2)+h(G*L,2))/1e3)),w=U[X][G],w>0&&(T=(V*f+z)*4,D+=w,F+=w*_[T],R+=w*_[T+1],j+=w*_[T+2],I+=w*_[T+3]))}T=(M*m+P)*4,y[T]=F/D,y[T+1]=R/D,y[T+2]=j/D,y[T+3]=I/D}return++P<m?p(P):C}var _=l.imageData.data,C=l.ctx.createImageData(m,v),y=C.data,S=this.lanczosCreate(this.lanczosLobes),x=this.rcpScaleX,O=this.rcpScaleY,E=2/this.rcpScaleX,L=2/this.rcpScaleY,B=a(x*this.lanczosLobes/2),Y=a(O*this.lanczosLobes/2),U={},b={},k={};return p(0)},bilinearFiltering:function(l,f,g,m,v){var p,_,C,y,S,x,O,E,L,B,Y,U,b=0,k,P=this.rcpScaleX,M=this.rcpScaleY,z=4*(f-1),w=l.imageData,T=w.data,D=l.ctx.createImageData(m,v),F=D.data;for(O=0;O<v;O++)for(E=0;E<m;E++)for(S=i(P*E),x=i(M*O),L=P*E-S,B=M*O-x,k=4*(x*f+S),Y=0;Y<4;Y++)p=T[k+Y],_=T[k+4+Y],C=T[k+z+Y],y=T[k+z+4+Y],U=p*(1-L)*(1-B)+_*L*(1-B)+C*B*(1-L)+y*L*B,F[b++]=U;return D},hermiteFastResize:function(l,f,g,m,v){for(var p=this.rcpScaleX,_=this.rcpScaleY,C=a(p/2),y=a(_/2),S=l.imageData,x=S.data,O=l.ctx.createImageData(m,v),E=O.data,L=0;L<v;L++)for(var B=0;B<m;B++){for(var Y=(B+L*m)*4,U=0,b=0,k=0,P=0,M=0,z=0,w=0,T=(L+.5)*_,D=i(L*_);D<(L+1)*_;D++)for(var F=s(T-(D+.5))/y,R=(B+.5)*p,j=F*F,I=i(B*p);I<(B+1)*p;I++){var X=s(R-(I+.5))/C,G=t(j+X*X);G>1&&G<-1||(U=2*G*G*G-3*G*G+1,U>0&&(X=4*(I+D*f),w+=U*x[X+3],k+=U,x[X+3]<255&&(U=U*x[X+3]/250),P+=U*x[X],M+=U*x[X+1],z+=U*x[X+2],b+=U))}E[Y]=P/b,E[Y+1]=M/b,E[Y+2]=z/b,E[Y+3]=w/k}return O},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,i=e.util.createClass;h.Contrast=i(h.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(t){if(this.contrast!==0){var s=t.imageData,n,a,c=s.data,a=c.length,r=Math.floor(this.contrast*255),o=259*(r+255)/(255*(259-r));for(n=0;n<a;n+=4)c[n]=o*(c[n]-128)+128,c[n+1]=o*(c[n+1]-128)+128,c[n+2]=o*(c[n+2]-128)+128}},getUniformLocations:function(t,s){return{uContrast:t.getUniformLocation(s,"uContrast")}},sendUniformData:function(t,s){t.uniform1f(s.uContrast,this.contrast)}}),e.Image.filters.Contrast.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,i=e.util.createClass;h.Saturation=i(h.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(t){if(this.saturation!==0){var s=t.imageData,n=s.data,c=n.length,a=-this.saturation,r,o;for(r=0;r<c;r+=4)o=Math.max(n[r],n[r+1],n[r+2]),n[r]+=o!==n[r]?(o-n[r])*a:0,n[r+1]+=o!==n[r+1]?(o-n[r+1])*a:0,n[r+2]+=o!==n[r+2]?(o-n[r+2])*a:0}},getUniformLocations:function(t,s){return{uSaturation:t.getUniformLocation(s,"uSaturation")}},sendUniformData:function(t,s){t.uniform1f(s.uSaturation,-this.saturation)}}),e.Image.filters.Saturation.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,i=e.util.createClass;h.Blur=i(h.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(t){t.webgl?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},applyTo2d:function(t){t.imageData=this.simpleBlur(t)},simpleBlur:function(t){var s=t.filterBackend.resources,n,c,a=t.imageData.width,r=t.imageData.height;s.blurLayer1||(s.blurLayer1=e.util.createCanvasElement(),s.blurLayer2=e.util.createCanvasElement()),n=s.blurLayer1,c=s.blurLayer2,(n.width!==a||n.height!==r)&&(c.width=n.width=a,c.height=n.height=r);var o=n.getContext("2d"),l=c.getContext("2d"),f=15,g,m,v,p,_=this.blur*.06*.5;for(o.putImageData(t.imageData,0,0),l.clearRect(0,0,a,r),p=-f;p<=f;p++)g=(Math.random()-.5)/4,m=p/f,v=_*m*a+g,l.globalAlpha=1-Math.abs(m),l.drawImage(n,v,g),o.drawImage(c,0,0),l.globalAlpha=1,l.clearRect(0,0,c.width,c.height);for(p=-f;p<=f;p++)g=(Math.random()-.5)/4,m=p/f,v=_*m*r+g,l.globalAlpha=1-Math.abs(m),l.drawImage(n,g,v),o.drawImage(c,0,0),l.globalAlpha=1,l.clearRect(0,0,c.width,c.height);t.ctx.drawImage(n,0,0);var C=t.ctx.getImageData(0,0,n.width,n.height);return o.globalAlpha=1,o.clearRect(0,0,n.width,n.height),C},getUniformLocations:function(t,s){return{delta:t.getUniformLocation(s,"uDelta")}},sendUniformData:function(t,s){var n=this.chooseRightDelta();t.uniform2fv(s.delta,n)},chooseRightDelta:function(){var t=1,s=[0,0],n;return this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio),n=t*this.blur*.12,this.horizontal?s[0]=n:s[1]=n,s}}),h.Blur.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,i=e.util.createClass;h.Gamma=i(h.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(t){this.gamma=[1,1,1],h.BaseFilter.prototype.initialize.call(this,t)},applyTo2d:function(t){var s=t.imageData,n=s.data,c=this.gamma,a=n.length,r=1/c[0],o=1/c[1],l=1/c[2],f;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),f=0,a=256;f<a;f++)this.rVals[f]=Math.pow(f/255,r)*255,this.gVals[f]=Math.pow(f/255,o)*255,this.bVals[f]=Math.pow(f/255,l)*255;for(f=0,a=n.length;f<a;f+=4)n[f]=this.rVals[n[f]],n[f+1]=this.gVals[n[f+1]],n[f+2]=this.bVals[n[f+2]]},getUniformLocations:function(t,s){return{uGamma:t.getUniformLocation(s,"uGamma")}},sendUniformData:function(t,s){t.uniform3fv(s.uGamma,this.gamma)}}),e.Image.filters.Gamma.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,i=e.util.createClass;h.Composed=i(h.BaseFilter,{type:"Composed",subFilters:[],initialize:function(t){this.callSuper("initialize",t),this.subFilters=this.subFilters.slice(0)},applyTo:function(t){t.passes+=this.subFilters.length-1,this.subFilters.forEach(function(s){s.applyTo(t)})},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(t){return t.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(t){return!t.isNeutralState()})}}),e.Image.filters.Composed.fromObject=function(t,s){var n=t.subFilters||[],c=n.map(function(r){return new e.Image.filters[r.type](r)}),a=new e.Image.filters.Composed({subFilters:c});return s&&s(a),a}}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.Image.filters,i=e.util.createClass;h.HueRotation=i(h.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var t=this.rotation*Math.PI,s=e.util.cos(t),n=e.util.sin(t),c=1/3,a=Math.sqrt(c)*n,r=1-s;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=s+r/3,this.matrix[1]=c*r-a,this.matrix[2]=c*r+a,this.matrix[5]=c*r+a,this.matrix[6]=s+c*r,this.matrix[7]=c*r-a,this.matrix[10]=c*r-a,this.matrix[11]=c*r+a,this.matrix[12]=s+c*r},isNeutralState:function(t){return this.calculateMatrix(),h.BaseFilter.prototype.isNeutralState.call(this,t)},applyTo:function(t){this.calculateMatrix(),h.BaseFilter.prototype.applyTo.call(this,t)}}),e.Image.filters.HueRotation.fromObject=e.Image.filters.BaseFilter.fromObject}(W),function(u){var e=u.fabric||(u.fabric={}),h=e.util.object.clone;if(e.Text){e.warn("fabric.Text is already defined");return}e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:e.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:e.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(i,t){this.styles=t?t.styles||{}:{},this.text=i,this.__skipDimension=!0,this.callSuper("initialize",t),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return e._measuringContext||(e._measuringContext=this.canvas&&this.canvas.contextCache||e.util.createCanvasElement().getContext("2d")),e._measuringContext},_splitText:function(){var i=this._splitTextIntoLines(this.text);return this.textLines=i.lines,this._textLines=i.graphemeLines,this._unwrappedTextLines=i._unwrappedLines,this._text=i.graphemeText,i},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var i,t,s,n,c,a,r,o=0,l=this._textLines.length;o<l;o++)if(!(this.textAlign!=="justify"&&(o===l-1||this.isEndOfWrapping(o)))&&(n=0,c=this._textLines[o],t=this.getLineWidth(o),t<this.width&&(r=this.textLines[o].match(this._reSpacesAndTabs)))){s=r.length,i=(this.width-t)/s;for(var f=0,g=c.length;f<=g;f++)a=this.__charBounds[o][f],this._reSpaceAndTab.test(c[f])?(a.width+=i,a.kernedWidth+=i,a.left+=n,n+=i):a.left+=n}},isEndOfWrapping:function(i){return i===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var i=this.callSuper("_getCacheCanvasDimensions"),t=this.fontSize;return i.width+=t*i.zoomX,i.height+=t*i.zoomY,i},_render:function(i){this._setTextStyles(i),this._renderTextLinesBackground(i),this._renderTextDecoration(i,"underline"),this._renderText(i),this._renderTextDecoration(i,"overline"),this._renderTextDecoration(i,"linethrough")},_renderText:function(i){this.paintFirst==="stroke"?(this._renderTextStroke(i),this._renderTextFill(i)):(this._renderTextFill(i),this._renderTextStroke(i))},_setTextStyles:function(i,t,s){i.textBaseline="alphabetic",i.font=this._getFontDeclaration(t,s)},calcTextWidth:function(){for(var i=this.getLineWidth(0),t=1,s=this._textLines.length;t<s;t++){var n=this.getLineWidth(t);n>i&&(i=n)}return i},_renderTextLine:function(i,t,s,n,c,a){this._renderChars(i,t,s,n,c,a)},_renderTextLinesBackground:function(i){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var t=0,s,n,c=i.fillStyle,a,r,o=this._getLeftOffset(),l=this._getTopOffset(),f=0,g=0,m,v,p=0,_=this._textLines.length;p<_;p++){if(s=this.getHeightOfLine(p),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",p)){t+=s;continue}a=this._textLines[p],n=this._getLineLeftOffset(p),g=0,f=0,r=this.getValueOfPropertyAt(p,0,"textBackgroundColor");for(var C=0,y=a.length;C<y;C++)m=this.__charBounds[p][C],v=this.getValueOfPropertyAt(p,C,"textBackgroundColor"),v!==r?(i.fillStyle=r,r&&i.fillRect(o+n+f,l+t,g,s/this.lineHeight),f=m.left,g=m.width,r=v):g+=m.kernedWidth;v&&(i.fillStyle=v,i.fillRect(o+n+f,l+t,g,s/this.lineHeight)),t+=s}i.fillStyle=c,this._removeShadow(i)}},getFontCache:function(i){var t=i.fontFamily.toLowerCase();e.charWidthsCache[t]||(e.charWidthsCache[t]={});var s=e.charWidthsCache[t],n=i.fontStyle.toLowerCase()+"_"+(i.fontWeight+"").toLowerCase();return s[n]||(s[n]={}),s[n]},_applyCharStyles:function(i,t,s,n,c){this._setFillStyles(t,c),this._setStrokeStyles(t,c),t.font=this._getFontDeclaration(c)},_measureChar:function(i,t,s,n){var c=this.getFontCache(t),a=this._getFontDeclaration(t),r=this._getFontDeclaration(n),o=s+i,l=a===r,f,g,m,v=t.fontSize/this.CACHE_FONT_SIZE,p;if(s&&c[s]!==void 0&&(m=c[s]),c[i]!==void 0&&(p=f=c[i]),l&&c[o]!==void 0&&(g=c[o],p=g-m),f===void 0||m===void 0||g===void 0){var _=this.getMeasuringContext();this._setTextStyles(_,t,!0)}return f===void 0&&(p=f=_.measureText(i).width,c[i]=f),m===void 0&&l&&s&&(m=_.measureText(s).width,c[s]=m),l&&g===void 0&&(g=_.measureText(o).width,c[o]=g,p=g-m),{width:f*v,kernedWidth:p*v}},getHeightOfChar:function(i,t){return this.getValueOfPropertyAt(i,t,"fontSize")},measureLine:function(i){var t=this._measureLine(i);return this.charSpacing!==0&&(t.width-=this._getWidthOfCharSpacing()),t.width<0&&(t.width=0),t},_measureLine:function(i){var t=0,s,n,c=this._textLines[i],a,r,o=0,l=new Array(c.length);for(this.__charBounds[i]=l,s=0;s<c.length;s++)n=c[s],r=this._getGraphemeBox(n,i,s,a),l[s]=r,t+=r.kernedWidth,a=n;return l[s]={left:r?r.left+r.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:t,numOfSpaces:o}},_getGraphemeBox:function(i,t,s,n,c){var a=this.getCompleteStyleDeclaration(t,s),r=n?this.getCompleteStyleDeclaration(t,s-1):{},o=this._measureChar(i,a,n,r),l=o.kernedWidth,f=o.width,g;this.charSpacing!==0&&(g=this._getWidthOfCharSpacing(),f+=g,l+=g);var m={width:f,left:0,height:a.fontSize,kernedWidth:l,deltaY:a.deltaY};if(s>0&&!c){var v=this.__charBounds[t][s-1];m.left=v.left+v.width+o.kernedWidth-o.width}return m},getHeightOfLine:function(i){if(this.__lineHeights[i])return this.__lineHeights[i];for(var t=this._textLines[i],s=this.getHeightOfChar(i,0),n=1,c=t.length;n<c;n++)s=Math.max(this.getHeightOfChar(i,n),s);return this.__lineHeights[i]=s*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var i,t=0,s=0,n=this._textLines.length;s<n;s++)i=this.getHeightOfLine(s),t+=s===n-1?i/this.lineHeight:i;return t},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_applyPatternGradientTransform:function(i,t){if(!t||!t.toLive)return{offsetX:0,offsetY:0};var s=-this.width/2+t.offsetX||0,n=-this.height/2+t.offsetY||0;return i.transform(1,0,0,1,s,n),{offsetX:s,offsetY:n}},_renderTextCommon:function(i,t){i.save();for(var s=0,n=this._getLeftOffset(),c=this._getTopOffset(),a=this._applyPatternGradientTransform(i,t==="fillText"?this.fill:this.stroke),r=0,o=this._textLines.length;r<o;r++){var l=this.getHeightOfLine(r),f=l/this.lineHeight,g=this._getLineLeftOffset(r);this._renderTextLine(t,i,this._textLines[r],n+g-a.offsetX,c+s+f-a.offsetY,r),s+=l}i.restore()},_renderTextFill:function(i){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(i,"fillText")},_renderTextStroke:function(i){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(i),i.save(),this._setLineDash(i,this.strokeDashArray),i.beginPath(),this._renderTextCommon(i,"strokeText"),i.closePath(),i.restore())},_renderChars:function(i,t,s,n,c,a){var r=this.getHeightOfLine(a),o=this.textAlign.indexOf("justify")!==-1,l,f,g="",m,v=0,p,_=!o&&this.charSpacing===0&&this.isEmptyStyles(a);if(t.save(),c-=r*this._fontSizeFraction/this.lineHeight,_){this._renderChar(i,t,a,0,this.textLines[a],n,c,r),t.restore();return}for(var C=0,y=s.length-1;C<=y;C++)p=C===y||this.charSpacing,g+=s[C],m=this.__charBounds[a][C],v===0?(n+=m.kernedWidth-m.width,v+=m.width):v+=m.kernedWidth,o&&!p&&this._reSpaceAndTab.test(s[C])&&(p=!0),p||(l=l||this.getCompleteStyleDeclaration(a,C),f=this.getCompleteStyleDeclaration(a,C+1),p=this._hasStyleChanged(l,f)),p&&(this._renderChar(i,t,a,C,g,n,c,r),g="",l=f,n+=v,v=0);t.restore()},_renderChar:function(i,t,s,n,c,a,r){var o=this._getStyleDeclaration(s,n),l=this.getCompleteStyleDeclaration(s,n),f=i==="fillText"&&l.fill,g=i==="strokeText"&&l.stroke&&l.strokeWidth;!g&&!f||(o&&t.save(),this._applyCharStyles(i,t,s,n,l),o&&o.textBackgroundColor&&this._removeShadow(t),o&&o.deltaY&&(r+=o.deltaY),f&&t.fillText(c,a,r),g&&t.strokeText(c,a,r),o&&t.restore())},setSuperscript:function(i,t){return this._setScript(i,t,this.superscript)},setSubscript:function(i,t){return this._setScript(i,t,this.subscript)},_setScript:function(i,t,s){var n=this.get2DCursorLocation(i,!0),c=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"fontSize"),a=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"deltaY"),r={fontSize:c*s.size,deltaY:a+c*s.baseline};return this.setSelectionStyles(r,i,t),this},_hasStyleChanged:function(i,t){return i.fill!==t.fill||i.stroke!==t.stroke||i.strokeWidth!==t.strokeWidth||i.fontSize!==t.fontSize||i.fontFamily!==t.fontFamily||i.fontWeight!==t.fontWeight||i.fontStyle!==t.fontStyle||i.deltaY!==t.deltaY},_hasStyleChangedForSvg:function(i,t){return this._hasStyleChanged(i,t)||i.overline!==t.overline||i.underline!==t.underline||i.linethrough!==t.linethrough},_getLineLeftOffset:function(i){var t=this.getLineWidth(i);return this.textAlign==="center"?(this.width-t)/2:this.textAlign==="right"?this.width-t:this.textAlign==="justify-center"&&this.isEndOfWrapping(i)?(this.width-t)/2:this.textAlign==="justify-right"&&this.isEndOfWrapping(i)?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var i=this._forceClearCache;return i||(i=this.hasStateChanged("_dimensionAffectingProps")),i&&(this.dirty=!0,this._forceClearCache=!1),i},getLineWidth:function(i){if(this.__lineWidths[i])return this.__lineWidths[i];var t,s=this._textLines[i],n;return s===""?t=0:(n=this.measureLine(i),t=n.width),this.__lineWidths[i]=t,t},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(i,t,s){var n=this._getStyleDeclaration(i,t);return n&&typeof n[s]<"u"?n[s]:this[s]},_renderTextDecoration:function(i,t){if(!(!this[t]&&!this.styleHas(t))){for(var s,n,c,a,r,o,l,f,g=this._getLeftOffset(),m=this._getTopOffset(),v,p,_,C,y,S,x,O,E=this._getWidthOfCharSpacing(),L=0,B=this._textLines.length;L<B;L++){if(s=this.getHeightOfLine(L),!this[t]&&!this.styleHas(t,L)){m+=s;continue}l=this._textLines[L],S=s/this.lineHeight,a=this._getLineLeftOffset(L),p=0,_=0,f=this.getValueOfPropertyAt(L,0,t),O=this.getValueOfPropertyAt(L,0,"fill"),v=m+S*(1-this._fontSizeFraction),n=this.getHeightOfChar(L,0),r=this.getValueOfPropertyAt(L,0,"deltaY");for(var Y=0,U=l.length;Y<U;Y++)C=this.__charBounds[L][Y],y=this.getValueOfPropertyAt(L,Y,t),x=this.getValueOfPropertyAt(L,Y,"fill"),c=this.getHeightOfChar(L,Y),o=this.getValueOfPropertyAt(L,Y,"deltaY"),(y!==f||x!==O||c!==n||o!==r)&&_>0?(i.fillStyle=O,f&&O&&i.fillRect(g+a+p,v+this.offsets[t]*n+r,_,this.fontSize/15),p=C.left,_=C.width,f=y,O=x,n=c,r=o):_+=C.kernedWidth;i.fillStyle=x,y&&x&&i.fillRect(g+a+p,v+this.offsets[t]*n+r,_-E,this.fontSize/15),m+=s}this._removeShadow(i)}},_getFontDeclaration:function(i,t){var s=i||this,n=this.fontFamily,c=e.Text.genericFonts.indexOf(n.toLowerCase())>-1,a=n===void 0||n.indexOf("'")>-1||n.indexOf(",")>-1||n.indexOf('"')>-1||c?s.fontFamily:'"'+s.fontFamily+'"';return[e.isLikelyNode?s.fontWeight:s.fontStyle,e.isLikelyNode?s.fontStyle:s.fontWeight,t?this.CACHE_FONT_SIZE+"px":s.fontSize+"px",a].join(" ")},render:function(i){!this.visible||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",i))},_splitTextIntoLines:function(i){for(var t=i.split(this._reNewline),s=new Array(t.length),n=[`
`],c=[],a=0;a<t.length;a++)s[a]=e.util.string.graphemeSplit(t[a]),c=c.concat(s[a],n);return c.pop(),{_unwrappedLines:s,lines:t,graphemeText:c,graphemeLines:s}},toObject:function(i){var t=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(i),s=this.callSuper("toObject",t);return s.styles=h(this.styles,!0),s},set:function(i,t){this.callSuper("set",i,t);var s=!1;if(typeof i=="object")for(var n in i)s=s||this._dimensionAffectingProps.indexOf(n)!==-1;else s=this._dimensionAffectingProps.indexOf(i)!==-1;return s&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(i,t,s){if(!i)return t(null);var n=e.parseAttributes(i,e.Text.ATTRIBUTE_NAMES),c=n.textAnchor||"left";if(s=e.util.object.extend(s?h(s):{},n),s.top=s.top||0,s.left=s.left||0,n.textDecoration){var a=n.textDecoration;a.indexOf("underline")!==-1&&(s.underline=!0),a.indexOf("overline")!==-1&&(s.overline=!0),a.indexOf("line-through")!==-1&&(s.linethrough=!0),delete s.textDecoration}"dx"in n&&(s.left+=n.dx),"dy"in n&&(s.top+=n.dy),"fontSize"in s||(s.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE);var r="";"textContent"in i?r=i.textContent:"firstChild"in i&&i.firstChild!==null&&"data"in i.firstChild&&i.firstChild.data!==null&&(r=i.firstChild.data),r=r.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var o=s.strokeWidth;s.strokeWidth=0;var l=new e.Text(r,s),f=l.getScaledHeight()/l.height,g=(l.height+l.strokeWidth)*l.lineHeight-l.height,m=g*f,v=l.getScaledHeight()+m,p=0;c==="center"&&(p=l.getScaledWidth()/2),c==="right"&&(p=l.getScaledWidth()),l.set({left:l.left-p,top:l.top-(v-l.fontSize*(.07+l._fontSizeFraction))/l.lineHeight,strokeWidth:typeof o<"u"?o:1}),t(l)},e.Text.fromObject=function(i,t){return e.Object._fromObject("Text",i,t,"text")},e.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],e.util.createAccessors&&e.util.createAccessors(e.Text)}(W),function(){d.util.object.extend(d.Text.prototype,{isEmptyStyles:function(u){if(!this.styles||typeof u<"u"&&!this.styles[u])return!0;var e=typeof u>"u"?this.styles:{line:this.styles[u]};for(var h in e)for(var i in e[h])for(var t in e[h][i])return!1;return!0},styleHas:function(u,e){if(!this.styles||!u||u===""||typeof e<"u"&&!this.styles[e])return!1;var h=typeof e>"u"?this.styles:{0:this.styles[e]};for(var i in h)for(var t in h[i])if(typeof h[i][t][u]<"u")return!0;return!1},cleanStyle:function(u){if(!this.styles||!u||u==="")return!1;var e=this.styles,h=0,i,t,s=!0,n=0,c;for(var a in e){i=0;for(var r in e[a]){var c=e[a][r],o=c.hasOwnProperty(u);h++,o?(t?c[u]!==t&&(s=!1):t=c[u],c[u]===this[u]&&delete c[u]):s=!1,Object.keys(c).length!==0?i++:delete e[a][r]}i===0&&delete e[a]}for(var l=0;l<this._textLines.length;l++)n+=this._textLines[l].length;s&&h===n&&(this[u]=t,this.removeStyle(u))},removeStyle:function(u){if(!(!this.styles||!u||u==="")){var e=this.styles,h,i,t;for(i in e){h=e[i];for(t in h)delete h[t][u],Object.keys(h[t]).length===0&&delete h[t];Object.keys(h).length===0&&delete e[i]}}},_extendStyles:function(u,e){var h=this.get2DCursorLocation(u);this._getLineStyle(h.lineIndex)||this._setLineStyle(h.lineIndex),this._getStyleDeclaration(h.lineIndex,h.charIndex)||this._setStyleDeclaration(h.lineIndex,h.charIndex,{}),d.util.object.extend(this._getStyleDeclaration(h.lineIndex,h.charIndex),e)},get2DCursorLocation:function(u,e){typeof u>"u"&&(u=this.selectionStart);for(var h=e?this._unwrappedTextLines:this._textLines,i=h.length,t=0;t<i;t++){if(u<=h[t].length)return{lineIndex:t,charIndex:u};u-=h[t].length+this.missingNewlineOffset(t)}return{lineIndex:t-1,charIndex:h[t-1].length<u?h[t-1].length:u}},getSelectionStyles:function(u,e,h){typeof u>"u"&&(u=this.selectionStart||0),typeof e>"u"&&(e=this.selectionEnd||u);for(var i=[],t=u;t<e;t++)i.push(this.getStyleAtPosition(t,h));return i},getStyleAtPosition:function(u,e){var h=this.get2DCursorLocation(u),i=e?this.getCompleteStyleDeclaration(h.lineIndex,h.charIndex):this._getStyleDeclaration(h.lineIndex,h.charIndex);return i||{}},setSelectionStyles:function(u,e,h){typeof e>"u"&&(e=this.selectionStart||0),typeof h>"u"&&(h=this.selectionEnd||e);for(var i=e;i<h;i++)this._extendStyles(i,u);return this._forceClearCache=!0,this},_getStyleDeclaration:function(u,e){var h=this.styles&&this.styles[u];return h?h[e]:null},getCompleteStyleDeclaration:function(u,e){for(var h=this._getStyleDeclaration(u,e)||{},i={},t,s=0;s<this._styleProperties.length;s++)t=this._styleProperties[s],i[t]=typeof h[t]>"u"?this[t]:h[t];return i},_setStyleDeclaration:function(u,e,h){this.styles[u][e]=h},_deleteStyleDeclaration:function(u,e){delete this.styles[u][e]},_getLineStyle:function(u){return!!this.styles[u]},_setLineStyle:function(u){this.styles[u]={}},_deleteLineStyle:function(u){delete this.styles[u]}})}(),function(){function u(e){e.textDecoration&&(e.textDecoration.indexOf("underline")>-1&&(e.underline=!0),e.textDecoration.indexOf("line-through")>-1&&(e.linethrough=!0),e.textDecoration.indexOf("overline")>-1&&(e.overline=!0),delete e.textDecoration)}d.IText=d.util.createClass(d.Text,d.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(e,h){this.callSuper("initialize",e,h),this.initBehavior()},setSelectionStart:function(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)},setSelectionEnd:function(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)},_updateAndFire:function(e,h){this[e]!==h&&(this._fireSelectionChanged(),this[e]=h),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(e){this.clearContextTop(),this.callSuper("render",e),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(e){this.callSuper("_render",e)},clearContextTop:function(e){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var h=this.canvas.contextTop,i=this.canvas.viewportTransform;h.save(),h.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(h),this.transformMatrix&&h.transform.apply(h,this.transformMatrix),this._clearTextArea(h),e||h.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var e=this._getCursorBoundaries(),h=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(e,h):this.renderSelection(e,h),h.restore()}},_clearTextArea:function(e){var h=this.width+4,i=this.height+4;e.clearRect(-h/2,-i/2,h,i)},_getCursorBoundaries:function(e){typeof e>"u"&&(e=this.selectionStart);var h=this._getLeftOffset(),i=this._getTopOffset(),t=this._getCursorBoundariesOffsets(e);return{left:h,top:i,leftOffset:t.left,topOffset:t.top}},_getCursorBoundariesOffsets:function(e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var h,i,t,s=0,n=0,c,a=this.get2DCursorLocation(e);t=a.charIndex,i=a.lineIndex;for(var r=0;r<i;r++)s+=this.getHeightOfLine(r);h=this._getLineLeftOffset(i);var o=this.__charBounds[i][t];return o&&(n=o.left),this.charSpacing!==0&&t===this._textLines[i].length&&(n-=this._getWidthOfCharSpacing()),c={top:s,left:h+(n>0?n:0)},this.cursorOffsetCache=c,this.cursorOffsetCache},renderCursor:function(e,h){var i=this.get2DCursorLocation(),t=i.lineIndex,s=i.charIndex>0?i.charIndex-1:0,n=this.getValueOfPropertyAt(t,s,"fontSize"),c=this.scaleX*this.canvas.getZoom(),a=this.cursorWidth/c,r=e.topOffset,o=this.getValueOfPropertyAt(t,s,"deltaY");r+=(1-this._fontSizeFraction)*this.getHeightOfLine(t)/this.lineHeight-n*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(e,h),h.fillStyle=this.getValueOfPropertyAt(t,s,"fill"),h.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,h.fillRect(e.left+e.leftOffset-a/2,r+e.top+o,a,n)},renderSelection:function(e,h){for(var i=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,t=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,s=this.textAlign.indexOf("justify")!==-1,n=this.get2DCursorLocation(i),c=this.get2DCursorLocation(t),a=n.lineIndex,r=c.lineIndex,o=n.charIndex<0?0:n.charIndex,l=c.charIndex<0?0:c.charIndex,f=a;f<=r;f++){var g=this._getLineLeftOffset(f)||0,m=this.getHeightOfLine(f),v=0,p=0,_=0;if(f===a&&(p=this.__charBounds[a][o].left),f>=a&&f<r)_=s&&!this.isEndOfWrapping(f)?this.width:this.getLineWidth(f)||5;else if(f===r)if(l===0)_=this.__charBounds[r][l].left;else{var C=this._getWidthOfCharSpacing();_=this.__charBounds[r][l-1].left+this.__charBounds[r][l-1].width-C}v=m,(this.lineHeight<1||f===r&&this.lineHeight>1)&&(m/=this.lineHeight),this.inCompositionMode?(h.fillStyle=this.compositionColor||"black",h.fillRect(e.left+g+p,e.top+e.topOffset+m,_-p,1)):(h.fillStyle=this.selectionColor,h.fillRect(e.left+g+p,e.top+e.topOffset,_-p,m)),e.topOffset+=v}},getCurrentCharFontSize:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")},getCurrentCharColor:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fill")},_getCurrentCharIndex:function(){var e=this.get2DCursorLocation(this.selectionStart,!0),h=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c:h}}}),d.IText.fromObject=function(e,h){if(u(e),e.styles)for(var i in e.styles)for(var t in e.styles[i])u(e.styles[i][t]);d.Object._fromObject("IText",e,h,"text")}}(),function(){var u=d.util.object.clone;d.util.object.extend(d.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var e=this;this.on("added",function(){var h=e.canvas;h&&(h._hasITextHandlers||(h._hasITextHandlers=!0,e._initCanvasHandlers(h)),h._iTextInstances=h._iTextInstances||[],h._iTextInstances.push(e))})},initRemovedHandler:function(){var e=this;this.on("removed",function(){var h=e.canvas;h&&(h._iTextInstances=h._iTextInstances||[],d.util.removeFromArray(h._iTextInstances,e),h._iTextInstances.length===0&&(h._hasITextHandlers=!1,e._removeCanvasHandlers(h)))})},_initCanvasHandlers:function(e){e._mouseUpITextHandler=function(){e._iTextInstances&&e._iTextInstances.forEach(function(h){h.__isMousedown=!1})},e.on("mouse:up",e._mouseUpITextHandler)},_removeCanvasHandlers:function(e){e.off("mouse:up",e._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,h,i,t){var s;return s={isAborted:!1,abort:function(){this.isAborted=!0}},e.animate("_currentCursorOpacity",h,{duration:i,onComplete:function(){s.isAborted||e[t]()},onChange:function(){e.canvas&&e.selectionStart===e.selectionEnd&&e.renderCursorOrSelection()},abort:function(){return s.isAborted}}),s},_onTickComplete:function(){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){e._currentTickCompleteState=e._animateCursor(e,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(e){var h=this,i=e?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){h._tick()},i)},abortCursorAnimation:function(){var e=this._currentTickState||this._currentTickCompleteState,h=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,e&&h&&h.clearContext(h.contextTop||h.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(e){var h=0,i=e-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)h++,i--;for(;/\S/.test(this._text[i])&&i>-1;)h++,i--;return e-h},findWordBoundaryRight:function(e){var h=0,i=e;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)h++,i++;for(;/\S/.test(this._text[i])&&i<this._text.length;)h++,i++;return e+h},findLineBoundaryLeft:function(e){for(var h=0,i=e-1;!/\n/.test(this._text[i])&&i>-1;)h++,i--;return e-h},findLineBoundaryRight:function(e){for(var h=0,i=e;!/\n/.test(this._text[i])&&i<this._text.length;)h++,i++;return e+h},searchWordBoundary:function(e,h){for(var i=this._text,t=this._reSpace.test(i[e])?e-1:e,s=i[t],n=d.reNonWord;!n.test(s)&&t>0&&t<i.length;)t+=h,s=i[t];return n.test(s)&&(t+=h===1?0:1),t},selectWord:function(e){e=e||this.selectionStart;var h=this.searchWordBoundary(e,-1),i=this.searchWordBoundary(e,1);this.selectionStart=h,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(e){e=e||this.selectionStart;var h=this.findLineBoundaryLeft(e),i=this.findLineBoundaryRight(e);return this.selectionStart=h,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(e){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(e),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(e){e._iTextInstances&&e._iTextInstances.forEach(function(h){h.selected=!1,h.isEditing&&h.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(e){if(!(!this.__isMousedown||!this.isEditing)){var h=this.getSelectionStartFromPointer(e.e),i=this.selectionStart,t=this.selectionEnd;(h!==this.__selectionStartOnMouseDown||i===t)&&(i===h||t===h)||(h>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=h):(this.selectionStart=h,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==i||this.selectionEnd!==t)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(e,h,i){var t=i.slice(0,e),s=d.util.string.graphemeSplit(t).length;if(e===h)return{selectionStart:s,selectionEnd:s};var n=i.slice(e,h),c=d.util.string.graphemeSplit(n).length;return{selectionStart:s,selectionEnd:s+c}},fromGraphemeToStringSelection:function(e,h,i){var t=i.slice(0,e),s=t.join("").length;if(e===h)return{selectionStart:s,selectionEnd:s};var n=i.slice(e,h),c=n.join("").length;return{selectionStart:s,selectionEnd:s+c}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(!!this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var e=this.inCompositionMode?this.compositionStart:this.selectionStart,h=this._getCursorBoundaries(e),i=this.get2DCursorLocation(e),t=i.lineIndex,s=i.charIndex,n=this.getValueOfPropertyAt(t,s,"fontSize")*this.lineHeight,c=h.leftOffset,a=this.calcTransformMatrix(),r={x:h.left+c,y:h.top+h.topOffset+n},o=this.canvas.getRetinaScaling(),l=this.canvas.upperCanvasEl,f=l.width/o,g=l.height/o,m=f-n,v=g-n,p=l.clientWidth/f,_=l.clientHeight/g;return r=d.util.transformPoint(r,a),r=d.util.transformPoint(r,this.canvas.viewportTransform),r.x*=p,r.y*=_,r.x<0&&(r.x=0),r.x>m&&(r.x=m),r.y<0&&(r.y=0),r.y>v&&(r.y=v),r.x+=this.canvas._offset.left,r.y+=this.canvas._offset.top,{left:r.x+"px",top:r.y+"px",fontSize:n+"px",charHeight:n}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){!this._savedProps||(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var e=this._textBeforeEdit!==this.text,h=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,h&&(h.blur&&h.blur(),h.parentNode&&h.parentNode.removeChild(h)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),e&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var e in this.styles)this._textLines[e]||delete this.styles[e]},removeStyleFromTo:function(e,h){var i=this.get2DCursorLocation(e,!0),t=this.get2DCursorLocation(h,!0),s=i.lineIndex,n=i.charIndex,c=t.lineIndex,a=t.charIndex,r,o;if(s!==c){if(this.styles[s])for(r=n;r<this._unwrappedTextLines[s].length;r++)delete this.styles[s][r];if(this.styles[c])for(r=a;r<this._unwrappedTextLines[c].length;r++)o=this.styles[c][r],o&&(this.styles[s]||(this.styles[s]={}),this.styles[s][n+r-a]=o);for(r=s+1;r<=c;r++)delete this.styles[r];this.shiftLineStyles(c,s-c)}else if(this.styles[s]){o=this.styles[s];var l=a-n,f,g;for(r=n;r<a;r++)delete o[r];for(g in this.styles[s])f=parseInt(g,10),f>=a&&(o[f-l]=o[g],delete o[g])}},shiftLineStyles:function(e,h){var i=u(this.styles);for(var t in this.styles){var s=parseInt(t,10);s>e&&(this.styles[s+h]=i[s],i[s-h]||delete this.styles[s])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(e,h,i,t){var s,n={},c=!1,a=this._unwrappedTextLines[e].length===h;i||(i=1),this.shiftLineStyles(e,i),this.styles[e]&&(s=this.styles[e][h===0?h:h-1]);for(var r in this.styles[e]){var o=parseInt(r,10);o>=h&&(c=!0,n[o-h]=this.styles[e][r],a&&h===0||delete this.styles[e][r])}var l=!1;for(c&&!a&&(this.styles[e+i]=n,l=!0),l&&i--;i>0;)t&&t[i-1]?this.styles[e+i]={0:u(t[i-1])}:s?this.styles[e+i]={0:u(s)}:delete this.styles[e+i],i--;this._forceClearCache=!0},insertCharStyleObject:function(e,h,i,t){this.styles||(this.styles={});var s=this.styles[e],n=s?u(s):{};i||(i=1);for(var c in n){var a=parseInt(c,10);a>=h&&(s[a+i]=n[a],n[a-i]||delete s[a])}if(this._forceClearCache=!0,t){for(;i--;)!Object.keys(t[i]).length||(this.styles[e]||(this.styles[e]={}),this.styles[e][h+i]=u(t[i]));return}if(!!s)for(var r=s[h?h-1:1];r&&i--;)this.styles[e][h+i]=u(r)},insertNewStyleBlock:function(e,h,i){for(var t=this.get2DCursorLocation(h,!0),s=[0],n=0,c=0;c<e.length;c++)e[c]===`
`?(n++,s[n]=0):s[n]++;s[0]>0&&(this.insertCharStyleObject(t.lineIndex,t.charIndex,s[0],i),i=i&&i.slice(s[0]+1)),n&&this.insertNewlineStyleObject(t.lineIndex,t.charIndex+s[0],n);for(var c=1;c<n;c++)s[c]>0?this.insertCharStyleObject(t.lineIndex+c,0,s[c],i):i&&(this.styles[t.lineIndex+c][0]=i[0]),i=i&&i.slice(s[c]+1);s[c]>0&&this.insertCharStyleObject(t.lineIndex+c,0,s[c],i)},setSelectionStartEndWithShift:function(e,h,i){i<=e?(h===e?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=e),this.selectionStart=i):i>e&&i<h?this._selectionDirection==="right"?this.selectionEnd=i:this.selectionStart=i:(h===e?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=h),this.selectionEnd=i)},setSelectionInBoundaries:function(){var e=this.text.length;this.selectionStart>e?this.selectionStart=e:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>e?this.selectionEnd=e:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),d.util.object.extend(d.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(u){if(!!this.canvas){this.__newClickTime=+new Date;var e=u.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",u),this._stopEvent(u.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(u){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===u.x&&this.__lastPointer.y===u.y},_stopEvent:function(u){u.preventDefault&&u.preventDefault(),u.stopPropagation&&u.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(u){!this.isEditing||this.selectWord(this.getSelectionStartFromPointer(u.e))},tripleClickHandler:function(u){!this.isEditing||this.selectLine(this.getSelectionStartFromPointer(u.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(u){!this.canvas||!this.editable||u.e.button&&u.e.button!==1||(this.__isMousedown=!0,this.selected&&this.setCursorByClick(u.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(u){!this.canvas||!this.editable||u.e.button&&u.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(u){if(this.__isMousedown=!1,!(!this.editable||this.group||u.transform&&u.transform.actionPerformed||u.e.button&&u.e.button!==1)){if(this.canvas){var e=this.canvas._activeObject;if(e&&e!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(u.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(u){var e=this.getSelectionStartFromPointer(u),h=this.selectionStart,i=this.selectionEnd;u.shiftKey?this.setSelectionStartEndWithShift(h,i,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(u){for(var e=this.getLocalPointer(u),h=0,i=0,t=0,s=0,n=0,c,a,r=0,o=this._textLines.length;r<o&&t<=e.y;r++)t+=this.getHeightOfLine(r)*this.scaleY,n=r,r>0&&(s+=this._textLines[r-1].length+this.missingNewlineOffset(r-1));c=this._getLineLeftOffset(n),i=c*this.scaleX,a=this._textLines[n];for(var l=0,f=a.length;l<f&&(h=i,i+=this.__charBounds[n][l].kernedWidth*this.scaleX,i<=e.x);l++)s++;return this._getNewSelectionStartFromOffset(e,h,i,s,f)},_getNewSelectionStartFromOffset:function(u,e,h,i,t){var s=u.x-e,n=h-u.x,c=n>s||n<0?0:1,a=i+c;return this.flipX&&(a=t-a),a>this._text.length&&(a=this._text.length),a}}),d.util.object.extend(d.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=d.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var u=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+u.top+"; left: "+u.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uFF70top: "+u.fontSize+";",d.document.body.appendChild(this.hiddenTextarea),d.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),d.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),d.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),d.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),d.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),d.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),d.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),d.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),d.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(d.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(u){if(!(!this.isEditing||this.inCompositionMode)){if(u.keyCode in this.keysMap)this[this.keysMap[u.keyCode]](u);else if(u.keyCode in this.ctrlKeysMapDown&&(u.ctrlKey||u.metaKey))this[this.ctrlKeysMapDown[u.keyCode]](u);else return;u.stopImmediatePropagation(),u.preventDefault(),u.keyCode>=33&&u.keyCode<=40?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(u){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(u.keyCode in this.ctrlKeysMapUp&&(u.ctrlKey||u.metaKey))this[this.ctrlKeysMapUp[u.keyCode]](u);else return;u.stopImmediatePropagation(),u.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(u){var e=this.fromPaste;if(this.fromPaste=!1,u&&u.stopPropagation(),!!this.isEditing){var h=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,i=this._text.length,t=h.length,s,n,c=t-i,a=this.selectionStart,r=this.selectionEnd,o=a!==r,v,l,f;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var g=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),m=a>g.selectionStart;o?(s=this._text.slice(a,r),c+=r-a):t<i&&(m?s=this._text.slice(r+c,r):s=this._text.slice(a,a-c));var v;n=h.slice(g.selectionEnd-c,g.selectionEnd),s&&s.length&&(n.length&&(v=this.getSelectionStyles(a,a+1,!0),v=n.map(function(){return v[0]})),o?(l=a,f=r):m?(l=r-s.length,f=r):(l=r,f=r+s.length),this.removeStyleFromTo(l,f)),n.length&&(e&&n.join("")===d.copiedText&&!d.disableStyleCopyPaste&&(v=d.copiedTextStyle),this.insertNewStyleBlock(n,a,v)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(u){this.compositionStart=u.target.selectionStart,this.compositionEnd=u.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(d.copiedText=this.getSelectedText(),d.disableStyleCopyPaste?d.copiedTextStyle=null:d.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(u){return u&&u.clipboardData||d.window.clipboardData},_getWidthBeforeCursor:function(u,e){var h=this._getLineLeftOffset(u),i;return e>0&&(i=this.__charBounds[u][e-1],h+=i.left+i.width),h},getDownCursorOffset:function(u,e){var h=this._getSelectionForOffset(u,e),i=this.get2DCursorLocation(h),t=i.lineIndex;if(t===this._textLines.length-1||u.metaKey||u.keyCode===34)return this._text.length-h;var s=i.charIndex,n=this._getWidthBeforeCursor(t,s),c=this._getIndexOnLine(t+1,n),a=this._textLines[t].slice(s);return a.length+c+1+this.missingNewlineOffset(t)},_getSelectionForOffset:function(u,e){return u.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(u,e){var h=this._getSelectionForOffset(u,e),i=this.get2DCursorLocation(h),t=i.lineIndex;if(t===0||u.metaKey||u.keyCode===33)return-h;var s=i.charIndex,n=this._getWidthBeforeCursor(t,s),c=this._getIndexOnLine(t-1,n),a=this._textLines[t].slice(0,s),r=this.missingNewlineOffset(t-1);return-this._textLines[t-1].length+c-a.length+(1-r)},_getIndexOnLine:function(u,e){for(var h=this._textLines[u],i=this._getLineLeftOffset(u),t=i,s=0,n,c,a=0,r=h.length;a<r;a++)if(n=this.__charBounds[u][a].width,t+=n,t>e){c=!0;var o=t-n,l=t,f=Math.abs(o-e),g=Math.abs(l-e);s=g<f?a:a-1;break}return c||(s=h.length-1),s},moveCursorDown:function(u){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",u)},moveCursorUp:function(u){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",u)},_moveCursorUpOrDown:function(u,e){var h="get"+u+"CursorOffset",i=this[h](e,this._selectionDirection==="right");e.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),i!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(u){var e=this._selectionDirection==="left"?this.selectionStart+u:this.selectionEnd+u;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),u!==0},moveCursorWithoutShift:function(u){return u<0?(this.selectionStart+=u,this.selectionEnd=this.selectionStart):(this.selectionEnd+=u,this.selectionStart=this.selectionEnd),u!==0},moveCursorLeft:function(u){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",u)},_move:function(u,e,h){var i;if(u.altKey)i=this["findWordBoundary"+h](this[e]);else if(u.metaKey||u.keyCode===35||u.keyCode===36)i=this["findLineBoundary"+h](this[e]);else return this[e]+=h==="Left"?-1:1,!0;if(typeof i!==void 0&&this[e]!==i)return this[e]=i,!0},_moveLeft:function(u,e){return this._move(u,e,"Left")},_moveRight:function(u,e){return this._move(u,e,"Right")},moveCursorLeftWithoutShift:function(u){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(e=this._moveLeft(u,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(u){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(u,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(u,"selectionStart")},moveCursorRight:function(u){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",u)},_moveCursorLeftOrRight:function(u,e){var h="moveCursor"+u+"With";this._currentCursorOpacity=1,e.shiftKey?h+="Shift":h+="outShift",this[h](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(u){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(u,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(u,"selectionEnd")},moveCursorRightWithoutShift:function(u){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(u,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(u,e){typeof e>"u"&&(e=u+1),this.removeStyleFromTo(u,e),this._text.splice(u,e-u),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(u,e,h,i){typeof i>"u"&&(i=h),i>h&&this.removeStyleFromTo(h,i);var t=d.util.string.graphemeSplit(u);this.insertNewStyleBlock(t,h,e),this._text=[].concat(this._text.slice(0,h),t,this._text.slice(i)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var u=d.util.toFixed,e=/  +/g;d.util.object.extend(d.Text.prototype,{_toSVG:function(){var h=this._getSVGLeftTopOffsets(),i=this._getSVGTextAndBg(h.textTop,h.textLeft);return this._wrapSVGTextAndBg(i)},toSVG:function(h){return this._createBaseSVGMarkup(this._toSVG(),{reviver:h,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(h){var i=!0,t=this.getSvgTextDecoration(this);return[h.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",t?'text-decoration="'+t+'" ':"",'style="',this.getSvgStyles(i),'"',this.addPaintOrder()," >",h.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(h,i){var t=[],s=[],n=h,c;this._setSVGBg(s);for(var a=0,r=this._textLines.length;a<r;a++)c=this._getLineLeftOffset(a),(this.textBackgroundColor||this.styleHas("textBackgroundColor",a))&&this._setSVGTextLineBg(s,a,i+c,n),this._setSVGTextLineText(t,a,i+c,n),n+=this.getHeightOfLine(a);return{textSpans:t,textBgRects:s}},_createTextCharSpan:function(h,i,t,s){var n=h!==h.trim()||h.match(e),c=this.getSvgSpanStyles(i,n),a=c?'style="'+c+'"':"",r=i.deltaY,o="",l=d.Object.NUM_FRACTION_DIGITS;return r&&(o=' dy="'+u(r,l)+'" '),['<tspan x="',u(t,l),'" y="',u(s,l),'" ',o,a,">",d.util.string.escapeXml(h),"</tspan>"].join("")},_setSVGTextLineText:function(h,i,t,s){var n=this.getHeightOfLine(i),c=this.textAlign.indexOf("justify")!==-1,a,r,o="",l,f,g=0,m=this._textLines[i],v;s+=n*(1-this._fontSizeFraction)/this.lineHeight;for(var p=0,_=m.length-1;p<=_;p++)v=p===_||this.charSpacing,o+=m[p],l=this.__charBounds[i][p],g===0?(t+=l.kernedWidth-l.width,g+=l.width):g+=l.kernedWidth,c&&!v&&this._reSpaceAndTab.test(m[p])&&(v=!0),v||(a=a||this.getCompleteStyleDeclaration(i,p),r=this.getCompleteStyleDeclaration(i,p+1),v=this._hasStyleChangedForSvg(a,r)),v&&(f=this._getStyleDeclaration(i,p)||{},h.push(this._createTextCharSpan(o,f,t,s)),o="",a=r,t+=g,g=0)},_pushTextBgRect:function(h,i,t,s,n,c){var a=d.Object.NUM_FRACTION_DIGITS;h.push("		<rect ",this._getFillAttributes(i),' x="',u(t,a),'" y="',u(s,a),'" width="',u(n,a),'" height="',u(c,a),`"></rect>
`)},_setSVGTextLineBg:function(h,i,t,s){for(var n=this._textLines[i],c=this.getHeightOfLine(i)/this.lineHeight,a=0,r=0,o,l,f=this.getValueOfPropertyAt(i,0,"textBackgroundColor"),g=0,m=n.length;g<m;g++)o=this.__charBounds[i][g],l=this.getValueOfPropertyAt(i,g,"textBackgroundColor"),l!==f?(f&&this._pushTextBgRect(h,f,t+r,s,a,c),r=o.left,a=o.width,f=l):a+=o.kernedWidth;l&&this._pushTextBgRect(h,l,t+r,s,a,c)},_getFillAttributes:function(h){var i=h&&typeof h=="string"?new d.Color(h):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+h+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(h){for(var i=0,t=0,s=0;s<h;s++)i+=this.getHeightOfLine(s);return t=this.getHeightOfLine(s),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*t/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(h){var i=d.Object.prototype.getSvgStyles.call(this,h);return i+" white-space: pre;"}})}(),function(u){var e=u.fabric||(u.fabric={});e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:e.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(h){for(var i=0,t=0,s=0,n={},c=0;c<h.graphemeLines.length;c++)h.graphemeText[s]===`
`&&c>0?(t=0,s++,i++):!this.splitByGrapheme&&this._reSpaceAndTab.test(h.graphemeText[s])&&c>0&&(t++,s++),n[c]={line:i,offset:t},s+=h.graphemeLines[c].length,t+=h.graphemeLines[c].length;return n},styleHas:function(h,i){if(this._styleMap&&!this.isWrapping){var t=this._styleMap[i];t&&(i=t.line)}return e.Text.prototype.styleHas.call(this,h,i)},isEmptyStyles:function(h){if(!this.styles)return!0;var i=0,t=h+1,s,n,c=!1,a=this._styleMap[h],r=this._styleMap[h+1];a&&(h=a.line,i=a.offset),r&&(t=r.line,c=t===h,s=r.offset),n=typeof h>"u"?this.styles:{line:this.styles[h]};for(var o in n)for(var l in n[o])if(l>=i&&(!c||l<s))for(var f in n[o][l])return!1;return!0},_getStyleDeclaration:function(h,i){if(this._styleMap&&!this.isWrapping){var t=this._styleMap[h];if(!t)return null;h=t.line,i=t.offset+i}return this.callSuper("_getStyleDeclaration",h,i)},_setStyleDeclaration:function(h,i,t){var s=this._styleMap[h];h=s.line,i=s.offset+i,this.styles[h][i]=t},_deleteStyleDeclaration:function(h,i){var t=this._styleMap[h];h=t.line,i=t.offset+i,delete this.styles[h][i]},_getLineStyle:function(h){var i=this._styleMap[h];return!!this.styles[i.line]},_setLineStyle:function(h){var i=this._styleMap[h];this.styles[i.line]={}},_wrapText:function(h,i){var t=[],s;for(this.isWrapping=!0,s=0;s<h.length;s++)t=t.concat(this._wrapLine(h[s],s,i));return this.isWrapping=!1,t},_measureWord:function(h,i,t){var s=0,n,c=!0;t=t||0;for(var a=0,r=h.length;a<r;a++){var o=this._getGraphemeBox(h[a],i,a+t,n,c);s+=o.kernedWidth,n=h[a]}return s},_wrapLine:function(h,i,t,y){var n=0,c=this.splitByGrapheme,a=[],r=[],o=c?e.util.string.graphemeSplit(h):h.split(this._wordJoiners),l="",f=0,g=c?"":" ",m=0,v=0,p=0,_=!0,C=c?0:this._getWidthOfCharSpacing(),y=y||0;o.length===0&&o.push([]),t-=y;for(var S=0;S<o.length;S++)l=c?o[S]:e.util.string.graphemeSplit(o[S]),m=this._measureWord(l,i,f),f+=l.length,n+=v+m-C,n>=t&&!_?(a.push(r),r=[],n=m,_=!0):n+=C,!_&&!c&&r.push(g),r=r.concat(l),v=this._measureWord([g],i,f),f++,_=!1,m>p&&(p=m);return S&&a.push(r),p+y>this.dynamicMinWidth&&(this.dynamicMinWidth=p-C+y),a},isEndOfWrapping:function(h){return!this._styleMap[h+1]||this._styleMap[h+1].line!==this._styleMap[h].line},missingNewlineOffset:function(h){return this.splitByGrapheme?this.isEndOfWrapping(h)?1:0:1},_splitTextIntoLines:function(h){for(var i=e.Text.prototype._splitTextIntoLines.call(this,h),t=this._wrapText(i.lines,this.width),s=new Array(t.length),n=0;n<t.length;n++)s[n]=t[n].join("");return i.lines=s,i.graphemeLines=t,i},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var h={};for(var i in this._styleMap)this._textLines[i]&&(h[this._styleMap[i].line]=1);for(var i in this.styles)h[i]||delete this.styles[i]},toObject:function(h){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(h))}}),e.Textbox.fromObject=function(h,i){return e.Object._fromObject("Textbox",h,i,"text")}}(W)})(ut);var Lt={exports:{}};(function(W,d){(function($,Z){Z()})(Ct,function(){function $(h,i){return typeof i>"u"?i={autoBom:!1}:typeof i!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(h.type)?new Blob(["\uFEFF",h],{type:h.type}):h}function Z(h,i,t){var s=new XMLHttpRequest;s.open("GET",h),s.responseType="blob",s.onload=function(){e(s.response,i,t)},s.onerror=function(){console.error("could not download file")},s.send()}function at(h){var i=new XMLHttpRequest;i.open("HEAD",h,!1);try{i.send()}catch{}return 200<=i.status&&299>=i.status}function N(h){try{h.dispatchEvent(new MouseEvent("click"))}catch{var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),h.dispatchEvent(i)}}var A=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Ct=="object"&&Ct.global===Ct?Ct:void 0,u=A.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),e=A.saveAs||(typeof window!="object"||window!==A?function(){}:"download"in HTMLAnchorElement.prototype&&!u?function(h,i,t){var s=A.URL||A.webkitURL,n=document.createElement("a");i=i||h.name||"download",n.download=i,n.rel="noopener",typeof h=="string"?(n.href=h,n.origin===location.origin?N(n):at(n.href)?Z(h,i,t):N(n,n.target="_blank")):(n.href=s.createObjectURL(h),setTimeout(function(){s.revokeObjectURL(n.href)},4e4),setTimeout(function(){N(n)},0))}:"msSaveOrOpenBlob"in navigator?function(h,i,t){if(i=i||h.name||"download",typeof h!="string")navigator.msSaveOrOpenBlob($(h,t),i);else if(at(h))Z(h,i,t);else{var s=document.createElement("a");s.href=h,s.target="_blank",setTimeout(function(){N(s)})}}:function(h,i,t,s){if(s=s||open("","_blank"),s&&(s.document.title=s.document.body.innerText="downloading..."),typeof h=="string")return Z(h,i,t);var n=h.type==="application/octet-stream",c=/constructor/i.test(A.HTMLElement)||A.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||n&&c||u)&&typeof FileReader<"u"){var r=new FileReader;r.onloadend=function(){var f=r.result;f=a?f:f.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=f:location=f,s=null},r.readAsDataURL(h)}else{var o=A.URL||A.webkitURL,l=o.createObjectURL(h);s?s.location=l:location.href=l,s=null,setTimeout(function(){o.revokeObjectURL(l)},4e4)}});A.saveAs=e.saveAs=e,W.exports=e})})(Lt);const ie=Lt.exports;var rt=(W=>(W.Pencil="pencil",W.Line="line",W.DashedLine="dashedLine",W.Arrow="arrow",W.Text="text",W.Rect="rect",W.Circle="circle",W.Ellipse="ellipse",W.Equilateral="equilateral",W.Upload="upload",W.Rubber="rubber",W.Undo="undo",W.Redo="redo",W.Move="move",W.Clear="clear",W.Download="download",W))(rt||{});const re=[{name:"\u94C5\u7B14",type:"pencil",icon:"icon-pan_icon"},{name:"\u5B9E\u7EBF",type:"line",icon:"icon-xian"},{name:"\u865A\u7EBF",type:"dashedLine",icon:"icon-xian1"},{name:"\u7BAD\u5934",type:"arrow",icon:"icon-jiantou"},{name:"\u6587\u5B57",type:"text",icon:"icon-wenzi"},{name:"\u77E9\u5F62",type:"rect",icon:"icon-juxing"},{name:"\u5706\u5F62",type:"circle",icon:"icon-yuanxing"},{name:"\u692D\u5706\u5F62",type:"ellipse",icon:"icon-tuoyuanxing"},{name:"\u4E09\u89D2\u5F62",type:"equilateral",icon:"icon-sanjiaoxing"},{name:"\u4E0A\u4F20\u56FE\u7247",type:"upload",icon:"icon-seiyw41"},{name:"\u6A61\u76AE",type:"rubber",icon:"icon-xiangpi"},{name:"\u56DE\u9000",type:"undo",icon:"icon-undo"},{name:"\u5411\u524D",type:"redo",icon:"icon-redo"},{name:"\u6E05\u9664",type:"clear",icon:"icon-clear"},{name:"\u79FB\u52A8",type:"move",icon:"icon-yidong"},{name:"\u4E0B\u8F7D",type:"download",icon:"icon-xiazai"}],ne=["onClick"],se={key:0,for:"x-whiteboard-upload"},ae={id:"myCanvas",ref:"myCanvas"},oe={name:"x-whiteboard"},he=Dt({...oe,props:{toolPosition:{},canvasWidth:{default:window.innerWidth},canvasHeight:{default:window.innerHeight},canvasBgColor:{default:"#f6f6f6"},strokeColor:{default:"#f30"},strokeWidth:{default:2},showTools:{type:Boolean,default:!0},initData:{default:()=>null}},emits:["save"],setup(W,{emit:d}){const $=W,Z=Tt({stage:0,data:[]}),at=Tt({width:$.canvasWidth||window.innerWidth,height:$.canvasHeight||window.innerHeight,bgColor:$.canvasBgColor||"#ffffff"}),N=Tt({type:rt.Pencil,strokeColor:$.strokeColor||"#f30",strokeWidth:$.strokeWidth||2}),A={boardObj:null,textObj:null,mouseFrom:{},mouseTo:{},isDrawing:!1,drawingObj:null};It(()=>{Xt(()=>{const{initData:y}=$;A.boardObj=new ut.fabric.Canvas("myCanvas",{isDrawingMode:!0,selectable:!0,selection:!0,devicePixelRatio:!0,backgroundColor:at.bgColor||"#ffffff"}),A.boardObj.freeDrawingBrush.color=N.strokeColor,A.boardObj.freeDrawingBrush.width=N.strokeWidth,A.boardObj.setWidth(at.width),A.boardObj.setHeight(at.height),y&&A.boardObj.loadFromJSON(y),u()})});function u(){A.boardObj.on({"mouse:down":y=>{let{x:S,y:x}=y.pointer;A.mouseFrom={x:S,y:x},A.boardObj.getActiveObject()||(A.isDrawing=!0),N.type===rt.Text&&l()},"mouse:up":y=>{let{x:S,y:x}=y.pointer;A.mouseTo={x:S,y:x},A.isDrawing=!1,A.drawingObj=null,f()},"mouse:move":y=>{if(A.isDrawing){let{x:S,y:x}=y.pointer;A.mouseTo={x:S,y:x},e()}},"object:moving":y=>{},"object:scaling":y=>{},"object:rotating":y=>{},"selection:created":y=>{if(N.type===rt.Rubber){if(y.target._objects){const S=y.target._objects.length;for(let x=0;x<S;x++)A.boardObj.remove(y.target._objects[x])}else A.boardObj.remove(y.target);A.boardObj.discardActiveObject()}f()}})}function e(){A.drawingObj&&A.boardObj.remove(A.drawingObj),A.boardObj.isDrawingMode=!1,A.boardObj.selectable=!1,A.boardObj.selection=!1;let y=null;switch(N.type){case rt.Pencil:A.boardObj.isDrawingMode=!0;break;case rt.Line:y=t();break;case rt.DashedLine:y=s();break;case rt.Arrow:y=o();break;case rt.Rect:y=n();break;case rt.Circle:y=c();break;case rt.Ellipse:y=a();break;case rt.Equilateral:y=r();break;default:y=null,A.boardObj.selection=!0,A.boardObj.skipTargetFind=!1,A.boardObj.selectable=!0;break}y&&(A.boardObj.add(y),A.drawingObj=y)}function h(y){switch(A.boardObj.isDrawingMode=!1,i(),A.boardObj.getActiveObject()&&(A.boardObj.discardActiveObject(),A.boardObj.renderAll()),console.log("type",y),y){case rt.Clear:return A.boardObj.clear();case rt.Upload:return;case rt.Undo:return g();case rt.Redo:return m();case rt.Download:return v();default:switch(N.type=y,y){case rt.Pencil:A.boardObj.isDrawingMode=!0;break;case rt.Rubber:case rt.Move:A.boardObj.selection=!0,A.boardObj.skipTargetFind=!1,A.boardObj.selectable=!0;break}C();break}}function i(){A.boardObj.selectable=!0,A.boardObj.selection=!0,A.boardObj.skipTargetFind=!1,A.textObj&&(A.textObj.exitEditing(),A.textObj=null)}function t(){return new ut.fabric.Line([A.mouseFrom.x,A.mouseFrom.y,A.mouseTo.x,A.mouseTo.y],{stroke:N.strokeColor,strokeWidth:N.strokeWidth})}function s(){return new ut.fabric.Line([A.mouseFrom.x,A.mouseFrom.y,A.mouseTo.x,A.mouseTo.y],{stroke:N.strokeColor,strokeWidth:N.strokeWidth,strokeDashArray:[10,3]})}function n(){return new ut.fabric.Rect({left:A.mouseFrom.x,top:A.mouseFrom.y,height:Math.abs(A.mouseTo.y-A.mouseFrom.y),width:Math.abs(A.mouseTo.x-A.mouseFrom.x),stroke:N.strokeColor,strokeWidth:N.strokeWidth,fill:"rgba(255, 255, 255, 0)"})}function c(){let y=A.mouseTo.x-A.mouseFrom.x,S=A.mouseTo.y-A.mouseFrom.y,x=Math.sqrt(Math.pow(y,2)+Math.pow(S,2))/2;return new ut.fabric.Circle({left:A.mouseFrom.x,top:A.mouseFrom.y,stroke:N.strokeColor,fill:"rgba(255, 255, 255, 0)",radius:x,strokeWidth:N.strokeWidth})}function a(){let y=A.mouseFrom.x,S=A.mouseFrom.y;return new ut.fabric.Ellipse({left:y,top:S,fill:"rgba(255, 255, 255, 0)",originX:"center",originY:"center",rx:Math.abs(y-A.mouseTo.x),ry:Math.abs(S-A.mouseTo.y),stroke:N.strokeColor,strokeWidth:N.strokeWidth})}function r(){let y=A.mouseTo.y-A.mouseFrom.y;return new ut.fabric.Triangle({top:A.mouseFrom.y,left:A.mouseFrom.x,width:Math.sqrt(Math.pow(y,2)+Math.pow(y/2,2)),height:y,stroke:N.strokeColor,strokeWidth:N.strokeWidth,fill:"rgba(255,255,255,0)"})}function o(){let[y,S]=[A.mouseFrom.x,A.mouseFrom.y],[x,O]=[A.mouseTo.x,A.mouseTo.y],E=S-O,L=y-x,B=30,Y=30,U=Math.atan2(E,L)*180/Math.PI,b=(U+B)*Math.PI/180,k=(U-B)*Math.PI/180,P=Y*Math.cos(b),M=Y*Math.sin(b),z=Y*Math.cos(k),w=Y*Math.sin(k),T=y-P,D=S-M,F=" M "+y+" "+S;return F+=" L "+x+" "+O,T=x+P,D=O+M,F+=" M "+T+" "+D,F+=" L "+x+" "+O,T=x+z,D=O+w,F+=" L "+T+" "+D,new ut.fabric.Path(F,{stroke:N.strokeColor,strokeWidth:N.strokeWidth,fill:"rgba(255,255,255,0)"})}function l(){let{x:y,y:S}=A.mouseFrom;A.textObj=new ut.fabric.Textbox("",{left:y,top:S,width:"",height:"",fill:N.strokeColor,hasControls:!0}),A.boardObj.add(A.textObj),A.textObj.enterEditing(),A.textObj.hiddenTextarea.focus(),f()}function f(){Z.data.push(JSON.stringify(A.boardObj)),C()}function g(){let y=Z.data;Z.stage<y.length&&(A.boardObj.clear().renderAll(),A.boardObj.loadFromJSON(y[y.length-1-Z.stage-1]),A.boardObj.renderAll(),Z.stage+=1,C())}function m(){let y=Z.data;Z.stage>0&&(A.boardObj.clear().renderAll(),A.boardObj.loadFromJSON(y[y.length-1-Z.stage+1]),A.boardObj.renderAll(),Z.stage-=1,C())}function v(){let S=A.boardObj.toDataURL({formart:"png",multiplier:2}).split(","),x=S[0].match(/:(.*?);/)[1],O=atob(S[1]),E=O.length,L=new Uint8Array(E);for(;E--;)L[E]=O.charCodeAt(E);let B=new Blob([L],{type:x});ie.saveAs(B,"sketchpad.png")}const p=Yt(null);function _(y){let S=y.target.files[0],x=new FileReader;x.onload=O=>{let E=O.target.result,L=new Image;L.src=E,L.onload=()=>{const B=new ut.fabric.Image(L);B.scale(.5),A.boardObj.centerObject(B).add(B).renderAll(),p.value.value=""}},x.readAsDataURL(S)}function C(){const y={set:{canvas:{width:at.width,height:at.height,bgColor:at.bgColor},stroke:{size:N.strokeWidth,color:N.strokeColor}},json:A.boardObj.toJSON()};d("save",y)}return(y,S)=>(lt(),dt("div",{class:"x-whiteboard",style:Mt({width:at.width+"px",height:at.height+"px"})},[_t("input",{type:"file",accept:"image/*",id:"x-whiteboard-upload",ref_key:"upload",ref:p,onChange:S[0]||(S[0]=x=>_(x))},null,544),_t("ul",{class:"x-tool-bar",style:Mt(y.toolPosition)},[(lt(!0),dt(Wt,null,Ut(et(re),x=>(lt(),dt("li",{key:x.type,class:kt(["tool-con",{active:N.type===x.type}]),onClick:O=>h(x.type)},[x.type==="upload"?(lt(),dt("label",se,[_t("i",{class:kt(["iconfont",x.icon])},null,2)])):(lt(),dt("i",{key:1,class:kt(["iconfont",x.icon])},null,2))],10,ne))),128))],4),_t("canvas",ae,null,512)],4))}});const le=jt(he,[["__scopeId","data-v-2c999ac0"]]),ce={name:"WhiteboardEditor"},ue=Dt({...ce,setup(W){const d=Ft("contentName"),$=Ft("contentIdentity");Qt(ft,$,["content"],d);const Z=Pt(()=>ft.item[$.value].content.setting.canvas),at=Pt(()=>ft.item[$.value].content.setting.stroke),N=Pt(()=>({left:ct.menuDrawer.collapse?"28px":"228px",top:"58px"}));function A(u){const{set:{canvas:e,stroke:h},json:i}=u,t={canvas:{width:e.width,height:e.height,bgColor:e.bgColor},stroke:{size:h.size,color:h.color}};ft.item[$.value].content.setting=t,ft.item[$.value].content.content=i}return(u,e)=>(lt(),Ot(le,{"tool-position":N.value,"canvas-width":Z.value.width,"canvas-height":Z.value.height,"canvas-bg-color":Z.value.bgColor,"stroke-color":at.value.color,"stroke-width":at.value.size,"init-data":et(ft).item[et($)].content.content,onSave:A},null,8,["tool-position","canvas-width","canvas-height","canvas-bg-color","stroke-color","stroke-width","init-data"]))}}),fe={class:"warp_bigger whiteboard_area"},de={key:0,class:"show_area"},ge={class:"tw-flex tw-justify-end tw-items-center"},me={key:0},ve={class:"tw-ml-4"},pe={key:0,class:"editor-area"},_e={name:"ModuleWhiteboard"},ye=Dt({..._e,setup(W){const d=Ft("storeIDB"),{curContentIdentity:$,curContentName:Z,curContentFolderIdentity:at,curFolders:N,curHistoryFolders:A,curIsSaved:u,addFolder:e,renameFolder:h,deleteFolder:i,sortFolder:t,createContent:s,saveContent:n,showContent:c,renameContent:a,copyContent:r,deleteContent:o,autoSaveContent:l,importContent:f,getContent:g,saveFolder:m,saveContentItem:v}=Nt(d,te,ft,ee());st("contentIsSaved",u),st("contentFolderIdentity",at),st("contentIdentity",$),st("contentName",Z),st("historyFolders",A),st("folders",N),st("addFolder",e),st("renameFolder",h),st("deleteFolder",i),st("showContent",c),st("copyContent",r),st("renameContent",a),st("deleteContent",o),st("sortFolder",t),st("saveContent",n),st("autoSaveContent",l),st("getContent",g),st("saveFolder",m),st("saveContentItem",v);function p(){s()}function _(C){ct.loading=!0;const{name:y,content:S,isSave:x,folderIdentity:O}=C;f(y,S,x,O,xt).then(()=>{ct.loading=!1}).catch(()=>{ct.loading=!1})}return(C,y)=>(lt(),dt("div",fe,[yt($t,{collapse:et(ct).historyDrawer.collapse,"onUpdate:collapse":y[2]||(y[2]=S=>et(ct).historyDrawer.collapse=S),history:et(ct).historyDrawer,suffix:et(xt)},{default:Et(()=>[et($)?(lt(),dt("div",de,[yt(Ht,{title:et(Zt)(`module.${et(ct).module}`),contentName:et(Z),"onUpdate:contentName":y[1]||(y[1]=S=>zt(Z)?Z.value=S:null),"is-has-name":!0},{titleRight:Et(()=>[_t("div",ge,[et($)?(lt(),dt("span",me,[yt(Vt,{"store-item-data":et(ft).item[et($)]},null,8,["store-item-data"])])):St("",!0),_t("span",ve,[yt(qt,{"support-types":["text/plain"],accept:[et(xt)],"store-item-data":et(ft).item[et($)],suffix:et(xt),onSelect:p,onContent:_},null,8,["accept","store-item-data","suffix"])]),yt(Kt,Gt({class:"tw-ml-2"},C.$attrs),null,16),et(ct).historyDrawer.collapse?(lt(),Ot(Jt,{key:1,class:"tw-ml-2",visible:et(ct).historyDrawer.visible,"onUpdate:visible":y[0]||(y[0]=S=>et(ct).historyDrawer.visible=S)},null,8,["visible"])):St("",!0)])]),default:Et(()=>[et($)?(lt(),dt("div",pe,[(lt(),Ot(ue,{key:et($)}))])):St("",!0)]),_:1},8,["title","contentName"])])):St("",!0)]),_:1},8,["collapse","history","suffix"])]))}});const Ce=jt(ye,[["__scopeId","data-v-2536e434"]]),Ke=Dt({__name:"Whiteboard",setup(W){return(d,$)=>(lt(),Ot(Ce))}});export{Ke as default};
