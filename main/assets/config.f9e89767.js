var S=Object.defineProperty;var D=(i,e,t)=>e in i?S(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var b=(i,e,t)=>(D(i,typeof e!="symbol"?e+"":e,t),t);import{g as f}from"./dateLib.63528a18.js";import{E as h}from"./index.611b52b0.js";var g=(i=>(i.INDEXEDDB="indexedDB",i.LOCALSTORAGE="localstorage",i))(g||{}),m=(i=>(i.ReadOnly="readonly",i.ReadWrite="readwrite",i))(m||{});class w{constructor(e){if(this.version=0,this.dbName=e,!this.isSupport)throw Error("Browser not support indexDB.")}isSupport(){return!!window.indexedDB}connect(e=0){return new Promise((t,a)=>{if(this.isSupport()){e&&(this.version=e);const r=window.indexedDB.open(this.dbName,this.version);r.onblocked=()=>{alert("Close other Tab for change version")},r.onerror=s=>{console.log("e",s),a(s)},e?r.onupgradeneeded=s=>{t(s.target.result)}:r.onsuccess=()=>{t(r.result)}}})}checkTableIsExists(e,t){return new Promise((a,r)=>{this.connect(t).then(s=>{let o=!1;s.objectStoreNames.contains(e)&&(o=!0),a({db:s,isContain:o})}).catch(s=>{r(s)})})}createTable(e,t,a,r=[]){return new Promise((s,o)=>{this.checkTableIsExists(t,e).then(n=>{const{db:l,isContain:u}=n;if(!u){let c;a==="autoIncrement"?c={autoIncrement:!0}:c={keyPath:a};const d=l.createObjectStore(t,c);r.length>0&&r.forEach(p=>{d.createIndex(p.name,p.keyPath,p.option||{})})}s(!0)}).catch(n=>{o(n)})})}getTransaction(e,t){return new Promise((a,r)=>{this.connect().then(s=>{const o=s.transaction([e],t);o.onerror=n=>{r(n)},a(o.objectStore(e))})})}get(e,t,a=""){return new Promise((r,s)=>{this.getTransaction(e,m.ReadOnly).then(o=>{let n;a?n=o.index(a).get(t):n=o.get(t),n.onsuccess=l=>{r(l.target.result)},n.onerror=l=>{s(l)}})})}set(e,t){return new Promise(a=>{this.getTransaction(e,m.ReadWrite).then(r=>{const s={success:[],failed:[]};t.forEach(o=>{const n=r.put(o);n.onsuccess=()=>{s.success.push(o)},n.onerror=()=>{s.failed.push(o)}}),a(s)})})}add(e,t){return new Promise(a=>{this.getTransaction(e,m.ReadWrite).then(r=>{const s={success:[],failed:[]};t.forEach(o=>{const n=r.add(o);n.onsuccess=()=>{s.success.push(o)},n.onerror=()=>{s.failed.push(o)}}),a(s)})})}delete(e,t){return new Promise(a=>{this.getTransaction(e,m.ReadWrite).then(r=>{const s={success:[],failed:[]};t.forEach(o=>{const n=r.delete(o);n.onsuccess=()=>{s.success.push(o)},n.onerror=()=>{s.failed.push(o)}}),a(s)})})}clear(e){return new Promise((t,a)=>{this.getTransaction(e,m.ReadWrite).then(r=>{const s=r.clear();s.onsuccess=()=>{t(!0)},s.onerror=()=>{a(!1)}})})}getAll(e){return new Promise((t,a)=>{this.getTransaction(e,m.ReadOnly).then(r=>{let s=[],o;r.getAll?(o=r.getAll(),o.onsuccess=n=>{s=n.target.result,t(s)},o.onerror=n=>{a(n)}):(o=r.openCursor(),o.onsuccess=n=>{const l=n.target.result;l?(s.push(l.value),l.continue()):t(s)},o.onerror=n=>{a(n)})})})}}class P{constructor(e){if(this.tableKeyPath={},this.dbName=e,!this.isSupport)throw Error("Browser not support LocalStorage.")}isSupport(){return!!window.localStorage}createTable(e,t,a){return new Promise(r=>{this.tableKeyPath[t]=a,r(!0)})}_get(e){return localStorage.getItem(e)}_set(e,t){return localStorage.setItem(e,t)}_getDBData(){return new Promise((e,t)=>{try{let a={};const r=this._get(this.dbName);if(r)try{a=JSON.parse(r)}catch{a={}}e(a)}catch(a){t(a)}})}_setDBData(e){return new Promise((t,a)=>{try{this._set(this.dbName,JSON.stringify(e)),t("")}catch(r){a(r)}})}get(e,t,a=""){return new Promise((r,s)=>{this._getDBData().then(o=>{const n=o[e]||[],l=a||this.tableKeyPath[e];let u;n.forEach(c=>{c[l]===t&&(u=c)}),r(u)}).catch(o=>{s(o)})})}getAll(e){return new Promise((t,a)=>{this._getDBData().then(r=>{t((r==null?void 0:r[e])||"")}).catch(r=>{a(r)})})}set(e,t){return new Promise((a,r)=>{this._getDBData().then(s=>{const o=s,n=o[e]||[],l=this.tableKeyPath[e],u=[];n.forEach(c=>{u.push(c[l])}),t.forEach(c=>{const d=u.indexOf(c[l]);d>-1?n[d]=c:n.push(c)}),o[e]=n,this._setDBData(o).then(()=>{a(!0)}).catch(c=>{r(c)})}).catch(s=>{r(s)})})}add(e,t){return new Promise((a,r)=>{this._getDBData().then(s=>{const o=s,n=o[e]||[],l=[],u=this.tableKeyPath[e];n.forEach(c=>{l.push(c[u])}),t.forEach(c=>{l.includes(c[u])||n.push(c)}),o[e]=n,this._setDBData(o).then(()=>{a(!0)}).catch(c=>{r(c)})}).catch(s=>{r(s)})})}delete(e,t){return new Promise((a,r)=>{this._getDBData().then(s=>{const o=[],n=s[e]||[],l=this.tableKeyPath[e];n.forEach(u=>{t.includes(u[l])||o.push(u)}),s[e]=o,this._setDBData(s).then(()=>{a("")}).catch(u=>{r(u)})}).catch(s=>{r(s)})})}clear(e){return new Promise((t,a)=>{this._getDBData().then(r=>{const s={...r};delete s[e],this._setDBData(s).then(()=>{t("")}).catch(o=>{a(o)})}).catch(r=>{a(r)})})}}class v{constructor(e){this.version=1,this.dbName="x_db",this.tableName="x_table",this.useStores=[g.INDEXEDDB,g.LOCALSTORAGE];try{e!=null&&e.dbName&&(this.dbName=e.dbName),e!=null&&e.tableName&&(this.tableName=e.tableName),e!=null&&e.useStores&&(this.useStores=e.useStores);for(let t=0;t<this.useStores.length;t+=1){switch(this.useStores[t]){case g.INDEXEDDB:this.storeIns=new w(this.dbName);break;case g.LOCALSTORAGE:this.storeIns=new P(this.dbName);break}if(this.storeIns.isSupport())break}}catch(t){throw new Error(t)}if(!this.storeIns.isSupport())throw new Error("browser not support")}getVersion(){return this.version}createTable(e,t=[],a=0){this.version=a,this.storeIns.createTable(this.version,this.tableName,e,t)}set(e){return this.storeIns.set(this.tableName,e)}add(e){return this.storeIns.add(this.tableName,e)}get(e,t=""){return this.storeIns.get(this.tableName,e,t)}getAll(){return this.storeIns.getAll(this.tableName)}delete(e){return this.storeIns.delete(this.tableName,e)}clear(){return this.storeIns.clear(this.tableName)}}var N=(i=>(i.Config="config",i.Folder="folder",i.Content="content",i.Env="env",i))(N||{}),y=(i=>(i.Key="key",i.Type="type",i.Value="value",i.Datetime="datetime",i))(y||{});class _{constructor(e,t=1){b(this,"storeIns");b(this,"storageName","");b(this,"version",1);this.storageName=e,this.version=t}getStorageConfig(){return{dbName:"useful",tableName:this.storageName,useStores:["indexedDB","localstorage"]}}initStorageIns(){this.storeIns=new v(this.getStorageConfig()),this.storeIns.createTable("key",[{name:"key",keyPath:"key"},{name:"type",keyPath:"type"},{name:"value",keyPath:"value"},{name:"datetime",keyPath:"datetime"}],this.version)}getStoreIns(){return this.storeIns||this.initStorageIns(),this.storeIns}getStorageName(){return this.storageName}getStorageAllData(){return this.getStoreIns().getAll()}getStorageData(e,t="key"){return this.getStoreIns().get(e,t)}saveStorage(e){const t=[{...e,datetime:f()}];return this.getStoreIns().set(t)}delStorage(e){return this.getStoreIns().delete(e)}}const B=[{value:h.Format,label:`module.${h.Format}`,path:{name:h.Format}},{value:h.Coding,label:`module.${h.Coding}`,path:{name:h.Coding}},{value:h.Compare,label:`module.${h.Compare}`,path:{name:h.Compare}},{value:h.Timestamp,label:`module.${h.Timestamp}`,path:{name:h.Timestamp}},{value:h.Decimal,label:`module.${h.Decimal}`,path:{name:h.Decimal}},{value:h.Poster,label:`module.${h.Poster}`,path:{name:h.Poster}},{value:h.Socket,label:`module.${h.Socket}`,path:{name:h.Socket}},{value:h.Typing,label:`module.${h.Typing}`,path:{name:h.Typing}},{value:h.Whiteboard,label:`module.${h.Whiteboard}`,path:{name:h.Whiteboard}}];var I=(i=>(i.Config="config",i))(I||{}),E=(i=>(i.Common="common",i))(E||{});export{_ as C,E,I as a,N as b,B as c,y as d};
