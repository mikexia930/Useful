var Qe=Object.defineProperty;var et=(g,U,f)=>U in g?Qe(g,U,{enumerable:!0,configurable:!0,writable:!0,value:f}):g[U]=f;var le=(g,U,f)=>(et(g,typeof U!="symbol"?U+"":U,f),f);import{q as de,bh as ye,g as b,m as Re,s as Xe,d as he,b as Ge,M as ce,o as te,x as ve,w as K,v as C,a as F,$ as A,a0 as q,z as ke,c as ue,y as Ce,bm as tt,K as be,t as it,U as nt,O as ot,as as Oe,S as V,a4 as ne,av as st,a1 as at}from"./index.c3214609.js";import{_ as rt,U as lt}from"./UIWithTitle.ecee8726.js";import{f as Pe,a as qe,b as dt,c as ht,d as _t,e as ct,U as ut}from"./UICreateImport.vue_vue_type_script_setup_true_lang.58b157a9.js";import{u as ft}from"./PortImport.vue_vue_type_script_setup_true_lang.803ac0fc.js";import{g as $e}from"./randomLib.04c6c9cc.js";import{u as pt}from"./ModuleAutoSaveLib.c58791b0.js";import{_ as Ye}from"./DSpin.d6233a34.js";import{_ as je}from"./DInputNumber.vue_vue_type_script_setup_true_lang.5c02b878.js";import{_ as Se,D as vt}from"./DUploadImgPreview.6408d307.js";import{_ as Le}from"./DSelect.vue_vue_type_script_setup_true_lang.8a285078.js";import{_ as Ae}from"./DButton.vue_vue_type_script_setup_true_lang.e16dae94.js";import{s as ze,E as Ne,_ as Je,a as Ke}from"./Interface.dbd528a2.js";import{_ as Me}from"./_plugin-vue_export-helper.cdc0426e.js";import"./DTooltip.0f458019.js";import"./_baseIsEqual.5cb87b9a.js";import"./ModuleCollapsetLib.64a30fa6.js";import"./routeLib.772d14c3.js";import"./findIndex.df2567c0.js";import"./hasIn.93447342.js";import"./memoize.bfe40189.js";import"./index.7f436b9e.js";import"./KeyCode.9e37adda.js";import"./pick.13f70975.js";import"./_flatRest.c8325c51.js";import"./styleChecker.995dbee2.js";import"./debounce.fb34cc77.js";import"./now.4cfd5464.js";import"./DResult.vue_vue_type_script_setup_true_lang.78329022.js";import"./fileLib.c4bc32da.js";import"./config.aa76b2c0.js";import"./stringify.15412eb9.js";import"./DPopover.vue_vue_type_style_index_0_lang.0d82634e.js";import"./DUpload.3ee7df55.js";import"./index.4a90695f.js";import"./index.279ed12a.js";import"./Col.df8743ce.js";import"./responsiveObserve.65b40bc4.js";import"./last.934f6069.js";var G=(g=>(g.Default="default",g.Primary="primary",g.Warning="warning",g.Danger="danger",g.Success="success",g.Info="info",g.GreenSea="greensea",g.Nephrite="nephrite",g.BelizeHole="belizehole",g.Wisteria="wisteria",g.Asphalt="asphalt",g.Orange="orange",g.Pumpkin="pumpkin",g.Pomegranate="pomegranate",g.Clouds="clouds",g.Asbestos="asbestos",g))(G||{}),Ie=(g=>(g.NodeTree="node_tree",g.NodeArray="node_array",g.FreeMind="freemind",g))(Ie||{}),De=(g=>(g.Full="full",g.Side="side",g))(De||{}),Ze=(g=>(g.Debug="debug",g.Info="info",g.Warn="warn",g.Error="error",g.Disable="disable",g))(Ze||{}),Te=(g=>(g.Canvas="canvas",g.Svg="svg",g))(Te||{}),Ee=(g=>(g.Hidden="hidden",g.Wrap="wrap",g))(Ee||{});const H=de({config:{theme:G.GreenSea,mode:De.Full,layout:{hspace:30,vspace:20},view:{engine:Te.Canvas,line_width:1,line_color:"#c1c1c1",node_overflow:Ee.Wrap}},folders:[],item:{}}),_e=de({isExportImage:!1,isExportFreemind:!1,isPositionRoot:!1,zoom:0}),xe=".mind",gt={[ye.Config]:"mind_config",[ye.Folder]:"mind_folder",[ye.Content]:"mind_content",[ye.Env]:"mind_env"};function mt(){return{content:{config:{layout:H.config.layout,mode:H.config.mode,theme:H.config.theme,view:H.config.view},data:{meta:{name:b("name.unnamed"),author:"",version:"0.2"},format:Ie.NodeTree,data:{id:"root",topic:b("mind.name.root"),children:[]}}},isSaved:0}}var Be={exports:{}};/**
* @license BSD-3-Clause
* @copyright 2014-2023 hizzgdev@163.com
*
* Project Home:
*   https://github.com/hizzgdev/jsmind/
*/var He;function Fe(){return He||(He=1,function(g,U){(function(f,D){g.exports=D()})(Re,function(){const f="0.7.8",D="hizzgdev@163.com";typeof String.prototype.startsWith!="function"&&(String.prototype.startsWith=function(s){return this.slice(0,s.length)===s});const _={left:-1,center:0,right:1,of:function(s){return s&&s!==-1&&s!==0&&s!==1?s==="-1"||s==="0"||s==="1"?parseInt(s):s.toLowerCase()==="left"?this.left:s.toLowerCase()==="right"?this.right:s.toLowerCase()==="center"?this.center:void 0:s}},y={show:1,resize:2,edit:3,select:4},w={debug:1,info:2,warn:3,error:4,disable:9};var T=function(){};let v=typeof console>"u"?{level:T,log:T,debug:T,info:T,warn:T,error:T}:{level:function(s){v.debug=s>w.debug?T:console.debug,v.info=s>w.info?T:console.info,v.warn=s>w.warn?T:console.warn,v.error=s>w.error?T:console.error},log:console.log,debug:console.debug,info:console.info,warn:console.warn,error:console.error};const x=new class{constructor(s){this.w=s,this.d=s.document,this.g=function(e){return this.d.getElementById(e)},this.c=function(e){return this.d.createElement(e)},this.t=function(e,t){e.hasChildNodes()?e.firstChild.nodeValue=t:e.appendChild(this.d.createTextNode(t))},this.h=function(e,t){t instanceof HTMLElement?(e.innerHTML="",e.appendChild(t)):e.innerHTML=t},this.i=function(e){return!!e&&typeof e=="object"&&e.nodeType===1&&typeof e.style=="object"&&typeof e.ownerDocument=="object"},this.on=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)}}}(window),S={ajax:{request:function(s,e,t,i,n){var o=Object.keys(e).map(c=>encodeURIComponent(c)+"="+encodeURIComponent(e[c])).join("&"),r=new XMLHttpRequest;r&&(r.onreadystatechange=function(){if(r.readyState==4)if(r.status==200||r.status==0){if(typeof i=="function"){var c=S.json.string2json(r.responseText);i(c!=null?c:r.responseText)}}else typeof n=="function"?n(r):v.error("xhr request failed.",r)},t=t||"GET",r.open(t,s,!0),r.setRequestHeader("If-Modified-Since","0"),t=="POST"?(r.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.send(o)):r.send())},get:function(s,e){return S.ajax.request(s,{},"GET",e)},post:function(s,e,t){return S.ajax.request(s,e,"POST",t)}},file:{read:function(s,e){var t=new FileReader;t.onload=function(){typeof e=="function"&&e(this.result,s.name)},t.readAsText(s)},save:function(s,e,t){var i;if(typeof x.w.Blob=="function")i=new Blob([s],{type:e});else{var n=new(x.w.BlobBuilder||x.w.MozBlobBuilder||x.w.WebKitBlobBuilder||x.w.MSBlobBuilder);n.append(s),i=n.getBlob(e)}if(navigator.msSaveBlob)navigator.msSaveBlob(i,t);else{var o=(x.w.URL||x.w.webkitURL).createObjectURL(i),r=x.c("a");if("download"in r){r.style.visibility="hidden",r.href=o,r.download=t,x.d.body.appendChild(r);var c=x.d.createEvent("MouseEvents");c.initEvent("click",!0,!0),r.dispatchEvent(c),x.d.body.removeChild(r)}else location.href=o}}},json:{json2string:function(s){return JSON.stringify(s)},string2json:function(s){return JSON.parse(s)},merge:function(s,e){for(var t in e)t in s?typeof s[t]!="object"||Object.prototype.toString.call(s[t]).toLowerCase()!="[object object]"||s[t].length?s[t]=e[t]:S.json.merge(s[t],e[t]):s[t]=e[t];return s}},uuid:{newid:function(){return(new Date().getTime().toString(16)+Math.random().toString(16).substring(2)).substring(2,18)}},text:{is_empty:function(s){return!s||s.replace(/\s*/,"").length==0}}},d={container:"",editable:!1,theme:null,mode:"full",support_html:!0,log_level:"info",view:{engine:"canvas",hmargin:100,vmargin:50,line_width:2,line_color:"#555",line_style:"curved",draggable:!1,hide_scrollbars_when_draggable:!1,node_overflow:"hidden",zoom:{min:.5,max:2.1,step:.1},custom_node_render:null,expander_style:"char"},layout:{hspace:30,vspace:20,pspace:13,cousin_space:0},default_event_handle:{enable_mousedown_handle:!0,enable_click_handle:!0,enable_dblclick_handle:!0,enable_mousewheel_handle:!0},shortcut:{enable:!0,handles:{},mapping:{addchild:[45,4109],addbrother:13,editnode:113,delnode:46,toggle:32,left:37,up:38,right:39,down:40}},plugin:{}};class a{constructor(e,t,i,n,o,r,c,h){e?typeof t=="number"?(h===void 0&&(h=!0),this.id=e,this.index=t,this.topic=i,this.data=n||{},this.isroot=o,this.parent=r,this.direction=c,this.expanded=!!h,this.children=[],this._data={}):v.error("invalid node index"):v.error("invalid node id")}get_location(){var e=this._data.view;return{x:e.abs_x,y:e.abs_y}}get_size(){var e=this._data.view;return{w:e.width,h:e.height}}static compare(e,t){var i=e.index,n=t.index;return i>=0&&n>=0?i-n:i==-1&&n==-1?0:i==-1?1:n==-1?-1:0}static inherited(e,t){if(e&&t){if(e.id===t.id||e.isroot)return!0;for(var i=e.id,n=t;!n.isroot;)if((n=n.parent).id===i)return!0}return!1}static is_node(e){return!!e&&e instanceof a}}class l{constructor(){this.name=null,this.author=null,this.version=null,this.root=null,this.selected=null,this.nodes={}}get_node(e){return e in this.nodes?this.nodes[e]:(v.warn("the node[id="+e+"] can not be found"),null)}set_root(e,t,i){return this.root==null?(this.root=new a(e,0,t,i,!0),this._put_node(this.root),this.root):(v.error("root node is already exist"),null)}add_node(e,t,i,n,o,r,c){if(!a.is_node(e))return v.error("the parent_node "+e+" is not a node."),null;var h=new a(t,c||-1,i,n,!1,e,e.direction,r);return e.isroot&&(h.direction=o||_.right),this._put_node(h)?(e.children.push(h),this._update_index(e)):(v.error("fail, the node id '"+h.id+"' has been already exist."),h=null),h}insert_node_before(e,t,i,n,o){if(!a.is_node(e))return v.error("the node_before "+e+" is not a node."),null;var r=e.index-.5;return this.add_node(e.parent,t,i,n,o,!0,r)}get_node_before(e){if(!a.is_node(e)){var t=this.get_node(e);return t?this.get_node_before(t):(v.error("the node[id="+e+"] can not be found."),null)}if(e.isroot)return null;var i=e.index-2;return i>=0?e.parent.children[i]:null}insert_node_after(e,t,i,n,o){if(!a.is_node(e))return v.error("the node_after "+e+" is not a node."),null;var r=e.index+.5;return this.add_node(e.parent,t,i,n,o,!0,r)}get_node_after(e){if(!a.is_node(e)){var t=this.get_node(e);return t?this.get_node_after(t):(v.error("the node[id="+e+"] can not be found."),null)}if(e.isroot)return null;var i=e.index;return e.parent.children.length>i?e.parent.children[i]:null}move_node(e,t,i,n){return a.is_node(e)?(i||(i=e.parent.id),this._move_node(e,t,i,n)):(v.error("the parameter node "+e+" is not a node."),null)}_flow_node_direction(e,t){t===void 0?t=e.direction:e.direction=t;for(var i=e.children.length;i--;)this._flow_node_direction(e.children[i],t)}_move_node_internal(e,t){if(e&&t)if(t=="_last_")e.index=-1,this._update_index(e.parent);else if(t=="_first_")e.index=0,this._update_index(e.parent);else{var i=t?this.get_node(t):null;i!=null&&i.parent!=null&&i.parent.id==e.parent.id&&(e.index=i.index-.5,this._update_index(e.parent))}return e}_move_node(e,t,i,n){if(e&&i){var o=this.get_node(i);if(a.inherited(e,o))return v.error("can not move a node to its children"),null;if(e.parent.id!=i){for(var r=e.parent.children,c=r.length;c--;)if(r[c].id==e.id){r.splice(c,1);break}e.parent=o,o.children.push(e)}e.parent.isroot?n==_.left?e.direction=n:e.direction=_.right:e.direction=e.parent.direction,this._move_node_internal(e,t),this._flow_node_direction(e)}return e}remove_node(e){if(!a.is_node(e))return v.error("the parameter node "+e+" is not a node."),!1;if(e.isroot)return v.error("fail, can not remove root node"),!1;this.selected!=null&&this.selected.id==e.id&&(this.selected=null);for(var t=e.children,i=t.length;i--;)this.remove_node(t[i]);t.length=0;for(var n=e.parent.children,o=n.length;o--;)if(n[o].id==e.id){n.splice(o,1);break}for(var r in delete this.nodes[e.id],e)delete e[r];return e=null,!0}_put_node(e){return e.id in this.nodes?(v.warn("the node_id '"+e.id+"' has been already exist."),!1):(this.nodes[e.id]=e,!0)}_update_index(e){if(e instanceof a){e.children.sort(a.compare);for(var t=0;t<e.children.length;t++)e.children[t].index=t+1}}}const u={node_tree:{example:{meta:{name:"jsMind node_tree simple",author:D,version:f},format:"node_tree",data:{id:"root",topic:"jsMind Example"}},get_mind:function(s){var e=u.node_tree,t=new l;return t.name=s.meta.name,t.author=s.meta.author,t.version=s.meta.version,e._parse(t,s.data),t},get_data:function(s){var e=u.node_tree,t={};return t.meta={name:s.name,author:s.author,version:s.version},t.format="node_tree",t.data=e._build_node(s.root),t},_parse:function(s,e){var t=u.node_tree,i=t._extract_data(e);if(s.set_root(e.id,e.topic,i),"children"in e)for(var n=e.children,o=0;o<n.length;o++)t._extract_subnode(s,s.root,n[o])},_extract_data:function(s){var e={};for(var t in s)t!="id"&&t!="topic"&&t!="children"&&t!="direction"&&t!="expanded"&&(e[t]=s[t]);return e},_extract_subnode:function(s,e,t){var i=u.node_tree,n=i._extract_data(t),o=null;e.isroot&&(o=t.direction=="left"?_.left:_.right);var r=s.add_node(e,t.id,t.topic,n,o,t.expanded);if(t.children)for(var c=t.children,h=0;h<c.length;h++)i._extract_subnode(s,r,c[h])},_build_node:function(s){var e=u.node_tree;if(s instanceof a){var t={id:s.id,topic:s.topic,expanded:s.expanded};if(s.parent&&s.parent.isroot&&(t.direction=s.direction==_.left?"left":"right"),s.data!=null){var i=s.data;for(var n in i)t[n]=i[n]}var o=s.children;if(o.length>0){t.children=[];for(var r=0;r<o.length;r++)t.children.push(e._build_node(o[r]))}return t}}},node_array:{example:{meta:{name:"jsMind node_array simple",author:D,version:f},format:"node_array",data:[{id:"root",topic:"jsMind Example",isroot:!0}]},get_mind:function(s){var e=u.node_array,t=new l;return t.name=s.meta.name,t.author=s.meta.author,t.version=s.meta.version,e._parse(t,s.data),t},get_data:function(s){var e=u.node_array,t={};return t.meta={name:s.name,author:s.author,version:s.version},t.format="node_array",t.data=[],e._array(s,t.data),t},_parse:function(s,e){var t=u.node_array,i=e.slice(0);i.reverse();var n=t._extract_root(s,i);n?t._extract_subnode(s,n,i):v.error("root node can not be found")},_extract_root:function(s,e){for(var t=u.node_array,i=e.length;i--;)if("isroot"in e[i]&&e[i].isroot){var n=e[i],o=t._extract_data(n),r=s.set_root(n.id,n.topic,o);return e.splice(i,1),r}return null},_extract_subnode:function(s,e,t){for(var i=u.node_array,n=t.length,o=null,r=null,c=0;n--;)if((o=t[n]).parentid==e.id){r=i._extract_data(o);var h=null,p=o.direction;p&&(h=p=="left"?_.left:_.right);var M=s.add_node(e,o.id,o.topic,r,h,o.expanded);t.splice(n,1),c++;var R=i._extract_subnode(s,M,t);R>0&&(n=t.length,c+=R)}return c},_extract_data:function(s){var e={};for(var t in s)t!="id"&&t!="topic"&&t!="parentid"&&t!="isroot"&&t!="direction"&&t!="expanded"&&(e[t]=s[t]);return e},_array:function(s,e){u.node_array._array_node(s.root,e)},_array_node:function(s,e){var t=u.node_array;if(s instanceof a){var i={id:s.id,topic:s.topic,expanded:s.expanded};if(s.parent&&(i.parentid=s.parent.id),s.isroot&&(i.isroot=!0),s.parent&&s.parent.isroot&&(i.direction=s.direction==_.left?"left":"right"),s.data!=null){var n=s.data;for(var o in n)i[o]=n[o]}e.push(i);for(var r=s.children.length,c=0;c<r;c++)t._array_node(s.children[c],e)}}},freemind:{example:{meta:{name:"jsMind freemind example",author:D,version:f},format:"freemind",data:'<map version="1.0.1"><node ID="root" TEXT="freemind Example"/></map>'},get_mind:function(s){var e=u.freemind,t=new l;t.name=s.meta.name,t.author=s.meta.author,t.version=s.meta.version;var i=s.data,n=e._parse_xml(i),o=e._find_root(n);return e._load_node(t,null,o),t},get_data:function(s){var e=u.freemind,t={};t.meta={name:s.name,author:s.author,version:s.version},t.format="freemind";var i=[];return i.push('<map version="1.0.1">'),e._build_map(s.root,i),i.push("</map>"),t.data=i.join(" "),t},_parse_xml:function(s){var e=null;return window.DOMParser?e=new DOMParser().parseFromString(s,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async=!1,e.loadXML(s)),e},_find_root:function(s){for(var e=s.childNodes,t=null,i=null,n=0;n<e.length;n++)if((i=e[n]).nodeType==1&&i.tagName=="map"){t=i;break}if(t){var o=t.childNodes;for(t=null,n=0;n<o.length;n++)if((i=o[n]).nodeType==1&&i.tagName=="node"){t=i;break}}return t},_load_node:function(s,e,t){var i=u.freemind,n=t.getAttribute("ID"),o=t.getAttribute("TEXT");if(o==null){for(var r=t.childNodes,c=null,h=0;h<r.length;h++)if((c=r[h]).nodeType==1&&c.tagName==="richcontent"){o=c.textContent;break}}var p=i._load_attributes(t),M=!("expanded"in p)||p.expanded=="true";delete p.expanded;var R=t.getAttribute("POSITION"),O=null;R&&(O=R=="left"?_.left:_.right);var B=null;B=e?s.add_node(e,n,o,p,O,M):s.set_root(n,o,p);var m=t.childNodes,z=null;for(h=0;h<m.length;h++)(z=m[h]).nodeType==1&&z.tagName=="node"&&i._load_node(s,B,z)},_load_attributes:function(s){for(var e=s.childNodes,t=null,i={},n=0;n<e.length;n++)(t=e[n]).nodeType==1&&t.tagName==="attribute"&&(i[t.getAttribute("NAME")]=t.getAttribute("VALUE"));return i},_build_map:function(s,e){var t=u.freemind,i=null;s.parent&&s.parent.isroot&&(i=s.direction===_.left?"left":"right"),e.push("<node"),e.push('ID="'+s.id+'"'),i&&e.push('POSITION="'+i+'"'),e.push('TEXT="'+s.topic+'">'),e.push('<attribute NAME="expanded" VALUE="'+s.expanded+'"/>');var n=s.data;if(n!=null)for(var o in n)e.push('<attribute NAME="'+o+'" VALUE="'+n[o]+'"/>');for(var r=s.children,c=0;c<r.length;c++)t._build_map(r[c],e);e.push("</node>")}},text:{example:{meta:{name:"jsMind text example",author:D,version:f},format:"text",data:`Text Example
 node1
  node1-sub
  node1-sub
 node2`},_line_regex:/\s*/,get_mind:function(s){var e=u.text,t=new l;t.name=s.meta.name,t.author=s.meta.author,t.version=s.meta.version;var i=s.data.split(/\n|\r/);return e._fill_nodes(t,i,0,0),t},_fill_nodes:function(s,e){let t=[],i=0;for(;i<e.length;){let n=e[i],o=n.match(/\s*/)[0].length,r=n.substr(o);if(o==0&&t.length>0)return void log.error("more than 1 root node was found: "+r);if(o>t.length)return void log.error("a suspended node was found: "+r);let c=t.length-o;for(;c--;)t.pop();if(o==0&&t.length==0){let h=s.set_root(S.uuid.newid(),r);t.push(h)}else{let h=s.add_node(t[o-1],S.uuid.newid(),r,{},null);t.push(h)}i++}t.length=0},get_data:function(s){var e=u.text,t={};t.meta={name:s.name,author:s.author,version:s.version},t.format="text";let i=[];return e._build_lines(i,[s.root],0),t.data=i.join(`
`),t},_build_lines:function(s,e,t){let i=new Array(t+1).join(" ");for(let n of e)s.push(i+n.topic),n.children&&u.text._build_lines(s,n.children,t+1)}}};class P{constructor(e){this.jm=e}init(){v.debug("data.init")}reset(){v.debug("data.reset")}load(e){var t=null,i=null;return(t=typeof e=="object"?e.format?e.format:"node_tree":"freemind")=="node_array"?i=u.node_array.get_mind(e):t=="node_tree"?i=u.node_tree.get_mind(e):t=="freemind"?i=u.freemind.get_mind(e):t=="text"?i=u.text.get_mind(e):v.warn("unsupported format"),i}get_data(e){var t=null;return e=="node_array"?t=u.node_array.get_data(this.jm.mind):e=="node_tree"?t=u.node_tree.get_data(this.jm.mind):e=="freemind"?t=u.freemind.get_data(this.jm.mind):e=="text"?t=u.text.get_data(this.jm.mind):v.error("unsupported "+e+" format"),t}}class L{constructor(e,t){this.opts=t,this.jm=e,this.isside=this.opts.mode=="side",this.bounds=null,this.cache_valid=!1}init(){v.debug("layout.init")}reset(){v.debug("layout.reset"),this.bounds={n:0,s:0,w:0,e:0}}calculate_next_child_direction(e){if(this.isside)return _.right;for(var t=e.children||[],i=t.length,n=0,o=0;o<i;o++)t[o].direction===_.left?n--:n++;return i>1&&n>0?_.left:_.right}layout(){v.debug("layout.layout"),this.layout_direction(),this.layout_offset()}layout_direction(){this._layout_direction_root()}_layout_direction_root(){var e=this.jm.mind.root,t=null;"layout"in e._data?t=e._data.layout:(t={},e._data.layout=t);var i=e.children,n=i.length;if(t.direction=_.center,t.side_index=0,this.isside)for(var o=n;o--;)this._layout_direction_side(i[o],_.right,o);else{o=n;for(var r=null;o--;)(r=i[o]).direction==_.left?this._layout_direction_side(r,_.left,o):this._layout_direction_side(r,_.right,o)}}_layout_direction_side(e,t,i){var n=null;"layout"in e._data?n=e._data.layout:(n={},e._data.layout=n);var o=e.children,r=o.length;n.direction=t,n.side_index=i;for(var c=r;c--;)this._layout_direction_side(o[c],t,c)}layout_offset(){var e=this.jm.mind.root,t=e._data.layout;t.offset_x=0,t.offset_y=0,t.outer_height=0;for(var i=e.children,n=i.length,o=[],r=[],c=null;n--;)(c=i[n])._data.layout.direction==_.right?r.unshift(c):o.unshift(c);t.left_nodes=o,t.right_nodes=r,t.outer_height_left=this._layout_offset_subnodes(o),t.outer_height_right=this._layout_offset_subnodes(r),this.bounds.e=e._data.view.width/2,this.bounds.w=0-this.bounds.e,this.bounds.n=0,this.bounds.s=Math.max(t.outer_height_left,t.outer_height_right)}_layout_offset_subnodes(e){for(var t=0,i=e.length,n=i,o=null,r=0,c=null,h=0,p=null;n--;)c=(o=e[n])._data.layout,p==null&&(p=o.parent._data),r=this._layout_offset_subnodes(o.children),o.expanded||(r=0,this.set_visible(o.children,!1)),r=Math.max(o._data.view.height,r),o.children.length>1&&(r+=this.opts.cousin_space),c.outer_height=r,c.offset_y=h-r/2,c.offset_x=this.opts.hspace*c.direction+p.view.width*(p.layout.direction+c.direction)/2,o.parent.isroot||(c.offset_x+=this.opts.pspace*c.direction),h=h-r-this.opts.vspace,t+=r;i>1&&(t+=this.opts.vspace*(i-1)),n=i;for(var M=t/2;n--;)(o=e[n])._data.layout.offset_y+=M;return t}_layout_offset_subnodes_height(e){for(var t=0,i=e.length,n=i,o=null,r=0,c=null,h=0,p=null;n--;)c=(o=e[n])._data.layout,p==null&&(p=o.parent._data),r=this._layout_offset_subnodes_height(o.children),o.expanded||(r=0),r=Math.max(o._data.view.height,r),o.children.length>1&&(r+=this.opts.cousin_space),c.outer_height=r,c.offset_y=h-r/2,h=h-r-this.opts.vspace,t+=r;i>1&&(t+=this.opts.vspace*(i-1)),n=i;for(var M=t/2;n--;)(o=e[n])._data.layout.offset_y+=M;return t}get_node_offset(e){var t=e._data.layout,i=null;if("_offset_"in t&&this.cache_valid?i=t._offset_:(i={x:-1,y:-1},t._offset_=i),i.x==-1||i.y==-1){var n=t.offset_x,o=t.offset_y;if(!e.isroot){var r=this.get_node_offset(e.parent);n+=r.x,o+=r.y}i.x=n,i.y=o}return i}get_node_point(e){var t=e._data.view,i=this.get_node_offset(e),n={};return n.x=i.x+t.width*(e._data.layout.direction-1)/2,n.y=i.y-t.height/2,n}get_node_point_in(e){return this.get_node_offset(e)}get_node_point_out(e){var t=e._data.layout,i=null;if("_pout_"in t&&this.cache_valid?i=t._pout_:(i={x:-1,y:-1},t._pout_=i),i.x==-1||i.y==-1)if(e.isroot)i.x=0,i.y=0;else{var n=e._data.view,o=this.get_node_offset(e);i.x=o.x+(n.width+this.opts.pspace)*e._data.layout.direction,i.y=o.y}return i}get_expander_point(e){var t=this.get_node_point_out(e),i={};return e._data.layout.direction==_.right?i.x=t.x-this.opts.pspace:i.x=t.x,i.y=t.y-Math.ceil(this.opts.pspace/2),i}get_min_size(){var e=this.jm.mind.nodes,t=null,i=null;for(var n in e)t=e[n],(i=this.get_node_point_out(t)).x>this.bounds.e&&(this.bounds.e=i.x),i.x<this.bounds.w&&(this.bounds.w=i.x);return{w:this.bounds.e-this.bounds.w,h:this.bounds.s-this.bounds.n}}toggle_node(e){e.isroot||(e.expanded?this.collapse_node(e):this.expand_node(e))}expand_node(e){e.expanded=!0,this.part_layout(e),this.set_visible(e.children,!0),this.jm.invoke_event_handle(y.show,{evt:"expand_node",data:[],node:e.id})}collapse_node(e){e.expanded=!1,this.part_layout(e),this.set_visible(e.children,!1),this.jm.invoke_event_handle(y.show,{evt:"collapse_node",data:[],node:e.id})}expand_all(){var e,t=this.jm.mind.nodes,i=0;for(var n in t)(e=t[n]).expanded||(e.expanded=!0,i++);if(i>0){var o=this.jm.mind.root;this.part_layout(o),this.set_visible(o.children,!0)}}collapse_all(){var e,t=this.jm.mind.nodes,i=0;for(var n in t)(e=t[n]).expanded&&!e.isroot&&(e.expanded=!1,i++);if(i>0){var o=this.jm.mind.root;this.part_layout(o),this.set_visible(o.children,!0)}}expand_to_depth(e,t,i){if(!(e<1))for(var n=t||this.jm.mind.root.children,o=i||1,r=n.length,c=null;r--;)c=n[r],o<e&&(c.expanded||this.expand_node(c),this.expand_to_depth(e,c.children,o+1)),o==e&&c.expanded&&this.collapse_node(c)}part_layout(e){var t=this.jm.mind.root;if(t){var i=t._data.layout;e.isroot?(i.outer_height_right=this._layout_offset_subnodes_height(i.right_nodes),i.outer_height_left=this._layout_offset_subnodes_height(i.left_nodes)):e._data.layout.direction==_.right?i.outer_height_right=this._layout_offset_subnodes_height(i.right_nodes):i.outer_height_left=this._layout_offset_subnodes_height(i.left_nodes),this.bounds.s=Math.max(i.outer_height_left,i.outer_height_right),this.cache_valid=!1}else v.warn("can not found root node")}set_visible(e,t){for(var i=e.length,n=null;i--;)(n=e[i])._data.layout,n.expanded?this.set_visible(n.children,t):this.set_visible(n.children,!1),n.isroot||(n._data.layout.visible=t)}is_expand(e){return e.expanded}is_visible(e){var t=e._data.layout;return!("visible"in t&&!t.visible)}}class W{constructor(e){this.view=e,this.opts=e.opts,this.e_svg=W.c("svg"),this.e_svg.setAttribute("class","jsmind"),this.size={w:0,h:0},this.lines=[],this.line_drawing={straight:this._line_to,curved:this._bezier_to},this.drawing=this.line_drawing[this.opts.line_style]||this.line_drawing.curved}static c(e){return x.d.createElementNS("http://www.w3.org/2000/svg",e)}element(){return this.e_svg}set_size(e,t){this.size.w=e,this.size.h=t,this.e_svg.setAttribute("width",e),this.e_svg.setAttribute("height",t)}clear(){for(var e=this.lines.length;e--;)this.e_svg.removeChild(this.lines[e]);this.lines.length=0}draw_line(e,t,i,n){var o=W.c("path");o.setAttribute("stroke",n||this.opts.line_color),o.setAttribute("stroke-width",this.opts.line_width),o.setAttribute("fill","transparent"),this.lines.push(o),this.e_svg.appendChild(o),this.drawing(o,t.x+i.x,t.y+i.y,e.x+i.x,e.y+i.y)}copy_to(e,t){var i=new Image;i.onload=function(){e.drawImage(i,0,0),t&&t()},i.src="data:image/svg+xml;base64,"+btoa(new XMLSerializer().serializeToString(this.e_svg))}_bezier_to(e,t,i,n,o){e.setAttribute("d","M "+t+" "+i+" C "+(t+2*(n-t)/3)+" "+i+", "+t+" "+o+", "+n+" "+o)}_line_to(e,t,i,n,o){e.setAttribute("d","M "+t+" "+i+" L "+n+" "+o)}}class Y{constructor(e){this.opts=e.opts,this.e_canvas=x.c("canvas"),this.e_canvas.className="jsmind",this.canvas_ctx=this.e_canvas.getContext("2d"),this.size={w:0,h:0},this.line_drawing={straight:this._line_to,curved:this._bezier_to},this.drawing=this.line_drawing[this.opts.line_style]||this.line_drawing.curved}element(){return this.e_canvas}set_size(e,t){this.size.w=e,this.size.h=t,this.e_canvas.width=e,this.e_canvas.height=t}clear(){this.canvas_ctx.clearRect(0,0,this.size.w,this.size.h)}draw_line(e,t,i,n){var o=this.canvas_ctx;o.strokeStyle=n||this.opts.line_color,o.lineWidth=this.opts.line_width,o.lineCap="round",this.drawing(o,t.x+i.x,t.y+i.y,e.x+i.x,e.y+i.y)}copy_to(e,t){e.drawImage(this.e_canvas,0,0),t&&t()}_bezier_to(e,t,i,n,o){e.beginPath(),e.moveTo(t,i),e.bezierCurveTo(t+2*(n-t)/3,i,t,o,n,o),e.stroke()}_line_to(e,t,i,n,o){e.beginPath(),e.moveTo(t,i),e.lineTo(n,o),e.stroke()}}class Q{constructor(e,t){this.opts=t,this.jm=e,this.layout=e.layout,this.container=null,this.e_panel=null,this.e_nodes=null,this.size={w:0,h:0},this.selected_node=null,this.editing_node=null,this.graph=null,this.render_node=t.custom_node_render?this._custom_node_render:this._default_node_render,this._initialized=!1}init(){if(v.debug(this.opts),v.debug("view.init"),this.container=x.i(this.opts.container)?this.opts.container:x.g(this.opts.container),this.container){var e;this.graph=(e=this,this.opts.engine.toLowerCase()==="svg"?new W(e):new Y(e)),this.e_panel=x.c("div"),this.e_nodes=x.c("jmnodes"),this.e_editor=x.c("input"),this.e_panel.className="jsmind-inner jmnode-overflow-"+this.opts.node_overflow,this.e_panel.tabIndex=1,this.e_panel.appendChild(this.graph.element()),this.e_panel.appendChild(this.e_nodes),this.e_editor.className="jsmind-editor",this.e_editor.type="text",this.zoom_current=1;var t=this;x.on(this.e_editor,"keydown",function(i){var n=i||event;n.keyCode==13&&(t.edit_node_end(),n.stopPropagation())}),x.on(this.e_editor,"blur",function(i){t.edit_node_end()}),this.container.appendChild(this.e_panel),this.container.offsetParent||new IntersectionObserver((i,n)=>{i[0].isIntersecting&&(n.unobserve(this.e_panel),this.resize())}).observe(this.e_panel)}else v.error("the options.view.container was not be found in dom")}add_event(e,t,i,n){let o=n?this.e_panel:this.e_nodes;x.on(o,t,function(r){var c=r||event;i.call(e,c)})}get_binded_nodeid(e){if(e==null)return null;var t=e.tagName.toLowerCase();return t=="jmnode"||t=="jmexpander"?e.getAttribute("nodeid"):t=="jmnodes"||t=="body"||t=="html"?null:this.get_binded_nodeid(e.parentElement)}is_node(e){if(e==null)return!1;var t=e.tagName.toLowerCase();return t=="jmnode"||t!="jmnodes"&&t!="body"&&t!="html"&&this.is_node(e.parentElement)}is_expander(e){return e.tagName.toLowerCase()=="jmexpander"}reset(){v.debug("view.reset"),this.selected_node=null,this.clear_lines(),this.clear_nodes(),this.reset_theme()}reset_theme(){var e=this.jm.options.theme;this.e_nodes.className=e?"theme-"+e:""}reset_custom_style(){var e=this.jm.mind.nodes;for(var t in e)this.reset_node_custom_style(e[t])}load(){v.debug("view.load"),this.setup_canvas_draggable(this.opts.draggable),this.init_nodes(),this._initialized=!0}expand_size(){var e=this.layout.get_min_size(),t=e.w+2*this.opts.hmargin,i=e.h+2*this.opts.vmargin,n=this.e_panel.clientWidth,o=this.e_panel.clientHeight;n<t&&(n=t),o<i&&(o=i),this.size.w=n,this.size.h=o}init_nodes_size(e){var t=e._data.view;t.width=t.element.clientWidth,t.height=t.element.clientHeight}init_nodes(){var e=this.jm.mind.nodes,t=x.d.createDocumentFragment();for(var i in e)this.create_node_element(e[i],t);this.e_nodes.appendChild(t),this.run_in_c11y_mode_if_needed(()=>{for(var n in e)this.init_nodes_size(e[n])})}add_node(e){this.create_node_element(e,this.e_nodes),this.run_in_c11y_mode_if_needed(()=>{this.init_nodes_size(e)})}run_in_c11y_mode_if_needed(e){this.container.offsetParent?e():(v.warn("init nodes in compatibility mode. because the container or its parent has style {display:none}. "),this.e_panel.style.position="absolute",this.e_panel.style.top="-100000",x.d.body.appendChild(this.e_panel),e(),this.container.appendChild(this.e_panel),this.e_panel.style.position=null,this.e_panel.style.top=null)}create_node_element(e,t){var i=null;"view"in e._data?i=e._data.view:(i={},e._data.view=i);var n=x.c("jmnode");if(e.isroot)n.className="root";else{var o=x.c("jmexpander");x.t(o,"-"),o.setAttribute("nodeid",e.id),o.style.visibility="hidden",t.appendChild(o),i.expander=o}e.topic&&this.render_node(n,e),n.setAttribute("nodeid",e.id),n.style.visibility="hidden",this._reset_node_custom_style(n,e.data),t.appendChild(n),i.element=n}remove_node(e){this.selected_node!=null&&this.selected_node.id==e.id&&(this.selected_node=null),this.editing_node!=null&&this.editing_node.id==e.id&&(e._data.view.element.removeChild(this.e_editor),this.editing_node=null);for(var t=e.children,i=t.length;i--;)this.remove_node(t[i]);if(e._data.view){var n=e._data.view.element,o=e._data.view.expander;this.e_nodes.removeChild(n),this.e_nodes.removeChild(o),e._data.view.element=null,e._data.view.expander=null}}update_node(e){var t=e._data.view,i=t.element;if(e.topic&&this.render_node(i,e),this.layout.is_visible(e))t.width=i.clientWidth,t.height=i.clientHeight;else{let n=i.getAttribute("style");i.style="visibility: visible; left:0; top:0;",t.width=i.clientWidth,t.height=i.clientHeight,i.style=n}}select_node(e){if(this.selected_node){var t=this.selected_node._data.view.element;t.className=t.className.replace(/\s*selected\b/i,""),this.restore_selected_node_custom_style(this.selected_node)}e&&(this.selected_node=e,e._data.view.element.className+=" selected",this.clear_selected_node_custom_style(e))}select_clear(){this.select_node(null)}get_editing_node(){return this.editing_node}is_editing(){return!!this.editing_node}edit_node_begin(e){if(e.topic){this.editing_node!=null&&this.edit_node_end(),this.editing_node=e;var t=e._data.view.element,i=e.topic,n=getComputedStyle(t);this.e_editor.value=i,this.e_editor.style.width=t.clientWidth-parseInt(n.getPropertyValue("padding-left"))-parseInt(n.getPropertyValue("padding-right"))+"px",t.innerHTML="",t.appendChild(this.e_editor),t.style.zIndex=5,this.e_editor.focus(),this.e_editor.select()}else v.warn("don't edit image nodes")}edit_node_end(){if(this.editing_node!=null){var e=this.editing_node;this.editing_node=null;var t=e._data.view.element,i=this.e_editor.value;t.style.zIndex="auto",t.removeChild(this.e_editor),S.text.is_empty(i)||e.topic===i?this.render_node(t,e):this.jm.update_node(e.id,i)}this.e_panel.focus()}get_view_offset(){var e=this.layout.bounds;return{x:(this.size.w-e.e-e.w)/2,y:this.size.h/2}}resize(){this.graph.set_size(1,1),this.e_nodes.style.width="1px",this.e_nodes.style.height="1px",this.expand_size(),this._show()}_show(){this.graph.set_size(this.size.w,this.size.h),this.e_nodes.style.width=this.size.w+"px",this.e_nodes.style.height=this.size.h+"px",this.show_nodes(),this.show_lines(),this.jm.invoke_event_handle(y.resize,{data:[]})}zoom_in(e){return this.set_zoom(this.zoom_current+this.opts.zoom.step,e)}zoom_out(e){return this.set_zoom(this.zoom_current-this.opts.zoom.step,e)}set_zoom(e,t){if(e<this.opts.zoom.min||e>this.opts.zoom.max)return!1;let i=this.e_panel.getBoundingClientRect();if(e<1&&this.size.w*e<i.width&&this.size.h*e<i.height)return!1;let n=t?{x:t.x-i.x,y:t.y-i.y}:{x:i.width/2,y:i.height/2},o=(this.e_panel.scrollLeft+n.x)*e/this.zoom_current-n.x,r=(this.e_panel.scrollTop+n.y)*e/this.zoom_current-n.y;this.zoom_current=e;for(var c=0;c<this.e_panel.children.length;c++)this.e_panel.children[c].style.zoom=e;return this._show(),this.e_panel.scrollLeft=o,this.e_panel.scrollTop=r,!0}show(e){v.debug("view.show"),this.expand_size(),this._show(),e&&this.center_node(this.jm.mind.root)}relayout(){this.expand_size(),this._show()}save_location(e){var t=e._data.view;t._saved_location={x:parseInt(t.element.style.left)-this.e_panel.scrollLeft,y:parseInt(t.element.style.top)-this.e_panel.scrollTop}}restore_location(e){var t=e._data.view;this.e_panel.scrollLeft=parseInt(t.element.style.left)-t._saved_location.x,this.e_panel.scrollTop=parseInt(t.element.style.top)-t._saved_location.y}clear_nodes(){var e=this.jm.mind;if(e!=null){var t=e.nodes,i=null;for(var n in t)(i=t[n])._data.view.element=null,i._data.view.expander=null;this.e_nodes.innerHTML=""}}show_nodes(){var e=this.jm.mind.nodes,t=null,i=null,n=null,o=null,r=this.get_view_offset();for(var c in e)i=(o=(t=e[c])._data.view).element,this.layout.is_visible(t)?(this.reset_node_custom_style(t),n=this.layout.get_node_point(t),o.abs_x=r.x+n.x,o.abs_y=r.y+n.y,i.style.left=r.x+n.x+"px",i.style.top=r.y+n.y+"px",i.style.display="",i.style.visibility="visible",this._show_expander(t,r)):(i.style.display="none",o.expander.style.display="none")}_show_expander(e,t){if(e.isroot)return;var i=e._data.view.expander;if(e.children.length==0)return i.style.display="none",void(i.style.visibility="hidden");let n=this._get_expander_text(e);x.t(i,n);let o=this.layout.get_expander_point(e);i.style.left=t.x+o.x+"px",i.style.top=t.y+o.y+"px",i.style.display="",i.style.visibility="visible"}_get_expander_text(e){let t=this.opts.expander_style?this.opts.expander_style.toLowerCase():"char";return t==="number"?e.children.length>99?"...":e.children.length:t==="char"?e.expanded?"-":"+":void 0}_default_node_render(e,t){this.opts.support_html?x.h(e,t.topic):x.t(e,t.topic)}_custom_node_render(e,t){this.opts.custom_node_render(this.jm,e,t)||this._default_node_render(e,t)}reset_node_custom_style(e){this._reset_node_custom_style(e._data.view.element,e.data)}_reset_node_custom_style(e,t){if("background-color"in t&&(e.style.backgroundColor=t["background-color"]),"foreground-color"in t&&(e.style.color=t["foreground-color"]),"width"in t&&(e.style.width=t.width+"px"),"height"in t&&(e.style.height=t.height+"px"),"font-size"in t&&(e.style.fontSize=t["font-size"]+"px"),"font-weight"in t&&(e.style.fontWeight=t["font-weight"]),"font-style"in t&&(e.style.fontStyle=t["font-style"]),"background-image"in t){var i=t["background-image"];if(i.startsWith("data")&&t.width&&t.height){var n=new Image;n.onload=function(){var o=x.c("canvas");if(o.width=e.clientWidth,o.height=e.clientHeight,o.getContext){o.getContext("2d").drawImage(this,2,2,e.clientWidth,e.clientHeight);var r=o.toDataURL();e.style.backgroundImage="url("+r+")"}},n.src=i}else e.style.backgroundImage="url("+i+")";e.style.backgroundSize="99%","background-rotation"in t&&(e.style.transform="rotate("+t["background-rotation"]+"deg)")}}restore_selected_node_custom_style(e){var t=e._data.view.element,i=e.data;"background-color"in i&&(t.style.backgroundColor=i["background-color"]),"foreground-color"in i&&(t.style.color=i["foreground-color"])}clear_selected_node_custom_style(e){var t=e._data.view.element;t.style.backgroundColor="",t.style.color=""}clear_lines(){this.graph.clear()}show_lines(){this.clear_lines();var e=this.jm.mind.nodes,t=null,i=null,n=null,o=null,r=this.get_view_offset();for(var c in e)(t=e[c]).isroot||this.layout.is_visible(t)&&(i=this.layout.get_node_point_in(t),n=this.layout.get_node_point_out(t.parent),o=t.data["leading-line-color"],this.graph.draw_line(n,i,r,o))}setup_canvas_draggable(e){if(this.opts.draggable=e,!this._initialized){let t,i,n=!1;this.opts.hide_scrollbars_when_draggable&&(this.e_panel.style="overflow: hidden"),x.on(this.container,"mousedown",o=>{this.opts.draggable&&(n=!0,t=o.clientX,i=o.clientY)}),x.on(this.container,"mouseup",()=>{n=!1}),x.on(this.container,"mousemove",o=>{this.opts.draggable&&n&&(this.e_panel.scrollBy(t-o.clientX,i-o.clientY),t=o.clientX,i=o.clientY)})}}center_node(e){if(!this.layout.is_visible(e))return v.warn("can not scroll to the node, because it is invisible"),!1;let t=e._data.view,i=this.e_panel.getBoundingClientRect(),n=t.abs_x+t.width/2,o=t.abs_y+t.height/2;return this.e_panel.scrollTo(n*this.zoom_current-i.width/2,o*this.zoom_current-i.height/2),!0}zoomIn(e){return v.warn("please use zoom_in instead"),this.zoom_in(e)}zoomOut(e){return v.warn("please use zoom_out instead"),this.zoom_out(e)}setZoom(e,t){return v.warn("please use set_zoom instead"),this.set_zoom(e,t)}}class ee{constructor(e,t){this.jm=e,this.opts=t,this.mapping=t.mapping,this.handles=t.handles,this._newid=null,this._mapping={}}init(){for(var e in x.on(this.jm.view.e_panel,"keydown",this.handler.bind(this)),this.handles.addchild=this.handle_addchild,this.handles.addbrother=this.handle_addbrother,this.handles.editnode=this.handle_editnode,this.handles.delnode=this.handle_delnode,this.handles.toggle=this.handle_toggle,this.handles.up=this.handle_up,this.handles.down=this.handle_down,this.handles.left=this.handle_left,this.handles.right=this.handle_right,this.mapping)if(this.mapping[e]&&e in this.handles){let t=this.mapping[e];Array.isArray(t)||(t=[t]);for(let i of t)this._mapping[i]=this.handles[e]}typeof this.opts.id_generator=="function"?this._newid=this.opts.id_generator:this._newid=S.uuid.newid}enable_shortcut(){this.opts.enable=!0}disable_shortcut(){this.opts.enable=!1}handler(e){if(e.which==9&&e.preventDefault(),!this.jm.view.is_editing()){var t=e||event;if(!this.opts.enable)return!0;var i=t.keyCode+(t.metaKey<<13)+(t.ctrlKey<<12)+(t.altKey<<11)+(t.shiftKey<<10);i in this._mapping&&this._mapping[i].call(this,this.jm,e)}}handle_addchild(e,t){var i=e.get_selected_node();if(i){var n=this._newid();e.add_node(i,n,"New Node")&&(e.select_node(n),e.begin_edit(n))}}handle_addbrother(e,t){var i=e.get_selected_node();if(i&&!i.isroot){var n=this._newid();e.insert_node_after(i,n,"New Node")&&(e.select_node(n),e.begin_edit(n))}}handle_editnode(e,t){var i=e.get_selected_node();i&&e.begin_edit(i)}handle_delnode(e,t){var i=e.get_selected_node();i&&!i.isroot&&(e.select_node(i.parent),e.remove_node(i))}handle_toggle(e,t){var i=t||event,n=e.get_selected_node();n&&(e.toggle_node(n.id),i.stopPropagation(),i.preventDefault())}handle_up(e,t){var i=t||event,n=e.get_selected_node();if(n){var o=e.find_node_before(n);if(!o){var r=e.find_node_before(n.parent);r&&r.children.length>0&&(o=r.children[r.children.length-1])}o&&e.select_node(o),i.stopPropagation(),i.preventDefault()}}handle_down(e,t){var i=t||event,n=e.get_selected_node();if(n){var o=e.find_node_after(n);if(!o){var r=e.find_node_after(n.parent);r&&r.children.length>0&&(o=r.children[0])}o&&e.select_node(o),i.stopPropagation(),i.preventDefault()}}handle_left(e,t){this._handle_direction(e,t,_.left)}handle_right(e,t){this._handle_direction(e,t,_.right)}_handle_direction(e,t,i){var n=t||event,o=e.get_selected_node(),r=null;if(o){if(o.isroot){for(var c=o.children,h=[],p=0;p<c.length;p++)c[p].direction===i&&h.push(p);r=c[h[Math.floor((h.length-1)/2)]]}else if(o.direction===i){var M=(h=o.children).length;M>0&&(r=h[Math.floor((M-1)/2)])}else r=o.parent;r&&e.select_node(r),n.stopPropagation(),n.preventDefault()}}}const Z={plugins:[]};function oe(s){if(!(s instanceof k))throw new Error("can not register plugin, it is not an instance of Plugin");if(Z.plugins.map(e=>e.name).includes(s.name))throw new Error("can not register plugin "+s.name+": plugin name already exist");Z.plugins.push(s)}function N(s,e){x.w.setTimeout(function(){(function(t,i){Z.plugins.forEach(n=>n.fn_init(t,i[n.name]))})(s,e)},0)}class k{constructor(e,t){if(!e)throw new Error("plugin must has a name");if(!t||typeof t!="function")throw new Error("plugin must has an init function");this.name=e,this.fn_init=t}}const I=class{constructor(e){I.current=this,this.options=function(t){var i={};if(S.json.merge(i,d),S.json.merge(i,t),!i.container)throw new Error("the options.container should not be null or empty.");return i}(e),v.level(w[this.options.log_level]),this.version=f,this.initialized=!1,this.mind=null,this.event_handles=[],this.init()}init(){if(!this.initialized){this.initialized=!0;var e={mode:this.options.mode,hspace:this.options.layout.hspace,vspace:this.options.layout.vspace,pspace:this.options.layout.pspace,cousin_space:this.options.layout.cousin_space},t={container:this.options.container,support_html:this.options.support_html,engine:this.options.view.engine,hmargin:this.options.view.hmargin,vmargin:this.options.view.vmargin,line_width:this.options.view.line_width,line_color:this.options.view.line_color,line_style:this.options.view.line_style,draggable:this.options.view.draggable,hide_scrollbars_when_draggable:this.options.view.hide_scrollbars_when_draggable,node_overflow:this.options.view.node_overflow,zoom:this.options.view.zoom,custom_node_render:this.options.view.custom_node_render,expander_style:this.options.view.expander_style};this.data=new P(this),this.layout=new L(this,e),this.view=new Q(this,t),this.shortcut=new ee(this,this.options.shortcut),this.data.init(),this.layout.init(),this.view.init(),this.shortcut.init(),this._event_bind(),N(this,this.options.plugin)}}get_editable(){return this.options.editable}enable_edit(){this.options.editable=!0}disable_edit(){this.options.editable=!1}get_view_draggable(){return this.options.view.draggable}enable_view_draggable(){this.options.view.draggable=!0,this.view.setup_canvas_draggable(!0)}disable_view_draggable(){this.options.view.draggable=!1,this.view.setup_canvas_draggable(!1)}enable_event_handle(e){this.options.default_event_handle["enable_"+e+"_handle"]=!0}disable_event_handle(e){this.options.default_event_handle["enable_"+e+"_handle"]=!1}set_theme(e){var t=this.options.theme;this.options.theme=e||null,t!=this.options.theme&&(this.view.reset_theme(),this.view.reset_custom_style())}_event_bind(){this.view.add_event(this,"mousedown",this.mousedown_handle),this.view.add_event(this,"click",this.click_handle),this.view.add_event(this,"dblclick",this.dblclick_handle),this.view.add_event(this,"mousewheel",this.mousewheel_handle,!0)}mousedown_handle(e){if(this.options.default_event_handle.enable_mousedown_handle){var t=e.target||event.srcElement,i=this.view.get_binded_nodeid(t);i?this.view.is_node(t)&&this.select_node(i):this.select_clear()}}click_handle(e){if(this.options.default_event_handle.enable_click_handle){var t=e.target||event.srcElement;if(this.view.is_expander(t)){var i=this.view.get_binded_nodeid(t);i&&this.toggle_node(i)}}}dblclick_handle(e){if(this.options.default_event_handle.enable_dblclick_handle&&this.get_editable()){var t=e.target||event.srcElement;if(this.view.is_node(t)){var i=this.view.get_binded_nodeid(t);i&&this.begin_edit(i)}}}mousewheel_handle(e){if(this.options.default_event_handle.enable_mousewheel_handle&&e.ctrlKey){var t=e||event;t.preventDefault(),t.deltaY<0?this.view.zoom_in(t):this.view.zoom_out(t)}}begin_edit(e){if(!a.is_node(e)){var t=this.get_node(e);return t?this.begin_edit(t):(v.error("the node[id="+e+"] can not be found."),!1)}this.get_editable()?this.view.edit_node_begin(e):v.error("fail, this mind map is not editable.")}end_edit(){this.view.edit_node_end()}toggle_node(e){if(!a.is_node(e)){var t=this.get_node(e);return t?this.toggle_node(t):void v.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.toggle_node(e),this.view.relayout(),this.view.restore_location(e))}expand_node(e){if(!a.is_node(e)){var t=this.get_node(e);return t?this.expand_node(t):void v.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.expand_node(e),this.view.relayout(),this.view.restore_location(e))}collapse_node(e){if(!a.is_node(e)){var t=this.get_node(e);return t?this.collapse_node(t):void v.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.collapse_node(e),this.view.relayout(),this.view.restore_location(e))}expand_all(){this.layout.expand_all(),this.view.relayout()}collapse_all(){this.layout.collapse_all(),this.view.relayout()}expand_to_depth(e){this.layout.expand_to_depth(e),this.view.relayout()}_reset(){this.view.reset(),this.layout.reset(),this.data.reset()}_show(e){var t=e||u.node_array.example;this.mind=this.data.load(t),this.mind?(v.debug("data.load ok"),this.view.load(),v.debug("view.load ok"),this.layout.layout(),v.debug("layout.layout ok"),this.view.show(!0),v.debug("view.show ok"),this.invoke_event_handle(y.show,{data:[e]})):v.error("data.load error")}show(e){this._reset(),this._show(e)}get_meta(){return{name:this.mind.name,author:this.mind.author,version:this.mind.version}}get_data(e){var t=e||"node_tree";return this.data.get_data(t)}get_root(){return this.mind.root}get_node(e){return a.is_node(e)?e:this.mind.get_node(e)}add_node(e,t,i,n,o){if(this.get_editable()){var r=this.get_node(e),c=_.of(o);c===void 0&&(c=this.layout.calculate_next_child_direction(r));var h=this.mind.add_node(r,t,i,n,c);return h&&(this.view.add_node(h),this.layout.layout(),this.view.show(!1),this.view.reset_node_custom_style(h),this.expand_node(r),this.invoke_event_handle(y.edit,{evt:"add_node",data:[r.id,t,i,n,c],node:t})),h}return v.error("fail, this mind map is not editable"),null}insert_node_before(e,t,i,n,o){if(this.get_editable()){var r=this.get_node(e),c=_.of(o);c===void 0&&(c=this.layout.calculate_next_child_direction(r.parent));var h=this.mind.insert_node_before(r,t,i,n,c);return h&&(this.view.add_node(h),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(y.edit,{evt:"insert_node_before",data:[r.id,t,i,n,c],node:t})),h}return v.error("fail, this mind map is not editable"),null}insert_node_after(e,t,i,n,o){if(this.get_editable()){var r=this.get_node(e),c=_.of(o);c===void 0&&(c=this.layout.calculate_next_child_direction(r.parent));var h=this.mind.insert_node_after(r,t,i,n,c);return h&&(this.view.add_node(h),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(y.edit,{evt:"insert_node_after",data:[r.id,t,i,n,c],node:t})),h}return v.error("fail, this mind map is not editable"),null}remove_node(e){if(!a.is_node(e)){var t=this.get_node(e);return t?this.remove_node(t):(v.error("the node[id="+e+"] can not be found."),!1)}if(this.get_editable()){if(e.isroot)return v.error("fail, can not remove root node"),!1;var i=e.id,n=e.parent.id,o=this.get_node(n);return this.view.save_location(o),this.view.remove_node(e),this.mind.remove_node(e),this.layout.layout(),this.view.show(!1),this.view.restore_location(o),this.invoke_event_handle(y.edit,{evt:"remove_node",data:[i],node:n}),!0}return v.error("fail, this mind map is not editable"),!1}update_node(e,t){if(this.get_editable())if(S.text.is_empty(t))v.warn("fail, topic can not be empty");else{var i=this.get_node(e);if(i){if(i.topic===t)return v.info("nothing changed"),void this.view.update_node(i);i.topic=t,this.view.update_node(i),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(y.edit,{evt:"update_node",data:[e,t],node:e})}}else v.error("fail, this mind map is not editable")}move_node(e,t,i,n){if(this.get_editable()){var o=this.get_node(e),r=this.mind.move_node(o,t,i,n);r&&(this.view.update_node(r),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(y.edit,{evt:"move_node",data:[e,t,i,n],node:e}))}else v.error("fail, this mind map is not editable")}select_node(e){if(!a.is_node(e)){var t=this.get_node(e);return t?this.select_node(t):void v.error("the node[id="+e+"] can not be found.")}this.layout.is_visible(e)&&(this.mind.selected=e,this.view.select_node(e),this.invoke_event_handle(y.select,{evt:"select_node",data:[],node:e.id}))}get_selected_node(){return this.mind?this.mind.selected:null}select_clear(){this.mind&&(this.mind.selected=null,this.view.select_clear())}is_node_visible(e){return this.layout.is_visible(e)}scroll_node_to_center(e){if(a.is_node(e))this.view.center_node(e);else{var t=this.get_node(e);t?this.scroll_node_to_center(t):v.error("the node[id="+e+"] can not be found.")}}find_node_before(e){if(!a.is_node(e)){var t=this.get_node(e);return t?this.find_node_before(t):void v.error("the node[id="+e+"] can not be found.")}if(e.isroot)return null;var i=null;if(e.parent.isroot)for(var n=e.parent.children,o=null,r=null,c=0;c<n.length;c++)r=n[c],e.direction===r.direction&&(e.id===r.id&&(i=o),o=r);else i=this.mind.get_node_before(e);return i}find_node_after(e){if(!a.is_node(e)){var t=this.get_node(e);return t?this.find_node_after(t):void v.error("the node[id="+e+"] can not be found.")}if(e.isroot)return null;var i=null;if(e.parent.isroot){for(var n=e.parent.children,o=!1,r=null,c=0;c<n.length;c++)if(r=n[c],e.direction===r.direction){if(o){i=r;break}e.id===r.id&&(o=!0)}}else i=this.mind.get_node_after(e);return i}set_node_color(e,t,i){if(!this.get_editable())return v.error("fail, this mind map is not editable"),null;var n=this.mind.get_node(e);n&&(t&&(n.data["background-color"]=t),i&&(n.data["foreground-color"]=i),this.view.reset_node_custom_style(n))}set_node_font_style(e,t,i,n){if(!this.get_editable())return v.error("fail, this mind map is not editable"),null;var o=this.mind.get_node(e);o&&(t&&(o.data["font-size"]=t),i&&(o.data["font-weight"]=i),n&&(o.data["font-style"]=n),this.view.reset_node_custom_style(o),this.view.update_node(o),this.layout.layout(),this.view.show(!1))}set_node_background_image(e,t,i,n,o){if(!this.get_editable())return v.error("fail, this mind map is not editable"),null;var r=this.mind.get_node(e);r&&(t&&(r.data["background-image"]=t),i&&(r.data.width=i),n&&(r.data.height=n),o&&(r.data["background-rotation"]=o),this.view.reset_node_custom_style(r),this.view.update_node(r),this.layout.layout(),this.view.show(!1))}set_node_background_rotation(e,t){if(!this.get_editable())return v.error("fail, this mind map is not editable"),null;var i=this.mind.get_node(e);if(i){if(!i.data["background-image"])return v.error("fail, only can change rotation angle of node with background image"),null;i.data["background-rotation"]=t,this.view.reset_node_custom_style(i),this.view.update_node(i),this.layout.layout(),this.view.show(!1)}}resize(){this.view.resize()}add_event_listener(e){typeof e=="function"&&this.event_handles.push(e)}clear_event_listener(){this.event_handles=[]}invoke_event_handle(e,t){var i=this;x.w.setTimeout(function(){i._invoke_event_handle(e,t)},0)}_invoke_event_handle(e,t){for(var i=this.event_handles.length,n=0;n<i;n++)this.event_handles[n](e,t)}static show(e,t){v.warn("`jsMind.show(options, mind)` is deprecated, please use `jm = new jsMind(options); jm.show(mind);` instead");var i=new I(e);return i.show(t),i}};let j=I;return le(j,"mind",l),le(j,"node",a),le(j,"direction",_),le(j,"event_type",y),le(j,"$",x),le(j,"plugin",k),le(j,"register_plugin",oe),le(j,"util",S),j})}(Be)),Be.exports}/**
* @license BSD-3-Clause
* @copyright 2014-2023 hizzgdev@163.com
*
* Project Home:
*   https://github.com/hizzgdev/jsmind/
*/(function(g,U){(function(f,D){D(Fe())})(Re,function(f){function D(S){return S&&typeof S=="object"&&"default"in S?S:{default:S}}var _=D(f);if(!_.default)throw new Error("jsMind is not defined");const y=_.default.$,w="getSelection"in y.w?function(){y.w.getSelection().removeAllRanges()}:function(){y.d.selection.empty()},T={line_width:5,line_color:"rgba(0,0,0,0.3)",line_color_invalid:"rgba(255,51,51,0.6)",lookup_delay:200,lookup_interval:100,scrolling_trigger_width:20,scrolling_step_length:10,shadow_node_class_name:"jsmind-draggable-shadow-node"};class v{constructor(d,a){var l={};_.default.util.json.merge(l,T),_.default.util.json.merge(l,a),this.version="0.4.0",this.jm=d,this.options=l,this.e_canvas=null,this.canvas_ctx=null,this.shadow=null,this.shadow_p_x=0,this.shadow_p_y=0,this.shadow_w=0,this.shadow_h=0,this.active_node=null,this.target_node=null,this.target_direct=null,this.client_w=0,this.client_h=0,this.offset_x=0,this.offset_y=0,this.hlookup_delay=0,this.hlookup_timer=0,this.capture=!1,this.moved=!1,this.canvas_draggable=d.get_view_draggable(),this.view_panel=d.view.e_panel,this.view_panel_rect=null}init(){this.create_canvas(),this.create_shadow(),this.event_bind()}resize(){this.jm.view.e_nodes.appendChild(this.shadow),this.e_canvas.width=this.jm.view.size.w,this.e_canvas.height=this.jm.view.size.h}create_canvas(){var d=y.c("canvas");this.jm.view.e_panel.appendChild(d);var a=d.getContext("2d");this.e_canvas=d,this.canvas_ctx=a}create_shadow(){var d=y.c("jmnode");d.style.visibility="hidden",d.style.zIndex="3",d.style.cursor="move",d.style.opacity="0.7",d.className=this.options.shadow_node_class_name,this.shadow=d}reset_shadow(d){var a=this.shadow.style;this.shadow.innerHTML=d.innerHTML,a.left=d.style.left,a.top=d.style.top,a.width=d.style.width,a.height=d.style.height,a.backgroundImage=d.style.backgroundImage,a.backgroundSize=d.style.backgroundSize,a.transform=d.style.transform,this.shadow_w=this.shadow.clientWidth,this.shadow_h=this.shadow.clientHeight}show_shadow(){this.moved||(this.shadow.style.visibility="visible")}hide_shadow(){this.shadow.style.visibility="hidden"}magnet_shadow(d,a,l){this.canvas_ctx.lineWidth=this.options.line_width,this.canvas_ctx.strokeStyle=l?this.options.line_color_invalid:this.options.line_color,this.canvas_ctx.lineCap="round",this.clear_lines(),this.canvas_lineto(d.x,d.y,a.x,a.y)}clear_lines(){this.canvas_ctx.clearRect(0,0,this.jm.view.size.w,this.jm.view.size.h)}canvas_lineto(d,a,l,u){this.canvas_ctx.beginPath(),this.canvas_ctx.moveTo(d,a),this.canvas_ctx.lineTo(l,u),this.canvas_ctx.stroke()}event_bind(){var d=this,a=this.jm.view.container;y.on(a,"mousedown",function(l){l.button===0&&d.dragstart.call(d,l)}),y.on(a,"mousemove",function(l){l.movementX===0&&l.movementY===0||d.drag.call(d,l)}),y.on(a,"mouseup",function(l){d.dragend.call(d,l)}),y.on(a,"touchstart",function(l){d.dragstart.call(d,l)}),y.on(a,"touchmove",function(l){d.drag.call(d,l)}),y.on(a,"touchend",function(l){d.dragend.call(d,l)})}dragstart(d){if(this.jm.get_editable()&&!this.capture){this.active_node=null,this.view_draggable=this.jm.get_view_draggable();var a=this.jm.view,l=d.target;if(l.tagName.toLowerCase()=="jmnode"){this.view_draggable&&this.jm.disable_view_draggable();var u=a.get_binded_nodeid(l);if(u){var P=this.jm.get_node(u);if(!P.isroot){this.reset_shadow(l),this.view_panel_rect=this.view_panel.getBoundingClientRect(),this.active_node=P,this.offset_x=(d.clientX||d.touches[0].clientX)/a.zoom_current-l.offsetLeft,this.offset_y=(d.clientY||d.touches[0].clientY)/a.zoom_current-l.offsetTop,this.client_hw=Math.floor(l.clientWidth/2),this.client_hh=Math.floor(l.clientHeight/2),this.hlookup_delay!=0&&y.w.clearTimeout(this.hlookup_delay),this.hlookup_timer!=0&&y.w.clearInterval(this.hlookup_timer);var L=this;this.hlookup_delay=y.w.setTimeout(function(){L.hlookup_delay=0,L.hlookup_timer=y.w.setInterval(function(){L.lookup_target_node.call(L)},L.options.lookup_interval)},this.options.lookup_delay),L.capture=!0}}}}}drag(d){if(this.jm.get_editable()&&this.capture){d.preventDefault(),this.show_shadow(),this.moved=!0,w();var a=this.jm.view,l=(d.clientX||d.touches[0].clientX)/a.zoom_current-this.offset_x,u=(d.clientY||d.touches[0].clientY)/a.zoom_current-this.offset_y;d.clientY-this.view_panel_rect.top<this.options.scrolling_trigger_width&&this.view_panel.scrollTop>this.options.scrolling_step_length?(this.view_panel.scrollBy(0,-this.options.scrolling_step_length),this.offset_y+=this.options.scrolling_step_length/a.zoom_current):this.view_panel_rect.bottom-d.clientY<this.options.scrolling_trigger_width&&this.view_panel.scrollTop<this.view_panel.scrollHeight-this.view_panel_rect.height-this.options.scrolling_step_length&&(this.view_panel.scrollBy(0,this.options.scrolling_step_length),this.offset_y-=this.options.scrolling_step_length/a.zoom_current),d.clientX-this.view_panel_rect.left<this.options.scrolling_trigger_width&&this.view_panel.scrollLeft>this.options.scrolling_step_length?(this.view_panel.scrollBy(-this.options.scrolling_step_length,0),this.offset_x+=this.options.scrolling_step_length/a.zoom_current):this.view_panel_rect.right-d.clientX<this.options.scrolling_trigger_width&&this.view_panel.scrollLeft<this.view_panel.scrollWidth-this.view_panel_rect.width-this.options.scrolling_step_length&&(this.view_panel.scrollBy(this.options.scrolling_step_length,0),this.offset_x-=this.options.scrolling_step_length/a.zoom_current),this.shadow.style.left=l+"px",this.shadow.style.top=u+"px",w()}}dragend(d){if(this.jm.get_editable()){if(this.view_draggable&&this.jm.enable_view_draggable(),this.capture){if(this.hlookup_delay!=0&&(y.w.clearTimeout(this.hlookup_delay),this.hlookup_delay=0,this.clear_lines()),this.hlookup_timer!=0&&(y.w.clearInterval(this.hlookup_timer),this.hlookup_timer=0,this.clear_lines()),this.moved){var a=this.active_node,l=this.target_node,u=this.target_direct;this.move_node(a,l,u)}this.hide_shadow()}this.view_panel_rect=null,this.moved=!1,this.capture=!1}}lookup_target_node(){let d=this.shadow.offsetLeft,a=this.shadow.offsetTop;if(d===this.shadow_p_x&&a===this.shadow_p_y)return;this.shadow_p_x=d,this.shadow_p_y=a;let l=this.shadow_p_x+this.shadow_w/2>=this.get_root_x()?_.default.direction.right:_.default.direction.left,u=this.lookup_overlapping_node_parent(l)||this.lookup_close_node(l);if(u){let P=this.calc_point_of_node(u,l),L=_.default.node.inherited(this.active_node,u);this.magnet_shadow(P.sp,P.np,L),this.target_node=u,this.target_direct=l}}get_root_x(){let d=this.jm.get_root(),a=d.get_location(),l=d.get_size();return a.x+l.w/2}lookup_overlapping_node_parent(d){let a=this.shadow.getBoundingClientRect(),l=a.x+a.width*(1-d)/2,u=(this.jm.options.layout.hspace+this.jm.options.layout.pspace)*d,P=a.height,L=[[l,a.y],[l,a.y+P/2],[l,a.y+P],[l+u/2,a.y],[l+u/2,a.y+P/2],[l+u/2,a.y+P],[l+u,a.y],[l+u,a.y+P/2],[l+u,a.y+P]];for(const W of L){let Y=this.lookup_node_parent_by_location(W[0],W[1]);if(Y)return Y}}lookup_node_parent_by_location(d,a){return y.d.elementsFromPoint(d,a).filter(l=>l.tagName==="JMNODE"&&l.className!==this.options.shadow_node_class_name).map(l=>this.jm.view.get_binded_nodeid(l)).map(l=>l&&this.jm.mind.nodes[l]).map(l=>l&&l.parent).find(l=>l)}lookup_close_node(d){return Object.values(this.jm.mind.nodes).filter(a=>a.direction==d||a.isroot).filter(a=>this.jm.layout.is_visible(a)).filter(a=>this.shadow_on_target_side(a,d)).map(a=>({node:a,distance:this.shadow_to_node(a,d)})).reduce((a,l)=>a.distance<l.distance?a:l,{node:this.jm.get_root(),distance:Number.MAX_VALUE}).node}shadow_on_target_side(d,a){return a==_.default.direction.right&&this.shadow_to_right_of_node(d)>0||a==_.default.direction.left&&this.shadow_to_left_of_node(d)>0}shadow_to_right_of_node(d){return this.shadow_p_x-d.get_location().x-d.get_size().w}shadow_to_left_of_node(d){return d.get_location().x-this.shadow_p_x-this.shadow_w}shadow_to_base_line_of_node(d){return this.shadow_p_y+this.shadow_h/2-d.get_location().y-d.get_size().h/2}shadow_to_node(d,a){return(a===_.default.direction.right?Math.abs(this.shadow_to_right_of_node(d)):Math.abs(this.shadow_to_left_of_node(d)))+Math.abs(this.shadow_to_base_line_of_node(d))}calc_point_of_node(d,a){let l=d.get_size(),u=d.get_location(),P=d.isroot?u.x+l.w/2:u.x+l.w*(1+a)/2+this.options.line_width*a,L=u.y+l.h/2;return{sp:{x:this.shadow_p_x+this.shadow_w*(1-a)/2-this.options.line_width*a,y:this.shadow_p_y+this.shadow_h/2},np:{x:P,y:L}}}move_node(d,a,l){var u=this.shadow.offsetTop;if(a&&d&&!_.default.node.inherited(d,a)){for(var P=a.children,L=P.length,W=null,Y=Number.MAX_VALUE,Q=null,ee="_last_";L--;)if((W=P[L]).direction==l&&W.id!=d.id){var Z=W.get_location().y-u;Z>0&&Z<Y&&(Y=Z,Q=W,ee="_first_")}Q&&(ee=Q.id),this.jm.move_node(d.id,ee,a.id,l)}this.active_node=null,this.target_node=null,this.target_direct=null}jm_event_handle(d,a){d===_.default.event_type.resize&&this.resize()}}var x=new _.default.plugin("draggable_node",function(S,d){var a=new v(S,d);a.init(),S.add_event_listener(function(l,u){a.jm_event_handle.call(a,l,u)})});_.default.register_plugin(x)})})();var We=Fe(),Ue={exports:{}},Ve;function wt(){return Ve||(Ve=1,function(g){(function(U){var f=Q(),D=ee(),_=Z(),y=oe(),w={imagePlaceholder:void 0,cacheBust:!1},T={toSvg:v,toPng:S,toJpeg:d,toBlob:a,toPixelData:x,impl:{fontFaces:_,images:y,util:f,inliner:D,options:{}}};g.exports=T;function v(N,k){return k=k||{},l(k),Promise.resolve(N).then(function(I){return P(I,k.filter,!0)}).then(L).then(W).then(j).then(function(I){return Y(I,k.width||f.width(N),k.height||f.height(N))});function j(I){return k.bgcolor&&(I.style.backgroundColor=k.bgcolor),k.width&&(I.style.width=k.width+"px"),k.height&&(I.style.height=k.height+"px"),k.style&&Object.keys(k.style).forEach(function(s){I.style[s]=k.style[s]}),I}}function x(N,k){return u(N,k||{}).then(function(j){return j.getContext("2d").getImageData(0,0,f.width(N),f.height(N)).data})}function S(N,k){return u(N,k||{}).then(function(j){return j.toDataURL()})}function d(N,k){return k=k||{},u(N,k).then(function(j){return j.toDataURL("image/jpeg",k.quality||1)})}function a(N,k){return u(N,k||{}).then(f.canvasToBlob)}function l(N){typeof N.imagePlaceholder>"u"?T.impl.options.imagePlaceholder=w.imagePlaceholder:T.impl.options.imagePlaceholder=N.imagePlaceholder,typeof N.cacheBust>"u"?T.impl.options.cacheBust=w.cacheBust:T.impl.options.cacheBust=N.cacheBust}function u(N,k){return v(N,k).then(f.makeImage).then(f.delay(100)).then(function(I){var s=j(N);return s.getContext("2d").drawImage(I,0,0),s});function j(I){var s=document.createElement("canvas");if(s.width=k.width||f.width(I),s.height=k.height||f.height(I),k.bgcolor){var e=s.getContext("2d");e.fillStyle=k.bgcolor,e.fillRect(0,0,s.width,s.height)}return s}}function P(N,k,j){if(!j&&k&&!k(N))return Promise.resolve();return Promise.resolve(N).then(I).then(function(t){return s(N,t,k)}).then(function(t){return e(N,t)});function I(t){return t instanceof HTMLCanvasElement?f.makeImage(t.toDataURL()):t.cloneNode(!1)}function s(t,i,n){var o=t.childNodes;if(o.length===0)return Promise.resolve(i);return r(i,f.asArray(o),n).then(function(){return i});function r(c,h,p){var M=Promise.resolve();return h.forEach(function(R){M=M.then(function(){return P(R,p)}).then(function(O){O&&c.appendChild(O)})}),M}}function e(t,i){if(!(i instanceof Element))return i;return Promise.resolve().then(n).then(o).then(r).then(c).then(function(){return i});function n(){h(window.getComputedStyle(t),i.style);function h(p,M){p.cssText?M.cssText=p.cssText:R(p,M);function R(O,B){f.asArray(O).forEach(function(m){B.setProperty(m,O.getPropertyValue(m),O.getPropertyPriority(m))})}}}function o(){[":before",":after"].forEach(function(p){h(p)});function h(p){var M=window.getComputedStyle(t,p),R=M.getPropertyValue("content");if(R===""||R==="none")return;var O=f.uid();i.className=i.className+" "+O;var B=document.createElement("style");B.appendChild(m(O,p,M)),i.appendChild(B);function m(z,$,E){var X="."+z+":"+$,J=E.cssText?ie(E):se(E);return document.createTextNode(X+"{"+J+"}");function ie(ae){var re=ae.getPropertyValue("content");return ae.cssText+" content: "+re+";"}function se(ae){return f.asArray(ae).map(re).join("; ")+";";function re(ge){return ge+": "+ae.getPropertyValue(ge)+(ae.getPropertyPriority(ge)?" !important":"")}}}}}function r(){t instanceof HTMLTextAreaElement&&(i.innerHTML=t.value),t instanceof HTMLInputElement&&i.setAttribute("value",t.value)}function c(){i instanceof SVGElement&&(i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i instanceof SVGRectElement&&["width","height"].forEach(function(h){var p=i.getAttribute(h);!p||i.style.setProperty(h,p)}))}}}function L(N){return _.resolveAll().then(function(k){var j=document.createElement("style");return N.appendChild(j),j.appendChild(document.createTextNode(k)),N})}function W(N){return y.inlineAll(N).then(function(){return N})}function Y(N,k,j){return Promise.resolve(N).then(function(I){return I.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(I)}).then(f.escapeXhtml).then(function(I){return'<foreignObject x="0" y="0" width="100%" height="100%">'+I+"</foreignObject>"}).then(function(I){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+k+'" height="'+j+'">'+I+"</svg>"}).then(function(I){return"data:image/svg+xml;charset=utf-8,"+I})}function Q(){return{escape:c,parseExtension:k,mimeType:j,dataAsUrl:r,isDataUrl:I,canvasToBlob:e,resolveUrl:t,getAndEncode:o,uid:i(),delay:h,asArray:p,escapeXhtml:M,makeImage:n,width:R,height:O};function N(){var m="application/font-woff",z="image/jpeg";return{woff:m,woff2:m,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:z,jpeg:z,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function k(m){var z=/\.([^\.\/]*?)$/g.exec(m);return z?z[1]:""}function j(m){var z=k(m).toLowerCase();return N()[z]||""}function I(m){return m.search(/^(data:)/)!==-1}function s(m){return new Promise(function(z){for(var $=window.atob(m.toDataURL().split(",")[1]),E=$.length,X=new Uint8Array(E),J=0;J<E;J++)X[J]=$.charCodeAt(J);z(new Blob([X],{type:"image/png"}))})}function e(m){return m.toBlob?new Promise(function(z){m.toBlob(z)}):s(m)}function t(m,z){var $=document.implementation.createHTMLDocument(),E=$.createElement("base");$.head.appendChild(E);var X=$.createElement("a");return $.body.appendChild(X),E.href=z,X.href=m,X.href}function i(){var m=0;return function(){return"u"+z()+m++;function z(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function n(m){return new Promise(function(z,$){var E=new Image;E.onload=function(){z(E)},E.onerror=$,E.src=m})}function o(m){var z=3e4;return T.impl.options.cacheBust&&(m+=(/\?/.test(m)?"&":"?")+new Date().getTime()),new Promise(function($){var E=new XMLHttpRequest;E.onreadystatechange=ie,E.ontimeout=se,E.responseType="blob",E.timeout=z,E.open("GET",m,!0),E.send();var X;if(T.impl.options.imagePlaceholder){var J=T.impl.options.imagePlaceholder.split(/,/);J&&J[1]&&(X=J[1])}function ie(){if(E.readyState===4){if(E.status!==200){X?$(X):ae("cannot fetch resource: "+m+", status: "+E.status);return}var re=new FileReader;re.onloadend=function(){var ge=re.result.split(/,/)[1];$(ge)},re.readAsDataURL(E.response)}}function se(){X?$(X):ae("timeout of "+z+"ms occured while fetching resource: "+m)}function ae(re){console.error(re),$("")}})}function r(m,z){return"data:"+z+";base64,"+m}function c(m){return m.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function h(m){return function(z){return new Promise(function($){setTimeout(function(){$(z)},m)})}}function p(m){for(var z=[],$=m.length,E=0;E<$;E++)z.push(m[E]);return z}function M(m){return m.replace(/#/g,"%23").replace(/\n/g,"%0A")}function R(m){var z=B(m,"border-left-width"),$=B(m,"border-right-width");return m.scrollWidth+z+$}function O(m){var z=B(m,"border-top-width"),$=B(m,"border-bottom-width");return m.scrollHeight+z+$}function B(m,z){var $=window.getComputedStyle(m).getPropertyValue(z);return parseFloat($.replace("px",""))}}function ee(){var N=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:s,shouldProcess:k,impl:{readUrls:j,inline:I}};function k(e){return e.search(N)!==-1}function j(e){for(var t=[],i;(i=N.exec(e))!==null;)t.push(i[1]);return t.filter(function(n){return!f.isDataUrl(n)})}function I(e,t,i,n){return Promise.resolve(t).then(function(r){return i?f.resolveUrl(r,i):r}).then(n||f.getAndEncode).then(function(r){return f.dataAsUrl(r,f.mimeType(t))}).then(function(r){return e.replace(o(t),"$1"+r+"$3")});function o(r){return new RegExp(`(url\\(['"]?)(`+f.escape(r)+`)(['"]?\\))`,"g")}}function s(e,t,i){if(n())return Promise.resolve(e);return Promise.resolve(e).then(j).then(function(o){var r=Promise.resolve(e);return o.forEach(function(c){r=r.then(function(h){return I(h,c,t,i)})}),r});function n(){return!k(e)}}}function Z(){return{resolveAll:N,impl:{readAll:k}};function N(){return k().then(function(j){return Promise.all(j.map(function(I){return I.resolve()}))}).then(function(j){return j.join(`
`)})}function k(){return Promise.resolve(f.asArray(document.styleSheets)).then(I).then(j).then(function(e){return e.map(s)});function j(e){return e.filter(function(t){return t.type===CSSRule.FONT_FACE_RULE}).filter(function(t){return D.shouldProcess(t.style.getPropertyValue("src"))})}function I(e){var t=[];return e.forEach(function(i){try{f.asArray(i.cssRules||[]).forEach(t.push.bind(t))}catch(n){console.log("Error while reading CSS rules from "+i.href,n.toString())}}),t}function s(e){return{resolve:function(){var i=(e.parentStyleSheet||{}).href;return D.inlineAll(e.cssText,i)},src:function(){return e.style.getPropertyValue("src")}}}}}function oe(){return{inlineAll:k,impl:{newImage:N}};function N(j){return{inline:I};function I(s){return f.isDataUrl(j.src)?Promise.resolve():Promise.resolve(j.src).then(s||f.getAndEncode).then(function(e){return f.dataAsUrl(e,f.mimeType(j.src))}).then(function(e){return new Promise(function(t,i){j.onload=t,j.onerror=i,j.src=e})})}}function k(j){if(!(j instanceof Element))return Promise.resolve(j);return I(j).then(function(){return j instanceof HTMLImageElement?N(j).inline():Promise.all(f.asArray(j.childNodes).map(function(s){return k(s)}))});function I(s){var e=s.style.getPropertyValue("background");return e?D.inlineAll(e).then(function(t){s.style.setProperty("background",t,s.style.getPropertyPriority("background"))}).then(function(){return s}):Promise.resolve(s)}}}})()}(Ue)),Ue.exports}/**
* @license BSD-3-Clause
* @copyright 2014-2023 hizzgdev@163.com
*
* Project Home:
*   https://github.com/hizzgdev/jsmind/
*/(function(g,U){(function(f,D){D(Fe(),wt())})(Re,function(f,D){function _(d){return d&&typeof d=="object"&&"default"in d?d:{default:d}}var y=_(f),w=_(D);if(!y.default)throw new Error("jsMind is not defined");if(!w.default)throw new Error("dom-to-image is required");const T=y.default.$,v={filename:null,watermark:{left:T.w.location,right:"https://github.com/hizzgdev/jsmind"}};class x{constructor(a,l){var u={};y.default.util.json.merge(u,v),y.default.util.json.merge(u,l),this.version="0.2.0",this.jm=a,this.options=u}shoot(){let a=this.create_canvas(),l=a.getContext("2d");Promise.resolve(l).then(()=>this.draw_lines(l)).then(()=>this.draw_nodes(l)).then(()=>this.draw_watermark(a,l)).then(()=>this.download(a)).then(()=>this.clear(a))}create_canvas(){let a=T.c("canvas");return a.width=this.jm.view.size.w,a.height=this.jm.view.size.h,this.jm.view.e_panel.appendChild(a),a}clear(a){a.parentNode.removeChild(a)}draw_lines(a){return new Promise(function(l,u){this.jm.view.graph.copy_to(a,function(){l(a)})}.bind(this))}draw_nodes(a){return w.default.toSvg(this.jm.view.e_nodes).then(this.load_image).then(function(l){return a.drawImage(l,0,0),a})}draw_watermark(a,l){return l.textBaseline="bottom",l.fillStyle="#000",l.font="11px Verdana,Arial,Helvetica,sans-serif",this.options.watermark.left&&(l.textAlign="left",l.fillText(this.options.watermark.left,5.5,a.height-2.5)),this.options.watermark.right&&(l.textAlign="right",l.fillText(this.options.watermark.right,a.width-5.5,a.height-2.5)),l}load_image(a){return new Promise(function(l,u){let P=new Image;P.onload=function(){l(P)},P.onerror=u,P.src=a})}download(a){var l=(this.options.filename||this.jm.mind.name)+".png";if(navigator.msSaveBlob&&a.msToBlob){var u=a.msToBlob();navigator.msSaveBlob(u,l)}else{var P=a.toDataURL(),L=T.c("a");if("download"in L){L.style.visibility="hidden",L.href=P,L.download=l,T.d.body.appendChild(L);var W=T.d.createEvent("MouseEvents");W.initEvent("click",!0,!0),L.dispatchEvent(W),T.d.body.removeChild(L)}else location.href=P}}}let S=new y.default.plugin("screenshot",function(d,a){var l=new x(d,a);d.screenshot=l,d.shoot=function(){l.shoot()}});y.default.register_plugin(S)})})();function bt(){function g(a){return window.document.createElement(a)}function U(){return{padding:"6px 6px",position:"fixed","z-index":"10",background:"#fff","box-shadow":"0 2px 12px 0 rgba(0,0,0,0.1)","border-radius":"5px","font-size":"12px",display:"none"}}function f(){return{padding:"5px 15px",cursor:"pointer",display:"block","text-align":"center",transition:"all .2s"}}function D(a,l){let u={};switch(l){case"menuItem":u=f();break;case"menu":u=U();break}u&&Object.keys(u).forEach(P=>{a.style[P]=u[P]})}function _(a){const l=g("menu");return D(l,"menu"),a.forEach(u=>{l.appendChild(x(u.name,u.callback))}),l}let y,w,T;function v(a,l){let u;return a?(y||(y=_(l),u=y),T=y):(w||(w=_(l),u=w),T=w),u}function x(a,l){const u=g("menu-item");return D(u,"menuItem"),u.innerText=a,u.addEventListener("click",()=>{l&&l()}),u.addEventListener("mouseover",()=>{u.style.background="rgb(179, 216, 255)"}),u.addEventListener("mouseleave",()=>{u.style.background="#fff"}),u}function S(a,l){T&&(T.style.left=a+"px",T.style.top=l+"px",T.style.display="block")}function d(){T&&(T.style.display="none")}return{createMenu:v,showMenu:S,hideMenu:d}}function yt(g){const U=Xe(null);function f(){return U.value||(U.value=new We(g)),U.value}function D(h){var p;(p=f())==null||p.show(h)}function _(){var h;return(h=f())==null?void 0:h.get_selected_node()}function y(h){var p;return(p=f())==null?void 0:p.get_node(h)}function w(h){return h==null?void 0:h.parent}function T(h){var p;(p=f())==null||p.select_node(h)}function v(){var h;(h=f())==null||h.select_clear()}function x(h){var p;(p=f())==null||p.collapse_node(h)}function S(h){var p;(p=f())==null||p.expand_node(h)}function d(h){var p;(p=f())==null||p.toggle_node(h)}function a(h){var p;(p=f())==null||p.expand_to_depth(h)}function l(h){var p;(p=f())==null||p.scroll_node_to_center(h)}function u(){var h;(h=f())==null||h.enable_edit()}function P(){var h;(h=f())==null||h.disable_edit()}function L(h){var p;(p=f())==null||p.begin_edit(h)}function W(h){var p;(p=f())==null||p.end_edit(h)}function Y(){var h;(h=f())==null||h.expand_all()}function Q(){var h;(h=f())==null||h.collapse_all()}function ee(h,p,M,R,O){var B;(B=f())==null||B.add_node(h,p,M)}function Z(h,p,M,R,O){var B;(B=f())==null||B.insert_node_before(h,p,M,R,O)}function oe(h,p,M,R,O){var B;(B=f())==null||B.insert_node_before(h,p,M,R,O)}function N(h,p){var M;(M=f())==null||M.update_node(h,p)}function k(h){var p;(p=f())==null||p.remove_node(h)}function j(){var h;return(h=f())==null?void 0:h.get_meta()}function I(h=Ie.NodeTree){var p;return(p=f())==null?void 0:p.get_data(h)}function s(h){var p;(p=f())==null||p.is_node_visible(h)}function e(h){var p;(p=f())==null||p.set_theme(h)}function t(h,p,M){var R;(R=f())==null||R.set_node_color(h,p,M)}function i(h,p,M,R){var O;(O=f())==null||O.set_node_font_style(h,p,M,R)}function n(h,p,M,R){var O;(O=f())==null||O.set_node_background_image(h,p,M,R)}function o(h,p,M,R){h.data["leading-line-color"]=R}function r(){var h;(h=f())==null||h.shoot()}function c(){var R;const h=(R=f())==null?void 0:R.get_data(Ie.FreeMind),p=h.meta.name||"freemind",M=h.data;We.util.file.save(M,"text/xml",p+".mm")}return{mindIns:U,showMind:D,getNode:y,getCurSelectNode:_,getParentNode:w,selectNode:T,clearSelectNode:v,collapseNode:x,expandNode:S,toggleNode:d,expandToDepth:a,scrollNodeToCenter:l,enableEdit:u,disableEdit:P,beginEditNode:L,endEditNode:W,expandAllNode:Y,collapseAllNode:Q,addChildNode:ee,addNodeBefore:Z,addNodeAfter:oe,updateNode:N,removeNode:k,isNodeVisible:s,getMeta:j,getData:I,setTheme:e,setNodeColor:t,setNodeFontStyle:i,setNodeBackgroundImage:n,setNodeStyle:o,exportImage:r,exportFreemind:c}}var fe=(g=>(g.Normal="normal",g.Bold="bold",g))(fe||{}),pe=(g=>(g.Normal="normal",g.Italic="italic",g))(pe||{});const xt={class:"setting-item"},kt={class:"setting-item_label"},Ct={class:"setting-item"},jt={class:"setting-item_label"},St={class:"setting-item"},zt={class:"setting-item_label"},Nt={class:"setting-item"},It={class:"setting-item_label"},Dt={class:"setting-item"},Tt={class:"setting-item_label"},Et={key:0,class:"setting-item"},At={class:"setting-item_label"},Mt={class:"setting-item"},Pt={class:"setting-item_label"},Bt={class:"setting-item"},Ut={class:"setting-item_label"},$t={class:"tw-text-right"},Lt={name:"NodeSettingDrawer"},Rt=he({...Lt,props:{visible:{type:Boolean},nodeId:{},nodeData:{}},emits:["update:visible","save"],setup(g,{emit:U}){const f=g,D=Ge({get:()=>f.visible,set:x=>U("update:visible",x)}),_=de({isRoot:!1,background:{image:"",height:0,width:0},color:{background:"",line:""},font:{color:"",style:pe.Normal,size:12,weight:fe.Normal},width:0,height:0,text:""}),y=[{label:b("mind.nodeSetting.font.weight.normal"),value:fe.Normal},{label:b("mind.nodeSetting.font.weight.bold"),value:fe.Bold}],w=[{label:b("mind.nodeSetting.font.style.normal"),value:pe.Normal},{label:b("mind.nodeSetting.font.style.italic"),value:pe.Italic}];ce(()=>D.value,x=>{if(x){const{isRoot:S,background:d,color:a,font:l,width:u,height:P,text:L}=f.nodeData;_.isRoot=S,_.text=L,_.width=u,_.height=P,_.background.width=d.width,_.background.height=d.height,_.background.image=d.image,_.color.background=a.background,_.color.line=a.line,_.font.color=l.color,_.font.size=l.size,_.font.style=l.style,_.font.weight=l.weight}});function T(x){if(x){const{height:S,width:d,previewUrl:a}=x;_.background.image=a,_.background.height=S,_.background.width=d}else _.background.image="",_.background.height=0,_.background.width=0}function v(){U("save",{nodeId:f.nodeId,nodeData:{...tt(_)}}),ze(Ne.Success,b("notice.saveOk")),D.value=!1}return(x,S)=>(te(),ve(Ye,{title:A(b)("mind.nodeSetting.label"),visible:D.value,"onUpdate:visible":S[7]||(S[7]=d=>D.value=d)},{footer:K(()=>[C("div",$t,[F(Ae,{onClick:v,type:"primary",name:A(b)("tags.save")},null,8,["name"])])]),default:K(()=>[C("div",null,[C("div",xt,[C("div",kt,q(A(b)("mind.nodeSetting.content")),1),C("div",null,[F(rt,{value:_.text,"onUpdate:value":S[0]||(S[0]=d=>_.text=d)},null,8,["value"])])]),C("div",Ct,[C("div",jt,q(A(b)("mind.nodeSetting.font.size")),1),C("div",null,[F(je,{value:_.font.size,"onUpdate:value":S[1]||(S[1]=d=>_.font.size=d),min:5,max:50},{addonAfter:K(()=>[ke("px")]),_:1},8,["value"])])]),C("div",St,[C("div",zt,q(A(b)("mind.nodeSetting.font.color")),1),C("div",null,[F(Se,{"is-use-confirm":!0,color:_.font.color,"onUpdate:color":S[2]||(S[2]=d=>_.font.color=d)},null,8,["color"])])]),C("div",Nt,[C("div",It,q(A(b)("mind.nodeSetting.font.style.label")),1),C("div",null,[F(Le,{options:w,select:_.font.style,"onUpdate:select":S[3]||(S[3]=d=>_.font.style=d)},null,8,["select"])])]),C("div",Dt,[C("div",Tt,q(A(b)("mind.nodeSetting.font.weight.label")),1),C("div",null,[F(Le,{options:y,select:_.font.weight,"onUpdate:select":S[4]||(S[4]=d=>_.font.weight=d)},null,8,["select"])])]),_.isRoot?Ce("",!0):(te(),ue("div",Et,[C("div",At,q(A(b)("mind.nodeSetting.color.line")),1),C("div",null,[F(Se,{"is-use-confirm":!0,color:_.color.line,"onUpdate:color":S[5]||(S[5]=d=>_.color.line=d)},null,8,["color"])])])),C("div",Mt,[C("div",Pt,q(A(b)("mind.nodeSetting.color.background")),1),C("div",null,[F(Se,{"is-use-confirm":!0,color:_.color.background,"onUpdate:color":S[6]||(S[6]=d=>_.color.background=d)},null,8,["color"])])]),C("div",Bt,[C("div",Ut,q(A(b)("mind.nodeSetting.background.image")),1),C("div",null,[F(vt,{"image-url":_.background.image,"max-size":100,onFile:T},null,8,["image-url"])])])])]),_:1},8,["title","visible"]))}});const Ft=Me(Rt,[["__scopeId","data-v-56f0459e"]]),Ot={class:"tw-h-full tw-w-full"},Ht=["onClick","onContextmenu"],Wt={name:"index"},Vt=he({...Wt,props:{isEditable:{type:Boolean,default:!0}},setup(g){const U=g,f=be("contentIdentity"),D=be("contentName");ce(()=>D.value,B=>{H.item[f.value].content.data.meta.name=B}),pt(H,f,["content"],D);const _=de({visible:!1,nodeId:"",nodeData:{isRoot:!1,background:{image:"",height:5,width:5},color:{background:"",line:""},font:{color:"",style:pe.Normal,size:25,weight:fe.Normal},width:0,height:0,text:""}}),y=de({options:w(),data:H.item[f.value].content.data});function w(){return{container:"x-mind-editor",editable:U.isEditable,log_level:Ze.Error,shortcut:{enable:!1},...H.item[f.value].content.config}}const{mindIns:T,showMind:v,getNode:x,getCurSelectNode:S,getParentNode:d,addChildNode:a,removeNode:l,expandNode:u,collapseNode:P,clearSelectNode:L,selectNode:W,beginEditNode:Y,getData:Q,disableEdit:ee,enableEdit:Z,expandAllNode:oe,collapseAllNode:N,setNodeColor:k,setNodeFontStyle:j,setNodeBackgroundImage:I,updateNode:s,setNodeStyle:e,exportImage:t,exportFreemind:i}=yt(y.options),{createMenu:n,showMenu:o,hideMenu:r}=bt();let c="";function h(B){const m=[];return m.push({name:b("mind.work.edit"),callback:()=>{const{id:z,topic:$,data:E,_data:X,isroot:J}=x(c);_.nodeId=z,_.nodeData.isRoot=J,_.nodeData.text=$;const{view:ie}=X,{view:se}=H.item[f.value].content.config;_.nodeData.width=E.width||ie.width,_.nodeData.height=E.height||ie.height,_.nodeData.background.image=E["background-image"]||"",_.nodeData.background.width=E["background-image"]?ie.width+4:0,_.nodeData.background.height=E["background-image"]?ie.height+4:0,_.nodeData.font.size=E["font-size"]||(J?25:16),_.nodeData.font.weight=E["font-weight"]||fe.Normal,_.nodeData.font.style=E["font-style"]||pe.Normal,_.nodeData.font.color=E["foreground-color"]||"",_.nodeData.color.background=E["background-color"]||"",_.nodeData.color.line=E["leading-line-color"]||se.line_color||"",_.visible=!0}},{name:b("mind.work.add"),callback:()=>{const z=$e();a(c,z,b("mind.name.child")),W(z),Y(z)}}),B?m.push({name:b("mind.work.collapseAll"),callback:()=>{N()}},{name:b("mind.work.expandAll"),callback:()=>{oe()}}):m.push({name:b("mind.work.sibling"),callback:()=>{const z=$e();a(d(c),z,b("mind.name.child")),W(z),Y(z)}},{name:b("mind.work.delete"),callback:()=>{l(c)}},{name:b("mind.work.collapse"),callback:()=>{P(c)}},{name:b("mind.work.expand"),callback:()=>{u(c)}}),m}let p=null;it(()=>{nt(()=>{v(y.data),p&&(clearInterval(p),p=null),p=setInterval(()=>{H.item[f.value].content.data=Q()},3e3)})}),ot(()=>{p&&(clearInterval(p),p=null)});function M(B){B.preventDefault(),r()}function R(B){var m,z;if(B.preventDefault(),r(),c=S(),c){const{isroot:$}=c,E=n($,h($));E&&T.value&&((z=(m=T.value)==null?void 0:m.view)==null||z.e_panel.appendChild(E)),o(B.clientX,B.clientY)}}function O(B){const{nodeId:m,nodeData:{isRoot:z,font:$,color:E,text:X,height:J,width:ie,background:se}}=B;s(m,X),j(m,$.size,$.weight,$.style),k(m,E.background,$.color),I(m,se.image,se.width,se.height),e(x(m),ie,J,E.line)}return ce(()=>_e.isExportImage,B=>{B&&(t(),_e.isExportImage=!1)}),ce(()=>_e.isExportFreemind,B=>{B&&(i(),_e.isExportFreemind=!1)}),(B,m)=>(te(),ue("div",Ot,[C("div",{id:"x-mind-editor",class:"x-mind-editor",onClick:Oe(M,["left","prevent"]),onContextmenu:Oe(R,["right","prevent"])},null,40,Ht),F(Ft,{visible:_.visible,"onUpdate:visible":m[0]||(m[0]=z=>_.visible=z),"node-id":_.nodeId,"node-data":_.nodeData,onSave:O},null,8,["visible","node-id","node-data"])]))}});const Xt=Me(Vt,[["__scopeId","data-v-e2b387b2"]]),Gt={class:"setting-item"},qt={class:"setting-item_label"},Yt={class:"setting-item"},Jt={class:"setting-item_label"},Kt={class:"setting-item"},Zt={class:"setting-item_label"},Qt={class:"setting-item"},ei={class:"setting-item_label"},ti={class:"setting-item"},ii={class:"setting-item_label"},ni={class:"setting-item"},oi={class:"setting-item_label"},si={class:"setting-item"},ai={class:"setting-item_label"},ri={class:"setting-item"},li={class:"setting-item_label"},di={class:"tw-text-right"},hi={name:"MindSettingDrawer"},_i=he({...hi,props:{isGlobal:{type:Boolean},visible:{type:Boolean}},emits:["update:visible"],setup(g,{emit:U}){const f=g,D=be("contentIdentity"),_=be("saveConfig"),y=Ge({get:()=>f.visible,set:a=>U("update:visible",a)}),w=de({theme:H.config.theme,mode:H.config.mode,engine:H.config.view.engine,view:{line:{weight:H.config.view.line_width,color:H.config.view.line_color||""},node:{hSpace:H.config.layout.hspace,vSpace:H.config.layout.vspace},text:H.config.view.node_overflow}});ce(()=>f.visible,a=>{if(a){let l;f.isGlobal?l=H.config:l=H.item[D.value].content.config,w.theme=l.theme,w.mode=l.mode,w.engine=l.view.engine,w.view.line.weight=l.view.line_width,w.view.line.color=l.view.line_color||"",w.view.node.hSpace=l.layout.hspace,w.view.node.vSpace=l.layout.vspace,w.view.text=l.view.node_overflow}},{immediate:!0});const T=[{label:b("mind.setting.theme.white"),value:G.Default},{label:b("mind.setting.theme.lightGrey"),value:G.Clouds},{label:b("mind.setting.theme.darkGrey"),value:G.Asbestos},{label:b("mind.setting.theme.lightBlue"),value:G.Info},{label:b("mind.setting.theme.blue"),value:G.BelizeHole},{label:b("mind.setting.theme.darkBlue"),value:G.Primary},{label:b("mind.setting.theme.lightYellow"),value:G.Warning},{label:b("mind.setting.theme.yellow"),value:G.Orange},{label:b("mind.setting.theme.darkYellow"),value:G.Pumpkin},{label:b("mind.setting.theme.lightRed"),value:G.Pomegranate},{label:b("mind.setting.theme.red"),value:G.Danger},{label:b("mind.setting.theme.lightGreen"),value:G.Nephrite},{label:b("mind.setting.theme.green"),value:G.Success},{label:b("mind.setting.theme.cyan"),value:G.GreenSea},{label:b("mind.setting.theme.asphalt"),value:G.Asphalt},{label:b("mind.setting.theme.purple"),value:G.Wisteria}],v=[{label:b("mind.setting.nodeText.wrap"),value:Ee.Wrap},{label:b("mind.setting.nodeText.hidden"),value:Ee.Hidden}],x=[{label:b("mind.setting.engine.canvas"),value:Te.Canvas},{label:b("mind.setting.engine.svg"),value:Te.Svg}],S=[{label:b("mind.setting.mode.full"),value:De.Full},{label:b("mind.setting.mode.side"),value:De.Side}];function d(){if(f.isGlobal)H.config={theme:w.theme,mode:w.mode,layout:{hspace:w.view.node.hSpace,vspace:w.view.node.vSpace},view:{engine:w.engine,line_width:w.view.line.weight,line_color:w.view.line.color,node_overflow:w.view.text}},_().then(()=>{ze(Ne.Success,b("mind.setting.notice.saveOk")),y.value=!1}).catch(a=>{console.log("saveConfigCallback",a),ze(Ne.Error,b("notice.saveErr"))});else{const a=H.item[D.value].content.config;a.theme=w.theme,a.mode=w.mode,a.view.engine=w.engine,a.view.line_color=w.view.line.color,a.view.line_width=w.view.line.weight,a.view.node_overflow=w.view.text,a.layout.hspace=w.view.node.hSpace,a.layout.vspace=w.view.node.vSpace,ze(Ne.Success,b("notice.saveOk")),y.value=!1}}return(a,l)=>(te(),ve(Ye,{title:A(b)(a.isGlobal?"mind.setting.global":"mind.setting.document"),visible:y.value,"onUpdate:visible":l[8]||(l[8]=u=>y.value=u)},{footer:K(()=>[C("div",di,[F(Ae,{onClick:d,type:"primary",name:A(b)("tags.save")},null,8,["name"])])]),default:K(()=>[C("div",null,[C("div",Gt,[C("div",qt,q(A(b)("mind.setting.engine.label")),1),C("div",null,[F(Pe,{options:x,value:w.engine,"onUpdate:value":l[0]||(l[0]=u=>w.engine=u)},null,8,["value"])])]),C("div",Yt,[C("div",Jt,q(A(b)("mind.setting.mode.label")),1),C("div",null,[F(Pe,{options:S,value:w.mode,"onUpdate:value":l[1]||(l[1]=u=>w.mode=u)},null,8,["value"])])]),C("div",Kt,[C("div",Zt,q(A(b)("mind.setting.theme.label")),1),C("div",null,[F(Le,{options:T,select:w.theme,"onUpdate:select":l[2]||(l[2]=u=>w.theme=u)},null,8,["select"])])]),C("div",Qt,[C("div",ei,q(A(b)("mind.setting.lineColor")),1),C("div",null,[F(Se,{color:w.view.line.color,"onUpdate:color":l[3]||(l[3]=u=>w.view.line.color=u),"is-use-confirm":!0},null,8,["color"])])]),C("div",ti,[C("div",ii,q(A(b)("mind.setting.lineWeight")),1),C("div",null,[F(je,{value:w.view.line.weight,"onUpdate:value":l[4]||(l[4]=u=>w.view.line.weight=u),min:1,max:10},{addonAfter:K(()=>[ke("px")]),_:1},8,["value"])])]),C("div",ni,[C("div",oi,q(A(b)("mind.setting.nodeHSpace")),1),C("div",null,[F(je,{value:w.view.node.hSpace,"onUpdate:value":l[5]||(l[5]=u=>w.view.node.hSpace=u),min:10,max:100},{addonAfter:K(()=>[ke("px")]),_:1},8,["value"])])]),C("div",si,[C("div",ai,q(A(b)("mind.setting.nodeVSpace")),1),C("div",null,[F(je,{value:w.view.node.vSpace,"onUpdate:value":l[6]||(l[6]=u=>w.view.node.vSpace=u),min:5,max:100},{addonAfter:K(()=>[ke("px")]),_:1},8,["value"])])]),C("div",ri,[C("div",li,q(A(b)("mind.setting.nodeText.label")),1),C("div",null,[F(Pe,{options:v,value:w.view.text,"onUpdate:value":l[7]||(l[7]=u=>w.view.text=u)},null,8,["value"])])])])]),_:1},8,["title","visible"]))}});const ci=Me(_i,[["__scopeId","data-v-f5a61870"]]);var me=(g=>(g.Global="global",g.Document="document",g))(me||{});const ui={class:"tw-mr-1"},fi={name:"MindSetting"},pi=he({...fi,setup(g){const U=de({visible:!1,position:me.Global}),f=[{label:b("mind.setting.global"),value:me.Global},{label:b("mind.setting.document"),value:me.Document}];function D(_){U.visible=!0,U.position=_}return(_,y)=>(te(),ue("span",null,[F(qe,{data:f,onSelected:D},{anchor:K(()=>[F(Ae,null,{default:K(()=>[C("div",null,[C("span",ui,q(A(b)("mind.setting.label")),1),F(Je,{type:A(Ke).DownOutlined,size:"xs"},null,8,["type"])])]),_:1})]),_:1}),F(ci,{"is-global":U.position===A(me).Global,visible:U.visible,"onUpdate:visible":y[0]||(y[0]=w=>U.visible=w)},null,8,["is-global","visible"])]))}});var we=(g=>(g.Image="image",g.Freemind="freemind",g))(we||{});const vi={class:"tw-mr-1"},gi={name:"MindExport"},mi=he({...gi,setup(g){const U=[{label:b("mind.export.picture"),value:we.Image},{label:b("mind.export.freemind"),value:we.Freemind}];function f(D){switch(D){case we.Image:_e.isExportImage=!0;break;case we.Freemind:_e.isExportFreemind=!0;break}}return(D,_)=>(te(),ve(qe,{data:U,onSelected:f},{anchor:K(()=>[F(Ae,null,{default:K(()=>[C("div",null,[C("span",vi,q(A(b)("tags.export")),1),F(Je,{type:A(Ke).DownOutlined,size:"xs"},null,8,["type"])])]),_:1})]),_:1}))}}),wi={class:"warp_bigger mind_area"},bi={key:0,class:"show_area"},yi={class:"tw-flex tw-justify-end tw-items-center"},xi={key:0},ki={class:"tw-ml-2"},Ci={class:"tw-ml-2"},ji={class:"tw-ml-2"},Si={name:"ModuleMind"},zi=he({...Si,setup(g){const U=be("storeIDB"),{curIsSaved:f,curContentIdentity:D,curContentName:_,curContentFolderIdentity:y,curFolders:w,curHistoryFolders:T,addFolder:v,renameFolder:x,deleteFolder:S,sortFolder:d,createContent:a,saveContent:l,showContent:u,renameContent:P,copyContent:L,deleteContent:W,autoSaveContent:Y,importContent:Q,getContent:ee,saveFolder:Z,saveContentItem:oe,saveConfig:N}=ft(U,gt,H,()=>mt(),!1,!0);V("contentIsSaved",f),V("contentFolderIdentity",y),V("contentIdentity",D),V("contentName",_),V("historyFolders",T),V("folders",w),V("addFolder",v),V("renameFolder",x),V("deleteFolder",S),V("showContent",u),V("copyContent",L),V("renameContent",P),V("deleteContent",W),V("sortFolder",d),V("saveContent",l),V("autoSaveContent",Y),V("getContent",ee),V("saveFolder",Z),V("saveContentItem",oe),V("saveConfig",N);function k(){a()}function j(s){ne.loading=!0;const{name:e,content:t,isSave:i,folderIdentity:n}=s;Q(e,t,i,n,xe).then(()=>{ne.loading=!1}).catch(()=>{ne.loading=!1})}const I=Xe("");return ce(()=>{var s,e,t;return(t=(e=(s=H.item)==null?void 0:s[D.value])==null?void 0:e.content)==null?void 0:t.config},()=>{I.value=$e()},{deep:!0}),(s,e)=>(te(),ue("div",wi,[F(ut,{collapse:A(ne).historyDrawer.collapse,"onUpdate:collapse":e[2]||(e[2]=t=>A(ne).historyDrawer.collapse=t),history:A(ne).historyDrawer,suffix:A(xe)},{default:K(()=>[A(D)?(te(),ue("div",bi,[F(lt,{title:A(b)(`module.${A(ne).module}`),contentName:A(_),"onUpdate:contentName":e[1]||(e[1]=t=>st(_)?_.value=t:null),"is-has-name":!0},{titleRight:K(()=>[C("div",yi,[A(D)?(te(),ue("span",xi,[F(dt,{"store-item-data":A(H).item[A(D)]},null,8,["store-item-data"])])):Ce("",!0),C("span",ki,[F(ht,{"support-types":["text/plain"],accept:[A(xe)],"store-item-data":A(H).item[A(D)],suffix:A(xe),onSelect:k,onContent:j},null,8,["accept","store-item-data","suffix"])]),C("span",Ci,[F(pi)]),C("span",ji,[F(mi)]),F(_t,at({class:"tw-ml-2"},s.$attrs),null,16),A(ne).historyDrawer.collapse?(te(),ve(ct,{key:1,class:"tw-ml-2",visible:A(ne).historyDrawer.visible,"onUpdate:visible":e[0]||(e[0]=t=>A(ne).historyDrawer.visible=t)},null,8,["visible"])):Ce("",!0)])]),default:K(()=>[(te(),ve(Xt,{key:`${A(D)}_${I.value}`}))]),_:1},8,["title","contentName"])])):Ce("",!0)]),_:1},8,["collapse","history","suffix"])]))}});const Ni=Me(zi,[["__scopeId","data-v-a1222c9d"]]),pn=he({__name:"Mind",setup(g){return(U,f)=>(te(),ve(Ni))}});export{pn as default};
