import{aG as $,d as Z,P as D,s as A,K as ee,B as ne,I as te,aH as z,D as oe,G as re,a as ie,aI as ae,j as ue,H as se,b as k,E as H,aJ as ce,ah as _,g as le}from"./index.f845ce86.js";import{P as fe}from"./DTooltip.62c08d25.js";import{_ as de,a as me,w as F}from"./Interface.f196cb1a.js";import{E as G,g as K,c as ve,r as X,a as Y}from"./routeLib.f9bd26de.js";import{f as pe}from"./findIndex.6579a158.js";var B;function J(m){if(typeof document>"u")return 0;if(m||B===void 0){var e=document.createElement("div");e.style.width="100%",e.style.height="200px";var i=document.createElement("div"),t=i.style;t.position="absolute",t.top="0",t.left="0",t.pointerEvents="none",t.visibility="hidden",t.width="200px",t.height="150px",t.overflow="hidden",i.appendChild(e),document.body.appendChild(i);var o=e.offsetWidth;i.style.overflow="scroll";var a=e.offsetWidth;o===a&&(a=i.clientWidth),document.body.removeChild(i),B=o-a}return B}function S(m){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=e.element,t=i===void 0?document.body:i,o={},a=Object.keys(m);return a.forEach(function(f){o[f]=t.style[f]}),a.forEach(function(f){t.style[f]=m[f]}),o}function ge(){return document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&window.innerWidth>document.body.offsetWidth}var O={};const q=function(m){if(!(!ge()&&!m)){var e="ant-scrolling-effect",i=new RegExp("".concat(e),"g"),t=document.body.className;if(m){if(!i.test(t))return;S(O),O={},document.body.className=t.replace(i,"").trim();return}var o=J();if(o&&(O=S({position:"relative",width:"calc(100% - ".concat(o,"px)")}),!i.test(t))){var a="".concat(t," ").concat(e);document.body.className=a.trim()}}};var C=[],Q="ant-scrolling-effect",j=new RegExp("".concat(Q),"g"),he=0,V=new Map,Ce=de(function m(e){var i=this;me(this,m),this.getContainer=function(){var t;return(t=i.options)===null||t===void 0?void 0:t.container},this.reLock=function(t){var o=C.find(function(a){var f=a.target;return f===i.lockTarget});o&&i.unLock(),i.options=t,o&&(o.options=t,i.lock())},this.lock=function(){var t;if(!C.some(function(l){var c=l.target;return c===i.lockTarget})){if(C.some(function(l){var c=l.options,h;return(c==null?void 0:c.container)===((h=i.options)===null||h===void 0?void 0:h.container)})){C=[].concat($(C),[{target:i.lockTarget,options:i.options}]);return}var o=0,a=((t=i.options)===null||t===void 0?void 0:t.container)||document.body;(a===document.body&&window.innerWidth-document.documentElement.clientWidth>0||a.scrollHeight>a.clientHeight)&&(o=J());var f=a.className;if(C.filter(function(l){var c=l.options,h;return(c==null?void 0:c.container)===((h=i.options)===null||h===void 0?void 0:h.container)}).length===0&&V.set(a,S({width:o!==0?"calc(100% - ".concat(o,"px)"):void 0,overflow:"hidden",overflowX:"hidden",overflowY:"hidden"},{element:a})),!j.test(f)){var g="".concat(f," ").concat(Q);a.className=g.trim()}C=[].concat($(C),[{target:i.lockTarget,options:i.options}])}},this.unLock=function(){var t,o=C.find(function(g){var l=g.target;return l===i.lockTarget});if(C=C.filter(function(g){var l=g.target;return l!==i.lockTarget}),!(!o||C.some(function(g){var l=g.options,c;return(l==null?void 0:l.container)===((c=o.options)===null||c===void 0?void 0:c.container)}))){var a=((t=i.options)===null||t===void 0?void 0:t.container)||document.body,f=a.className;!j.test(f)||(S(V.get(a),{element:a}),V.delete(a),a.className=a.className.replace(j,"").trim())}},this.lockTarget=he++,this.options=e}),w=0,T=ae(),R={},N=function(e){if(!T)return null;if(e){if(typeof e=="string")return document.querySelectorAll(e)[0];if(typeof e=="function")return e();if(ue(e)==="object"&&e instanceof window.HTMLElement)return e}return document.body};const Ne=Z({name:"PortalWrapper",inheritAttrs:!1,props:{wrapperClassName:String,forceRender:{type:Boolean,default:void 0},getContainer:D.any,visible:{type:Boolean,default:void 0}},setup:function(e,i){var t=i.slots,o=A(),a=A(),f=A(),g=new Ce({container:N(e.getContainer)}),l=function(){var d,p;(p=(d=o.value)===null||d===void 0?void 0:d.parentNode)===null||p===void 0||p.removeChild(o.value)},c=function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(d||o.value&&!o.value.parentNode){var p=N(e.getContainer);return p?(p.appendChild(o.value),!0):!1}return!0},h=function(){return T?(o.value||(o.value=document.createElement("div"),c(!0)),L(),o.value):null},L=function(){var d=e.wrapperClassName;o.value&&d&&d!==o.value.className&&(o.value.className=d)};ee(function(){L(),c()});var I=function(){w===1&&!Object.keys(R).length?(q(),R=S({overflow:"hidden",overflowX:"hidden",overflowY:"hidden"})):w||(S(R),R={},q(!0))},U=se();return ne(function(){var v=!1;te([function(){return e.visible},function(){return e.getContainer}],function(d,p){var E=z(d,2),r=E[0],u=E[1],s=z(p,2),n=s[0],y=s[1];if(T&&N(e.getContainer)===document.body&&(r&&!n?w+=1:v&&(w-=1)),v){var M=typeof u=="function"&&typeof y=="function";(M?u.toString()!==y.toString():u!==y)&&l(),r&&r!==n&&T&&N(u)!==g.getContainer()&&g.reLock({container:N(u)})}v=!0},{immediate:!0,flush:"post"}),oe(function(){c()||(f.value=F(function(){U.update()}))})}),re(function(){var v=e.visible,d=e.getContainer;T&&N(d)===document.body&&(w=v&&w?w-1:w),l(),F.cancel(f.value)}),function(){var v=e.forceRender,d=e.visible,p=null,E={getOpenCount:function(){return w},getContainer:h,switchScrollingEffect:I,scrollLocker:g};return(v||d||a.value)&&(p=ie(fe,{getContainer:h,ref:a},{default:function(){var u;return(u=t.default)===null||u===void 0?void 0:u.call(t,E)}})),p}}});function Se(m,e){function i(r){e.theme=r}function t(r){e.autoSave=r}const o=k(()=>e.module);function a(r){e.module=r}const f=k(()=>e.historyDrawer.collapse);function g(r){e.historyDrawer.collapse=r}const l=k(()=>e.menuDrawer.collapse);function c(r){e.menuDrawer.collapse=r}const h=k(()=>e.menuDrawer.visible);function L(r){e.menuDrawer.visible=r}function I(){const r=[],u=K(),s=[];return _(e.menus,n=>{const{module:y,label:M,isUse:W,customLabel:P}=n;s.push(n.module);const x=pe(u,b=>b.value===y);if(x>-1){const b={...u[x],isUse:W};b.label=P||M||le(`module.${y}`)||"",r.push(b)}}),s.length<u.length&&_(u,n=>{s.includes(n.value)||r.push({...n,isUse:!1})}),r}const U=k(()=>{const r=I();let u=!1,s=!1;return o.value===H.Setting?(u=!0,s=!0):_(r,n=>{const{isUse:y,value:M}=n;y&&(s=!0,o.value===M&&(u=!0))}),s?u||X(Y.Push,{name:"notfound",params:{module:String(o.value)}}):X(Y.Replace,{name:"notfound"}),r});function v(r){e.menus=[...r]}function d(){return new Promise((r,u)=>{m.getStorageData(G.Common).then(s=>{if(s){const{value:n}=s;e.menuDrawer.collapse=!!(n!=null&&n.menu),e.menuDrawer.cooperate=n!=null&&n.menuIconCooperate?{...n.menuIconCooperate}:{x:0,y:50},e.historyDrawer.collapse=!!(n!=null&&n.history),e.module=(n==null?void 0:n.module)||H.Format,e.autoSave=n!=null&&n.autoSave?{...n.autoSave}:{isAuto:!1,saveTime:10},e.theme=n!=null&&n.theme?{...n.theme}:{current:ce.Light},e.group=n!=null&&n.group?{...n.group}:{current:""},e.menus=n!=null&&n.menus?[...n.menus]:p(),r(e.module)}else e.menus=p(),r(H.Format)}).catch(s=>{console.log("getStoreCommon",s),r(H.Format)})})}function p(){const r=[],u=K();return _(u,s=>{r.push({module:s.value,label:s.label,isUse:!0})}),r}function E(){const{menuDrawer:r,historyDrawer:u,module:s,autoSave:n,theme:y,group:M,menus:W}=e,P=[];_(W,b=>{P.push({module:b.module,isUse:b.isUse,customLabel:b.customLabel})});const x={key:G.Common,type:ve.Config,value:{menu:r.collapse,menuIconCooperate:{...r.cooperate},history:u.collapse,module:s,autoSave:{...n},theme:{...y},group:{...M},menus:P}};m.saveStorage(x)}return{curModule:o,setModule:a,curMenuCollapse:l,curMenuVisible:h,setMenuVisible:L,setMenuCollapse:c,curHistoryCollapse:f,setHistoryCollapse:g,curMenus:U,setMenus:v,getStoreCommon:d,setStoreCommon:E,setTheme:i,setAutoSave:t}}export{Ne as P,J as g,Se as u};
